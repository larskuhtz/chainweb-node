<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">-- | Content-addressable stores.</span><span>
</span><span id="line-2"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Chainweb.Store.CAS</span><span>
</span><span id="line-3"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Chainweb.Store.CAS.html#DB"><span class="hs-identifier">DB</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-4"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.Store.CAS.html#PayloadConfig"><span class="hs-identifier">PayloadConfig</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-5"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-6"></span><span>
</span><span id="line-7"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-8"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Vector</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Vector</span></span><span class="hs-special">)</span><span>
</span><span id="line-9"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Chainweb.BlockHeader.html"><span class="hs-identifier">Chainweb.BlockHeader</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.Payload.html#BlockPayloadHash"><span class="hs-identifier">BlockPayloadHash</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Chainweb.Utils.html"><span class="hs-identifier">Chainweb.Utils</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.Utils.html#Codec"><span class="hs-identifier">Codec</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-12"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-13"></span><span>
</span><span id="line-14"></span><span class="hs-comment">-- | 'PayloadConfig' tells the CAS store how to interpret payloads.</span><span>
</span><span id="line-15"></span><span class="hs-keyword">data</span><span> </span><span id="PayloadConfig"><span class="annot"><a href="Chainweb.Store.CAS.html#PayloadConfig"><span class="hs-identifier hs-var">PayloadConfig</span></a></span></span><span> </span><span id="local-6989586621681481534"><span class="annot"><a href="#local-6989586621681481534"><span class="hs-identifier hs-type">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="PayloadConfig"><span class="annot"><a href="Chainweb.Store.CAS.html#PayloadConfig"><span class="hs-identifier hs-var">PayloadConfig</span></a></span></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-16"></span><span>    </span><span id="payloadCodec"><span class="annot"><span class="annottext">PayloadConfig t -&gt; Codec t
</span><a href="Chainweb.Store.CAS.html#payloadCodec"><span class="hs-identifier hs-var hs-var">payloadCodec</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.Utils.html#Codec"><span class="hs-identifier hs-type">Codec</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681481534"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span>    </span><span class="hs-comment">-- ^ codec for the payload.</span><span>
</span><span id="line-17"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="payloadHash"><span class="annot"><span class="annottext">PayloadConfig t -&gt; t -&gt; BlockPayloadHash
</span><a href="Chainweb.Store.CAS.html#payloadHash"><span class="hs-identifier hs-var hs-var">payloadHash</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621681481534"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Chainweb.Payload.html#BlockPayloadHash"><span class="hs-identifier hs-type">BlockPayloadHash</span></a></span><span>         </span><span class="hs-comment">-- ^ hash function for the payload.</span><span>
</span><span id="line-18"></span><span class="hs-special">}</span><span>
</span><span id="line-19"></span><span>
</span><span id="line-20"></span><span class="hs-comment">-- | The content-addressable store DB api.</span><span>
</span><span id="line-21"></span><span class="hs-keyword">data</span><span> </span><span id="DB"><span class="annot"><a href="Chainweb.Store.CAS.html#DB"><span class="hs-identifier hs-var">DB</span></a></span></span><span> </span><span id="local-6989586621681481530"><span class="annot"><a href="#local-6989586621681481530"><span class="hs-identifier hs-type">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="DB"><span class="annot"><a href="Chainweb.Store.CAS.html#DB"><span class="hs-identifier hs-var">DB</span></a></span></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-22"></span><span>    </span><span id="casDbConfig"><span class="annot"><span class="annottext">DB t -&gt; PayloadConfig t
</span><a href="Chainweb.Store.CAS.html#casDbConfig"><span class="hs-identifier hs-var hs-var">casDbConfig</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Chainweb.Store.CAS.html#PayloadConfig"><span class="hs-identifier hs-type">PayloadConfig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681481530"><span class="hs-identifier hs-type">t</span></a></span><span>
</span><span id="line-23"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="casLookup"><span class="annot"><span class="annottext">DB t -&gt; Vector BlockPayloadHash -&gt; IO (Vector (Maybe t))
</span><a href="Chainweb.Store.CAS.html#casLookup"><span class="hs-identifier hs-var hs-var">casLookup</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="annot"><a href="Chainweb.Payload.html#BlockPayloadHash"><span class="hs-identifier hs-type">BlockPayloadHash</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621681481530"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="casInsert"><span class="annot"><span class="annottext">DB t -&gt; Vector t -&gt; IO ()
</span><a href="Chainweb.Store.CAS.html#casInsert"><span class="hs-identifier hs-var hs-var">casInsert</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="annot"><a href="#local-6989586621681481530"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="casDelete"><span class="annot"><span class="annottext">DB t -&gt; Vector BlockPayloadHash -&gt; IO ()
</span><a href="Chainweb.Store.CAS.html#casDelete"><span class="hs-identifier hs-var hs-var">casDelete</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="annot"><a href="Chainweb.Payload.html#BlockPayloadHash"><span class="hs-identifier hs-type">BlockPayloadHash</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span class="hs-special">}</span><span>
</span><span id="line-27"></span></pre></body></html>