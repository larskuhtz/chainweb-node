<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE AllowAmbiguousTypes #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE DeriveGeneric #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE FlexibleInstances #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE GADTs #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE PatternSynonyms #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE RankNTypes #-}</span><span>
</span><span id="line-10"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-11"></span><span class="hs-pragma">{-# LANGUAGE TypeApplications #-}</span><span>
</span><span id="line-12"></span><span class="hs-pragma">{-# LANGUAGE UndecidableInstances #-}</span><span>
</span><span id="line-13"></span><span>
</span><span id="line-14"></span><span class="hs-pragma">{-# OPTIONS_GHC -Wno-orphans #-}</span><span>
</span><span id="line-15"></span><span>
</span><span id="line-16"></span><span class="hs-comment">-- |</span><span>
</span><span id="line-17"></span><span class="hs-comment">-- Module: Chainweb.Cut.Test</span><span>
</span><span id="line-18"></span><span class="hs-comment">-- Copyright: Copyright &#169; 2019 Kadena LLC.</span><span>
</span><span id="line-19"></span><span class="hs-comment">-- License: MIT</span><span>
</span><span id="line-20"></span><span class="hs-comment">-- Maintainer: Lars Kuhtz &lt;lars@kadena.io&gt;</span><span>
</span><span id="line-21"></span><span class="hs-comment">-- Stability: experimental</span><span>
</span><span id="line-22"></span><span class="hs-comment">--</span><span>
</span><span id="line-23"></span><span class="hs-comment">-- TODO</span><span>
</span><span id="line-24"></span><span class="hs-comment">--</span><span>
</span><span id="line-25"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Chainweb.Cut.Test</span><span>
</span><span id="line-26"></span><span class="hs-special">(</span><span>
</span><span id="line-27"></span><span class="annot"><span class="hs-comment">-- * Testing</span></span><span>
</span><span id="line-28"></span><span>
</span><span id="line-29"></span><span>  </span><span class="annot"><a href="Chainweb.Cut.Test.html#MineFailure"><span class="hs-identifier">MineFailure</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-30"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.Cut.Test.html#testMine"><span class="hs-identifier">testMine</span></a></span><span>
</span><span id="line-31"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.Cut.Test.html#testMineWithPayloadHash"><span class="hs-identifier">testMineWithPayloadHash</span></a></span><span>
</span><span id="line-32"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.Cut.Test.html#createNewCut"><span class="hs-identifier">createNewCut</span></a></span><span>
</span><span id="line-33"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.Version.html#randomChainId"><span class="hs-identifier">randomChainId</span></a></span><span>
</span><span id="line-34"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.Cut.Test.html#arbitraryChainGraphChainId"><span class="hs-identifier">arbitraryChainGraphChainId</span></a></span><span>
</span><span id="line-35"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.Cut.Test.html#giveNewWebChain"><span class="hs-identifier">giveNewWebChain</span></a></span><span>
</span><span id="line-36"></span><span>
</span><span id="line-37"></span><span class="annot"><span class="hs-comment">-- ** properties</span></span><span>
</span><span id="line-38"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.Cut.Test.html#prop_cutBraiding"><span class="hs-identifier">prop_cutBraiding</span></a></span><span>
</span><span id="line-39"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.Cut.Test.html#prop_cutBraidingGenesis"><span class="hs-identifier">prop_cutBraidingGenesis</span></a></span><span>
</span><span id="line-40"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.Cut.Test.html#prop_joinBase"><span class="hs-identifier">prop_joinBase</span></a></span><span>
</span><span id="line-41"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.Cut.Test.html#prop_joinBaseMeet"><span class="hs-identifier">prop_joinBaseMeet</span></a></span><span>
</span><span id="line-42"></span><span>
</span><span id="line-43"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.Cut.Test.html#properties_lattice"><span class="hs-identifier">properties_lattice</span></a></span><span>
</span><span id="line-44"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.Cut.Test.html#properties_lattice_passing"><span class="hs-identifier">properties_lattice_passing</span></a></span><span>
</span><span id="line-45"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.Cut.Test.html#properties_cut"><span class="hs-identifier">properties_cut</span></a></span><span>
</span><span id="line-46"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.Cut.Test.html#properties_testMining"><span class="hs-identifier">properties_testMining</span></a></span><span>
</span><span id="line-47"></span><span>
</span><span id="line-48"></span><span class="annot"><span class="hs-comment">-- ** all passing properties</span></span><span>
</span><span id="line-49"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.Cut.Test.html#properties"><span class="hs-identifier">properties</span></a></span><span>
</span><span id="line-50"></span><span>
</span><span id="line-51"></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-52"></span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Error.Util</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">hush</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">note</span></span><span class="hs-special">)</span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Exception</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">catch</span></span><span class="hs-special">)</span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Lens</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">(:&gt;)</span></span><span class="hs-special">)</span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">join</span></span><span class="hs-special">)</span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.IO.Class</span></span><span>
</span><span id="line-58"></span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Bifunctor</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">first</span></span><span class="hs-special">)</span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Foldable</span></span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Function</span></span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.HashMap.Strict</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HM</span></span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Monoid</span></span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Ord</span></span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Reflection</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">int</span></span><span class="hs-special">)</span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Tuple.Strict</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">T2</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-67"></span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Generics</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Generic</span></span><span class="hs-special">)</span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Stack</span></span><span>
</span><span id="line-70"></span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Prelude</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">lookup</span></span><span class="hs-special">)</span><span>
</span><span id="line-72"></span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">QuickCheck.GenT</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TT</span></span><span>
</span><span id="line-74"></span><span>
</span><span id="line-75"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Streaming.Prelude</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">S</span></span><span>
</span><span id="line-76"></span><span>
</span><span id="line-77"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Test.QuickCheck</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-78"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Test.QuickCheck.Monadic</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-79"></span><span>
</span><span id="line-80"></span><span class="hs-comment">-- internal modules</span><span>
</span><span id="line-81"></span><span>
</span><span id="line-82"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Chainweb.BlockHash.html"><span class="hs-identifier">Chainweb.BlockHash</span></a></span><span>
</span><span id="line-83"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Chainweb.BlockHeader.html"><span class="hs-identifier">Chainweb.BlockHeader</span></a></span><span>
</span><span id="line-84"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Chainweb.ChainId.html"><span class="hs-identifier">Chainweb.ChainId</span></a></span><span>
</span><span id="line-85"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Chainweb.Cut.html"><span class="hs-identifier">Chainweb.Cut</span></a></span><span>
</span><span id="line-86"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Chainweb.Difficulty.html"><span class="hs-identifier">Chainweb.Difficulty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.Difficulty.html#checkTarget"><span class="hs-identifier">checkTarget</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-87"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Chainweb.Graph.html"><span class="hs-identifier">Chainweb.Graph</span></a></span><span>
</span><span id="line-88"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Chainweb.Time.html"><span class="hs-identifier">Chainweb.Time</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.Time.html#Micros"><span class="hs-identifier">Micros</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.Time.html#Time"><span class="hs-identifier">Time</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.Time.html#getCurrentTimeIntegral"><span class="hs-identifier">getCurrentTimeIntegral</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.Time.html#second"><span class="hs-identifier">second</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-89"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Chainweb.Utils.html"><span class="hs-identifier">Chainweb.Utils</span></a></span><span>
</span><span id="line-90"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Chainweb.Version.html"><span class="hs-identifier">Chainweb.Version</span></a></span><span>
</span><span id="line-91"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Chainweb.WebBlockHeaderDB.html"><span class="hs-identifier">Chainweb.WebBlockHeaderDB</span></a></span><span>
</span><span id="line-92"></span><span>
</span><span id="line-93"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.CAS.RocksDB</span></span><span>
</span><span id="line-94"></span><span>
</span><span id="line-95"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Numeric.AffineSpace.html"><span class="hs-identifier">Numeric.AffineSpace</span></a></span><span>
</span><span id="line-96"></span><span>
</span><span id="line-97"></span><span class="hs-comment">-- -------------------------------------------------------------------------- --</span><span>
</span><span id="line-98"></span><span class="hs-comment">-- Test Mining</span><span>
</span><span id="line-99"></span><span>
</span><span id="line-100"></span><span class="hs-keyword">data</span><span> </span><span id="MineFailure"><span class="annot"><a href="Chainweb.Cut.Test.html#MineFailure"><span class="hs-identifier hs-var">MineFailure</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="BadNonce"><span class="annot"><a href="Chainweb.Cut.Test.html#BadNonce"><span class="hs-identifier hs-var">BadNonce</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="BadAdjacents"><span class="annot"><a href="Chainweb.Cut.Test.html#BadAdjacents"><span class="hs-identifier hs-var">BadAdjacents</span></a></span></span><span>
</span><span id="line-101"></span><span>
</span><span id="line-102"></span><span class="hs-comment">-- Try to mine a new block header on the given chain for the given cut.</span><span>
</span><span id="line-103"></span><span class="hs-comment">-- Returns 'Nothing' if mining isn't possible because of missing adjacent</span><span>
</span><span id="line-104"></span><span class="hs-comment">-- dependencies.</span><span>
</span><span id="line-105"></span><span class="hs-comment">--</span><span>
</span><span id="line-106"></span><span class="annot"><a href="Chainweb.Cut.Test.html#testMine"><span class="hs-identifier hs-type">testMine</span></a></span><span>
</span><span id="line-107"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621681492459"><span class="annot"><a href="#local-6989586621681492459"><span class="hs-identifier hs-type">cid</span></a></span></span><span>
</span><span id="line-108"></span><span>    </span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Chainweb.ChainId.html#HasChainId"><span class="hs-identifier hs-type">HasChainId</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681492459"><span class="hs-identifier hs-type">cid</span></a></span><span>
</span><span id="line-109"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Given</span></span><span> </span><span class="annot"><a href="Chainweb.WebBlockHeaderDB.Types.html#WebBlockHeaderDb"><span class="hs-identifier hs-type">WebBlockHeaderDb</span></a></span><span>
</span><span id="line-110"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Chainweb.BlockHeader.html#Nonce"><span class="hs-identifier hs-type">Nonce</span></a></span><span>
</span><span id="line-111"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Chainweb.Time.html#Time"><span class="hs-identifier hs-type">Time</span></a></span><span> </span><span class="annot"><a href="Chainweb.Time.html#Micros"><span class="hs-identifier hs-type">Micros</span></a></span><span>
</span><span id="line-112"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Chainweb.Payload.html#BlockPayloadHash"><span class="hs-identifier hs-type">BlockPayloadHash</span></a></span><span>
</span><span id="line-113"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681492459"><span class="hs-identifier hs-type">cid</span></a></span><span>
</span><span id="line-114"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Chainweb.Cut.html#Cut"><span class="hs-identifier hs-type">Cut</span></a></span><span>
</span><span id="line-115"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Chainweb.Cut.Test.html#MineFailure"><span class="hs-identifier hs-type">MineFailure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">T2</span></span><span> </span><span class="annot"><a href="Chainweb.BlockHeader.html#BlockHeader"><span class="hs-identifier hs-type">BlockHeader</span></a></span><span> </span><span class="annot"><a href="Chainweb.Cut.html#Cut"><span class="hs-identifier hs-type">Cut</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-116"></span><span id="testMine"><span class="annot"><span class="annottext">testMine :: Nonce
-&gt; Time Micros
-&gt; BlockPayloadHash
-&gt; cid
-&gt; Cut
-&gt; IO (Either MineFailure (T2 BlockHeader Cut))
</span><a href="Chainweb.Cut.Test.html#testMine"><span class="hs-identifier hs-var hs-var">testMine</span></a></span></span><span> </span><span id="local-6989586621681492375"><span class="annot"><span class="annottext">n :: Nonce
</span><a href="#local-6989586621681492375"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621681492374"><span class="annot"><span class="annottext">t :: Time Micros
</span><a href="#local-6989586621681492374"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621681492373"><span class="annot"><span class="annottext">payloadHash :: BlockPayloadHash
</span><a href="#local-6989586621681492373"><span class="hs-identifier hs-var">payloadHash</span></a></span></span><span> </span><span id="local-6989586621681492372"><span class="annot"><span class="annottext">i :: cid
</span><a href="#local-6989586621681492372"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621681492371"><span class="annot"><span class="annottext">c :: Cut
</span><a href="#local-6989586621681492371"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-117"></span><span>    </span><span class="annot"><span class="annottext">Either MineFailure (T2 BlockHeader Cut)
-&gt; (T2 BlockHeader Cut -&gt; IO (T2 BlockHeader Cut))
-&gt; IO (Either MineFailure (T2 BlockHeader Cut))
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><span class="hs-identifier hs-var">forM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Nonce
-&gt; Time Micros
-&gt; BlockPayloadHash
-&gt; cid
-&gt; Cut
-&gt; Either MineFailure (T2 BlockHeader Cut)
forall cid.
(HasCallStack, HasChainId cid) =&gt;
Nonce
-&gt; Time Micros
-&gt; BlockPayloadHash
-&gt; cid
-&gt; Cut
-&gt; Either MineFailure (T2 BlockHeader Cut)
</span><a href="Chainweb.Cut.Test.html#createNewCut"><span class="hs-identifier hs-var">createNewCut</span></a></span><span> </span><span class="annot"><span class="annottext">Nonce
</span><a href="#local-6989586621681492375"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Time Micros
</span><a href="#local-6989586621681492374"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">BlockPayloadHash
</span><a href="#local-6989586621681492373"><span class="hs-identifier hs-var">payloadHash</span></a></span><span> </span><span class="annot"><span class="annottext">cid
</span><a href="#local-6989586621681492372"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492371"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((T2 BlockHeader Cut -&gt; IO (T2 BlockHeader Cut))
 -&gt; IO (Either MineFailure (T2 BlockHeader Cut)))
-&gt; (T2 BlockHeader Cut -&gt; IO (T2 BlockHeader Cut))
-&gt; IO (Either MineFailure (T2 BlockHeader Cut))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681492369"><span class="annot"><span class="annottext">p :: T2 BlockHeader Cut
</span><a href="#local-6989586621681492369"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">T2</span></span><span> </span><span id="local-6989586621681492367"><span class="annot"><span class="annottext">h :: BlockHeader
</span><a href="#local-6989586621681492367"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-118"></span><span>        </span><span class="annot"><span class="annottext">T2 BlockHeader Cut
</span><a href="#local-6989586621681492369"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">T2 BlockHeader Cut -&gt; IO () -&gt; IO (T2 BlockHeader Cut)
forall (f :: * -&gt; *) a b. Functor f =&gt; a -&gt; f b -&gt; f a
</span><span class="hs-operator hs-var">&lt;$</span></span><span> </span><span class="annot"><span class="annottext">Given WebBlockHeaderDb =&gt; BlockHeader -&gt; IO ()
BlockHeader -&gt; IO ()
</span><a href="Chainweb.WebBlockHeaderDB.html#insertWebBlockHeaderDb"><span class="hs-identifier hs-var">insertWebBlockHeaderDb</span></a></span><span> </span><span class="annot"><span class="annottext">BlockHeader
</span><a href="#local-6989586621681492367"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-119"></span><span>
</span><span id="line-120"></span><span class="annot"><a href="Chainweb.Cut.Test.html#testMineWithPayloadHash"><span class="hs-identifier hs-type">testMineWithPayloadHash</span></a></span><span>
</span><span id="line-121"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621681492364"><span class="annot"><a href="#local-6989586621681492364"><span class="hs-identifier hs-type">cid</span></a></span></span><span>
</span><span id="line-122"></span><span>    </span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Chainweb.ChainId.html#HasChainId"><span class="hs-identifier hs-type">HasChainId</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681492364"><span class="hs-identifier hs-type">cid</span></a></span><span>
</span><span id="line-123"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Chainweb.BlockHeader.html#Nonce"><span class="hs-identifier hs-type">Nonce</span></a></span><span>
</span><span id="line-124"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Chainweb.Time.html#Time"><span class="hs-identifier hs-type">Time</span></a></span><span> </span><span class="annot"><a href="Chainweb.Time.html#Micros"><span class="hs-identifier hs-type">Micros</span></a></span><span>
</span><span id="line-125"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Chainweb.Payload.html#BlockPayloadHash"><span class="hs-identifier hs-type">BlockPayloadHash</span></a></span><span>
</span><span id="line-126"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681492364"><span class="hs-identifier hs-type">cid</span></a></span><span>
</span><span id="line-127"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Chainweb.Cut.html#Cut"><span class="hs-identifier hs-type">Cut</span></a></span><span>
</span><span id="line-128"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Chainweb.Cut.Test.html#MineFailure"><span class="hs-identifier hs-type">MineFailure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">T2</span></span><span> </span><span class="annot"><a href="Chainweb.BlockHeader.html#BlockHeader"><span class="hs-identifier hs-type">BlockHeader</span></a></span><span> </span><span class="annot"><a href="Chainweb.Cut.html#Cut"><span class="hs-identifier hs-type">Cut</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-129"></span><span id="testMineWithPayloadHash"><span class="annot"><span class="annottext">testMineWithPayloadHash :: Nonce
-&gt; Time Micros
-&gt; BlockPayloadHash
-&gt; cid
-&gt; Cut
-&gt; IO (Either MineFailure (T2 BlockHeader Cut))
</span><a href="Chainweb.Cut.Test.html#testMineWithPayloadHash"><span class="hs-identifier hs-var hs-var">testMineWithPayloadHash</span></a></span></span><span> </span><span id="local-6989586621681492363"><span class="annot"><span class="annottext">n :: Nonce
</span><a href="#local-6989586621681492363"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621681492362"><span class="annot"><span class="annottext">t :: Time Micros
</span><a href="#local-6989586621681492362"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621681492361"><span class="annot"><span class="annottext">payloadHash :: BlockPayloadHash
</span><a href="#local-6989586621681492361"><span class="hs-identifier hs-var">payloadHash</span></a></span></span><span> </span><span id="local-6989586621681492360"><span class="annot"><span class="annottext">i :: cid
</span><a href="#local-6989586621681492360"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621681492359"><span class="annot"><span class="annottext">c :: Cut
</span><a href="#local-6989586621681492359"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-130"></span><span>    </span><span class="annot"><span class="annottext">Either MineFailure (T2 BlockHeader Cut)
-&gt; (T2 BlockHeader Cut -&gt; IO (T2 BlockHeader Cut))
-&gt; IO (Either MineFailure (T2 BlockHeader Cut))
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><span class="hs-identifier hs-var">forM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Nonce
-&gt; Time Micros
-&gt; BlockPayloadHash
-&gt; cid
-&gt; Cut
-&gt; Either MineFailure (T2 BlockHeader Cut)
forall cid.
(HasCallStack, HasChainId cid) =&gt;
Nonce
-&gt; Time Micros
-&gt; BlockPayloadHash
-&gt; cid
-&gt; Cut
-&gt; Either MineFailure (T2 BlockHeader Cut)
</span><a href="Chainweb.Cut.Test.html#createNewCut"><span class="hs-identifier hs-var">createNewCut</span></a></span><span> </span><span class="annot"><span class="annottext">Nonce
</span><a href="#local-6989586621681492363"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Time Micros
</span><a href="#local-6989586621681492362"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">BlockPayloadHash
</span><a href="#local-6989586621681492361"><span class="hs-identifier hs-var">payloadHash</span></a></span><span> </span><span class="annot"><span class="annottext">cid
</span><a href="#local-6989586621681492360"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492359"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">T2 BlockHeader Cut -&gt; IO (T2 BlockHeader Cut)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span>
</span><span id="line-131"></span><span>
</span><span id="line-132"></span><span class="hs-comment">-- | Create a new block. Only produces a new cut but doesn't insert it into the</span><span>
</span><span id="line-133"></span><span class="hs-comment">-- chain database.</span><span>
</span><span id="line-134"></span><span class="hs-comment">--</span><span>
</span><span id="line-135"></span><span id="local-6989586621681492595"><span class="annot"><a href="Chainweb.Cut.Test.html#createNewCut"><span class="hs-identifier hs-type">createNewCut</span></a></span><span>
</span><span id="line-136"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span>
</span><span id="line-137"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Chainweb.ChainId.html#HasChainId"><span class="hs-identifier hs-type">HasChainId</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681492595"><span class="hs-identifier hs-type">cid</span></a></span><span>
</span><span id="line-138"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Chainweb.BlockHeader.html#Nonce"><span class="hs-identifier hs-type">Nonce</span></a></span><span>
</span><span id="line-139"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Chainweb.Time.html#Time"><span class="hs-identifier hs-type">Time</span></a></span><span> </span><span class="annot"><a href="Chainweb.Time.html#Micros"><span class="hs-identifier hs-type">Micros</span></a></span><span>
</span><span id="line-140"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Chainweb.Payload.html#BlockPayloadHash"><span class="hs-identifier hs-type">BlockPayloadHash</span></a></span><span>
</span><span id="line-141"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681492595"><span class="hs-identifier hs-type">cid</span></a></span><span>
</span><span id="line-142"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Chainweb.Cut.html#Cut"><span class="hs-identifier hs-type">Cut</span></a></span><span>
</span><span id="line-143"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Chainweb.Cut.Test.html#MineFailure"><span class="hs-identifier hs-type">MineFailure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">T2</span></span><span> </span><span class="annot"><a href="Chainweb.BlockHeader.html#BlockHeader"><span class="hs-identifier hs-type">BlockHeader</span></a></span><span> </span><span class="annot"><a href="Chainweb.Cut.html#Cut"><span class="hs-identifier hs-type">Cut</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-144"></span><span id="createNewCut"><span class="annot"><span class="annottext">createNewCut :: Nonce
-&gt; Time Micros
-&gt; BlockPayloadHash
-&gt; cid
-&gt; Cut
-&gt; Either MineFailure (T2 BlockHeader Cut)
</span><a href="Chainweb.Cut.Test.html#createNewCut"><span class="hs-identifier hs-var hs-var">createNewCut</span></a></span></span><span> </span><span id="local-6989586621681492358"><span class="annot"><span class="annottext">n :: Nonce
</span><a href="#local-6989586621681492358"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621681492357"><span class="annot"><span class="annottext">t :: Time Micros
</span><a href="#local-6989586621681492357"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621681492356"><span class="annot"><span class="annottext">pay :: BlockPayloadHash
</span><a href="#local-6989586621681492356"><span class="hs-identifier hs-var">pay</span></a></span></span><span> </span><span id="local-6989586621681492355"><span class="annot"><span class="annottext">i :: cid
</span><a href="#local-6989586621681492355"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621681492354"><span class="annot"><span class="annottext">c :: Cut
</span><a href="#local-6989586621681492354"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-145"></span><span>    </span><span id="local-6989586621681492353"><span class="annot"><span class="annottext">BlockHeader
</span><a href="#local-6989586621681492353"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MineFailure -&gt; Maybe BlockHeader -&gt; Either MineFailure BlockHeader
forall a b. a -&gt; Maybe b -&gt; Either a b
</span><span class="hs-identifier hs-var">note</span></span><span> </span><span class="annot"><span class="annottext">MineFailure
</span><a href="Chainweb.Cut.Test.html#BadAdjacents"><span class="hs-identifier hs-var">BadAdjacents</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe BlockHeader -&gt; Either MineFailure BlockHeader)
-&gt; Maybe BlockHeader -&gt; Either MineFailure BlockHeader
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BlockHashRecord -&gt; BlockHeader
</span><a href="#local-6989586621681492352"><span class="hs-identifier hs-var">newHeader</span></a></span><span> </span><span class="annot"><span class="annottext">(BlockHashRecord -&gt; BlockHeader)
-&gt; (HashMap ChainId BlockHash -&gt; BlockHashRecord)
-&gt; HashMap ChainId BlockHash
-&gt; BlockHeader
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">HashMap ChainId BlockHash -&gt; BlockHashRecord
</span><a href="Chainweb.BlockHash.html#BlockHashRecord"><span class="hs-identifier hs-var">BlockHashRecord</span></a></span><span> </span><span class="annot"><span class="annottext">(HashMap ChainId BlockHash -&gt; BlockHeader)
-&gt; Maybe (HashMap ChainId BlockHash) -&gt; Maybe BlockHeader
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe (HashMap ChainId BlockHash)
</span><a href="#local-6989586621681492348"><span class="hs-identifier hs-var">newAdjHashes</span></a></span><span>
</span><span id="line-146"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; Either MineFailure () -&gt; Either MineFailure ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashTarget -&gt; PowHash -&gt; Bool
</span><a href="Chainweb.Difficulty.html#checkTarget"><span class="hs-identifier hs-var">checkTarget</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BlockHeader -&gt; HashTarget
</span><a href="Chainweb.BlockHeader.html#_blockTarget"><span class="hs-identifier hs-var hs-var">_blockTarget</span></a></span><span> </span><span class="annot"><span class="annottext">BlockHeader
</span><a href="#local-6989586621681492353"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(PowHash -&gt; Bool) -&gt; PowHash -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BlockHeader -&gt; PowHash
</span><a href="Chainweb.BlockHeader.html#_blockPow"><span class="hs-identifier hs-var">_blockPow</span></a></span><span> </span><span class="annot"><span class="annottext">BlockHeader
</span><a href="#local-6989586621681492353"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Either MineFailure () -&gt; Either MineFailure ())
-&gt; Either MineFailure () -&gt; Either MineFailure ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">MineFailure -&gt; Either MineFailure ()
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">MineFailure
</span><a href="Chainweb.Cut.Test.html#BadNonce"><span class="hs-identifier hs-var">BadNonce</span></a></span><span>
</span><span id="line-147"></span><span>    </span><span id="local-6989586621681492344"><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492344"><span class="hs-identifier hs-var">c'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(SomeException -&gt; MineFailure)
-&gt; Either SomeException Cut -&gt; Either MineFailure Cut
forall (p :: * -&gt; * -&gt; *) a b c.
Bifunctor p =&gt;
(a -&gt; b) -&gt; p a c -&gt; p b c
</span><span class="hs-identifier hs-var">first</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621681492343"><span class="annot"><span class="annottext">e :: SomeException
</span><a href="#local-6989586621681492343"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; MineFailure
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; MineFailure) -&gt; [Char] -&gt; MineFailure
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;Chainweb.Cut.createNewCut: &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">SomeException -&gt; [Char]
forall a b. (Show a, IsString b) =&gt; a -&gt; b
</span><a href="Chainweb.Utils.html#sshow"><span class="hs-identifier hs-var">sshow</span></a></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621681492343"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-148"></span><span>        </span><span class="annot"><span class="annottext">(Either SomeException Cut -&gt; Either MineFailure Cut)
-&gt; Either SomeException Cut -&gt; Either MineFailure Cut
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Cut -&gt; BlockHeader -&gt; Either SomeException Cut
forall (m :: * -&gt; *). MonadThrow m =&gt; Cut -&gt; BlockHeader -&gt; m Cut
</span><a href="Chainweb.Cut.html#monotonicCutExtension"><span class="hs-identifier hs-var">monotonicCutExtension</span></a></span><span> </span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492354"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">BlockHeader
</span><a href="#local-6989586621681492353"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-149"></span><span>    </span><span class="annot"><span class="annottext">T2 BlockHeader Cut -&gt; Either MineFailure (T2 BlockHeader Cut)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(T2 BlockHeader Cut -&gt; Either MineFailure (T2 BlockHeader Cut))
-&gt; T2 BlockHeader Cut -&gt; Either MineFailure (T2 BlockHeader Cut)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BlockHeader -&gt; Cut -&gt; T2 BlockHeader Cut
forall a b. a -&gt; b -&gt; T2 a b
</span><span class="hs-identifier hs-var">T2</span></span><span> </span><span class="annot"><span class="annottext">BlockHeader
</span><a href="#local-6989586621681492353"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492344"><span class="hs-identifier hs-var">c'</span></a></span><span>
</span><span id="line-150"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-151"></span><span>    </span><span id="local-6989586621681492339"><span class="annot"><span class="annottext">cid :: ChainId
</span><a href="#local-6989586621681492339"><span class="hs-identifier hs-var hs-var">cid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">cid -&gt; ChainId
forall a. HasChainId a =&gt; a -&gt; ChainId
</span><a href="Chainweb.ChainId.html#_chainId"><span class="hs-identifier hs-var">_chainId</span></a></span><span> </span><span class="annot"><span class="annottext">cid
</span><a href="#local-6989586621681492355"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-152"></span><span>
</span><span id="line-153"></span><span>    </span><span class="hs-comment">-- | The parent block to mine on.</span><span>
</span><span id="line-154"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-155"></span><span>    </span><span class="annot"><a href="#local-6989586621681492337"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Chainweb.BlockHeader.html#BlockHeader"><span class="hs-identifier hs-type">BlockHeader</span></a></span><span>
</span><span id="line-156"></span><span>    </span><span id="local-6989586621681492337"><span class="annot"><span class="annottext">p :: BlockHeader
</span><a href="#local-6989586621681492337"><span class="hs-identifier hs-var hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492354"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Cut -&gt; Getting (Endo BlockHeader) Cut BlockHeader -&gt; BlockHeader
forall s a. HasCallStack =&gt; s -&gt; Getting (Endo a) s a -&gt; a
</span><span class="hs-operator hs-var">^?!</span></span><span> </span><span class="annot"><span class="annottext">Index Cut -&gt; Fold Cut (IxValue Cut)
forall a. IxedGet a =&gt; Index a -&gt; Fold a (IxValue a)
</span><a href="Chainweb.Utils.html#ixg"><span class="hs-identifier hs-var">ixg</span></a></span><span> </span><span class="annot"><span class="annottext">Index Cut
ChainId
</span><a href="#local-6989586621681492339"><span class="hs-identifier hs-var">cid</span></a></span><span>
</span><span id="line-157"></span><span>
</span><span id="line-158"></span><span>    </span><span class="annot"><a href="#local-6989586621681492352"><span class="hs-identifier hs-type">newHeader</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Chainweb.BlockHash.html#BlockHashRecord"><span class="hs-identifier hs-type">BlockHashRecord</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Chainweb.BlockHeader.html#BlockHeader"><span class="hs-identifier hs-type">BlockHeader</span></a></span><span>
</span><span id="line-159"></span><span>    </span><span id="local-6989586621681492352"><span class="annot"><span class="annottext">newHeader :: BlockHashRecord -&gt; BlockHeader
</span><a href="#local-6989586621681492352"><span class="hs-identifier hs-var hs-var">newHeader</span></a></span></span><span> </span><span id="local-6989586621681492334"><span class="annot"><span class="annottext">as :: BlockHashRecord
</span><a href="#local-6989586621681492334"><span class="hs-keyword hs-var">as</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BlockHashRecord
-&gt; BlockPayloadHash
-&gt; Nonce
-&gt; Time Micros
-&gt; BlockHeader
-&gt; BlockHeader
</span><a href="Chainweb.BlockHeader.html#newBlockHeader"><span class="hs-identifier hs-var">newBlockHeader</span></a></span><span> </span><span class="annot"><span class="annottext">BlockHashRecord
</span><a href="#local-6989586621681492334"><span class="hs-keyword hs-var">as</span></a></span><span> </span><span class="annot"><span class="annottext">BlockPayloadHash
</span><a href="#local-6989586621681492356"><span class="hs-identifier hs-var">pay</span></a></span><span> </span><span class="annot"><span class="annottext">Nonce
</span><a href="#local-6989586621681492358"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Time Micros
</span><a href="#local-6989586621681492357"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">BlockHeader
</span><a href="#local-6989586621681492337"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-160"></span><span>
</span><span id="line-161"></span><span>    </span><span class="hs-comment">-- | Try to get all adjacent hashes dependencies.</span><span>
</span><span id="line-162"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-163"></span><span>    </span><span class="annot"><a href="#local-6989586621681492348"><span class="hs-identifier hs-type">newAdjHashes</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HM.HashMap</span></span><span> </span><span class="annot"><a href="Chainweb.ChainId.html#ChainId"><span class="hs-identifier hs-type">ChainId</span></a></span><span> </span><span class="annot"><a href="Chainweb.BlockHash.html#BlockHash"><span class="hs-identifier hs-type">BlockHash</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-164"></span><span>    </span><span id="local-6989586621681492348"><span class="annot"><span class="annottext">newAdjHashes :: Maybe (HashMap ChainId BlockHash)
</span><a href="#local-6989586621681492348"><span class="hs-identifier hs-var hs-var">newAdjHashes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashMap ChainId BlockHash
-&gt; (ChainId -&gt; BlockHash -&gt; Maybe BlockHash)
-&gt; Maybe (HashMap ChainId BlockHash)
forall i (t :: * -&gt; *) (m :: * -&gt; *) a b.
(TraversableWithIndex i t, Monad m) =&gt;
t a -&gt; (i -&gt; a -&gt; m b) -&gt; m (t b)
</span><span class="hs-identifier hs-var">iforM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BlockHashRecord -&gt; HashMap ChainId BlockHash
</span><a href="Chainweb.BlockHash.html#_getBlockHashRecord"><span class="hs-identifier hs-var hs-var">_getBlockHashRecord</span></a></span><span> </span><span class="annot"><span class="annottext">(BlockHashRecord -&gt; HashMap ChainId BlockHash)
-&gt; BlockHashRecord -&gt; HashMap ChainId BlockHash
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BlockHeader -&gt; BlockHashRecord
</span><a href="Chainweb.BlockHeader.html#_blockAdjacentHashes"><span class="hs-identifier hs-var hs-var">_blockAdjacentHashes</span></a></span><span> </span><span class="annot"><span class="annottext">BlockHeader
</span><a href="#local-6989586621681492337"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((ChainId -&gt; BlockHash -&gt; Maybe BlockHash)
 -&gt; Maybe (HashMap ChainId BlockHash))
-&gt; (ChainId -&gt; BlockHash -&gt; Maybe BlockHash)
-&gt; Maybe (HashMap ChainId BlockHash)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681492329"><span class="annot"><span class="annottext">xcid :: ChainId
</span><a href="#local-6989586621681492329"><span class="hs-identifier hs-var">xcid</span></a></span></span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-165"></span><span>        </span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492354"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Cut
-&gt; Getting (Endo (Maybe BlockHash)) Cut (Maybe BlockHash)
-&gt; Maybe BlockHash
forall s a. HasCallStack =&gt; s -&gt; Getting (Endo a) s a -&gt; a
</span><span class="hs-operator hs-var">^?!</span></span><span> </span><span class="annot"><span class="annottext">Index Cut -&gt; Fold Cut (IxValue Cut)
forall a. IxedGet a =&gt; Index a -&gt; Fold a (IxValue a)
</span><a href="Chainweb.Utils.html#ixg"><span class="hs-identifier hs-var">ixg</span></a></span><span> </span><span class="annot"><span class="annottext">Index Cut
ChainId
</span><a href="#local-6989586621681492329"><span class="hs-identifier hs-var">xcid</span></a></span><span> </span><span class="annot"><span class="annottext">((BlockHeader -&gt; Const (Endo (Maybe BlockHash)) BlockHeader)
 -&gt; Cut -&gt; Const (Endo (Maybe BlockHash)) Cut)
-&gt; ((Maybe BlockHash
     -&gt; Const (Endo (Maybe BlockHash)) (Maybe BlockHash))
    -&gt; BlockHeader -&gt; Const (Endo (Maybe BlockHash)) BlockHeader)
-&gt; Getting (Endo (Maybe BlockHash)) Cut (Maybe BlockHash)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(BlockHeader -&gt; Maybe BlockHash)
-&gt; (Maybe BlockHash
    -&gt; Const (Endo (Maybe BlockHash)) (Maybe BlockHash))
-&gt; BlockHeader
-&gt; Const (Endo (Maybe BlockHash)) BlockHeader
forall (p :: * -&gt; * -&gt; *) (f :: * -&gt; *) s a.
(Profunctor p, Contravariant f) =&gt;
(s -&gt; a) -&gt; Optic' p f s a
</span><span class="hs-identifier hs-var">to</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BlockHeight -&gt; BlockHeader -&gt; Maybe BlockHash
</span><a href="#local-6989586621681492327"><span class="hs-identifier hs-var">tryAdj</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BlockHeader -&gt; BlockHeight
</span><a href="Chainweb.BlockHeader.html#_blockHeight"><span class="hs-identifier hs-var hs-var">_blockHeight</span></a></span><span> </span><span class="annot"><span class="annottext">BlockHeader
</span><a href="#local-6989586621681492337"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-166"></span><span>
</span><span id="line-167"></span><span>    </span><span class="annot"><a href="#local-6989586621681492327"><span class="hs-identifier hs-type">tryAdj</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Chainweb.BlockHeader.html#BlockHeight"><span class="hs-identifier hs-type">BlockHeight</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Chainweb.BlockHeader.html#BlockHeader"><span class="hs-identifier hs-type">BlockHeader</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Chainweb.BlockHash.html#BlockHash"><span class="hs-identifier hs-type">BlockHash</span></a></span><span>
</span><span id="line-168"></span><span>    </span><span id="local-6989586621681492327"><span class="annot"><span class="annottext">tryAdj :: BlockHeight -&gt; BlockHeader -&gt; Maybe BlockHash
</span><a href="#local-6989586621681492327"><span class="hs-identifier hs-var hs-var">tryAdj</span></a></span></span><span> </span><span id="local-6989586621681492325"><span class="annot"><span class="annottext">h :: BlockHeight
</span><a href="#local-6989586621681492325"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span id="local-6989586621681492324"><span class="annot"><span class="annottext">b :: BlockHeader
</span><a href="#local-6989586621681492324"><span class="hs-identifier hs-var">b</span></a></span></span><span>
</span><span id="line-169"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">BlockHeader -&gt; BlockHeight
</span><a href="Chainweb.BlockHeader.html#_blockHeight"><span class="hs-identifier hs-var hs-var">_blockHeight</span></a></span><span> </span><span class="annot"><span class="annottext">BlockHeader
</span><a href="#local-6989586621681492324"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">BlockHeight -&gt; BlockHeight -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">BlockHeight
</span><a href="#local-6989586621681492325"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BlockHash -&gt; Maybe BlockHash
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(BlockHash -&gt; Maybe BlockHash) -&gt; BlockHash -&gt; Maybe BlockHash
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">BlockHeader -&gt; BlockHash
</span><a href="Chainweb.BlockHeader.html#_blockHash"><span class="hs-identifier hs-var hs-var">_blockHash</span></a></span><span> </span><span class="annot"><span class="annottext">BlockHeader
</span><a href="#local-6989586621681492324"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-170"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">BlockHeader -&gt; BlockHeight
</span><a href="Chainweb.BlockHeader.html#_blockHeight"><span class="hs-identifier hs-var hs-var">_blockHeight</span></a></span><span> </span><span class="annot"><span class="annottext">BlockHeader
</span><a href="#local-6989586621681492324"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">BlockHeight -&gt; BlockHeight -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">BlockHeight
</span><a href="#local-6989586621681492325"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">BlockHeight -&gt; BlockHeight -&gt; BlockHeight
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BlockHash -&gt; Maybe BlockHash
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(BlockHash -&gt; Maybe BlockHash) -&gt; BlockHash -&gt; Maybe BlockHash
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">BlockHeader -&gt; BlockHash
</span><a href="Chainweb.BlockHeader.html#_blockParent"><span class="hs-identifier hs-var hs-var">_blockParent</span></a></span><span> </span><span class="annot"><span class="annottext">BlockHeader
</span><a href="#local-6989586621681492324"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-171"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe BlockHash
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-172"></span><span>
</span><span id="line-173"></span><span class="hs-comment">-- | Create a new cut where the new block has a creation time of one second</span><span>
</span><span id="line-174"></span><span class="hs-comment">-- after its parent.</span><span>
</span><span id="line-175"></span><span class="hs-comment">--</span><span>
</span><span id="line-176"></span><span id="local-6989586621681492472"><span class="annot"><a href="Chainweb.Cut.Test.html#createNewCutWithoutTime"><span class="hs-identifier hs-type">createNewCutWithoutTime</span></a></span><span>
</span><span id="line-177"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span>
</span><span id="line-178"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Chainweb.ChainId.html#HasChainId"><span class="hs-identifier hs-type">HasChainId</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681492472"><span class="hs-identifier hs-type">cid</span></a></span><span>
</span><span id="line-179"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Chainweb.BlockHeader.html#Nonce"><span class="hs-identifier hs-type">Nonce</span></a></span><span>
</span><span id="line-180"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Chainweb.Payload.html#BlockPayloadHash"><span class="hs-identifier hs-type">BlockPayloadHash</span></a></span><span>
</span><span id="line-181"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681492472"><span class="hs-identifier hs-type">cid</span></a></span><span>
</span><span id="line-182"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Chainweb.Cut.html#Cut"><span class="hs-identifier hs-type">Cut</span></a></span><span>
</span><span id="line-183"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">T2</span></span><span> </span><span class="annot"><a href="Chainweb.BlockHeader.html#BlockHeader"><span class="hs-identifier hs-type">BlockHeader</span></a></span><span> </span><span class="annot"><a href="Chainweb.Cut.html#Cut"><span class="hs-identifier hs-type">Cut</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-184"></span><span id="createNewCutWithoutTime"><span class="annot"><span class="annottext">createNewCutWithoutTime :: Nonce
-&gt; BlockPayloadHash -&gt; cid -&gt; Cut -&gt; Maybe (T2 BlockHeader Cut)
</span><a href="Chainweb.Cut.Test.html#createNewCutWithoutTime"><span class="hs-identifier hs-var hs-var">createNewCutWithoutTime</span></a></span></span><span> </span><span id="local-6989586621681492318"><span class="annot"><span class="annottext">n :: Nonce
</span><a href="#local-6989586621681492318"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621681492317"><span class="annot"><span class="annottext">pay :: BlockPayloadHash
</span><a href="#local-6989586621681492317"><span class="hs-identifier hs-var">pay</span></a></span></span><span> </span><span id="local-6989586621681492316"><span class="annot"><span class="annottext">i :: cid
</span><a href="#local-6989586621681492316"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621681492315"><span class="annot"><span class="annottext">c :: Cut
</span><a href="#local-6989586621681492315"><span class="hs-identifier hs-var">c</span></a></span></span><span>
</span><span id="line-185"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Either MineFailure (T2 BlockHeader Cut)
-&gt; Maybe (T2 BlockHeader Cut)
forall a b. Either a b -&gt; Maybe b
</span><span class="hs-identifier hs-var">hush</span></span><span> </span><span class="annot"><span class="annottext">(Either MineFailure (T2 BlockHeader Cut)
 -&gt; Maybe (T2 BlockHeader Cut))
-&gt; Either MineFailure (T2 BlockHeader Cut)
-&gt; Maybe (T2 BlockHeader Cut)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Nonce
-&gt; Time Micros
-&gt; BlockPayloadHash
-&gt; cid
-&gt; Cut
-&gt; Either MineFailure (T2 BlockHeader Cut)
forall cid.
(HasCallStack, HasChainId cid) =&gt;
Nonce
-&gt; Time Micros
-&gt; BlockPayloadHash
-&gt; cid
-&gt; Cut
-&gt; Either MineFailure (T2 BlockHeader Cut)
</span><a href="Chainweb.Cut.Test.html#createNewCut"><span class="hs-identifier hs-var">createNewCut</span></a></span><span> </span><span class="annot"><span class="annottext">Nonce
</span><a href="#local-6989586621681492318"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Diff (Time Micros) -&gt; Time Micros -&gt; Time Micros
forall t. LeftTorsor t =&gt; Diff t -&gt; t -&gt; t
</span><a href="Numeric.AffineSpace.html#add"><span class="hs-identifier hs-var">add</span></a></span><span> </span><span class="annot"><span class="annottext">Diff (Time Micros)
forall a. Num a =&gt; TimeSpan a
</span><a href="Chainweb.Time.html#second"><span class="hs-identifier hs-var">second</span></a></span><span> </span><span class="annot"><span class="annottext">Time Micros
</span><a href="#local-6989586621681492313"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">BlockPayloadHash
</span><a href="#local-6989586621681492317"><span class="hs-identifier hs-var">pay</span></a></span><span> </span><span class="annot"><span class="annottext">cid
</span><a href="#local-6989586621681492316"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492315"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-186"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-187"></span><span>    </span><span id="local-6989586621681492312"><span class="annot"><span class="annottext">cid :: ChainId
</span><a href="#local-6989586621681492312"><span class="hs-identifier hs-var hs-var">cid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">cid -&gt; ChainId
forall a. HasChainId a =&gt; a -&gt; ChainId
</span><a href="Chainweb.ChainId.html#_chainId"><span class="hs-identifier hs-var">_chainId</span></a></span><span> </span><span class="annot"><span class="annottext">cid
</span><a href="#local-6989586621681492316"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-188"></span><span>    </span><span class="annot"><a href="Chainweb.BlockHeader.html#BlockCreationTime"><span class="hs-identifier hs-type">BlockCreationTime</span></a></span><span> </span><span id="local-6989586621681492313"><span class="annot"><span class="annottext">t :: Time Micros
</span><a href="#local-6989586621681492313"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BlockHeader -&gt; BlockCreationTime
</span><a href="Chainweb.BlockHeader.html#_blockCreationTime"><span class="hs-identifier hs-var hs-var">_blockCreationTime</span></a></span><span> </span><span class="annot"><span class="annottext">(BlockHeader -&gt; BlockCreationTime)
-&gt; BlockHeader -&gt; BlockCreationTime
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492315"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Cut -&gt; Getting (Endo BlockHeader) Cut BlockHeader -&gt; BlockHeader
forall s a. HasCallStack =&gt; s -&gt; Getting (Endo a) s a -&gt; a
</span><span class="hs-operator hs-var">^?!</span></span><span> </span><span class="annot"><span class="annottext">Index Cut -&gt; Fold Cut (IxValue Cut)
forall a. IxedGet a =&gt; Index a -&gt; Fold a (IxValue a)
</span><a href="Chainweb.Utils.html#ixg"><span class="hs-identifier hs-var">ixg</span></a></span><span> </span><span class="annot"><span class="annottext">Index Cut
ChainId
</span><a href="#local-6989586621681492312"><span class="hs-identifier hs-var">cid</span></a></span><span>
</span><span id="line-189"></span><span>
</span><span id="line-190"></span><span class="hs-comment">-- -------------------------------------------------------------------------- --</span><span>
</span><span id="line-191"></span><span class="hs-comment">-- Arbitrary Cuts</span><span>
</span><span id="line-192"></span><span>
</span><span id="line-193"></span><span class="annot"><a href="Chainweb.Cut.Test.html#arbitraryCut"><span class="hs-identifier hs-type">arbitraryCut</span></a></span><span>
</span><span id="line-194"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span>
</span><span id="line-195"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Chainweb.Version.html#ChainwebVersion"><span class="hs-identifier hs-type">ChainwebVersion</span></a></span><span>
</span><span id="line-196"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Gen</span></span><span> </span><span class="annot"><a href="Chainweb.Cut.html#Cut"><span class="hs-identifier hs-type">Cut</span></a></span><span>
</span><span id="line-197"></span><span id="arbitraryCut"><span class="annot"><span class="annottext">arbitraryCut :: ChainwebVersion -&gt; Gen Cut
</span><a href="Chainweb.Cut.Test.html#arbitraryCut"><span class="hs-identifier hs-var hs-var">arbitraryCut</span></a></span></span><span> </span><span id="local-6989586621681492308"><span class="annot"><span class="annottext">v :: ChainwebVersion
</span><a href="#local-6989586621681492308"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Gen Cut) -&gt; Gen Cut
forall a. (Int -&gt; Gen a) -&gt; Gen a
</span><span class="hs-identifier hs-var">T.sized</span></span><span> </span><span class="annot"><span class="annottext">((Int -&gt; Gen Cut) -&gt; Gen Cut) -&gt; (Int -&gt; Gen Cut) -&gt; Gen Cut
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681492306"><span class="annot"><span class="annottext">s :: Int
</span><a href="#local-6989586621681492306"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-198"></span><span>    </span><span id="local-6989586621681492305"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681492305"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Int, Int) -&gt; Gen Int
forall a. Random a =&gt; (a, a) -&gt; Gen a
</span><span class="hs-identifier hs-var">T.choose</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681492306"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-199"></span><span>    </span><span class="annot"><span class="annottext">(Cut -&gt; Int -&gt; Gen Cut) -&gt; Cut -&gt; [Int] -&gt; Gen Cut
forall (t :: * -&gt; *) (m :: * -&gt; *) b a.
(Foldable t, Monad m) =&gt;
(b -&gt; a -&gt; m b) -&gt; b -&gt; t a -&gt; m b
</span><span class="hs-identifier hs-var">foldlM</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621681492302"><span class="annot"><span class="annottext">c :: Cut
</span><a href="#local-6989586621681492302"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Cut -&gt; Gen Cut
</span><a href="#local-6989586621681492301"><span class="hs-identifier hs-var">genCut</span></a></span><span> </span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492302"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ChainwebVersion -&gt; Cut
</span><a href="Chainweb.Cut.html#genesisCut"><span class="hs-identifier hs-var">genesisCut</span></a></span><span> </span><span class="annot"><span class="annottext">ChainwebVersion
</span><a href="#local-6989586621681492308"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-number">0</span></span><span class="hs-glyph">..</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681492305"><span class="hs-identifier hs-var">k</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-200"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-201"></span><span>    </span><span class="annot"><a href="#local-6989586621681492301"><span class="hs-identifier hs-type">genCut</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Chainweb.Cut.html#Cut"><span class="hs-identifier hs-type">Cut</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Gen</span></span><span> </span><span class="annot"><a href="Chainweb.Cut.html#Cut"><span class="hs-identifier hs-type">Cut</span></a></span><span>
</span><span id="line-202"></span><span>    </span><span id="local-6989586621681492301"><span class="annot"><span class="annottext">genCut :: Cut -&gt; Gen Cut
</span><a href="#local-6989586621681492301"><span class="hs-identifier hs-var hs-var">genCut</span></a></span></span><span> </span><span id="local-6989586621681492299"><span class="annot"><span class="annottext">c :: Cut
</span><a href="#local-6989586621681492299"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-203"></span><span>        </span><span id="local-6989586621681492298"><span class="annot"><span class="annottext">[ChainId]
</span><a href="#local-6989586621681492298"><span class="hs-identifier hs-var">cids</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[ChainId] -&gt; Gen [ChainId]
forall a. [a] -&gt; Gen [a]
</span><span class="hs-identifier hs-var">T.shuffle</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashSet ChainId -&gt; [ChainId]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">(HashSet ChainId -&gt; [ChainId]) -&gt; HashSet ChainId -&gt; [ChainId]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ChainwebVersion -&gt; HashSet ChainId
forall v. HasChainwebVersion v =&gt; v -&gt; HashSet ChainId
</span><a href="Chainweb.Version.html#chainIds"><span class="hs-identifier hs-var">chainIds</span></a></span><span> </span><span class="annot"><span class="annottext">ChainwebVersion
</span><a href="#local-6989586621681492308"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-204"></span><span>        </span><span class="annot"><span class="annottext">[ChainId] -&gt; Stream (Of ChainId) Gen ()
forall (m :: * -&gt; *) (f :: * -&gt; *) a.
(Monad m, Foldable f) =&gt;
f a -&gt; Stream (Of a) m ()
</span><span class="hs-identifier hs-var">S.each</span></span><span> </span><span class="annot"><span class="annottext">[ChainId]
</span><a href="#local-6989586621681492298"><span class="hs-identifier hs-var">cids</span></a></span><span>
</span><span id="line-205"></span><span>            </span><span class="annot"><span class="annottext">Stream (Of ChainId) Gen ()
-&gt; (Stream (Of ChainId) Gen ()
    -&gt; Stream (Of (T2 BlockHeader Cut)) Gen ())
-&gt; Stream (Of (T2 BlockHeader Cut)) Gen ()
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(ChainId -&gt; Gen (Maybe (T2 BlockHeader Cut)))
-&gt; Stream (Of ChainId) Gen ()
-&gt; Stream (Of (T2 BlockHeader Cut)) Gen ()
forall (m :: * -&gt; *) a b r.
Monad m =&gt;
(a -&gt; m (Maybe b)) -&gt; Stream (Of a) m r -&gt; Stream (Of b) m r
</span><span class="hs-identifier hs-var">S.mapMaybeM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Cut -&gt; ChainId -&gt; Gen (Maybe (T2 BlockHeader Cut))
</span><a href="#local-6989586621681492291"><span class="hs-identifier hs-var">mine</span></a></span><span> </span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492299"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-206"></span><span>            </span><span class="annot"><span class="annottext">Stream (Of (T2 BlockHeader Cut)) Gen ()
-&gt; (Stream (Of (T2 BlockHeader Cut)) Gen ()
    -&gt; Stream (Of Cut) Gen ())
-&gt; Stream (Of Cut) Gen ()
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(T2 BlockHeader Cut -&gt; Cut)
-&gt; Stream (Of (T2 BlockHeader Cut)) Gen ()
-&gt; Stream (Of Cut) Gen ()
forall (m :: * -&gt; *) a b r.
Monad m =&gt;
(a -&gt; b) -&gt; Stream (Of a) m r -&gt; Stream (Of b) m r
</span><span class="hs-identifier hs-var">S.map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">T2</span></span><span> </span><span class="hs-identifier">_</span><span> </span><span id="local-6989586621681492289"><span class="annot"><span class="annottext">x :: Cut
</span><a href="#local-6989586621681492289"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492289"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-207"></span><span>            </span><span class="annot"><span class="annottext">Stream (Of Cut) Gen ()
-&gt; (Stream (Of Cut) Gen () -&gt; Gen (Maybe Cut)) -&gt; Gen (Maybe Cut)
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">Stream (Of Cut) Gen () -&gt; Gen (Maybe Cut)
forall (m :: * -&gt; *) a r.
Monad m =&gt;
Stream (Of a) m r -&gt; m (Maybe a)
</span><span class="hs-identifier hs-var">S.head_</span></span><span>
</span><span id="line-208"></span><span>            </span><span class="annot"><span class="annottext">Gen (Maybe Cut) -&gt; (Gen (Maybe Cut) -&gt; Gen Cut) -&gt; Gen Cut
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Cut -&gt; Cut) -&gt; Gen (Maybe Cut) -&gt; Gen Cut
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Maybe Cut -&gt; Cut
forall a. HasCallStack =&gt; Maybe a -&gt; a
</span><a href="Chainweb.Utils.html#fromJuste"><span class="hs-identifier hs-var">fromJuste</span></a></span><span>
</span><span id="line-209"></span><span>
</span><span id="line-210"></span><span>    </span><span class="annot"><a href="#local-6989586621681492291"><span class="hs-identifier hs-type">mine</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Chainweb.Cut.html#Cut"><span class="hs-identifier hs-type">Cut</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Chainweb.ChainId.html#ChainId"><span class="hs-identifier hs-type">ChainId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Gen</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">T2</span></span><span> </span><span class="annot"><a href="Chainweb.BlockHeader.html#BlockHeader"><span class="hs-identifier hs-type">BlockHeader</span></a></span><span> </span><span class="annot"><a href="Chainweb.Cut.html#Cut"><span class="hs-identifier hs-type">Cut</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-211"></span><span>    </span><span id="local-6989586621681492291"><span class="annot"><span class="annottext">mine :: Cut -&gt; ChainId -&gt; Gen (Maybe (T2 BlockHeader Cut))
</span><a href="#local-6989586621681492291"><span class="hs-identifier hs-var hs-var">mine</span></a></span></span><span> </span><span id="local-6989586621681492286"><span class="annot"><span class="annottext">c :: Cut
</span><a href="#local-6989586621681492286"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621681492285"><span class="annot"><span class="annottext">cid :: ChainId
</span><a href="#local-6989586621681492285"><span class="hs-identifier hs-var">cid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-212"></span><span>        </span><span id="local-6989586621681492284"><span class="annot"><span class="annottext">Nonce
</span><a href="#local-6989586621681492284"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Nonce
</span><a href="Chainweb.BlockHeader.html#Nonce"><span class="hs-identifier hs-var">Nonce</span></a></span><span> </span><span class="annot"><span class="annottext">(Word64 -&gt; Nonce) -&gt; Gen Word64 -&gt; Gen Nonce
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Gen Word64
forall a. Arbitrary a =&gt; Gen a
</span><span class="hs-identifier hs-var">T.arbitrary</span></span><span>
</span><span id="line-213"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681492281"><span class="annot"><span class="annottext">pay :: BlockPayloadHash
</span><a href="#local-6989586621681492281"><span class="hs-identifier hs-var hs-var">pay</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ChainwebVersion -&gt; ChainId -&gt; ByteString -&gt; BlockPayloadHash
forall p.
HasChainId p =&gt;
ChainwebVersion -&gt; p -&gt; ByteString -&gt; BlockPayloadHash
</span><a href="Chainweb.BlockHeader.html#hashPayload"><span class="hs-identifier hs-var">hashPayload</span></a></span><span> </span><span class="annot"><span class="annottext">ChainwebVersion
</span><a href="#local-6989586621681492308"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">ChainId
</span><a href="#local-6989586621681492285"><span class="hs-identifier hs-var">cid</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;TEST PAYLOAD&quot;</span></span><span>
</span><span id="line-214"></span><span>        </span><span class="annot"><span class="annottext">Maybe (T2 BlockHeader Cut) -&gt; Gen (Maybe (T2 BlockHeader Cut))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Maybe (T2 BlockHeader Cut) -&gt; Gen (Maybe (T2 BlockHeader Cut)))
-&gt; Maybe (T2 BlockHeader Cut) -&gt; Gen (Maybe (T2 BlockHeader Cut))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Nonce
-&gt; BlockPayloadHash -&gt; ChainId -&gt; Cut -&gt; Maybe (T2 BlockHeader Cut)
forall cid.
(HasCallStack, HasChainId cid) =&gt;
Nonce
-&gt; BlockPayloadHash -&gt; cid -&gt; Cut -&gt; Maybe (T2 BlockHeader Cut)
</span><a href="Chainweb.Cut.Test.html#createNewCutWithoutTime"><span class="hs-identifier hs-var">createNewCutWithoutTime</span></a></span><span> </span><span class="annot"><span class="annottext">Nonce
</span><a href="#local-6989586621681492284"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">BlockPayloadHash
</span><a href="#local-6989586621681492281"><span class="hs-identifier hs-var">pay</span></a></span><span> </span><span class="annot"><span class="annottext">ChainId
</span><a href="#local-6989586621681492285"><span class="hs-identifier hs-var">cid</span></a></span><span> </span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492286"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-215"></span><span>
</span><span id="line-216"></span><span class="annot"><a href="Chainweb.Cut.Test.html#arbitraryChainGraphChainId"><span class="hs-identifier hs-type">arbitraryChainGraphChainId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Given</span></span><span> </span><span class="annot"><a href="Chainweb.Graph.html#ChainGraph"><span class="hs-identifier hs-type">ChainGraph</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Gen</span></span><span> </span><span class="annot"><a href="Chainweb.ChainId.html#ChainId"><span class="hs-identifier hs-type">ChainId</span></a></span><span>
</span><span id="line-217"></span><span id="arbitraryChainGraphChainId"><span class="annot"><span class="annottext">arbitraryChainGraphChainId :: Gen ChainId
</span><a href="Chainweb.Cut.Test.html#arbitraryChainGraphChainId"><span class="hs-identifier hs-var hs-var">arbitraryChainGraphChainId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ChainId] -&gt; Gen ChainId
forall a. [a] -&gt; Gen a
</span><span class="hs-identifier hs-var">T.elements</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashSet ChainId -&gt; [ChainId]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">(HashSet ChainId -&gt; [ChainId]) -&gt; HashSet ChainId -&gt; [ChainId]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ChainGraph -&gt; HashSet ChainId
</span><a href="Chainweb.Graph.html#graphChainIds"><span class="hs-identifier hs-var">graphChainIds</span></a></span><span> </span><span class="annot"><span class="annottext">ChainGraph
forall a. Given a =&gt; a
</span><span class="hs-identifier hs-var">given</span></span><span class="hs-special">)</span><span>
</span><span id="line-218"></span><span>
</span><span id="line-219"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681492274"><span class="annot"><span class="hs-identifier hs-type">Given</span></span><span> </span><span class="annot"><a href="Chainweb.Version.html#ChainwebVersion"><span class="hs-identifier hs-type">ChainwebVersion</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Arbitrary</span></span><span> </span><span class="annot"><a href="Chainweb.Cut.html#Cut"><span class="hs-identifier hs-type">Cut</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-220"></span><span>    </span><span id="local-6989586621681492272"><span class="annot"><span class="annottext">arbitrary :: Gen Cut
</span><a href="#local-6989586621681492272"><span class="hs-identifier hs-var hs-var hs-var hs-var">arbitrary</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; ChainwebVersion -&gt; Gen Cut
ChainwebVersion -&gt; Gen Cut
</span><a href="Chainweb.Cut.Test.html#arbitraryCut"><span class="hs-identifier hs-var">arbitraryCut</span></a></span><span> </span><span class="annot"><span class="annottext">ChainwebVersion
forall a. Given a =&gt; a
</span><span class="hs-identifier hs-var">given</span></span><span>
</span><span id="line-221"></span><span>
</span><span id="line-222"></span><span class="hs-comment">-- | Provide option to provide db with a branch/cut.</span><span>
</span><span id="line-223"></span><span class="hs-comment">--</span><span>
</span><span id="line-224"></span><span class="annot"><a href="Chainweb.Cut.Test.html#arbitraryWebChainCut"><span class="hs-identifier hs-type">arbitraryWebChainCut</span></a></span><span>
</span><span id="line-225"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span>
</span><span id="line-226"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Given</span></span><span> </span><span class="annot"><a href="Chainweb.WebBlockHeaderDB.Types.html#WebBlockHeaderDb"><span class="hs-identifier hs-type">WebBlockHeaderDb</span></a></span><span>
</span><span id="line-227"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Chainweb.Cut.html#Cut"><span class="hs-identifier hs-type">Cut</span></a></span><span>
</span><span id="line-228"></span><span>        </span><span class="hs-comment">-- @genesisCut Test@ is always a valid cut</span><span>
</span><span id="line-229"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.PropertyM</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="Chainweb.Cut.html#Cut"><span class="hs-identifier hs-type">Cut</span></a></span><span>
</span><span id="line-230"></span><span id="arbitraryWebChainCut"><span class="annot"><span class="annottext">arbitraryWebChainCut :: Cut -&gt; PropertyM IO Cut
</span><a href="Chainweb.Cut.Test.html#arbitraryWebChainCut"><span class="hs-identifier hs-var hs-var">arbitraryWebChainCut</span></a></span></span><span> </span><span id="local-6989586621681492270"><span class="annot"><span class="annottext">initialCut :: Cut
</span><a href="#local-6989586621681492270"><span class="hs-identifier hs-var">initialCut</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-231"></span><span>    </span><span id="local-6989586621681492269"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681492269"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Gen Int -&gt; PropertyM IO Int
forall (m :: * -&gt; *) a. (Monad m, Show a) =&gt; Gen a -&gt; PropertyM m a
</span><span class="hs-identifier hs-var">T.pick</span></span><span> </span><span class="annot"><span class="annottext">(Gen Int -&gt; PropertyM IO Int) -&gt; Gen Int -&gt; PropertyM IO Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Gen Int) -&gt; Gen Int
forall a. (Int -&gt; Gen a) -&gt; Gen a
</span><span class="hs-identifier hs-var">T.sized</span></span><span> </span><span class="annot"><span class="annottext">((Int -&gt; Gen Int) -&gt; Gen Int) -&gt; (Int -&gt; Gen Int) -&gt; Gen Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681492267"><span class="annot"><span class="annottext">s :: Int
</span><a href="#local-6989586621681492267"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Int, Int) -&gt; Gen Int
forall a. Random a =&gt; (a, a) -&gt; Gen a
</span><span class="hs-identifier hs-var">T.choose</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681492267"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-232"></span><span>    </span><span class="annot"><span class="annottext">(Cut -&gt; Int -&gt; PropertyM IO Cut)
-&gt; Cut -&gt; [Int] -&gt; PropertyM IO Cut
forall (t :: * -&gt; *) (m :: * -&gt; *) b a.
(Foldable t, Monad m) =&gt;
(b -&gt; a -&gt; m b) -&gt; b -&gt; t a -&gt; m b
</span><span class="hs-identifier hs-var">foldlM</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621681492266"><span class="annot"><span class="annottext">c :: Cut
</span><a href="#local-6989586621681492266"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Cut -&gt; PropertyM IO Cut
</span><a href="#local-6989586621681492265"><span class="hs-identifier hs-var">genCut</span></a></span><span> </span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492266"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492270"><span class="hs-identifier hs-var">initialCut</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-number">0</span></span><span class="hs-glyph">..</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681492269"><span class="hs-identifier hs-var">k</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-233"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-234"></span><span>    </span><span id="local-6989586621681492265"><span class="annot"><span class="annottext">genCut :: Cut -&gt; PropertyM IO Cut
</span><a href="#local-6989586621681492265"><span class="hs-identifier hs-var hs-var">genCut</span></a></span></span><span> </span><span id="local-6989586621681492264"><span class="annot"><span class="annottext">c :: Cut
</span><a href="#local-6989586621681492264"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-235"></span><span>        </span><span id="local-6989586621681492263"><span class="annot"><span class="annottext">[ChainId]
</span><a href="#local-6989586621681492263"><span class="hs-identifier hs-var">cids</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Gen [ChainId] -&gt; PropertyM IO [ChainId]
forall (m :: * -&gt; *) a. (Monad m, Show a) =&gt; Gen a -&gt; PropertyM m a
</span><span class="hs-identifier hs-var">T.pick</span></span><span>
</span><span id="line-236"></span><span>            </span><span class="annot"><span class="annottext">(Gen [ChainId] -&gt; PropertyM IO [ChainId])
-&gt; Gen [ChainId] -&gt; PropertyM IO [ChainId]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[ChainId] -&gt; Gen [ChainId]
forall a. [a] -&gt; Gen [a]
</span><span class="hs-identifier hs-var">T.shuffle</span></span><span>
</span><span id="line-237"></span><span>            </span><span class="annot"><span class="annottext">([ChainId] -&gt; Gen [ChainId]) -&gt; [ChainId] -&gt; Gen [ChainId]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HashSet ChainId -&gt; [ChainId]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span>
</span><span id="line-238"></span><span>            </span><span class="annot"><span class="annottext">(HashSet ChainId -&gt; [ChainId]) -&gt; HashSet ChainId -&gt; [ChainId]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Cut -&gt; HashSet ChainId
forall v. HasChainwebVersion v =&gt; v -&gt; HashSet ChainId
</span><a href="Chainweb.Version.html#chainIds"><span class="hs-identifier hs-var">chainIds</span></a></span><span> </span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492270"><span class="hs-identifier hs-var">initialCut</span></a></span><span>
</span><span id="line-239"></span><span>        </span><span class="annot"><span class="annottext">[ChainId] -&gt; Stream (Of ChainId) (PropertyM IO) ()
forall (m :: * -&gt; *) (f :: * -&gt; *) a.
(Monad m, Foldable f) =&gt;
f a -&gt; Stream (Of a) m ()
</span><span class="hs-identifier hs-var">S.each</span></span><span> </span><span class="annot"><span class="annottext">[ChainId]
</span><a href="#local-6989586621681492263"><span class="hs-identifier hs-var">cids</span></a></span><span>
</span><span id="line-240"></span><span>            </span><span class="annot"><span class="annottext">Stream (Of ChainId) (PropertyM IO) ()
-&gt; (Stream (Of ChainId) (PropertyM IO) ()
    -&gt; Stream (Of (T2 BlockHeader Cut)) (PropertyM IO) ())
-&gt; Stream (Of (T2 BlockHeader Cut)) (PropertyM IO) ()
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(ChainId -&gt; PropertyM IO (Maybe (T2 BlockHeader Cut)))
-&gt; Stream (Of ChainId) (PropertyM IO) ()
-&gt; Stream (Of (T2 BlockHeader Cut)) (PropertyM IO) ()
forall (m :: * -&gt; *) a b r.
Monad m =&gt;
(a -&gt; m (Maybe b)) -&gt; Stream (Of a) m r -&gt; Stream (Of b) m r
</span><span class="hs-identifier hs-var">S.mapMaybeM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Cut -&gt; ChainId -&gt; PropertyM IO (Maybe (T2 BlockHeader Cut))
forall (m :: * -&gt; *) cid.
(MonadIO m, HasChainId cid) =&gt;
Cut -&gt; cid -&gt; PropertyM m (Maybe (T2 BlockHeader Cut))
</span><a href="#local-6989586621681492262"><span class="hs-identifier hs-var">mine</span></a></span><span> </span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492264"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-241"></span><span>            </span><span class="annot"><span class="annottext">Stream (Of (T2 BlockHeader Cut)) (PropertyM IO) ()
-&gt; (Stream (Of (T2 BlockHeader Cut)) (PropertyM IO) ()
    -&gt; Stream (Of Cut) (PropertyM IO) ())
-&gt; Stream (Of Cut) (PropertyM IO) ()
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(T2 BlockHeader Cut -&gt; Cut)
-&gt; Stream (Of (T2 BlockHeader Cut)) (PropertyM IO) ()
-&gt; Stream (Of Cut) (PropertyM IO) ()
forall (m :: * -&gt; *) a b r.
Monad m =&gt;
(a -&gt; b) -&gt; Stream (Of a) m r -&gt; Stream (Of b) m r
</span><span class="hs-identifier hs-var">S.map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">T2</span></span><span> </span><span class="hs-identifier">_</span><span> </span><span id="local-6989586621681492261"><span class="annot"><span class="annottext">c' :: Cut
</span><a href="#local-6989586621681492261"><span class="hs-identifier hs-var">c'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492261"><span class="hs-identifier hs-var">c'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-242"></span><span>            </span><span class="annot"><span class="annottext">Stream (Of Cut) (PropertyM IO) ()
-&gt; (Stream (Of Cut) (PropertyM IO) () -&gt; PropertyM IO (Maybe Cut))
-&gt; PropertyM IO (Maybe Cut)
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">Stream (Of Cut) (PropertyM IO) () -&gt; PropertyM IO (Maybe Cut)
forall (m :: * -&gt; *) a r.
Monad m =&gt;
Stream (Of a) m r -&gt; m (Maybe a)
</span><span class="hs-identifier hs-var">S.head_</span></span><span>
</span><span id="line-243"></span><span>            </span><span class="annot"><span class="annottext">PropertyM IO (Maybe Cut)
-&gt; (PropertyM IO (Maybe Cut) -&gt; PropertyM IO Cut)
-&gt; PropertyM IO Cut
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Cut -&gt; Cut) -&gt; PropertyM IO (Maybe Cut) -&gt; PropertyM IO Cut
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Maybe Cut -&gt; Cut
forall a. HasCallStack =&gt; Maybe a -&gt; a
</span><a href="Chainweb.Utils.html#fromJuste"><span class="hs-identifier hs-var">fromJuste</span></a></span><span>
</span><span id="line-244"></span><span>
</span><span id="line-245"></span><span>    </span><span id="local-6989586621681492262"><span class="annot"><span class="annottext">mine :: Cut -&gt; cid -&gt; PropertyM m (Maybe (T2 BlockHeader Cut))
</span><a href="#local-6989586621681492262"><span class="hs-identifier hs-var hs-var">mine</span></a></span></span><span> </span><span id="local-6989586621681492260"><span class="annot"><span class="annottext">c :: Cut
</span><a href="#local-6989586621681492260"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621681492259"><span class="annot"><span class="annottext">cid :: cid
</span><a href="#local-6989586621681492259"><span class="hs-identifier hs-var">cid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-246"></span><span>        </span><span id="local-6989586621681492258"><span class="annot"><span class="annottext">Nonce
</span><a href="#local-6989586621681492258"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Gen Nonce -&gt; PropertyM m Nonce
forall (m :: * -&gt; *) a. (Monad m, Show a) =&gt; Gen a -&gt; PropertyM m a
</span><span class="hs-identifier hs-var">T.pick</span></span><span> </span><span class="annot"><span class="annottext">(Gen Nonce -&gt; PropertyM m Nonce) -&gt; Gen Nonce -&gt; PropertyM m Nonce
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Nonce
</span><a href="Chainweb.BlockHeader.html#Nonce"><span class="hs-identifier hs-var">Nonce</span></a></span><span> </span><span class="annot"><span class="annottext">(Word64 -&gt; Nonce) -&gt; Gen Word64 -&gt; Gen Nonce
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Gen Word64
forall a. Arbitrary a =&gt; Gen a
</span><span class="hs-identifier hs-var">T.arbitrary</span></span><span>
</span><span id="line-247"></span><span>        </span><span id="local-6989586621681492257"><span class="annot"><span class="annottext">Time Micros
</span><a href="#local-6989586621681492257"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (Time Micros) -&gt; PropertyM m (Time Micros)
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span>  </span><span class="annot"><span class="annottext">IO (Time Micros)
forall a. Integral a =&gt; IO (Time a)
</span><a href="Chainweb.Time.html#getCurrentTimeIntegral"><span class="hs-identifier hs-var">getCurrentTimeIntegral</span></a></span><span>
</span><span id="line-248"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681492255"><span class="annot"><span class="annottext">pay :: BlockPayloadHash
</span><a href="#local-6989586621681492255"><span class="hs-identifier hs-var hs-var">pay</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ChainwebVersion -&gt; cid -&gt; ByteString -&gt; BlockPayloadHash
forall p.
HasChainId p =&gt;
ChainwebVersion -&gt; p -&gt; ByteString -&gt; BlockPayloadHash
</span><a href="Chainweb.BlockHeader.html#hashPayload"><span class="hs-identifier hs-var">hashPayload</span></a></span><span> </span><span class="annot"><span class="annottext">ChainwebVersion
</span><a href="#local-6989586621681492254"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">cid
</span><a href="#local-6989586621681492259"><span class="hs-identifier hs-var">cid</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;TEST PAYLOAD&quot;</span></span><span>
</span><span id="line-249"></span><span>        </span><span class="annot"><span class="annottext">IO (Maybe (T2 BlockHeader Cut))
-&gt; PropertyM m (Maybe (T2 BlockHeader Cut))
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (Maybe (T2 BlockHeader Cut))
 -&gt; PropertyM m (Maybe (T2 BlockHeader Cut)))
-&gt; IO (Maybe (T2 BlockHeader Cut))
-&gt; PropertyM m (Maybe (T2 BlockHeader Cut))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Either MineFailure (T2 BlockHeader Cut)
-&gt; Maybe (T2 BlockHeader Cut)
forall a b. Either a b -&gt; Maybe b
</span><span class="hs-identifier hs-var">hush</span></span><span> </span><span class="annot"><span class="annottext">(Either MineFailure (T2 BlockHeader Cut)
 -&gt; Maybe (T2 BlockHeader Cut))
-&gt; IO (Either MineFailure (T2 BlockHeader Cut))
-&gt; IO (Maybe (T2 BlockHeader Cut))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Nonce
-&gt; Time Micros
-&gt; BlockPayloadHash
-&gt; cid
-&gt; Cut
-&gt; IO (Either MineFailure (T2 BlockHeader Cut))
forall cid.
(HasChainId cid, Given WebBlockHeaderDb) =&gt;
Nonce
-&gt; Time Micros
-&gt; BlockPayloadHash
-&gt; cid
-&gt; Cut
-&gt; IO (Either MineFailure (T2 BlockHeader Cut))
</span><a href="Chainweb.Cut.Test.html#testMine"><span class="hs-identifier hs-var">testMine</span></a></span><span> </span><span class="annot"><span class="annottext">Nonce
</span><a href="#local-6989586621681492258"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Time Micros
</span><a href="#local-6989586621681492257"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">BlockPayloadHash
</span><a href="#local-6989586621681492255"><span class="hs-identifier hs-var">pay</span></a></span><span> </span><span class="annot"><span class="annottext">cid
</span><a href="#local-6989586621681492259"><span class="hs-identifier hs-var">cid</span></a></span><span> </span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492260"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-250"></span><span>
</span><span id="line-251"></span><span>    </span><span id="local-6989586621681492254"><span class="annot"><span class="annottext">v :: ChainwebVersion
</span><a href="#local-6989586621681492254"><span class="hs-identifier hs-var hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ChainGraph -&gt; ChainwebVersion
</span><a href="Chainweb.Version.html#Test"><span class="hs-identifier hs-var">Test</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WebBlockHeaderDb -&gt; ChainGraph
forall a. HasChainGraph a =&gt; a -&gt; ChainGraph
</span><a href="Chainweb.Graph.html#_chainGraph"><span class="hs-identifier hs-var">_chainGraph</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Chainweb.WebBlockHeaderDB.Types.html#WebBlockHeaderDb"><span class="hs-identifier hs-type">WebBlockHeaderDb</span></a></span><span> </span><span class="annot"><span class="annottext">WebBlockHeaderDb
forall a. Given a =&gt; a
</span><span class="hs-identifier hs-var">given</span></span><span class="hs-special">)</span><span>
</span><span id="line-252"></span><span>
</span><span id="line-253"></span><span class="annot"><a href="Chainweb.Cut.Test.html#arbitraryWebChainCut_"><span class="hs-identifier hs-type">arbitraryWebChainCut_</span></a></span><span>
</span><span id="line-254"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span>
</span><span id="line-255"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Given</span></span><span> </span><span class="annot"><a href="Chainweb.WebBlockHeaderDB.Types.html#WebBlockHeaderDb"><span class="hs-identifier hs-type">WebBlockHeaderDb</span></a></span><span>
</span><span id="line-256"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Chainweb.Cut.html#Cut"><span class="hs-identifier hs-type">Cut</span></a></span><span>
</span><span id="line-257"></span><span>        </span><span class="hs-comment">-- @genesisCut Test@ is always a valid cut</span><span>
</span><span id="line-258"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TT.GenT</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="Chainweb.Cut.html#Cut"><span class="hs-identifier hs-type">Cut</span></a></span><span>
</span><span id="line-259"></span><span id="arbitraryWebChainCut_"><span class="annot"><span class="annottext">arbitraryWebChainCut_ :: Cut -&gt; GenT IO Cut
</span><a href="Chainweb.Cut.Test.html#arbitraryWebChainCut_"><span class="hs-identifier hs-var hs-var">arbitraryWebChainCut_</span></a></span></span><span> </span><span id="local-6989586621681492250"><span class="annot"><span class="annottext">initialCut :: Cut
</span><a href="#local-6989586621681492250"><span class="hs-identifier hs-var">initialCut</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-260"></span><span>    </span><span id="local-6989586621681492249"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681492249"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; GenT IO Int) -&gt; GenT IO Int
forall (g :: * -&gt; *) a. MonadGen g =&gt; (Int -&gt; g a) -&gt; g a
</span><span class="hs-identifier hs-var">TT.sized</span></span><span> </span><span class="annot"><span class="annottext">((Int -&gt; GenT IO Int) -&gt; GenT IO Int)
-&gt; (Int -&gt; GenT IO Int) -&gt; GenT IO Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681492247"><span class="annot"><span class="annottext">s :: Int
</span><a href="#local-6989586621681492247"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Int, Int) -&gt; GenT IO Int
forall (g :: * -&gt; *) a. (MonadGen g, Random a) =&gt; (a, a) -&gt; g a
</span><span class="hs-identifier hs-var">TT.choose</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681492247"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-261"></span><span>    </span><span class="annot"><span class="annottext">(Cut -&gt; Int -&gt; GenT IO Cut) -&gt; Cut -&gt; [Int] -&gt; GenT IO Cut
forall (t :: * -&gt; *) (m :: * -&gt; *) b a.
(Foldable t, Monad m) =&gt;
(b -&gt; a -&gt; m b) -&gt; b -&gt; t a -&gt; m b
</span><span class="hs-identifier hs-var">foldlM</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621681492245"><span class="annot"><span class="annottext">c :: Cut
</span><a href="#local-6989586621681492245"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Cut -&gt; GenT IO Cut
</span><a href="#local-6989586621681492244"><span class="hs-identifier hs-var">genCut</span></a></span><span> </span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492245"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492250"><span class="hs-identifier hs-var">initialCut</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-number">0</span></span><span class="hs-glyph">..</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681492249"><span class="hs-identifier hs-var">k</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-262"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-263"></span><span>    </span><span id="local-6989586621681492244"><span class="annot"><span class="annottext">genCut :: Cut -&gt; GenT IO Cut
</span><a href="#local-6989586621681492244"><span class="hs-identifier hs-var hs-var">genCut</span></a></span></span><span> </span><span id="local-6989586621681492243"><span class="annot"><span class="annottext">c :: Cut
</span><a href="#local-6989586621681492243"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-264"></span><span>        </span><span id="local-6989586621681492242"><span class="annot"><span class="annottext">[ChainId]
</span><a href="#local-6989586621681492242"><span class="hs-identifier hs-var">cids</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Gen [ChainId] -&gt; GenT IO [ChainId]
forall (g :: * -&gt; *) a. MonadGen g =&gt; Gen a -&gt; g a
</span><span class="hs-identifier hs-var">TT.liftGen</span></span><span>
</span><span id="line-265"></span><span>            </span><span class="annot"><span class="annottext">(Gen [ChainId] -&gt; GenT IO [ChainId])
-&gt; Gen [ChainId] -&gt; GenT IO [ChainId]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[ChainId] -&gt; Gen [ChainId]
forall a. [a] -&gt; Gen [a]
</span><span class="hs-identifier hs-var">T.shuffle</span></span><span>
</span><span id="line-266"></span><span>            </span><span class="annot"><span class="annottext">([ChainId] -&gt; Gen [ChainId]) -&gt; [ChainId] -&gt; Gen [ChainId]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HashSet ChainId -&gt; [ChainId]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span>
</span><span id="line-267"></span><span>            </span><span class="annot"><span class="annottext">(HashSet ChainId -&gt; [ChainId]) -&gt; HashSet ChainId -&gt; [ChainId]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Cut -&gt; HashSet ChainId
forall v. HasChainwebVersion v =&gt; v -&gt; HashSet ChainId
</span><a href="Chainweb.Version.html#chainIds"><span class="hs-identifier hs-var">chainIds</span></a></span><span> </span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492250"><span class="hs-identifier hs-var">initialCut</span></a></span><span>
</span><span id="line-268"></span><span>        </span><span class="annot"><span class="annottext">[ChainId] -&gt; Stream (Of ChainId) (GenT IO) ()
forall (m :: * -&gt; *) (f :: * -&gt; *) a.
(Monad m, Foldable f) =&gt;
f a -&gt; Stream (Of a) m ()
</span><span class="hs-identifier hs-var">S.each</span></span><span> </span><span class="annot"><span class="annottext">[ChainId]
</span><a href="#local-6989586621681492242"><span class="hs-identifier hs-var">cids</span></a></span><span>
</span><span id="line-269"></span><span>            </span><span class="annot"><span class="annottext">Stream (Of ChainId) (GenT IO) ()
-&gt; (Stream (Of ChainId) (GenT IO) ()
    -&gt; Stream (Of (T2 BlockHeader Cut)) (GenT IO) ())
-&gt; Stream (Of (T2 BlockHeader Cut)) (GenT IO) ()
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(ChainId -&gt; GenT IO (Maybe (T2 BlockHeader Cut)))
-&gt; Stream (Of ChainId) (GenT IO) ()
-&gt; Stream (Of (T2 BlockHeader Cut)) (GenT IO) ()
forall (m :: * -&gt; *) a b r.
Monad m =&gt;
(a -&gt; m (Maybe b)) -&gt; Stream (Of a) m r -&gt; Stream (Of b) m r
</span><span class="hs-identifier hs-var">S.mapMaybeM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Either MineFailure (T2 BlockHeader Cut)
 -&gt; Maybe (T2 BlockHeader Cut))
-&gt; GenT IO (Either MineFailure (T2 BlockHeader Cut))
-&gt; GenT IO (Maybe (T2 BlockHeader Cut))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Either MineFailure (T2 BlockHeader Cut)
-&gt; Maybe (T2 BlockHeader Cut)
forall a b. Either a b -&gt; Maybe b
</span><span class="hs-identifier hs-var">hush</span></span><span> </span><span class="annot"><span class="annottext">(GenT IO (Either MineFailure (T2 BlockHeader Cut))
 -&gt; GenT IO (Maybe (T2 BlockHeader Cut)))
-&gt; (ChainId -&gt; GenT IO (Either MineFailure (T2 BlockHeader Cut)))
-&gt; ChainId
-&gt; GenT IO (Maybe (T2 BlockHeader Cut))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Cut -&gt; ChainId -&gt; GenT IO (Either MineFailure (T2 BlockHeader Cut))
forall (m :: * -&gt; *) cid.
(MonadGen m, MonadIO m, HasChainId cid) =&gt;
Cut -&gt; cid -&gt; m (Either MineFailure (T2 BlockHeader Cut))
</span><a href="#local-6989586621681492240"><span class="hs-identifier hs-var">mine</span></a></span><span> </span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492243"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-270"></span><span>            </span><span class="annot"><span class="annottext">Stream (Of (T2 BlockHeader Cut)) (GenT IO) ()
-&gt; (Stream (Of (T2 BlockHeader Cut)) (GenT IO) ()
    -&gt; Stream (Of Cut) (GenT IO) ())
-&gt; Stream (Of Cut) (GenT IO) ()
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(T2 BlockHeader Cut -&gt; Cut)
-&gt; Stream (Of (T2 BlockHeader Cut)) (GenT IO) ()
-&gt; Stream (Of Cut) (GenT IO) ()
forall (m :: * -&gt; *) a b r.
Monad m =&gt;
(a -&gt; b) -&gt; Stream (Of a) m r -&gt; Stream (Of b) m r
</span><span class="hs-identifier hs-var">S.map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">T2</span></span><span> </span><span class="hs-identifier">_</span><span> </span><span id="local-6989586621681492239"><span class="annot"><span class="annottext">c' :: Cut
</span><a href="#local-6989586621681492239"><span class="hs-identifier hs-var">c'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492239"><span class="hs-identifier hs-var">c'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-271"></span><span>            </span><span class="annot"><span class="annottext">Stream (Of Cut) (GenT IO) ()
-&gt; (Stream (Of Cut) (GenT IO) () -&gt; GenT IO (Maybe Cut))
-&gt; GenT IO (Maybe Cut)
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">Stream (Of Cut) (GenT IO) () -&gt; GenT IO (Maybe Cut)
forall (m :: * -&gt; *) a r.
Monad m =&gt;
Stream (Of a) m r -&gt; m (Maybe a)
</span><span class="hs-identifier hs-var">S.head_</span></span><span>
</span><span id="line-272"></span><span>            </span><span class="annot"><span class="annottext">GenT IO (Maybe Cut)
-&gt; (GenT IO (Maybe Cut) -&gt; GenT IO Cut) -&gt; GenT IO Cut
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Cut -&gt; Cut) -&gt; GenT IO (Maybe Cut) -&gt; GenT IO Cut
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Maybe Cut -&gt; Cut
forall a. HasCallStack =&gt; Maybe a -&gt; a
</span><a href="Chainweb.Utils.html#fromJuste"><span class="hs-identifier hs-var">fromJuste</span></a></span><span>
</span><span id="line-273"></span><span>
</span><span id="line-274"></span><span>    </span><span id="local-6989586621681492240"><span class="annot"><span class="annottext">mine :: Cut -&gt; cid -&gt; m (Either MineFailure (T2 BlockHeader Cut))
</span><a href="#local-6989586621681492240"><span class="hs-identifier hs-var hs-var">mine</span></a></span></span><span> </span><span id="local-6989586621681492238"><span class="annot"><span class="annottext">c :: Cut
</span><a href="#local-6989586621681492238"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621681492237"><span class="annot"><span class="annottext">cid :: cid
</span><a href="#local-6989586621681492237"><span class="hs-identifier hs-var">cid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-275"></span><span>        </span><span id="local-6989586621681492236"><span class="annot"><span class="annottext">Nonce
</span><a href="#local-6989586621681492236"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Nonce
</span><a href="Chainweb.BlockHeader.html#Nonce"><span class="hs-identifier hs-var">Nonce</span></a></span><span> </span><span class="annot"><span class="annottext">(Word64 -&gt; Nonce) -&gt; m Word64 -&gt; m Nonce
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Gen Word64 -&gt; m Word64
forall (g :: * -&gt; *) a. MonadGen g =&gt; Gen a -&gt; g a
</span><span class="hs-identifier hs-var">TT.liftGen</span></span><span> </span><span class="annot"><span class="annottext">Gen Word64
forall a. Arbitrary a =&gt; Gen a
</span><span class="hs-identifier hs-var">T.arbitrary</span></span><span>
</span><span id="line-276"></span><span>        </span><span id="local-6989586621681492235"><span class="annot"><span class="annottext">Time Micros
</span><a href="#local-6989586621681492235"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (Time Micros) -&gt; m (Time Micros)
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">IO (Time Micros)
forall a. Integral a =&gt; IO (Time a)
</span><a href="Chainweb.Time.html#getCurrentTimeIntegral"><span class="hs-identifier hs-var">getCurrentTimeIntegral</span></a></span><span>
</span><span id="line-277"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681492234"><span class="annot"><span class="annottext">pay :: BlockPayloadHash
</span><a href="#local-6989586621681492234"><span class="hs-identifier hs-var hs-var">pay</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ChainwebVersion -&gt; cid -&gt; ByteString -&gt; BlockPayloadHash
forall p.
HasChainId p =&gt;
ChainwebVersion -&gt; p -&gt; ByteString -&gt; BlockPayloadHash
</span><a href="Chainweb.BlockHeader.html#hashPayload"><span class="hs-identifier hs-var">hashPayload</span></a></span><span> </span><span class="annot"><span class="annottext">ChainwebVersion
</span><a href="#local-6989586621681492233"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">cid
</span><a href="#local-6989586621681492237"><span class="hs-identifier hs-var">cid</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;TEST PAYLOAD&quot;</span></span><span>
</span><span id="line-278"></span><span>        </span><span class="annot"><span class="annottext">IO (Either MineFailure (T2 BlockHeader Cut))
-&gt; m (Either MineFailure (T2 BlockHeader Cut))
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (Either MineFailure (T2 BlockHeader Cut))
 -&gt; m (Either MineFailure (T2 BlockHeader Cut)))
-&gt; IO (Either MineFailure (T2 BlockHeader Cut))
-&gt; m (Either MineFailure (T2 BlockHeader Cut))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Nonce
-&gt; Time Micros
-&gt; BlockPayloadHash
-&gt; cid
-&gt; Cut
-&gt; IO (Either MineFailure (T2 BlockHeader Cut))
forall cid.
(HasChainId cid, Given WebBlockHeaderDb) =&gt;
Nonce
-&gt; Time Micros
-&gt; BlockPayloadHash
-&gt; cid
-&gt; Cut
-&gt; IO (Either MineFailure (T2 BlockHeader Cut))
</span><a href="Chainweb.Cut.Test.html#testMine"><span class="hs-identifier hs-var">testMine</span></a></span><span> </span><span class="annot"><span class="annottext">Nonce
</span><a href="#local-6989586621681492236"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Time Micros
</span><a href="#local-6989586621681492235"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">BlockPayloadHash
</span><a href="#local-6989586621681492234"><span class="hs-identifier hs-var">pay</span></a></span><span> </span><span class="annot"><span class="annottext">cid
</span><a href="#local-6989586621681492237"><span class="hs-identifier hs-var">cid</span></a></span><span> </span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492238"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-279"></span><span>
</span><span id="line-280"></span><span>    </span><span id="local-6989586621681492233"><span class="annot"><span class="annottext">v :: ChainwebVersion
</span><a href="#local-6989586621681492233"><span class="hs-identifier hs-var hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ChainGraph -&gt; ChainwebVersion
</span><a href="Chainweb.Version.html#Test"><span class="hs-identifier hs-var">Test</span></a></span><span> </span><span class="annot"><span class="annottext">(ChainGraph -&gt; ChainwebVersion) -&gt; ChainGraph -&gt; ChainwebVersion
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">WebBlockHeaderDb -&gt; ChainGraph
forall a. HasChainGraph a =&gt; a -&gt; ChainGraph
</span><a href="Chainweb.Graph.html#_chainGraph"><span class="hs-identifier hs-var">_chainGraph</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Chainweb.WebBlockHeaderDB.Types.html#WebBlockHeaderDb"><span class="hs-identifier hs-type">WebBlockHeaderDb</span></a></span><span> </span><span class="annot"><span class="annottext">WebBlockHeaderDb
forall a. Given a =&gt; a
</span><span class="hs-identifier hs-var">given</span></span><span>
</span><span id="line-281"></span><span>
</span><span id="line-282"></span><span class="hs-comment">-- -------------------------------------------------------------------------- --</span><span>
</span><span id="line-283"></span><span class="hs-comment">-- Arbitrary Fork</span><span>
</span><span id="line-284"></span><span>
</span><span id="line-285"></span><span class="annot"><a href="Chainweb.Cut.Test.html#testGenCut"><span class="hs-identifier hs-type">testGenCut</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Given</span></span><span> </span><span class="annot"><a href="Chainweb.WebBlockHeaderDB.Types.html#WebBlockHeaderDb"><span class="hs-identifier hs-type">WebBlockHeaderDb</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Chainweb.Cut.html#Cut"><span class="hs-identifier hs-type">Cut</span></a></span><span>
</span><span id="line-286"></span><span id="testGenCut"><span class="annot"><span class="annottext">testGenCut :: Cut
</span><a href="Chainweb.Cut.Test.html#testGenCut"><span class="hs-identifier hs-var hs-var">testGenCut</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ChainwebVersion -&gt; Cut
</span><a href="Chainweb.Cut.html#genesisCut"><span class="hs-identifier hs-var">genesisCut</span></a></span><span> </span><span class="annot"><span class="annottext">(ChainwebVersion -&gt; Cut) -&gt; ChainwebVersion -&gt; Cut
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ChainGraph -&gt; ChainwebVersion
</span><a href="Chainweb.Version.html#Test"><span class="hs-identifier hs-var">Test</span></a></span><span> </span><span class="annot"><span class="annottext">(ChainGraph -&gt; ChainwebVersion) -&gt; ChainGraph -&gt; ChainwebVersion
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">WebBlockHeaderDb -&gt; ChainGraph
forall a. HasChainGraph a =&gt; a -&gt; ChainGraph
</span><a href="Chainweb.Graph.html#_chainGraph"><span class="hs-identifier hs-var">_chainGraph</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Chainweb.WebBlockHeaderDB.Types.html#WebBlockHeaderDb"><span class="hs-identifier hs-type">WebBlockHeaderDb</span></a></span><span> </span><span class="annot"><span class="annottext">WebBlockHeaderDb
forall a. Given a =&gt; a
</span><span class="hs-identifier hs-var">given</span></span><span>
</span><span id="line-287"></span><span>
</span><span id="line-288"></span><span id="local-6989586621681492230"><span id="local-6989586621681492231"></span></span><span class="hs-keyword">data</span><span> </span><span id="TestFork"><span class="annot"><a href="Chainweb.Cut.Test.html#TestFork"><span class="hs-identifier hs-var">TestFork</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="TestFork"><span class="annot"><a href="Chainweb.Cut.Test.html#TestFork"><span class="hs-identifier hs-var">TestFork</span></a></span></span><span>
</span><span id="line-289"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="_testForkBase"><span class="annot"><span class="annottext">TestFork -&gt; Cut
</span><a href="Chainweb.Cut.Test.html#_testForkBase"><span class="hs-identifier hs-var hs-var">_testForkBase</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Chainweb.Cut.html#Cut"><span class="hs-identifier hs-type">Cut</span></a></span><span>
</span><span id="line-290"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="_testForkLeft"><span class="annot"><span class="annottext">TestFork -&gt; Cut
</span><a href="Chainweb.Cut.Test.html#_testForkLeft"><span class="hs-identifier hs-var hs-var">_testForkLeft</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Chainweb.Cut.html#Cut"><span class="hs-identifier hs-type">Cut</span></a></span><span>
</span><span id="line-291"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="_testForkRight"><span class="annot"><span class="annottext">TestFork -&gt; Cut
</span><a href="Chainweb.Cut.Test.html#_testForkRight"><span class="hs-identifier hs-var hs-var">_testForkRight</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Chainweb.Cut.html#Cut"><span class="hs-identifier hs-type">Cut</span></a></span><span>
</span><span id="line-292"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-293"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681492220"><span id="local-6989586621681492222"><span id="local-6989586621681492224"><span class="annot"><span class="annottext">Int -&gt; TestFork -&gt; [Char] -&gt; [Char]
[TestFork] -&gt; [Char] -&gt; [Char]
TestFork -&gt; [Char]
(Int -&gt; TestFork -&gt; [Char] -&gt; [Char])
-&gt; (TestFork -&gt; [Char])
-&gt; ([TestFork] -&gt; [Char] -&gt; [Char])
-&gt; Show TestFork
forall a.
(Int -&gt; a -&gt; [Char] -&gt; [Char])
-&gt; (a -&gt; [Char]) -&gt; ([a] -&gt; [Char] -&gt; [Char]) -&gt; Show a
showList :: [TestFork] -&gt; [Char] -&gt; [Char]
$cshowList :: [TestFork] -&gt; [Char] -&gt; [Char]
show :: TestFork -&gt; [Char]
$cshow :: TestFork -&gt; [Char]
showsPrec :: Int -&gt; TestFork -&gt; [Char] -&gt; [Char]
$cshowsPrec :: Int -&gt; TestFork -&gt; [Char] -&gt; [Char]
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681492215"><span id="local-6989586621681492217"><span class="annot"><span class="annottext">TestFork -&gt; TestFork -&gt; Bool
(TestFork -&gt; TestFork -&gt; Bool)
-&gt; (TestFork -&gt; TestFork -&gt; Bool) -&gt; Eq TestFork
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: TestFork -&gt; TestFork -&gt; Bool
$c/= :: TestFork -&gt; TestFork -&gt; Bool
== :: TestFork -&gt; TestFork -&gt; Bool
$c== :: TestFork -&gt; TestFork -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681492199"><span id="local-6989586621681492201"><span id="local-6989586621681492203"><span id="local-6989586621681492205"><span id="local-6989586621681492207"><span id="local-6989586621681492209"><span id="local-6989586621681492211"><span class="annot"><span class="annottext">Eq TestFork
Eq TestFork =&gt;
(TestFork -&gt; TestFork -&gt; Ordering)
-&gt; (TestFork -&gt; TestFork -&gt; Bool)
-&gt; (TestFork -&gt; TestFork -&gt; Bool)
-&gt; (TestFork -&gt; TestFork -&gt; Bool)
-&gt; (TestFork -&gt; TestFork -&gt; Bool)
-&gt; (TestFork -&gt; TestFork -&gt; TestFork)
-&gt; (TestFork -&gt; TestFork -&gt; TestFork)
-&gt; Ord TestFork
TestFork -&gt; TestFork -&gt; Bool
TestFork -&gt; TestFork -&gt; Ordering
TestFork -&gt; TestFork -&gt; TestFork
forall a.
Eq a =&gt;
(a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
min :: TestFork -&gt; TestFork -&gt; TestFork
$cmin :: TestFork -&gt; TestFork -&gt; TestFork
max :: TestFork -&gt; TestFork -&gt; TestFork
$cmax :: TestFork -&gt; TestFork -&gt; TestFork
&gt;= :: TestFork -&gt; TestFork -&gt; Bool
$c&gt;= :: TestFork -&gt; TestFork -&gt; Bool
&gt; :: TestFork -&gt; TestFork -&gt; Bool
$c&gt; :: TestFork -&gt; TestFork -&gt; Bool
&lt;= :: TestFork -&gt; TestFork -&gt; Bool
$c&lt;= :: TestFork -&gt; TestFork -&gt; Bool
&lt; :: TestFork -&gt; TestFork -&gt; Bool
$c&lt; :: TestFork -&gt; TestFork -&gt; Bool
compare :: TestFork -&gt; TestFork -&gt; Ordering
$ccompare :: TestFork -&gt; TestFork -&gt; Ordering
$cp1Ord :: Eq TestFork
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(forall x. TestFork -&gt; Rep TestFork x)
-&gt; (forall x. Rep TestFork x -&gt; TestFork) -&gt; Generic TestFork
forall x. Rep TestFork x -&gt; TestFork
forall x. TestFork -&gt; Rep TestFork x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep TestFork x -&gt; TestFork
$cfrom :: forall x. TestFork -&gt; Rep TestFork x
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></span><span class="hs-special">)</span><span>
</span><span id="line-294"></span><span>
</span><span id="line-295"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681492192"><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Given</span></span><span> </span><span class="annot"><a href="Chainweb.WebBlockHeaderDB.Types.html#WebBlockHeaderDb"><span class="hs-identifier hs-type">WebBlockHeaderDb</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Arbitrary</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="Chainweb.Cut.Test.html#TestFork"><span class="hs-identifier hs-type">TestFork</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-296"></span><span>    </span><span id="local-6989586621681492191"><span class="annot"><span class="annottext">arbitrary :: Gen (IO TestFork)
</span><a href="#local-6989586621681492191"><span class="hs-identifier hs-var hs-var hs-var hs-var">arbitrary</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenT IO TestFork -&gt; Gen (IO TestFork)
forall (m :: * -&gt; *) a. GenT m a -&gt; Gen (m a)
</span><span class="hs-identifier hs-var">TT.runGenT</span></span><span> </span><span class="annot"><span class="annottext">GenT IO TestFork
Given WebBlockHeaderDb =&gt; GenT IO TestFork
</span><a href="Chainweb.Cut.Test.html#arbitraryFork_"><span class="hs-identifier hs-var">arbitraryFork_</span></a></span><span>
</span><span id="line-297"></span><span>
</span><span id="line-298"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681492186"><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Given</span></span><span> </span><span class="annot"><a href="Chainweb.WebBlockHeaderDB.Types.html#WebBlockHeaderDb"><span class="hs-identifier hs-type">WebBlockHeaderDb</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Arbitrary</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.Cut.html#Join"><span class="hs-identifier hs-type">Join</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-299"></span><span>    </span><span id="local-6989586621681492185"><span class="annot"><span class="annottext">arbitrary :: Gen (IO (Join Int))
</span><a href="#local-6989586621681492185"><span class="hs-identifier hs-var hs-var hs-var hs-var">arbitrary</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenT IO (Join Int) -&gt; Gen (IO (Join Int))
forall (m :: * -&gt; *) a. GenT m a -&gt; Gen (m a)
</span><span class="hs-identifier hs-var">TT.runGenT</span></span><span> </span><span class="annot"><span class="annottext">(GenT IO (Join Int) -&gt; Gen (IO (Join Int)))
-&gt; GenT IO (Join Int) -&gt; Gen (IO (Join Int))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-300"></span><span>        </span><span class="annot"><a href="Chainweb.Cut.Test.html#TestFork"><span class="hs-identifier hs-type">TestFork</span></a></span><span> </span><span class="hs-identifier">_</span><span> </span><span id="local-6989586621681492184"><span class="annot"><span class="annottext">cl :: Cut
</span><a href="#local-6989586621681492184"><span class="hs-identifier hs-var">cl</span></a></span></span><span> </span><span id="local-6989586621681492183"><span class="annot"><span class="annottext">cr :: Cut
</span><a href="#local-6989586621681492183"><span class="hs-identifier hs-var">cr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">GenT IO TestFork
Given WebBlockHeaderDb =&gt; GenT IO TestFork
</span><a href="Chainweb.Cut.Test.html#arbitraryFork_"><span class="hs-identifier hs-var">arbitraryFork_</span></a></span><span>
</span><span id="line-301"></span><span>        </span><span class="annot"><span class="annottext">IO (Join Int) -&gt; GenT IO (Join Int)
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (Join Int) -&gt; GenT IO (Join Int))
-&gt; IO (Join Int) -&gt; GenT IO (Join Int)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">WebBlockHeaderDb
-&gt; (DiffItem BlockHeader -&gt; DiffItem (Maybe Int))
-&gt; Cut
-&gt; Cut
-&gt; IO (Join Int)
forall a.
Ord a =&gt;
WebBlockHeaderDb
-&gt; (DiffItem BlockHeader -&gt; DiffItem (Maybe a))
-&gt; Cut
-&gt; Cut
-&gt; IO (Join a)
</span><a href="Chainweb.Cut.html#join"><span class="hs-identifier hs-var">join</span></a></span><span> </span><span class="annot"><span class="annottext">WebBlockHeaderDb
forall a. Given a =&gt; a
</span><span class="hs-identifier hs-var">given</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Cut -&gt; Cut -&gt; DiffItem BlockHeader -&gt; DiffItem (Maybe Int)
</span><a href="Chainweb.Cut.html#prioritizeHeavier"><span class="hs-identifier hs-var">prioritizeHeavier</span></a></span><span> </span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492184"><span class="hs-identifier hs-var">cl</span></a></span><span> </span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492183"><span class="hs-identifier hs-var">cr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492184"><span class="hs-identifier hs-var">cl</span></a></span><span> </span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492183"><span class="hs-identifier hs-var">cr</span></a></span><span>
</span><span id="line-302"></span><span>
</span><span id="line-303"></span><span class="hs-comment">-- | Fork point is the genesis cut</span><span>
</span><span id="line-304"></span><span class="hs-comment">--</span><span>
</span><span id="line-305"></span><span class="hs-comment">-- TODO: provide option to fork of elsewhere</span><span>
</span><span id="line-306"></span><span class="hs-comment">--</span><span>
</span><span id="line-307"></span><span class="annot"><a href="Chainweb.Cut.Test.html#arbitraryFork"><span class="hs-identifier hs-type">arbitraryFork</span></a></span><span>
</span><span id="line-308"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Given</span></span><span> </span><span class="annot"><a href="Chainweb.WebBlockHeaderDB.Types.html#WebBlockHeaderDb"><span class="hs-identifier hs-type">WebBlockHeaderDb</span></a></span><span>
</span><span id="line-309"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.PropertyM</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="Chainweb.Cut.Test.html#TestFork"><span class="hs-identifier hs-type">TestFork</span></a></span><span>
</span><span id="line-310"></span><span id="arbitraryFork"><span class="annot"><span class="annottext">arbitraryFork :: PropertyM IO TestFork
</span><a href="Chainweb.Cut.Test.html#arbitraryFork"><span class="hs-identifier hs-var hs-var">arbitraryFork</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-311"></span><span>    </span><span id="local-6989586621681492179"><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492179"><span class="hs-identifier hs-var">base</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HasCallStack, Given WebBlockHeaderDb) =&gt; Cut -&gt; PropertyM IO Cut
Cut -&gt; PropertyM IO Cut
</span><a href="Chainweb.Cut.Test.html#arbitraryWebChainCut"><span class="hs-identifier hs-var">arbitraryWebChainCut</span></a></span><span> </span><span class="annot"><span class="annottext">Cut
Given WebBlockHeaderDb =&gt; Cut
</span><a href="Chainweb.Cut.Test.html#testGenCut"><span class="hs-identifier hs-var">testGenCut</span></a></span><span>
</span><span id="line-312"></span><span>    </span><span class="annot"><span class="annottext">Cut -&gt; Cut -&gt; Cut -&gt; TestFork
</span><a href="Chainweb.Cut.Test.html#TestFork"><span class="hs-identifier hs-var">TestFork</span></a></span><span> </span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492179"><span class="hs-identifier hs-var">base</span></a></span><span>
</span><span id="line-313"></span><span>        </span><span class="annot"><span class="annottext">(Cut -&gt; Cut -&gt; TestFork)
-&gt; PropertyM IO Cut -&gt; PropertyM IO (Cut -&gt; TestFork)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(HasCallStack, Given WebBlockHeaderDb) =&gt; Cut -&gt; PropertyM IO Cut
Cut -&gt; PropertyM IO Cut
</span><a href="Chainweb.Cut.Test.html#arbitraryWebChainCut"><span class="hs-identifier hs-var">arbitraryWebChainCut</span></a></span><span> </span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492179"><span class="hs-identifier hs-var">base</span></a></span><span>
</span><span id="line-314"></span><span>        </span><span class="annot"><span class="annottext">PropertyM IO (Cut -&gt; TestFork)
-&gt; PropertyM IO Cut -&gt; PropertyM IO TestFork
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">(HasCallStack, Given WebBlockHeaderDb) =&gt; Cut -&gt; PropertyM IO Cut
Cut -&gt; PropertyM IO Cut
</span><a href="Chainweb.Cut.Test.html#arbitraryWebChainCut"><span class="hs-identifier hs-var">arbitraryWebChainCut</span></a></span><span> </span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492179"><span class="hs-identifier hs-var">base</span></a></span><span>
</span><span id="line-315"></span><span>
</span><span id="line-316"></span><span class="annot"><a href="Chainweb.Cut.Test.html#arbitraryFork_"><span class="hs-identifier hs-type">arbitraryFork_</span></a></span><span>
</span><span id="line-317"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Given</span></span><span> </span><span class="annot"><a href="Chainweb.WebBlockHeaderDB.Types.html#WebBlockHeaderDb"><span class="hs-identifier hs-type">WebBlockHeaderDb</span></a></span><span>
</span><span id="line-318"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TT.GenT</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="Chainweb.Cut.Test.html#TestFork"><span class="hs-identifier hs-type">TestFork</span></a></span><span>
</span><span id="line-319"></span><span id="arbitraryFork_"><span class="annot"><span class="annottext">arbitraryFork_ :: GenT IO TestFork
</span><a href="Chainweb.Cut.Test.html#arbitraryFork_"><span class="hs-identifier hs-var hs-var">arbitraryFork_</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-320"></span><span>    </span><span id="local-6989586621681492178"><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492178"><span class="hs-identifier hs-var">base</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HasCallStack, Given WebBlockHeaderDb) =&gt; Cut -&gt; GenT IO Cut
Cut -&gt; GenT IO Cut
</span><a href="Chainweb.Cut.Test.html#arbitraryWebChainCut_"><span class="hs-identifier hs-var">arbitraryWebChainCut_</span></a></span><span> </span><span class="annot"><span class="annottext">Cut
Given WebBlockHeaderDb =&gt; Cut
</span><a href="Chainweb.Cut.Test.html#testGenCut"><span class="hs-identifier hs-var">testGenCut</span></a></span><span>
</span><span id="line-321"></span><span>    </span><span class="annot"><span class="annottext">Cut -&gt; Cut -&gt; Cut -&gt; TestFork
</span><a href="Chainweb.Cut.Test.html#TestFork"><span class="hs-identifier hs-var">TestFork</span></a></span><span> </span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492178"><span class="hs-identifier hs-var">base</span></a></span><span>
</span><span id="line-322"></span><span>        </span><span class="annot"><span class="annottext">(Cut -&gt; Cut -&gt; TestFork)
-&gt; GenT IO Cut -&gt; GenT IO (Cut -&gt; TestFork)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(HasCallStack, Given WebBlockHeaderDb) =&gt; Cut -&gt; GenT IO Cut
Cut -&gt; GenT IO Cut
</span><a href="Chainweb.Cut.Test.html#arbitraryWebChainCut_"><span class="hs-identifier hs-var">arbitraryWebChainCut_</span></a></span><span> </span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492178"><span class="hs-identifier hs-var">base</span></a></span><span>
</span><span id="line-323"></span><span>        </span><span class="annot"><span class="annottext">GenT IO (Cut -&gt; TestFork) -&gt; GenT IO Cut -&gt; GenT IO TestFork
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">(HasCallStack, Given WebBlockHeaderDb) =&gt; Cut -&gt; GenT IO Cut
Cut -&gt; GenT IO Cut
</span><a href="Chainweb.Cut.Test.html#arbitraryWebChainCut_"><span class="hs-identifier hs-var">arbitraryWebChainCut_</span></a></span><span> </span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492178"><span class="hs-identifier hs-var">base</span></a></span><span>
</span><span id="line-324"></span><span>
</span><span id="line-325"></span><span class="hs-comment">-- -------------------------------------------------------------------------- --</span><span>
</span><span id="line-326"></span><span class="hs-comment">-- 'meet' and 'join' form a lattice with genesisCut as bottom</span><span>
</span><span id="line-327"></span><span class="hs-comment">--</span><span>
</span><span id="line-328"></span><span class="hs-comment">-- The order of the lattice is conistent with the weight order.</span><span>
</span><span id="line-329"></span><span class="hs-comment">--</span><span>
</span><span id="line-330"></span><span class="hs-comment">-- Note:</span><span>
</span><span id="line-331"></span><span class="hs-comment">--</span><span>
</span><span id="line-332"></span><span class="hs-comment">-- * The non-optimal join function 'joinIntoHeavier' doesn't satisfy the lattice</span><span>
</span><span id="line-333"></span><span class="hs-comment">--   laws In particular associativity. However it must satisfy commutativity,</span><span>
</span><span id="line-334"></span><span class="hs-comment">--   for reasonably fast convergence.</span><span>
</span><span id="line-335"></span><span class="hs-comment">--</span><span>
</span><span id="line-336"></span><span class="hs-comment">-- * 'joinIntoHeavier' is likely to be optimal on low diameter graphs even for</span><span>
</span><span id="line-337"></span><span class="hs-comment">--   relatively small test instance size parameters, because it is optimal when</span><span>
</span><span id="line-338"></span><span class="hs-comment">--   a fork on a chain is longer than the diameter.)</span><span>
</span><span id="line-339"></span><span class="hs-comment">--</span><span>
</span><span id="line-340"></span><span class="hs-comment">-- * for fork of depth 1 'joinIntoHeavier' is not a good strategy.</span><span>
</span><span id="line-341"></span><span class="hs-comment">--</span><span>
</span><span id="line-342"></span><span class="hs-comment">-- * TODO: properties about consistency of order</span><span>
</span><span id="line-343"></span><span class="hs-comment">--</span><span>
</span><span id="line-344"></span><span>
</span><span id="line-345"></span><span class="hs-comment">-- Join</span><span>
</span><span id="line-346"></span><span>
</span><span id="line-347"></span><span class="annot"><a href="Chainweb.Cut.Test.html#prop_joinIdempotent"><span class="hs-identifier hs-type">prop_joinIdempotent</span></a></span><span>
</span><span id="line-348"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Given</span></span><span> </span><span class="annot"><a href="Chainweb.WebBlockHeaderDB.Types.html#WebBlockHeaderDb"><span class="hs-identifier hs-type">WebBlockHeaderDb</span></a></span><span>
</span><span id="line-349"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.PropertyM</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-350"></span><span id="prop_joinIdempotent"><span class="annot"><span class="annottext">prop_joinIdempotent :: PropertyM IO Bool
</span><a href="Chainweb.Cut.Test.html#prop_joinIdempotent"><span class="hs-identifier hs-var hs-var">prop_joinIdempotent</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-351"></span><span>    </span><span id="local-6989586621681492176"><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492176"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HasCallStack, Given WebBlockHeaderDb) =&gt; Cut -&gt; PropertyM IO Cut
Cut -&gt; PropertyM IO Cut
</span><a href="Chainweb.Cut.Test.html#arbitraryWebChainCut"><span class="hs-identifier hs-var">arbitraryWebChainCut</span></a></span><span> </span><span class="annot"><span class="annottext">Cut
Given WebBlockHeaderDb =&gt; Cut
</span><a href="Chainweb.Cut.Test.html#testGenCut"><span class="hs-identifier hs-var">testGenCut</span></a></span><span>
</span><span id="line-352"></span><span>    </span><span class="annot"><span class="annottext">IO Bool -&gt; PropertyM IO Bool
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; PropertyM m a
</span><span class="hs-identifier hs-var">T.run</span></span><span> </span><span class="annot"><span class="annottext">(IO Bool -&gt; PropertyM IO Bool) -&gt; IO Bool -&gt; PropertyM IO Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Cut -&gt; Cut -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">(==)</span></span><span> </span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492176"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">(Cut -&gt; Bool) -&gt; IO Cut -&gt; IO Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">WebBlockHeaderDb -&gt; Cut -&gt; Cut -&gt; IO Cut
</span><a href="Chainweb.Cut.html#joinIntoHeavier"><span class="hs-identifier hs-var">joinIntoHeavier</span></a></span><span> </span><span class="annot"><span class="annottext">WebBlockHeaderDb
forall a. Given a =&gt; a
</span><span class="hs-identifier hs-var">given</span></span><span> </span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492176"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492176"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-353"></span><span>
</span><span id="line-354"></span><span class="hs-comment">-- FIXME!</span><span>
</span><span id="line-355"></span><span class="annot"><a href="Chainweb.Cut.Test.html#prop_joinCommutative"><span class="hs-identifier hs-type">prop_joinCommutative</span></a></span><span>
</span><span id="line-356"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Given</span></span><span> </span><span class="annot"><a href="Chainweb.WebBlockHeaderDB.Types.html#WebBlockHeaderDb"><span class="hs-identifier hs-type">WebBlockHeaderDb</span></a></span><span>
</span><span id="line-357"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.PropertyM</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-358"></span><span id="prop_joinCommutative"><span class="annot"><span class="annottext">prop_joinCommutative :: PropertyM IO Bool
</span><a href="Chainweb.Cut.Test.html#prop_joinCommutative"><span class="hs-identifier hs-var hs-var">prop_joinCommutative</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-359"></span><span>    </span><span class="annot"><a href="Chainweb.Cut.Test.html#TestFork"><span class="hs-identifier hs-type">TestFork</span></a></span><span> </span><span class="hs-identifier">_</span><span> </span><span id="local-6989586621681492172"><span class="annot"><span class="annottext">cl :: Cut
</span><a href="#local-6989586621681492172"><span class="hs-identifier hs-var">cl</span></a></span></span><span> </span><span id="local-6989586621681492171"><span class="annot"><span class="annottext">cr :: Cut
</span><a href="#local-6989586621681492171"><span class="hs-identifier hs-var">cr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PropertyM IO TestFork
Given WebBlockHeaderDb =&gt; PropertyM IO TestFork
</span><a href="Chainweb.Cut.Test.html#arbitraryFork"><span class="hs-identifier hs-var">arbitraryFork</span></a></span><span>
</span><span id="line-360"></span><span>    </span><span class="annot"><span class="annottext">IO Bool -&gt; PropertyM IO Bool
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; PropertyM m a
</span><span class="hs-identifier hs-var">T.run</span></span><span> </span><span class="annot"><span class="annottext">(IO Bool -&gt; PropertyM IO Bool) -&gt; IO Bool -&gt; PropertyM IO Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Cut -&gt; Cut -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">(==)</span></span><span>
</span><span id="line-361"></span><span>        </span><span class="annot"><span class="annottext">(Cut -&gt; Cut -&gt; Bool) -&gt; IO Cut -&gt; IO (Cut -&gt; Bool)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">WebBlockHeaderDb -&gt; Cut -&gt; Cut -&gt; IO Cut
</span><a href="Chainweb.Cut.html#joinIntoHeavier"><span class="hs-identifier hs-var">joinIntoHeavier</span></a></span><span> </span><span class="annot"><span class="annottext">WebBlockHeaderDb
forall a. Given a =&gt; a
</span><span class="hs-identifier hs-var">given</span></span><span> </span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492172"><span class="hs-identifier hs-var">cl</span></a></span><span> </span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492171"><span class="hs-identifier hs-var">cr</span></a></span><span>
</span><span id="line-362"></span><span>        </span><span class="annot"><span class="annottext">IO (Cut -&gt; Bool) -&gt; IO Cut -&gt; IO Bool
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">WebBlockHeaderDb -&gt; Cut -&gt; Cut -&gt; IO Cut
</span><a href="Chainweb.Cut.html#joinIntoHeavier"><span class="hs-identifier hs-var">joinIntoHeavier</span></a></span><span> </span><span class="annot"><span class="annottext">WebBlockHeaderDb
forall a. Given a =&gt; a
</span><span class="hs-identifier hs-var">given</span></span><span> </span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492171"><span class="hs-identifier hs-var">cr</span></a></span><span> </span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492172"><span class="hs-identifier hs-var">cl</span></a></span><span>
</span><span id="line-363"></span><span>
</span><span id="line-364"></span><span class="hs-comment">-- Fails for heuristic joins</span><span>
</span><span id="line-365"></span><span class="hs-comment">--</span><span>
</span><span id="line-366"></span><span class="annot"><a href="Chainweb.Cut.Test.html#prop_joinAssociative"><span class="hs-identifier hs-type">prop_joinAssociative</span></a></span><span>
</span><span id="line-367"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Given</span></span><span> </span><span class="annot"><a href="Chainweb.WebBlockHeaderDB.Types.html#WebBlockHeaderDb"><span class="hs-identifier hs-type">WebBlockHeaderDb</span></a></span><span>
</span><span id="line-368"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.PropertyM</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-369"></span><span id="prop_joinAssociative"><span class="annot"><span class="annottext">prop_joinAssociative :: PropertyM IO Bool
</span><a href="Chainweb.Cut.Test.html#prop_joinAssociative"><span class="hs-identifier hs-var hs-var">prop_joinAssociative</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-370"></span><span>    </span><span class="annot"><a href="Chainweb.Cut.Test.html#TestFork"><span class="hs-identifier hs-type">TestFork</span></a></span><span> </span><span class="hs-identifier">_</span><span> </span><span id="local-6989586621681492169"><span class="annot"><span class="annottext">c0 :: Cut
</span><a href="#local-6989586621681492169"><span class="hs-identifier hs-var">c0</span></a></span></span><span> </span><span id="local-6989586621681492168"><span class="annot"><span class="annottext">c1 :: Cut
</span><a href="#local-6989586621681492168"><span class="hs-identifier hs-var">c1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PropertyM IO TestFork
Given WebBlockHeaderDb =&gt; PropertyM IO TestFork
</span><a href="Chainweb.Cut.Test.html#arbitraryFork"><span class="hs-identifier hs-var">arbitraryFork</span></a></span><span>
</span><span id="line-371"></span><span>    </span><span class="annot"><a href="Chainweb.Cut.Test.html#TestFork"><span class="hs-identifier hs-type">TestFork</span></a></span><span> </span><span class="hs-identifier">_</span><span> </span><span id="local-6989586621681492167"><span class="annot"><span class="annottext">c10 :: Cut
</span><a href="#local-6989586621681492167"><span class="hs-identifier hs-var">c10</span></a></span></span><span> </span><span id="local-6989586621681492166"><span class="annot"><span class="annottext">c11 :: Cut
</span><a href="#local-6989586621681492166"><span class="hs-identifier hs-var">c11</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cut -&gt; Cut -&gt; Cut -&gt; TestFork
</span><a href="Chainweb.Cut.Test.html#TestFork"><span class="hs-identifier hs-var">TestFork</span></a></span><span> </span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492168"><span class="hs-identifier hs-var">c1</span></a></span><span>
</span><span id="line-372"></span><span>        </span><span class="annot"><span class="annottext">(Cut -&gt; Cut -&gt; TestFork)
-&gt; PropertyM IO Cut -&gt; PropertyM IO (Cut -&gt; TestFork)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(HasCallStack, Given WebBlockHeaderDb) =&gt; Cut -&gt; PropertyM IO Cut
Cut -&gt; PropertyM IO Cut
</span><a href="Chainweb.Cut.Test.html#arbitraryWebChainCut"><span class="hs-identifier hs-var">arbitraryWebChainCut</span></a></span><span> </span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492168"><span class="hs-identifier hs-var">c1</span></a></span><span>
</span><span id="line-373"></span><span>        </span><span class="annot"><span class="annottext">PropertyM IO (Cut -&gt; TestFork)
-&gt; PropertyM IO Cut -&gt; PropertyM IO TestFork
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">(HasCallStack, Given WebBlockHeaderDb) =&gt; Cut -&gt; PropertyM IO Cut
Cut -&gt; PropertyM IO Cut
</span><a href="Chainweb.Cut.Test.html#arbitraryWebChainCut"><span class="hs-identifier hs-var">arbitraryWebChainCut</span></a></span><span> </span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492168"><span class="hs-identifier hs-var">c1</span></a></span><span>
</span><span id="line-374"></span><span>
</span><span id="line-375"></span><span>    </span><span class="hs-comment">-- d0 &lt;- T.run $ forkDepth c10 c11</span><span>
</span><span id="line-376"></span><span>    </span><span class="hs-comment">-- T.pre (diameter (given @ChainGraph) &lt;= d0)</span><span>
</span><span id="line-377"></span><span>    </span><span class="hs-comment">-- T.monitor (T.counterexample $ &quot;fork depth: &quot; &lt;&gt; sshow d0)</span><span>
</span><span id="line-378"></span><span>    </span><span class="hs-comment">-- d1 &lt;- T.run $ forkDepth c0 c10</span><span>
</span><span id="line-379"></span><span>    </span><span class="hs-comment">-- T.pre (diameter (given @ChainGraph) &lt;= d1)</span><span>
</span><span id="line-380"></span><span>    </span><span class="hs-comment">-- T.monitor (T.counterexample $ &quot;fork depth: &quot; &lt;&gt; sshow d1)</span><span>
</span><span id="line-381"></span><span>
</span><span id="line-382"></span><span>    </span><span class="annot"><span class="annottext">IO Bool -&gt; PropertyM IO Bool
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; PropertyM m a
</span><span class="hs-identifier hs-var">T.run</span></span><span> </span><span class="annot"><span class="annottext">(IO Bool -&gt; PropertyM IO Bool) -&gt; IO Bool -&gt; PropertyM IO Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-383"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681492165"><span class="annot"><span class="annottext">m :: Cut -&gt; Cut -&gt; IO Cut
</span><a href="#local-6989586621681492165"><span class="hs-identifier hs-var hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WebBlockHeaderDb -&gt; Cut -&gt; Cut -&gt; IO Cut
</span><a href="Chainweb.Cut.html#joinIntoHeavier"><span class="hs-identifier hs-var">joinIntoHeavier</span></a></span><span> </span><span class="annot"><span class="annottext">WebBlockHeaderDb
forall a. Given a =&gt; a
</span><span class="hs-identifier hs-var">given</span></span><span>
</span><span id="line-384"></span><span>        </span><span class="annot"><span class="annottext">Cut -&gt; Cut -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">(==)</span></span><span>
</span><span id="line-385"></span><span>            </span><span class="annot"><span class="annottext">(Cut -&gt; Cut -&gt; Bool) -&gt; IO Cut -&gt; IO (Cut -&gt; Bool)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Cut -&gt; Cut -&gt; IO Cut
</span><a href="#local-6989586621681492165"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492169"><span class="hs-identifier hs-var">c0</span></a></span><span> </span><span class="annot"><span class="annottext">(Cut -&gt; IO Cut) -&gt; IO Cut -&gt; IO Cut
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">Cut -&gt; Cut -&gt; IO Cut
</span><a href="#local-6989586621681492165"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492167"><span class="hs-identifier hs-var">c10</span></a></span><span> </span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492166"><span class="hs-identifier hs-var">c11</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-386"></span><span>            </span><span class="annot"><span class="annottext">IO (Cut -&gt; Bool) -&gt; IO Cut -&gt; IO Bool
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Cut -&gt; Cut -&gt; IO Cut
</span><a href="#local-6989586621681492165"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492169"><span class="hs-identifier hs-var">c0</span></a></span><span> </span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492167"><span class="hs-identifier hs-var">c10</span></a></span><span> </span><span class="annot"><span class="annottext">IO Cut -&gt; (Cut -&gt; IO Cut) -&gt; IO Cut
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681492163"><span class="annot"><span class="annottext">x :: Cut
</span><a href="#local-6989586621681492163"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Cut -&gt; Cut -&gt; IO Cut
</span><a href="#local-6989586621681492165"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492163"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492166"><span class="hs-identifier hs-var">c11</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-387"></span><span>
</span><span id="line-388"></span><span class="annot"><a href="Chainweb.Cut.Test.html#prop_joinIdentity"><span class="hs-identifier hs-type">prop_joinIdentity</span></a></span><span>
</span><span id="line-389"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Given</span></span><span> </span><span class="annot"><a href="Chainweb.WebBlockHeaderDB.Types.html#WebBlockHeaderDb"><span class="hs-identifier hs-type">WebBlockHeaderDb</span></a></span><span>
</span><span id="line-390"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.PropertyM</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-391"></span><span id="prop_joinIdentity"><span class="annot"><span class="annottext">prop_joinIdentity :: PropertyM IO Bool
</span><a href="Chainweb.Cut.Test.html#prop_joinIdentity"><span class="hs-identifier hs-var hs-var">prop_joinIdentity</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-392"></span><span>    </span><span id="local-6989586621681492161"><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492161"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HasCallStack, Given WebBlockHeaderDb) =&gt; Cut -&gt; PropertyM IO Cut
Cut -&gt; PropertyM IO Cut
</span><a href="Chainweb.Cut.Test.html#arbitraryWebChainCut"><span class="hs-identifier hs-var">arbitraryWebChainCut</span></a></span><span> </span><span class="annot"><span class="annottext">Cut
Given WebBlockHeaderDb =&gt; Cut
</span><a href="Chainweb.Cut.Test.html#testGenCut"><span class="hs-identifier hs-var">testGenCut</span></a></span><span>
</span><span id="line-393"></span><span>    </span><span class="annot"><span class="annottext">IO Bool -&gt; PropertyM IO Bool
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; PropertyM m a
</span><span class="hs-identifier hs-var">T.run</span></span><span> </span><span class="annot"><span class="annottext">(IO Bool -&gt; PropertyM IO Bool) -&gt; IO Bool -&gt; PropertyM IO Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Cut -&gt; Cut -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">(==)</span></span><span> </span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492161"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">(Cut -&gt; Bool) -&gt; IO Cut -&gt; IO Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">WebBlockHeaderDb -&gt; Cut -&gt; Cut -&gt; IO Cut
</span><a href="Chainweb.Cut.html#joinIntoHeavier"><span class="hs-identifier hs-var">joinIntoHeavier</span></a></span><span> </span><span class="annot"><span class="annottext">WebBlockHeaderDb
forall a. Given a =&gt; a
</span><span class="hs-identifier hs-var">given</span></span><span> </span><span class="annot"><span class="annottext">Cut
Given WebBlockHeaderDb =&gt; Cut
</span><a href="Chainweb.Cut.Test.html#testGenCut"><span class="hs-identifier hs-var">testGenCut</span></a></span><span> </span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492161"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-394"></span><span>
</span><span id="line-395"></span><span class="hs-comment">-- Meet</span><span>
</span><span id="line-396"></span><span>
</span><span id="line-397"></span><span class="annot"><a href="Chainweb.Cut.Test.html#prop_meetIdempotent"><span class="hs-identifier hs-type">prop_meetIdempotent</span></a></span><span>
</span><span id="line-398"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Given</span></span><span> </span><span class="annot"><a href="Chainweb.WebBlockHeaderDB.Types.html#WebBlockHeaderDb"><span class="hs-identifier hs-type">WebBlockHeaderDb</span></a></span><span>
</span><span id="line-399"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.PropertyM</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-400"></span><span id="prop_meetIdempotent"><span class="annot"><span class="annottext">prop_meetIdempotent :: PropertyM IO Bool
</span><a href="Chainweb.Cut.Test.html#prop_meetIdempotent"><span class="hs-identifier hs-var hs-var">prop_meetIdempotent</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-401"></span><span>    </span><span id="local-6989586621681492159"><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492159"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HasCallStack, Given WebBlockHeaderDb) =&gt; Cut -&gt; PropertyM IO Cut
Cut -&gt; PropertyM IO Cut
</span><a href="Chainweb.Cut.Test.html#arbitraryWebChainCut"><span class="hs-identifier hs-var">arbitraryWebChainCut</span></a></span><span> </span><span class="annot"><span class="annottext">Cut
Given WebBlockHeaderDb =&gt; Cut
</span><a href="Chainweb.Cut.Test.html#testGenCut"><span class="hs-identifier hs-var">testGenCut</span></a></span><span>
</span><span id="line-402"></span><span>    </span><span class="annot"><span class="annottext">IO Bool -&gt; PropertyM IO Bool
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; PropertyM m a
</span><span class="hs-identifier hs-var">T.run</span></span><span> </span><span class="annot"><span class="annottext">(IO Bool -&gt; PropertyM IO Bool) -&gt; IO Bool -&gt; PropertyM IO Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Cut -&gt; Cut -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">(==)</span></span><span> </span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492159"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">(Cut -&gt; Bool) -&gt; IO Cut -&gt; IO Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">WebBlockHeaderDb -&gt; Cut -&gt; Cut -&gt; IO Cut
</span><a href="Chainweb.Cut.html#meet"><span class="hs-identifier hs-var">meet</span></a></span><span> </span><span class="annot"><span class="annottext">WebBlockHeaderDb
forall a. Given a =&gt; a
</span><span class="hs-identifier hs-var">given</span></span><span> </span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492159"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492159"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-403"></span><span>
</span><span id="line-404"></span><span class="annot"><a href="Chainweb.Cut.Test.html#prop_meetCommutative"><span class="hs-identifier hs-type">prop_meetCommutative</span></a></span><span>
</span><span id="line-405"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Given</span></span><span> </span><span class="annot"><a href="Chainweb.WebBlockHeaderDB.Types.html#WebBlockHeaderDb"><span class="hs-identifier hs-type">WebBlockHeaderDb</span></a></span><span>
</span><span id="line-406"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.PropertyM</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-407"></span><span id="prop_meetCommutative"><span class="annot"><span class="annottext">prop_meetCommutative :: PropertyM IO Bool
</span><a href="Chainweb.Cut.Test.html#prop_meetCommutative"><span class="hs-identifier hs-var hs-var">prop_meetCommutative</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-408"></span><span>    </span><span class="annot"><a href="Chainweb.Cut.Test.html#TestFork"><span class="hs-identifier hs-type">TestFork</span></a></span><span> </span><span class="hs-identifier">_</span><span> </span><span id="local-6989586621681492156"><span class="annot"><span class="annottext">cl :: Cut
</span><a href="#local-6989586621681492156"><span class="hs-identifier hs-var">cl</span></a></span></span><span> </span><span id="local-6989586621681492155"><span class="annot"><span class="annottext">cr :: Cut
</span><a href="#local-6989586621681492155"><span class="hs-identifier hs-var">cr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PropertyM IO TestFork
Given WebBlockHeaderDb =&gt; PropertyM IO TestFork
</span><a href="Chainweb.Cut.Test.html#arbitraryFork"><span class="hs-identifier hs-var">arbitraryFork</span></a></span><span>
</span><span id="line-409"></span><span>    </span><span class="annot"><span class="annottext">IO Bool -&gt; PropertyM IO Bool
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; PropertyM m a
</span><span class="hs-identifier hs-var">T.run</span></span><span> </span><span class="annot"><span class="annottext">(IO Bool -&gt; PropertyM IO Bool) -&gt; IO Bool -&gt; PropertyM IO Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Cut -&gt; Cut -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">(==)</span></span><span>
</span><span id="line-410"></span><span>        </span><span class="annot"><span class="annottext">(Cut -&gt; Cut -&gt; Bool) -&gt; IO Cut -&gt; IO (Cut -&gt; Bool)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">WebBlockHeaderDb -&gt; Cut -&gt; Cut -&gt; IO Cut
</span><a href="Chainweb.Cut.html#meet"><span class="hs-identifier hs-var">meet</span></a></span><span> </span><span class="annot"><span class="annottext">WebBlockHeaderDb
forall a. Given a =&gt; a
</span><span class="hs-identifier hs-var">given</span></span><span> </span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492156"><span class="hs-identifier hs-var">cl</span></a></span><span> </span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492155"><span class="hs-identifier hs-var">cr</span></a></span><span>
</span><span id="line-411"></span><span>        </span><span class="annot"><span class="annottext">IO (Cut -&gt; Bool) -&gt; IO Cut -&gt; IO Bool
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">WebBlockHeaderDb -&gt; Cut -&gt; Cut -&gt; IO Cut
</span><a href="Chainweb.Cut.html#meet"><span class="hs-identifier hs-var">meet</span></a></span><span> </span><span class="annot"><span class="annottext">WebBlockHeaderDb
forall a. Given a =&gt; a
</span><span class="hs-identifier hs-var">given</span></span><span> </span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492155"><span class="hs-identifier hs-var">cr</span></a></span><span> </span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492156"><span class="hs-identifier hs-var">cl</span></a></span><span>
</span><span id="line-412"></span><span>
</span><span id="line-413"></span><span class="annot"><a href="Chainweb.Cut.Test.html#prop_meetAssociative"><span class="hs-identifier hs-type">prop_meetAssociative</span></a></span><span>
</span><span id="line-414"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Given</span></span><span> </span><span class="annot"><a href="Chainweb.WebBlockHeaderDB.Types.html#WebBlockHeaderDb"><span class="hs-identifier hs-type">WebBlockHeaderDb</span></a></span><span>
</span><span id="line-415"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.PropertyM</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-416"></span><span id="prop_meetAssociative"><span class="annot"><span class="annottext">prop_meetAssociative :: PropertyM IO Bool
</span><a href="Chainweb.Cut.Test.html#prop_meetAssociative"><span class="hs-identifier hs-var hs-var">prop_meetAssociative</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-417"></span><span>    </span><span class="annot"><a href="Chainweb.Cut.Test.html#TestFork"><span class="hs-identifier hs-type">TestFork</span></a></span><span> </span><span class="hs-identifier">_</span><span> </span><span id="local-6989586621681492153"><span class="annot"><span class="annottext">c0 :: Cut
</span><a href="#local-6989586621681492153"><span class="hs-identifier hs-var">c0</span></a></span></span><span> </span><span id="local-6989586621681492152"><span class="annot"><span class="annottext">c1 :: Cut
</span><a href="#local-6989586621681492152"><span class="hs-identifier hs-var">c1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PropertyM IO TestFork
Given WebBlockHeaderDb =&gt; PropertyM IO TestFork
</span><a href="Chainweb.Cut.Test.html#arbitraryFork"><span class="hs-identifier hs-var">arbitraryFork</span></a></span><span>
</span><span id="line-418"></span><span>    </span><span class="annot"><a href="Chainweb.Cut.Test.html#TestFork"><span class="hs-identifier hs-type">TestFork</span></a></span><span> </span><span class="hs-identifier">_</span><span> </span><span id="local-6989586621681492151"><span class="annot"><span class="annottext">c10 :: Cut
</span><a href="#local-6989586621681492151"><span class="hs-identifier hs-var">c10</span></a></span></span><span> </span><span id="local-6989586621681492150"><span class="annot"><span class="annottext">c11 :: Cut
</span><a href="#local-6989586621681492150"><span class="hs-identifier hs-var">c11</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cut -&gt; Cut -&gt; Cut -&gt; TestFork
</span><a href="Chainweb.Cut.Test.html#TestFork"><span class="hs-identifier hs-var">TestFork</span></a></span><span> </span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492152"><span class="hs-identifier hs-var">c1</span></a></span><span>
</span><span id="line-419"></span><span>        </span><span class="annot"><span class="annottext">(Cut -&gt; Cut -&gt; TestFork)
-&gt; PropertyM IO Cut -&gt; PropertyM IO (Cut -&gt; TestFork)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(HasCallStack, Given WebBlockHeaderDb) =&gt; Cut -&gt; PropertyM IO Cut
Cut -&gt; PropertyM IO Cut
</span><a href="Chainweb.Cut.Test.html#arbitraryWebChainCut"><span class="hs-identifier hs-var">arbitraryWebChainCut</span></a></span><span> </span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492152"><span class="hs-identifier hs-var">c1</span></a></span><span>
</span><span id="line-420"></span><span>        </span><span class="annot"><span class="annottext">PropertyM IO (Cut -&gt; TestFork)
-&gt; PropertyM IO Cut -&gt; PropertyM IO TestFork
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">(HasCallStack, Given WebBlockHeaderDb) =&gt; Cut -&gt; PropertyM IO Cut
Cut -&gt; PropertyM IO Cut
</span><a href="Chainweb.Cut.Test.html#arbitraryWebChainCut"><span class="hs-identifier hs-var">arbitraryWebChainCut</span></a></span><span> </span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492152"><span class="hs-identifier hs-var">c1</span></a></span><span>
</span><span id="line-421"></span><span>    </span><span class="annot"><span class="annottext">IO Bool -&gt; PropertyM IO Bool
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; PropertyM m a
</span><span class="hs-identifier hs-var">T.run</span></span><span> </span><span class="annot"><span class="annottext">(IO Bool -&gt; PropertyM IO Bool) -&gt; IO Bool -&gt; PropertyM IO Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-422"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681492149"><span class="annot"><span class="annottext">m :: Cut -&gt; Cut -&gt; IO Cut
</span><a href="#local-6989586621681492149"><span class="hs-identifier hs-var hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WebBlockHeaderDb -&gt; Cut -&gt; Cut -&gt; IO Cut
</span><a href="Chainweb.Cut.html#meet"><span class="hs-identifier hs-var">meet</span></a></span><span> </span><span class="annot"><span class="annottext">WebBlockHeaderDb
forall a. Given a =&gt; a
</span><span class="hs-identifier hs-var">given</span></span><span>
</span><span id="line-423"></span><span>        </span><span class="annot"><span class="annottext">Cut -&gt; Cut -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">(==)</span></span><span>
</span><span id="line-424"></span><span>            </span><span class="annot"><span class="annottext">(Cut -&gt; Cut -&gt; Bool) -&gt; IO Cut -&gt; IO (Cut -&gt; Bool)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Cut -&gt; Cut -&gt; IO Cut
</span><a href="#local-6989586621681492149"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492153"><span class="hs-identifier hs-var">c0</span></a></span><span> </span><span class="annot"><span class="annottext">(Cut -&gt; IO Cut) -&gt; IO Cut -&gt; IO Cut
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">Cut -&gt; Cut -&gt; IO Cut
</span><a href="#local-6989586621681492149"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492151"><span class="hs-identifier hs-var">c10</span></a></span><span> </span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492150"><span class="hs-identifier hs-var">c11</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-425"></span><span>            </span><span class="annot"><span class="annottext">IO (Cut -&gt; Bool) -&gt; IO Cut -&gt; IO Bool
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Cut -&gt; Cut -&gt; IO Cut
</span><a href="#local-6989586621681492149"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492153"><span class="hs-identifier hs-var">c0</span></a></span><span> </span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492151"><span class="hs-identifier hs-var">c10</span></a></span><span> </span><span class="annot"><span class="annottext">IO Cut -&gt; (Cut -&gt; IO Cut) -&gt; IO Cut
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681492148"><span class="annot"><span class="annottext">x :: Cut
</span><a href="#local-6989586621681492148"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Cut -&gt; Cut -&gt; IO Cut
</span><a href="#local-6989586621681492149"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492148"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492150"><span class="hs-identifier hs-var">c11</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-426"></span><span>
</span><span id="line-427"></span><span class="hs-comment">-- | this a corollary of 'prop_joinIdentity' and 'prop_meetJoinAbsorption'</span><span>
</span><span id="line-428"></span><span class="hs-comment">--</span><span>
</span><span id="line-429"></span><span class="annot"><a href="Chainweb.Cut.Test.html#prop_meetZeroAbsorption"><span class="hs-identifier hs-type">prop_meetZeroAbsorption</span></a></span><span>
</span><span id="line-430"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Given</span></span><span> </span><span class="annot"><a href="Chainweb.WebBlockHeaderDB.Types.html#WebBlockHeaderDb"><span class="hs-identifier hs-type">WebBlockHeaderDb</span></a></span><span>
</span><span id="line-431"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.PropertyM</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-432"></span><span id="prop_meetZeroAbsorption"><span class="annot"><span class="annottext">prop_meetZeroAbsorption :: PropertyM IO Bool
</span><a href="Chainweb.Cut.Test.html#prop_meetZeroAbsorption"><span class="hs-identifier hs-var hs-var">prop_meetZeroAbsorption</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-433"></span><span>    </span><span id="local-6989586621681492146"><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492146"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HasCallStack, Given WebBlockHeaderDb) =&gt; Cut -&gt; PropertyM IO Cut
Cut -&gt; PropertyM IO Cut
</span><a href="Chainweb.Cut.Test.html#arbitraryWebChainCut"><span class="hs-identifier hs-var">arbitraryWebChainCut</span></a></span><span> </span><span class="annot"><span class="annottext">Cut
Given WebBlockHeaderDb =&gt; Cut
</span><a href="Chainweb.Cut.Test.html#testGenCut"><span class="hs-identifier hs-var">testGenCut</span></a></span><span>
</span><span id="line-434"></span><span>    </span><span class="annot"><span class="annottext">IO Bool -&gt; PropertyM IO Bool
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; PropertyM m a
</span><span class="hs-identifier hs-var">T.run</span></span><span> </span><span class="annot"><span class="annottext">(IO Bool -&gt; PropertyM IO Bool) -&gt; IO Bool -&gt; PropertyM IO Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-435"></span><span>        </span><span id="local-6989586621681492145"><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492145"><span class="hs-identifier hs-var">c'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">WebBlockHeaderDb -&gt; Cut -&gt; Cut -&gt; IO Cut
</span><a href="Chainweb.Cut.html#meet"><span class="hs-identifier hs-var">meet</span></a></span><span> </span><span class="annot"><span class="annottext">WebBlockHeaderDb
forall a. Given a =&gt; a
</span><span class="hs-identifier hs-var">given</span></span><span> </span><span class="annot"><span class="annottext">Cut
Given WebBlockHeaderDb =&gt; Cut
</span><a href="Chainweb.Cut.Test.html#testGenCut"><span class="hs-identifier hs-var">testGenCut</span></a></span><span> </span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492146"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-436"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; IO Bool
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492146"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Cut -&gt; Cut -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492145"><span class="hs-identifier hs-var">c'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-437"></span><span>
</span><span id="line-438"></span><span class="annot"><a href="Chainweb.Cut.Test.html#prop_joinMeetAbsorption"><span class="hs-identifier hs-type">prop_joinMeetAbsorption</span></a></span><span>
</span><span id="line-439"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Given</span></span><span> </span><span class="annot"><a href="Chainweb.WebBlockHeaderDB.Types.html#WebBlockHeaderDb"><span class="hs-identifier hs-type">WebBlockHeaderDb</span></a></span><span>
</span><span id="line-440"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.PropertyM</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-441"></span><span id="prop_joinMeetAbsorption"><span class="annot"><span class="annottext">prop_joinMeetAbsorption :: PropertyM IO Bool
</span><a href="Chainweb.Cut.Test.html#prop_joinMeetAbsorption"><span class="hs-identifier hs-var hs-var">prop_joinMeetAbsorption</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-442"></span><span>    </span><span class="annot"><a href="Chainweb.Cut.Test.html#TestFork"><span class="hs-identifier hs-type">TestFork</span></a></span><span> </span><span class="hs-identifier">_</span><span> </span><span id="local-6989586621681492143"><span class="annot"><span class="annottext">c0 :: Cut
</span><a href="#local-6989586621681492143"><span class="hs-identifier hs-var">c0</span></a></span></span><span> </span><span id="local-6989586621681492142"><span class="annot"><span class="annottext">c1 :: Cut
</span><a href="#local-6989586621681492142"><span class="hs-identifier hs-var">c1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PropertyM IO TestFork
Given WebBlockHeaderDb =&gt; PropertyM IO TestFork
</span><a href="Chainweb.Cut.Test.html#arbitraryFork"><span class="hs-identifier hs-var">arbitraryFork</span></a></span><span>
</span><span id="line-443"></span><span>    </span><span class="annot"><span class="annottext">IO Bool -&gt; PropertyM IO Bool
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; PropertyM m a
</span><span class="hs-identifier hs-var">T.run</span></span><span> </span><span class="annot"><span class="annottext">(IO Bool -&gt; PropertyM IO Bool) -&gt; IO Bool -&gt; PropertyM IO Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-444"></span><span>        </span><span id="local-6989586621681492141"><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492141"><span class="hs-identifier hs-var">c0'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">WebBlockHeaderDb -&gt; Cut -&gt; Cut -&gt; IO Cut
</span><a href="Chainweb.Cut.html#joinIntoHeavier"><span class="hs-identifier hs-var">joinIntoHeavier</span></a></span><span> </span><span class="annot"><span class="annottext">WebBlockHeaderDb
forall a. Given a =&gt; a
</span><span class="hs-identifier hs-var">given</span></span><span> </span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492143"><span class="hs-identifier hs-var">c0</span></a></span><span> </span><span class="annot"><span class="annottext">(Cut -&gt; IO Cut) -&gt; IO Cut -&gt; IO Cut
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">WebBlockHeaderDb -&gt; Cut -&gt; Cut -&gt; IO Cut
</span><a href="Chainweb.Cut.html#meet"><span class="hs-identifier hs-var">meet</span></a></span><span> </span><span class="annot"><span class="annottext">WebBlockHeaderDb
forall a. Given a =&gt; a
</span><span class="hs-identifier hs-var">given</span></span><span> </span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492143"><span class="hs-identifier hs-var">c0</span></a></span><span> </span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492142"><span class="hs-identifier hs-var">c1</span></a></span><span>
</span><span id="line-445"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; IO Bool
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492141"><span class="hs-identifier hs-var">c0'</span></a></span><span> </span><span class="annot"><span class="annottext">Cut -&gt; Cut -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492143"><span class="hs-identifier hs-var">c0</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-446"></span><span>
</span><span id="line-447"></span><span class="annot"><a href="Chainweb.Cut.Test.html#prop_meetJoinAbsorption"><span class="hs-identifier hs-type">prop_meetJoinAbsorption</span></a></span><span>
</span><span id="line-448"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Given</span></span><span> </span><span class="annot"><a href="Chainweb.WebBlockHeaderDB.Types.html#WebBlockHeaderDb"><span class="hs-identifier hs-type">WebBlockHeaderDb</span></a></span><span>
</span><span id="line-449"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.PropertyM</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-450"></span><span id="prop_meetJoinAbsorption"><span class="annot"><span class="annottext">prop_meetJoinAbsorption :: PropertyM IO Bool
</span><a href="Chainweb.Cut.Test.html#prop_meetJoinAbsorption"><span class="hs-identifier hs-var hs-var">prop_meetJoinAbsorption</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-451"></span><span>    </span><span class="annot"><a href="Chainweb.Cut.Test.html#TestFork"><span class="hs-identifier hs-type">TestFork</span></a></span><span> </span><span class="hs-identifier">_</span><span> </span><span id="local-6989586621681492139"><span class="annot"><span class="annottext">c0 :: Cut
</span><a href="#local-6989586621681492139"><span class="hs-identifier hs-var">c0</span></a></span></span><span> </span><span id="local-6989586621681492138"><span class="annot"><span class="annottext">c1 :: Cut
</span><a href="#local-6989586621681492138"><span class="hs-identifier hs-var">c1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PropertyM IO TestFork
Given WebBlockHeaderDb =&gt; PropertyM IO TestFork
</span><a href="Chainweb.Cut.Test.html#arbitraryFork"><span class="hs-identifier hs-var">arbitraryFork</span></a></span><span>
</span><span id="line-452"></span><span>    </span><span class="annot"><span class="annottext">IO Bool -&gt; PropertyM IO Bool
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; PropertyM m a
</span><span class="hs-identifier hs-var">T.run</span></span><span> </span><span class="annot"><span class="annottext">(IO Bool -&gt; PropertyM IO Bool) -&gt; IO Bool -&gt; PropertyM IO Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-453"></span><span>        </span><span id="local-6989586621681492137"><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492137"><span class="hs-identifier hs-var">c0'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">WebBlockHeaderDb -&gt; Cut -&gt; Cut -&gt; IO Cut
</span><a href="Chainweb.Cut.html#meet"><span class="hs-identifier hs-var">meet</span></a></span><span> </span><span class="annot"><span class="annottext">WebBlockHeaderDb
forall a. Given a =&gt; a
</span><span class="hs-identifier hs-var">given</span></span><span> </span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492139"><span class="hs-identifier hs-var">c0</span></a></span><span> </span><span class="annot"><span class="annottext">(Cut -&gt; IO Cut) -&gt; IO Cut -&gt; IO Cut
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">WebBlockHeaderDb -&gt; Cut -&gt; Cut -&gt; IO Cut
</span><a href="Chainweb.Cut.html#joinIntoHeavier"><span class="hs-identifier hs-var">joinIntoHeavier</span></a></span><span> </span><span class="annot"><span class="annottext">WebBlockHeaderDb
forall a. Given a =&gt; a
</span><span class="hs-identifier hs-var">given</span></span><span> </span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492139"><span class="hs-identifier hs-var">c0</span></a></span><span> </span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492138"><span class="hs-identifier hs-var">c1</span></a></span><span>
</span><span id="line-454"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; IO Bool
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492137"><span class="hs-identifier hs-var">c0'</span></a></span><span> </span><span class="annot"><span class="annottext">Cut -&gt; Cut -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492139"><span class="hs-identifier hs-var">c0</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-455"></span><span>
</span><span id="line-456"></span><span class="annot"><a href="Chainweb.Cut.Test.html#properties_lattice"><span class="hs-identifier hs-type">properties_lattice</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">RocksDb</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Chainweb.Version.html#ChainwebVersion"><span class="hs-identifier hs-type">ChainwebVersion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Property</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-457"></span><span id="properties_lattice"><span class="annot"><span class="annottext">properties_lattice :: RocksDb -&gt; ChainwebVersion -&gt; [([Char], Property)]
</span><a href="Chainweb.Cut.Test.html#properties_lattice"><span class="hs-identifier hs-var hs-var">properties_lattice</span></a></span></span><span> </span><span id="local-6989586621681492135"><span class="annot"><span class="annottext">db :: RocksDb
</span><a href="#local-6989586621681492135"><span class="hs-identifier hs-var">db</span></a></span></span><span> </span><span id="local-6989586621681492134"><span class="annot"><span class="annottext">v :: ChainwebVersion
</span><a href="#local-6989586621681492134"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-458"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;joinIdemPotent&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">RocksDb
-&gt; ChainwebVersion
-&gt; (Given WebBlockHeaderDb =&gt; PropertyM IO Bool)
-&gt; Property
</span><a href="Chainweb.Cut.Test.html#ioTest"><span class="hs-identifier hs-var">ioTest</span></a></span><span> </span><span class="annot"><span class="annottext">RocksDb
</span><a href="#local-6989586621681492135"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="annot"><span class="annottext">ChainwebVersion
</span><a href="#local-6989586621681492134"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Given WebBlockHeaderDb =&gt; PropertyM IO Bool
</span><a href="Chainweb.Cut.Test.html#prop_joinIdempotent"><span class="hs-identifier hs-var">prop_joinIdempotent</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-459"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;joinCommutative&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">RocksDb
-&gt; ChainwebVersion
-&gt; (Given WebBlockHeaderDb =&gt; PropertyM IO Bool)
-&gt; Property
</span><a href="Chainweb.Cut.Test.html#ioTest"><span class="hs-identifier hs-var">ioTest</span></a></span><span> </span><span class="annot"><span class="annottext">RocksDb
</span><a href="#local-6989586621681492135"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="annot"><span class="annottext">ChainwebVersion
</span><a href="#local-6989586621681492134"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Given WebBlockHeaderDb =&gt; PropertyM IO Bool
</span><a href="Chainweb.Cut.Test.html#prop_joinCommutative"><span class="hs-identifier hs-var">prop_joinCommutative</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-460"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;joinAssociative&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">RocksDb
-&gt; ChainwebVersion
-&gt; (Given WebBlockHeaderDb =&gt; PropertyM IO Bool)
-&gt; Property
</span><a href="Chainweb.Cut.Test.html#ioTest"><span class="hs-identifier hs-var">ioTest</span></a></span><span> </span><span class="annot"><span class="annottext">RocksDb
</span><a href="#local-6989586621681492135"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="annot"><span class="annottext">ChainwebVersion
</span><a href="#local-6989586621681492134"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Given WebBlockHeaderDb =&gt; PropertyM IO Bool
</span><a href="Chainweb.Cut.Test.html#prop_joinAssociative"><span class="hs-identifier hs-var">prop_joinAssociative</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- Fails</span><span>
</span><span id="line-461"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;joinIdentity&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">RocksDb
-&gt; ChainwebVersion
-&gt; (Given WebBlockHeaderDb =&gt; PropertyM IO Bool)
-&gt; Property
</span><a href="Chainweb.Cut.Test.html#ioTest"><span class="hs-identifier hs-var">ioTest</span></a></span><span> </span><span class="annot"><span class="annottext">RocksDb
</span><a href="#local-6989586621681492135"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="annot"><span class="annottext">ChainwebVersion
</span><a href="#local-6989586621681492134"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Given WebBlockHeaderDb =&gt; PropertyM IO Bool
</span><a href="Chainweb.Cut.Test.html#prop_joinIdentity"><span class="hs-identifier hs-var">prop_joinIdentity</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-462"></span><span>
</span><span id="line-463"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;meetIdemPotent&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">RocksDb
-&gt; ChainwebVersion
-&gt; (Given WebBlockHeaderDb =&gt; PropertyM IO Bool)
-&gt; Property
</span><a href="Chainweb.Cut.Test.html#ioTest"><span class="hs-identifier hs-var">ioTest</span></a></span><span> </span><span class="annot"><span class="annottext">RocksDb
</span><a href="#local-6989586621681492135"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="annot"><span class="annottext">ChainwebVersion
</span><a href="#local-6989586621681492134"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Given WebBlockHeaderDb =&gt; PropertyM IO Bool
</span><a href="Chainweb.Cut.Test.html#prop_meetIdempotent"><span class="hs-identifier hs-var">prop_meetIdempotent</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-464"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;meetCommutative&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">RocksDb
-&gt; ChainwebVersion
-&gt; (Given WebBlockHeaderDb =&gt; PropertyM IO Bool)
-&gt; Property
</span><a href="Chainweb.Cut.Test.html#ioTest"><span class="hs-identifier hs-var">ioTest</span></a></span><span> </span><span class="annot"><span class="annottext">RocksDb
</span><a href="#local-6989586621681492135"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="annot"><span class="annottext">ChainwebVersion
</span><a href="#local-6989586621681492134"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Given WebBlockHeaderDb =&gt; PropertyM IO Bool
</span><a href="Chainweb.Cut.Test.html#prop_meetCommutative"><span class="hs-identifier hs-var">prop_meetCommutative</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-465"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;meetAssociative&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">RocksDb
-&gt; ChainwebVersion
-&gt; (Given WebBlockHeaderDb =&gt; PropertyM IO Bool)
-&gt; Property
</span><a href="Chainweb.Cut.Test.html#ioTest"><span class="hs-identifier hs-var">ioTest</span></a></span><span> </span><span class="annot"><span class="annottext">RocksDb
</span><a href="#local-6989586621681492135"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="annot"><span class="annottext">ChainwebVersion
</span><a href="#local-6989586621681492134"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Given WebBlockHeaderDb =&gt; PropertyM IO Bool
</span><a href="Chainweb.Cut.Test.html#prop_meetAssociative"><span class="hs-identifier hs-var">prop_meetAssociative</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-466"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;meetZeroAbsorption&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">RocksDb
-&gt; ChainwebVersion
-&gt; (Given WebBlockHeaderDb =&gt; PropertyM IO Bool)
-&gt; Property
</span><a href="Chainweb.Cut.Test.html#ioTest"><span class="hs-identifier hs-var">ioTest</span></a></span><span> </span><span class="annot"><span class="annottext">RocksDb
</span><a href="#local-6989586621681492135"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="annot"><span class="annottext">ChainwebVersion
</span><a href="#local-6989586621681492134"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Given WebBlockHeaderDb =&gt; PropertyM IO Bool
</span><a href="Chainweb.Cut.Test.html#prop_meetZeroAbsorption"><span class="hs-identifier hs-var">prop_meetZeroAbsorption</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- Fails</span><span>
</span><span id="line-467"></span><span>
</span><span id="line-468"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;joinMeetAbsorption&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">RocksDb
-&gt; ChainwebVersion
-&gt; (Given WebBlockHeaderDb =&gt; PropertyM IO Bool)
-&gt; Property
</span><a href="Chainweb.Cut.Test.html#ioTest"><span class="hs-identifier hs-var">ioTest</span></a></span><span> </span><span class="annot"><span class="annottext">RocksDb
</span><a href="#local-6989586621681492135"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="annot"><span class="annottext">ChainwebVersion
</span><a href="#local-6989586621681492134"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Given WebBlockHeaderDb =&gt; PropertyM IO Bool
</span><a href="Chainweb.Cut.Test.html#prop_joinMeetAbsorption"><span class="hs-identifier hs-var">prop_joinMeetAbsorption</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-469"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;meetJoinAbsorption&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">RocksDb
-&gt; ChainwebVersion
-&gt; (Given WebBlockHeaderDb =&gt; PropertyM IO Bool)
-&gt; Property
</span><a href="Chainweb.Cut.Test.html#ioTest"><span class="hs-identifier hs-var">ioTest</span></a></span><span> </span><span class="annot"><span class="annottext">RocksDb
</span><a href="#local-6989586621681492135"><span class="hs-identifier hs-var">db</span></a></span><span>  </span><span class="annot"><span class="annottext">ChainwebVersion
</span><a href="#local-6989586621681492134"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Given WebBlockHeaderDb =&gt; PropertyM IO Bool
</span><a href="Chainweb.Cut.Test.html#prop_meetJoinAbsorption"><span class="hs-identifier hs-var">prop_meetJoinAbsorption</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- Fails</span><span>
</span><span id="line-470"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-471"></span><span>
</span><span id="line-472"></span><span class="annot"><a href="Chainweb.Cut.Test.html#properties_lattice_passing"><span class="hs-identifier hs-type">properties_lattice_passing</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">RocksDb</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Chainweb.Version.html#ChainwebVersion"><span class="hs-identifier hs-type">ChainwebVersion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Property</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-473"></span><span id="properties_lattice_passing"><span class="annot"><span class="annottext">properties_lattice_passing :: RocksDb -&gt; ChainwebVersion -&gt; [([Char], Property)]
</span><a href="Chainweb.Cut.Test.html#properties_lattice_passing"><span class="hs-identifier hs-var hs-var">properties_lattice_passing</span></a></span></span><span> </span><span id="local-6989586621681492132"><span class="annot"><span class="annottext">db :: RocksDb
</span><a href="#local-6989586621681492132"><span class="hs-identifier hs-var">db</span></a></span></span><span> </span><span id="local-6989586621681492131"><span class="annot"><span class="annottext">v :: ChainwebVersion
</span><a href="#local-6989586621681492131"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-474"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;joinIdemPotent&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">RocksDb
-&gt; ChainwebVersion
-&gt; (Given WebBlockHeaderDb =&gt; PropertyM IO Bool)
-&gt; Property
</span><a href="Chainweb.Cut.Test.html#ioTest"><span class="hs-identifier hs-var">ioTest</span></a></span><span> </span><span class="annot"><span class="annottext">RocksDb
</span><a href="#local-6989586621681492132"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="annot"><span class="annottext">ChainwebVersion
</span><a href="#local-6989586621681492131"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Given WebBlockHeaderDb =&gt; PropertyM IO Bool
</span><a href="Chainweb.Cut.Test.html#prop_joinIdempotent"><span class="hs-identifier hs-var">prop_joinIdempotent</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-475"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;joinCommutative&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">RocksDb
-&gt; ChainwebVersion
-&gt; (Given WebBlockHeaderDb =&gt; PropertyM IO Bool)
-&gt; Property
</span><a href="Chainweb.Cut.Test.html#ioTest"><span class="hs-identifier hs-var">ioTest</span></a></span><span> </span><span class="annot"><span class="annottext">RocksDb
</span><a href="#local-6989586621681492132"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="annot"><span class="annottext">ChainwebVersion
</span><a href="#local-6989586621681492131"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Given WebBlockHeaderDb =&gt; PropertyM IO Bool
</span><a href="Chainweb.Cut.Test.html#prop_joinCommutative"><span class="hs-identifier hs-var">prop_joinCommutative</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-476"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;joinIdentity&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">RocksDb
-&gt; ChainwebVersion
-&gt; (Given WebBlockHeaderDb =&gt; PropertyM IO Bool)
-&gt; Property
</span><a href="Chainweb.Cut.Test.html#ioTest"><span class="hs-identifier hs-var">ioTest</span></a></span><span> </span><span class="annot"><span class="annottext">RocksDb
</span><a href="#local-6989586621681492132"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="annot"><span class="annottext">ChainwebVersion
</span><a href="#local-6989586621681492131"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Given WebBlockHeaderDb =&gt; PropertyM IO Bool
</span><a href="Chainweb.Cut.Test.html#prop_joinIdentity"><span class="hs-identifier hs-var">prop_joinIdentity</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-477"></span><span>
</span><span id="line-478"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;meetIdemPotent&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">RocksDb
-&gt; ChainwebVersion
-&gt; (Given WebBlockHeaderDb =&gt; PropertyM IO Bool)
-&gt; Property
</span><a href="Chainweb.Cut.Test.html#ioTest"><span class="hs-identifier hs-var">ioTest</span></a></span><span> </span><span class="annot"><span class="annottext">RocksDb
</span><a href="#local-6989586621681492132"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="annot"><span class="annottext">ChainwebVersion
</span><a href="#local-6989586621681492131"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Given WebBlockHeaderDb =&gt; PropertyM IO Bool
</span><a href="Chainweb.Cut.Test.html#prop_meetIdempotent"><span class="hs-identifier hs-var">prop_meetIdempotent</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-479"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;meetCommutative&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">RocksDb
-&gt; ChainwebVersion
-&gt; (Given WebBlockHeaderDb =&gt; PropertyM IO Bool)
-&gt; Property
</span><a href="Chainweb.Cut.Test.html#ioTest"><span class="hs-identifier hs-var">ioTest</span></a></span><span> </span><span class="annot"><span class="annottext">RocksDb
</span><a href="#local-6989586621681492132"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="annot"><span class="annottext">ChainwebVersion
</span><a href="#local-6989586621681492131"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Given WebBlockHeaderDb =&gt; PropertyM IO Bool
</span><a href="Chainweb.Cut.Test.html#prop_meetCommutative"><span class="hs-identifier hs-var">prop_meetCommutative</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-480"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;meetAssociative&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">RocksDb
-&gt; ChainwebVersion
-&gt; (Given WebBlockHeaderDb =&gt; PropertyM IO Bool)
-&gt; Property
</span><a href="Chainweb.Cut.Test.html#ioTest"><span class="hs-identifier hs-var">ioTest</span></a></span><span> </span><span class="annot"><span class="annottext">RocksDb
</span><a href="#local-6989586621681492132"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="annot"><span class="annottext">ChainwebVersion
</span><a href="#local-6989586621681492131"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Given WebBlockHeaderDb =&gt; PropertyM IO Bool
</span><a href="Chainweb.Cut.Test.html#prop_meetAssociative"><span class="hs-identifier hs-var">prop_meetAssociative</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-481"></span><span>
</span><span id="line-482"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;joinMeetAbsorption&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">RocksDb
-&gt; ChainwebVersion
-&gt; (Given WebBlockHeaderDb =&gt; PropertyM IO Bool)
-&gt; Property
</span><a href="Chainweb.Cut.Test.html#ioTest"><span class="hs-identifier hs-var">ioTest</span></a></span><span> </span><span class="annot"><span class="annottext">RocksDb
</span><a href="#local-6989586621681492132"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="annot"><span class="annottext">ChainwebVersion
</span><a href="#local-6989586621681492131"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Given WebBlockHeaderDb =&gt; PropertyM IO Bool
</span><a href="Chainweb.Cut.Test.html#prop_joinMeetAbsorption"><span class="hs-identifier hs-var">prop_joinMeetAbsorption</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-483"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-484"></span><span>
</span><span id="line-485"></span><span class="hs-comment">-- -------------------------------------------------------------------------- --</span><span>
</span><span id="line-486"></span><span class="hs-comment">-- Cut Properties</span><span>
</span><span id="line-487"></span><span>
</span><span id="line-488"></span><span class="annot"><a href="Chainweb.Cut.Test.html#prop_cutBraiding"><span class="hs-identifier hs-type">prop_cutBraiding</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Chainweb.Cut.html#Cut"><span class="hs-identifier hs-type">Cut</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-489"></span><span id="prop_cutBraiding"><span class="annot"><span class="annottext">prop_cutBraiding :: Cut -&gt; Bool
</span><a href="Chainweb.Cut.Test.html#prop_cutBraiding"><span class="hs-identifier hs-var hs-var">prop_cutBraiding</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SomeException -&gt; Bool)
-&gt; (() -&gt; Bool) -&gt; Either SomeException () -&gt; Bool
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><span class="hs-identifier hs-var">either</span></span><span> </span><span class="annot"><span class="annottext">SomeException -&gt; Bool
forall a e. Exception e =&gt; e -&gt; a
</span><span class="hs-identifier hs-var">throw</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; () -&gt; Bool
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Either SomeException () -&gt; Bool)
-&gt; (Cut -&gt; Either SomeException ()) -&gt; Cut -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Cut -&gt; Either SomeException ()
forall (m :: * -&gt; *). MonadThrow m =&gt; Cut -&gt; m ()
</span><a href="Chainweb.Cut.html#checkBraidingOfCut"><span class="hs-identifier hs-var">checkBraidingOfCut</span></a></span><span>
</span><span id="line-490"></span><span>
</span><span id="line-491"></span><span class="annot"><a href="Chainweb.Cut.Test.html#prop_cutBraidingGenesis"><span class="hs-identifier hs-type">prop_cutBraidingGenesis</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Chainweb.Version.html#ChainwebVersion"><span class="hs-identifier hs-type">ChainwebVersion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-492"></span><span id="prop_cutBraidingGenesis"><span class="annot"><span class="annottext">prop_cutBraidingGenesis :: ChainwebVersion -&gt; Bool
</span><a href="Chainweb.Cut.Test.html#prop_cutBraidingGenesis"><span class="hs-identifier hs-var hs-var">prop_cutBraidingGenesis</span></a></span></span><span> </span><span id="local-6989586621681492126"><span class="annot"><span class="annottext">v :: ChainwebVersion
</span><a href="#local-6989586621681492126"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SomeException -&gt; Bool)
-&gt; (() -&gt; Bool) -&gt; Either SomeException () -&gt; Bool
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><span class="hs-identifier hs-var">either</span></span><span> </span><span class="annot"><span class="annottext">SomeException -&gt; Bool
forall a e. Exception e =&gt; e -&gt; a
</span><span class="hs-identifier hs-var">throw</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; () -&gt; Bool
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span>
</span><span id="line-493"></span><span>    </span><span class="annot"><span class="annottext">(Either SomeException () -&gt; Bool)
-&gt; Either SomeException () -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Cut -&gt; Either SomeException ()
forall (m :: * -&gt; *). MonadThrow m =&gt; Cut -&gt; m ()
</span><a href="Chainweb.Cut.html#checkBraidingOfCut"><span class="hs-identifier hs-var">checkBraidingOfCut</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ChainwebVersion -&gt; Cut
</span><a href="Chainweb.Cut.html#genesisCut"><span class="hs-identifier hs-var">genesisCut</span></a></span><span> </span><span class="annot"><span class="annottext">ChainwebVersion
</span><a href="#local-6989586621681492126"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-494"></span><span>
</span><span id="line-495"></span><span class="hs-comment">-- TODO</span><span>
</span><span id="line-496"></span><span class="hs-comment">--</span><span>
</span><span id="line-497"></span><span class="hs-comment">-- * cuts are partially ordered with respect to parent and parent hashes</span><span>
</span><span id="line-498"></span><span class="hs-comment">-- * partial order is consistent with weight and blockheight</span><span>
</span><span id="line-499"></span><span class="hs-comment">--</span><span>
</span><span id="line-500"></span><span class="hs-comment">-- * this order induces a lattice</span><span>
</span><span id="line-501"></span><span>
</span><span id="line-502"></span><span class="annot"><a href="Chainweb.Cut.Test.html#properties_cut"><span class="hs-identifier hs-type">properties_cut</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Chainweb.Version.html#ChainwebVersion"><span class="hs-identifier hs-type">ChainwebVersion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Property</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-503"></span><span id="properties_cut"><span class="annot"><span class="annottext">properties_cut :: ChainwebVersion -&gt; [([Char], Property)]
</span><a href="Chainweb.Cut.Test.html#properties_cut"><span class="hs-identifier hs-var hs-var">properties_cut</span></a></span></span><span> </span><span id="local-6989586621681492125"><span class="annot"><span class="annottext">v :: ChainwebVersion
</span><a href="#local-6989586621681492125"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-504"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;Cut has valid braiding&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ChainwebVersion -&gt; (Given ChainwebVersion =&gt; Property) -&gt; Property
forall a r. a -&gt; (Given a =&gt; r) -&gt; r
</span><span class="hs-identifier hs-var">give</span></span><span> </span><span class="annot"><span class="annottext">ChainwebVersion
</span><a href="#local-6989586621681492125"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">((Given ChainwebVersion =&gt; Property) -&gt; Property)
-&gt; (Given ChainwebVersion =&gt; Property) -&gt; Property
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Cut -&gt; Bool) -&gt; Property
forall prop. Testable prop =&gt; prop -&gt; Property
</span><span class="hs-identifier hs-var">T.property</span></span><span> </span><span class="annot"><span class="annottext">Cut -&gt; Bool
</span><a href="Chainweb.Cut.Test.html#prop_cutBraiding"><span class="hs-identifier hs-var">prop_cutBraiding</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-505"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;Genesis Cut has valid braiding&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Property
forall prop. Testable prop =&gt; prop -&gt; Property
</span><span class="hs-identifier hs-var">T.property</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ChainwebVersion -&gt; Bool
</span><a href="Chainweb.Cut.Test.html#prop_cutBraidingGenesis"><span class="hs-identifier hs-var">prop_cutBraidingGenesis</span></a></span><span> </span><span class="annot"><span class="annottext">ChainwebVersion
</span><a href="#local-6989586621681492125"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-506"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-507"></span><span>
</span><span id="line-508"></span><span class="hs-comment">-- -------------------------------------------------------------------------- --</span><span>
</span><span id="line-509"></span><span class="hs-comment">-- Meet Properties</span><span>
</span><span id="line-510"></span><span>
</span><span id="line-511"></span><span class="annot"><a href="Chainweb.Cut.Test.html#prop_meetGenesisCut"><span class="hs-identifier hs-type">prop_meetGenesisCut</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Given</span></span><span> </span><span class="annot"><a href="Chainweb.WebBlockHeaderDB.Types.html#WebBlockHeaderDb"><span class="hs-identifier hs-type">WebBlockHeaderDb</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.PropertyM</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-512"></span><span id="prop_meetGenesisCut"><span class="annot"><span class="annottext">prop_meetGenesisCut :: PropertyM IO Bool
</span><a href="Chainweb.Cut.Test.html#prop_meetGenesisCut"><span class="hs-identifier hs-var hs-var">prop_meetGenesisCut</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO Bool -&gt; PropertyM IO Bool
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO Bool -&gt; PropertyM IO Bool) -&gt; IO Bool -&gt; PropertyM IO Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Cut -&gt; Cut -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">(==)</span></span><span> </span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492121"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">(Cut -&gt; Bool) -&gt; IO Cut -&gt; IO Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">WebBlockHeaderDb -&gt; Cut -&gt; Cut -&gt; IO Cut
</span><a href="Chainweb.Cut.html#meet"><span class="hs-identifier hs-var">meet</span></a></span><span> </span><span class="annot"><span class="annottext">WebBlockHeaderDb
forall a. Given a =&gt; a
</span><span class="hs-identifier hs-var">given</span></span><span> </span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492121"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492121"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-513"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-514"></span><span>    </span><span id="local-6989586621681492121"><span class="annot"><span class="annottext">c :: Cut
</span><a href="#local-6989586621681492121"><span class="hs-identifier hs-var hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Cut
Given WebBlockHeaderDb =&gt; Cut
</span><a href="Chainweb.Cut.Test.html#testGenCut"><span class="hs-identifier hs-var">testGenCut</span></a></span><span>
</span><span id="line-515"></span><span>
</span><span id="line-516"></span><span class="hs-comment">-- -------------------------------------------------------------------------- --</span><span>
</span><span id="line-517"></span><span class="hs-comment">-- Misc Properties</span><span>
</span><span id="line-518"></span><span>
</span><span id="line-519"></span><span class="annot"><a href="Chainweb.Cut.Test.html#prop_arbitraryForkBraiding"><span class="hs-identifier hs-type">prop_arbitraryForkBraiding</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">RocksDb</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Chainweb.Version.html#ChainwebVersion"><span class="hs-identifier hs-type">ChainwebVersion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Property</span></span><span>
</span><span id="line-520"></span><span id="prop_arbitraryForkBraiding"><span class="annot"><span class="annottext">prop_arbitraryForkBraiding :: RocksDb -&gt; ChainwebVersion -&gt; Property
</span><a href="Chainweb.Cut.Test.html#prop_arbitraryForkBraiding"><span class="hs-identifier hs-var hs-var">prop_arbitraryForkBraiding</span></a></span></span><span> </span><span id="local-6989586621681492119"><span class="annot"><span class="annottext">db :: RocksDb
</span><a href="#local-6989586621681492119"><span class="hs-identifier hs-var">db</span></a></span></span><span> </span><span id="local-6989586621681492118"><span class="annot"><span class="annottext">v :: ChainwebVersion
</span><a href="#local-6989586621681492118"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RocksDb
-&gt; ChainwebVersion
-&gt; (Given WebBlockHeaderDb =&gt; PropertyM IO Bool)
-&gt; Property
</span><a href="Chainweb.Cut.Test.html#ioTest"><span class="hs-identifier hs-var">ioTest</span></a></span><span> </span><span class="annot"><span class="annottext">RocksDb
</span><a href="#local-6989586621681492119"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="annot"><span class="annottext">ChainwebVersion
</span><a href="#local-6989586621681492118"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">((Given WebBlockHeaderDb =&gt; PropertyM IO Bool) -&gt; Property)
-&gt; (Given WebBlockHeaderDb =&gt; PropertyM IO Bool) -&gt; Property
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ChainGraph
-&gt; (Given ChainGraph =&gt; PropertyM IO Bool) -&gt; PropertyM IO Bool
forall a r. a -&gt; (Given a =&gt; r) -&gt; r
</span><span class="hs-identifier hs-var">give</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ChainwebVersion -&gt; ChainGraph
forall a. HasChainGraph a =&gt; a -&gt; ChainGraph
</span><a href="Chainweb.Graph.html#_chainGraph"><span class="hs-identifier hs-var">_chainGraph</span></a></span><span> </span><span class="annot"><span class="annottext">ChainwebVersion
</span><a href="#local-6989586621681492118"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Given ChainGraph =&gt; PropertyM IO Bool) -&gt; PropertyM IO Bool)
-&gt; (Given ChainGraph =&gt; PropertyM IO Bool) -&gt; PropertyM IO Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-521"></span><span>    </span><span class="annot"><a href="Chainweb.Cut.Test.html#TestFork"><span class="hs-identifier hs-type">TestFork</span></a></span><span> </span><span id="local-6989586621681492117"><span class="annot"><span class="annottext">b :: Cut
</span><a href="#local-6989586621681492117"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621681492116"><span class="annot"><span class="annottext">cl :: Cut
</span><a href="#local-6989586621681492116"><span class="hs-identifier hs-var">cl</span></a></span></span><span> </span><span id="local-6989586621681492115"><span class="annot"><span class="annottext">cr :: Cut
</span><a href="#local-6989586621681492115"><span class="hs-identifier hs-var">cr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PropertyM IO TestFork
Given WebBlockHeaderDb =&gt; PropertyM IO TestFork
</span><a href="Chainweb.Cut.Test.html#arbitraryFork"><span class="hs-identifier hs-var">arbitraryFork</span></a></span><span>
</span><span id="line-522"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; PropertyM IO ()
forall (m :: * -&gt; *). Monad m =&gt; Bool -&gt; PropertyM m ()
</span><span class="hs-identifier hs-var">T.assert</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Cut -&gt; Bool
</span><a href="Chainweb.Cut.Test.html#prop_cutBraiding"><span class="hs-identifier hs-var">prop_cutBraiding</span></a></span><span> </span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492117"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-523"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; PropertyM IO ()
forall (m :: * -&gt; *). Monad m =&gt; Bool -&gt; PropertyM m ()
</span><span class="hs-identifier hs-var">T.assert</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Cut -&gt; Bool
</span><a href="Chainweb.Cut.Test.html#prop_cutBraiding"><span class="hs-identifier hs-var">prop_cutBraiding</span></a></span><span> </span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492116"><span class="hs-identifier hs-var">cl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-524"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; PropertyM IO ()
forall (m :: * -&gt; *). Monad m =&gt; Bool -&gt; PropertyM m ()
</span><span class="hs-identifier hs-var">T.assert</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Cut -&gt; Bool
</span><a href="Chainweb.Cut.Test.html#prop_cutBraiding"><span class="hs-identifier hs-var">prop_cutBraiding</span></a></span><span> </span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492115"><span class="hs-identifier hs-var">cr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-525"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; PropertyM IO Bool
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-526"></span><span>
</span><span id="line-527"></span><span class="annot"><a href="Chainweb.Cut.Test.html#prop_joinBase"><span class="hs-identifier hs-type">prop_joinBase</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">RocksDb</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Chainweb.Version.html#ChainwebVersion"><span class="hs-identifier hs-type">ChainwebVersion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Property</span></span><span>
</span><span id="line-528"></span><span id="prop_joinBase"><span class="annot"><span class="annottext">prop_joinBase :: RocksDb -&gt; ChainwebVersion -&gt; Property
</span><a href="Chainweb.Cut.Test.html#prop_joinBase"><span class="hs-identifier hs-var hs-var">prop_joinBase</span></a></span></span><span> </span><span id="local-6989586621681492113"><span class="annot"><span class="annottext">db :: RocksDb
</span><a href="#local-6989586621681492113"><span class="hs-identifier hs-var">db</span></a></span></span><span> </span><span id="local-6989586621681492112"><span class="annot"><span class="annottext">v :: ChainwebVersion
</span><a href="#local-6989586621681492112"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RocksDb
-&gt; ChainwebVersion
-&gt; (Given WebBlockHeaderDb =&gt; PropertyM IO Bool)
-&gt; Property
</span><a href="Chainweb.Cut.Test.html#ioTest"><span class="hs-identifier hs-var">ioTest</span></a></span><span> </span><span class="annot"><span class="annottext">RocksDb
</span><a href="#local-6989586621681492113"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="annot"><span class="annottext">ChainwebVersion
</span><a href="#local-6989586621681492112"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">((Given WebBlockHeaderDb =&gt; PropertyM IO Bool) -&gt; Property)
-&gt; (Given WebBlockHeaderDb =&gt; PropertyM IO Bool) -&gt; Property
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-529"></span><span>    </span><span class="annot"><a href="Chainweb.Cut.Test.html#TestFork"><span class="hs-identifier hs-type">TestFork</span></a></span><span> </span><span id="local-6989586621681492111"><span class="annot"><span class="annottext">b :: Cut
</span><a href="#local-6989586621681492111"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621681492110"><span class="annot"><span class="annottext">cl :: Cut
</span><a href="#local-6989586621681492110"><span class="hs-identifier hs-var">cl</span></a></span></span><span> </span><span id="local-6989586621681492109"><span class="annot"><span class="annottext">cr :: Cut
</span><a href="#local-6989586621681492109"><span class="hs-identifier hs-var">cr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PropertyM IO TestFork
Given WebBlockHeaderDb =&gt; PropertyM IO TestFork
</span><a href="Chainweb.Cut.Test.html#arbitraryFork"><span class="hs-identifier hs-var">arbitraryFork</span></a></span><span>
</span><span id="line-530"></span><span>    </span><span id="local-6989586621681492108"><span class="annot"><span class="annottext">Join Int
</span><a href="#local-6989586621681492108"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (Join Int) -&gt; PropertyM IO (Join Int)
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (Join Int) -&gt; PropertyM IO (Join Int))
-&gt; IO (Join Int) -&gt; PropertyM IO (Join Int)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">WebBlockHeaderDb
-&gt; (DiffItem BlockHeader -&gt; DiffItem (Maybe Int))
-&gt; Cut
-&gt; Cut
-&gt; IO (Join Int)
forall a.
Ord a =&gt;
WebBlockHeaderDb
-&gt; (DiffItem BlockHeader -&gt; DiffItem (Maybe a))
-&gt; Cut
-&gt; Cut
-&gt; IO (Join a)
</span><a href="Chainweb.Cut.html#join"><span class="hs-identifier hs-var">join</span></a></span><span> </span><span class="annot"><span class="annottext">WebBlockHeaderDb
forall a. Given a =&gt; a
</span><span class="hs-identifier hs-var">given</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Cut -&gt; Cut -&gt; DiffItem BlockHeader -&gt; DiffItem (Maybe Int)
</span><a href="Chainweb.Cut.html#prioritizeHeavier"><span class="hs-identifier hs-var">prioritizeHeavier</span></a></span><span> </span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492110"><span class="hs-identifier hs-var">cl</span></a></span><span> </span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492109"><span class="hs-identifier hs-var">cr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492110"><span class="hs-identifier hs-var">cl</span></a></span><span> </span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492109"><span class="hs-identifier hs-var">cr</span></a></span><span>
</span><span id="line-531"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; PropertyM IO Bool
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Join Int -&gt; Cut
forall a. Join a -&gt; Cut
</span><a href="Chainweb.Cut.html#_joinBase"><span class="hs-identifier hs-var hs-var">_joinBase</span></a></span><span> </span><span class="annot"><span class="annottext">Join Int
</span><a href="#local-6989586621681492108"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Cut -&gt; Cut -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492111"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-532"></span><span>
</span><span id="line-533"></span><span class="annot"><a href="Chainweb.Cut.Test.html#prop_joinBaseMeet"><span class="hs-identifier hs-type">prop_joinBaseMeet</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">RocksDb</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Chainweb.Version.html#ChainwebVersion"><span class="hs-identifier hs-type">ChainwebVersion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Property</span></span><span>
</span><span id="line-534"></span><span id="prop_joinBaseMeet"><span class="annot"><span class="annottext">prop_joinBaseMeet :: RocksDb -&gt; ChainwebVersion -&gt; Property
</span><a href="Chainweb.Cut.Test.html#prop_joinBaseMeet"><span class="hs-identifier hs-var hs-var">prop_joinBaseMeet</span></a></span></span><span> </span><span id="local-6989586621681492106"><span class="annot"><span class="annottext">db :: RocksDb
</span><a href="#local-6989586621681492106"><span class="hs-identifier hs-var">db</span></a></span></span><span> </span><span id="local-6989586621681492105"><span class="annot"><span class="annottext">v :: ChainwebVersion
</span><a href="#local-6989586621681492105"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RocksDb
-&gt; ChainwebVersion
-&gt; (Given WebBlockHeaderDb =&gt; PropertyM IO Bool)
-&gt; Property
</span><a href="Chainweb.Cut.Test.html#ioTest"><span class="hs-identifier hs-var">ioTest</span></a></span><span> </span><span class="annot"><span class="annottext">RocksDb
</span><a href="#local-6989586621681492106"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="annot"><span class="annottext">ChainwebVersion
</span><a href="#local-6989586621681492105"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">((Given WebBlockHeaderDb =&gt; PropertyM IO Bool) -&gt; Property)
-&gt; (Given WebBlockHeaderDb =&gt; PropertyM IO Bool) -&gt; Property
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-535"></span><span>    </span><span class="annot"><a href="Chainweb.Cut.Test.html#TestFork"><span class="hs-identifier hs-type">TestFork</span></a></span><span> </span><span class="hs-identifier">_</span><span> </span><span id="local-6989586621681492104"><span class="annot"><span class="annottext">a :: Cut
</span><a href="#local-6989586621681492104"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621681492103"><span class="annot"><span class="annottext">b :: Cut
</span><a href="#local-6989586621681492103"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PropertyM IO TestFork
Given WebBlockHeaderDb =&gt; PropertyM IO TestFork
</span><a href="Chainweb.Cut.Test.html#arbitraryFork"><span class="hs-identifier hs-var">arbitraryFork</span></a></span><span>
</span><span id="line-536"></span><span>    </span><span class="annot"><span class="annottext">IO Bool -&gt; PropertyM IO Bool
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO Bool -&gt; PropertyM IO Bool) -&gt; IO Bool -&gt; PropertyM IO Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Cut -&gt; Cut -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">(==)</span></span><span>
</span><span id="line-537"></span><span>        </span><span class="annot"><span class="annottext">(Cut -&gt; Cut -&gt; Bool) -&gt; IO Cut -&gt; IO (Cut -&gt; Bool)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">WebBlockHeaderDb -&gt; Cut -&gt; Cut -&gt; IO Cut
</span><a href="Chainweb.Cut.html#meet"><span class="hs-identifier hs-var">meet</span></a></span><span> </span><span class="annot"><span class="annottext">WebBlockHeaderDb
forall a. Given a =&gt; a
</span><span class="hs-identifier hs-var">given</span></span><span> </span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492104"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492103"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-538"></span><span>        </span><span class="annot"><span class="annottext">IO (Cut -&gt; Bool) -&gt; IO Cut -&gt; IO Bool
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Join Int -&gt; Cut
forall a. Join a -&gt; Cut
</span><a href="Chainweb.Cut.html#_joinBase"><span class="hs-identifier hs-var hs-var">_joinBase</span></a></span><span> </span><span class="annot"><span class="annottext">(Join Int -&gt; Cut) -&gt; IO (Join Int) -&gt; IO Cut
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">WebBlockHeaderDb
-&gt; (DiffItem BlockHeader -&gt; DiffItem (Maybe Int))
-&gt; Cut
-&gt; Cut
-&gt; IO (Join Int)
forall a.
Ord a =&gt;
WebBlockHeaderDb
-&gt; (DiffItem BlockHeader -&gt; DiffItem (Maybe a))
-&gt; Cut
-&gt; Cut
-&gt; IO (Join a)
</span><a href="Chainweb.Cut.html#join"><span class="hs-identifier hs-var">join</span></a></span><span> </span><span class="annot"><span class="annottext">WebBlockHeaderDb
forall a. Given a =&gt; a
</span><span class="hs-identifier hs-var">given</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Cut -&gt; Cut -&gt; DiffItem BlockHeader -&gt; DiffItem (Maybe Int)
</span><a href="Chainweb.Cut.html#prioritizeHeavier"><span class="hs-identifier hs-var">prioritizeHeavier</span></a></span><span> </span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492104"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492103"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492104"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681492103"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-539"></span><span>
</span><span id="line-540"></span><span class="annot"><a href="Chainweb.Cut.Test.html#properties_testMining"><span class="hs-identifier hs-type">properties_testMining</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">RocksDb</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Chainweb.Version.html#ChainwebVersion"><span class="hs-identifier hs-type">ChainwebVersion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Property</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-541"></span><span id="properties_testMining"><span class="annot"><span class="annottext">properties_testMining :: RocksDb -&gt; ChainwebVersion -&gt; [([Char], Property)]
</span><a href="Chainweb.Cut.Test.html#properties_testMining"><span class="hs-identifier hs-var hs-var">properties_testMining</span></a></span></span><span> </span><span id="local-6989586621681492102"><span class="annot"><span class="annottext">db :: RocksDb
</span><a href="#local-6989586621681492102"><span class="hs-identifier hs-var">db</span></a></span></span><span> </span><span id="local-6989586621681492101"><span class="annot"><span class="annottext">v :: ChainwebVersion
</span><a href="#local-6989586621681492101"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-542"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;Cuts of arbitrary fork have valid braiding&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">RocksDb -&gt; ChainwebVersion -&gt; Property
</span><a href="Chainweb.Cut.Test.html#prop_arbitraryForkBraiding"><span class="hs-identifier hs-var">prop_arbitraryForkBraiding</span></a></span><span> </span><span class="annot"><span class="annottext">RocksDb
</span><a href="#local-6989586621681492102"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="annot"><span class="annottext">ChainwebVersion
</span><a href="#local-6989586621681492101"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-543"></span><span>
</span><span id="line-544"></span><span class="annot"><a href="Chainweb.Cut.Test.html#properties_misc"><span class="hs-identifier hs-type">properties_misc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">RocksDb</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Chainweb.Version.html#ChainwebVersion"><span class="hs-identifier hs-type">ChainwebVersion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Property</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-545"></span><span id="properties_misc"><span class="annot"><span class="annottext">properties_misc :: RocksDb -&gt; ChainwebVersion -&gt; [([Char], Property)]
</span><a href="Chainweb.Cut.Test.html#properties_misc"><span class="hs-identifier hs-var hs-var">properties_misc</span></a></span></span><span> </span><span id="local-6989586621681492099"><span class="annot"><span class="annottext">db :: RocksDb
</span><a href="#local-6989586621681492099"><span class="hs-identifier hs-var">db</span></a></span></span><span> </span><span id="local-6989586621681492098"><span class="annot"><span class="annottext">v :: ChainwebVersion
</span><a href="#local-6989586621681492098"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-546"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;prop_joinBase&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">RocksDb -&gt; ChainwebVersion -&gt; Property
</span><a href="Chainweb.Cut.Test.html#prop_joinBase"><span class="hs-identifier hs-var">prop_joinBase</span></a></span><span> </span><span class="annot"><span class="annottext">RocksDb
</span><a href="#local-6989586621681492099"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="annot"><span class="annottext">ChainwebVersion
</span><a href="#local-6989586621681492098"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-547"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;prop_joinBaseMeet&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">RocksDb -&gt; ChainwebVersion -&gt; Property
</span><a href="Chainweb.Cut.Test.html#prop_joinBaseMeet"><span class="hs-identifier hs-var">prop_joinBaseMeet</span></a></span><span> </span><span class="annot"><span class="annottext">RocksDb
</span><a href="#local-6989586621681492099"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="annot"><span class="annottext">ChainwebVersion
</span><a href="#local-6989586621681492098"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-548"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;prop_meetGenesisCut&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">RocksDb
-&gt; ChainwebVersion
-&gt; (Given WebBlockHeaderDb =&gt; PropertyM IO Bool)
-&gt; Property
</span><a href="Chainweb.Cut.Test.html#ioTest"><span class="hs-identifier hs-var">ioTest</span></a></span><span> </span><span class="annot"><span class="annottext">RocksDb
</span><a href="#local-6989586621681492099"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="annot"><span class="annottext">ChainwebVersion
</span><a href="#local-6989586621681492098"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Given WebBlockHeaderDb =&gt; PropertyM IO Bool
</span><a href="Chainweb.Cut.Test.html#prop_meetGenesisCut"><span class="hs-identifier hs-var">prop_meetGenesisCut</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-549"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;Cuts of arbitrary fork have valid braiding&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">RocksDb -&gt; ChainwebVersion -&gt; Property
</span><a href="Chainweb.Cut.Test.html#prop_arbitraryForkBraiding"><span class="hs-identifier hs-var">prop_arbitraryForkBraiding</span></a></span><span> </span><span class="annot"><span class="annottext">RocksDb
</span><a href="#local-6989586621681492099"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="annot"><span class="annottext">ChainwebVersion
</span><a href="#local-6989586621681492098"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-550"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-551"></span><span>
</span><span id="line-552"></span><span class="hs-comment">-- -------------------------------------------------------------------------- --</span><span>
</span><span id="line-553"></span><span class="hs-comment">-- &quot;Valid&quot; Properties</span><span>
</span><span id="line-554"></span><span>
</span><span id="line-555"></span><span class="annot"><a href="Chainweb.Cut.Test.html#properties"><span class="hs-identifier hs-type">properties</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">RocksDb</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Property</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-556"></span><span id="properties"><span class="annot"><span class="annottext">properties :: RocksDb -&gt; [([Char], Property)]
</span><a href="Chainweb.Cut.Test.html#properties"><span class="hs-identifier hs-var hs-var">properties</span></a></span></span><span> </span><span id="local-6989586621681492097"><span class="annot"><span class="annottext">db :: RocksDb
</span><a href="#local-6989586621681492097"><span class="hs-identifier hs-var">db</span></a></span></span><span>
</span><span id="line-557"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RocksDb -&gt; ChainwebVersion -&gt; [([Char], Property)]
</span><a href="Chainweb.Cut.Test.html#properties_lattice_passing"><span class="hs-identifier hs-var">properties_lattice_passing</span></a></span><span> </span><span class="annot"><span class="annottext">RocksDb
</span><a href="#local-6989586621681492097"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="annot"><span class="annottext">ChainwebVersion
</span><a href="#local-6989586621681492096"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-558"></span><span>    </span><span class="annot"><span class="annottext">[([Char], Property)]
-&gt; [([Char], Property)] -&gt; [([Char], Property)]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ChainwebVersion -&gt; [([Char], Property)]
</span><a href="Chainweb.Cut.Test.html#properties_cut"><span class="hs-identifier hs-var">properties_cut</span></a></span><span> </span><span class="annot"><span class="annottext">ChainwebVersion
</span><a href="#local-6989586621681492096"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-559"></span><span>    </span><span class="annot"><span class="annottext">[([Char], Property)]
-&gt; [([Char], Property)] -&gt; [([Char], Property)]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">RocksDb -&gt; ChainwebVersion -&gt; [([Char], Property)]
</span><a href="Chainweb.Cut.Test.html#properties_testMining"><span class="hs-identifier hs-var">properties_testMining</span></a></span><span> </span><span class="annot"><span class="annottext">RocksDb
</span><a href="#local-6989586621681492097"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="annot"><span class="annottext">ChainwebVersion
</span><a href="#local-6989586621681492096"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-560"></span><span>    </span><span class="annot"><span class="annottext">[([Char], Property)]
-&gt; [([Char], Property)] -&gt; [([Char], Property)]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">RocksDb -&gt; ChainwebVersion -&gt; [([Char], Property)]
</span><a href="Chainweb.Cut.Test.html#properties_misc"><span class="hs-identifier hs-var">properties_misc</span></a></span><span> </span><span class="annot"><span class="annottext">RocksDb
</span><a href="#local-6989586621681492097"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="annot"><span class="annottext">ChainwebVersion
</span><a href="#local-6989586621681492096"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-561"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-562"></span><span>    </span><span id="local-6989586621681492096"><span class="annot"><span class="annottext">v :: ChainwebVersion
</span><a href="#local-6989586621681492096"><span class="hs-identifier hs-var hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ChainGraph -&gt; ChainwebVersion
</span><a href="Chainweb.Version.html#Test"><span class="hs-identifier hs-var">Test</span></a></span><span> </span><span class="annot"><span class="annottext">ChainGraph
</span><a href="Chainweb.Graph.html#pairChainGraph"><span class="hs-identifier hs-var">pairChainGraph</span></a></span><span>
</span><span id="line-563"></span><span>
</span><span id="line-564"></span><span class="hs-comment">-- -------------------------------------------------------------------------- --</span><span>
</span><span id="line-565"></span><span class="hs-comment">-- TestTools</span><span>
</span><span id="line-566"></span><span>
</span><span id="line-567"></span><span id="local-6989586621681492403"><span id="local-6989586621681492404"><span class="annot"><a href="Chainweb.Cut.Test.html#giveNewWebChain"><span class="hs-identifier hs-type">giveNewWebChain</span></a></span><span>
</span><span id="line-568"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621681492404"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-569"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">RocksDb</span></span><span>
</span><span id="line-570"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Chainweb.Version.html#ChainwebVersion"><span class="hs-identifier hs-type">ChainwebVersion</span></a></span><span>
</span><span id="line-571"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Given</span></span><span> </span><span class="annot"><a href="Chainweb.WebBlockHeaderDB.Types.html#WebBlockHeaderDb"><span class="hs-identifier hs-type">WebBlockHeaderDb</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681492404"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681492403"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-572"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681492404"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681492403"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-573"></span><span id="giveNewWebChain"><span class="annot"><span class="annottext">giveNewWebChain :: RocksDb
-&gt; ChainwebVersion -&gt; (Given WebBlockHeaderDb =&gt; m a) -&gt; m a
</span><a href="Chainweb.Cut.Test.html#giveNewWebChain"><span class="hs-identifier hs-var hs-var">giveNewWebChain</span></a></span></span><span> </span><span id="local-6989586621681492094"><span class="annot"><span class="annottext">db :: RocksDb
</span><a href="#local-6989586621681492094"><span class="hs-identifier hs-var">db</span></a></span></span><span> </span><span id="local-6989586621681492093"><span class="annot"><span class="annottext">v :: ChainwebVersion
</span><a href="#local-6989586621681492093"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621681492092"><span class="annot"><span class="annottext">f :: Given WebBlockHeaderDb =&gt; m a
</span><a href="#local-6989586621681492092"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-574"></span><span>    </span><span id="local-6989586621681492091"><span class="annot"><span class="annottext">WebBlockHeaderDb
</span><a href="#local-6989586621681492091"><span class="hs-identifier hs-var">bdb</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO WebBlockHeaderDb -&gt; m WebBlockHeaderDb
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RocksDb -&gt; ChainwebVersion -&gt; IO WebBlockHeaderDb
</span><a href="Chainweb.WebBlockHeaderDB.html#initWebBlockHeaderDb"><span class="hs-identifier hs-var">initWebBlockHeaderDb</span></a></span><span> </span><span class="annot"><span class="annottext">RocksDb
</span><a href="#local-6989586621681492094"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="annot"><span class="annottext">ChainwebVersion
</span><a href="#local-6989586621681492093"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-575"></span><span>    </span><span class="annot"><span class="annottext">WebBlockHeaderDb -&gt; (Given WebBlockHeaderDb =&gt; m a) -&gt; m a
forall a r. a -&gt; (Given a =&gt; r) -&gt; r
</span><span class="hs-identifier hs-var">give</span></span><span> </span><span class="annot"><span class="annottext">WebBlockHeaderDb
</span><a href="#local-6989586621681492091"><span class="hs-identifier hs-var">bdb</span></a></span><span> </span><span class="annot"><span class="annottext">Given WebBlockHeaderDb =&gt; m a
</span><a href="#local-6989586621681492092"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-576"></span><span>
</span><span id="line-577"></span><span class="annot"><a href="Chainweb.Cut.Test.html#ioTest"><span class="hs-identifier hs-type">ioTest</span></a></span><span>
</span><span id="line-578"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">RocksDb</span></span><span>
</span><span id="line-579"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Chainweb.Version.html#ChainwebVersion"><span class="hs-identifier hs-type">ChainwebVersion</span></a></span><span>
</span><span id="line-580"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Given</span></span><span> </span><span class="annot"><a href="Chainweb.WebBlockHeaderDB.Types.html#WebBlockHeaderDb"><span class="hs-identifier hs-type">WebBlockHeaderDb</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.PropertyM</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span>
</span><span id="line-581"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Property</span></span><span>
</span><span id="line-582"></span><span id="ioTest"><span class="annot"><span class="annottext">ioTest :: RocksDb
-&gt; ChainwebVersion
-&gt; (Given WebBlockHeaderDb =&gt; PropertyM IO Bool)
-&gt; Property
</span><a href="Chainweb.Cut.Test.html#ioTest"><span class="hs-identifier hs-var hs-var">ioTest</span></a></span></span><span> </span><span id="local-6989586621681492089"><span class="annot"><span class="annottext">db :: RocksDb
</span><a href="#local-6989586621681492089"><span class="hs-identifier hs-var">db</span></a></span></span><span> </span><span id="local-6989586621681492088"><span class="annot"><span class="annottext">v :: ChainwebVersion
</span><a href="#local-6989586621681492088"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621681492087"><span class="annot"><span class="annottext">f :: Given WebBlockHeaderDb =&gt; PropertyM IO Bool
</span><a href="#local-6989586621681492087"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PropertyM IO () -&gt; Property
forall a. Testable a =&gt; PropertyM IO a -&gt; Property
</span><span class="hs-identifier hs-var">T.monadicIO</span></span><span> </span><span class="annot"><span class="annottext">(PropertyM IO () -&gt; Property) -&gt; PropertyM IO () -&gt; Property
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RocksDb
-&gt; ChainwebVersion
-&gt; (Given WebBlockHeaderDb =&gt; PropertyM IO ())
-&gt; PropertyM IO ()
forall (m :: * -&gt; *) a.
MonadIO m =&gt;
RocksDb
-&gt; ChainwebVersion -&gt; (Given WebBlockHeaderDb =&gt; m a) -&gt; m a
</span><a href="Chainweb.Cut.Test.html#giveNewWebChain"><span class="hs-identifier hs-var">giveNewWebChain</span></a></span><span> </span><span class="annot"><span class="annottext">RocksDb
</span><a href="#local-6989586621681492089"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="annot"><span class="annottext">ChainwebVersion
</span><a href="#local-6989586621681492088"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">((Given WebBlockHeaderDb =&gt; PropertyM IO ()) -&gt; PropertyM IO ())
-&gt; (Given WebBlockHeaderDb =&gt; PropertyM IO ()) -&gt; PropertyM IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PropertyM IO Bool
Given WebBlockHeaderDb =&gt; PropertyM IO Bool
</span><a href="#local-6989586621681492087"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">PropertyM IO Bool -&gt; (Bool -&gt; PropertyM IO ()) -&gt; PropertyM IO ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; PropertyM IO ()
forall (m :: * -&gt; *). Monad m =&gt; Bool -&gt; PropertyM m ()
</span><span class="hs-identifier hs-var">T.assert</span></span><span>
</span><span id="line-583"></span></pre></body></html>