<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE BangPatterns #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE DeriveAnyClass #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE DeriveGeneric #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE DerivingStrategies #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE FlexibleInstances #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE GeneralizedNewtypeDeriving #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE MultiWayIf #-}</span><span>
</span><span id="line-10"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-11"></span><span class="hs-pragma">{-# LANGUAGE RankNTypes #-}</span><span>
</span><span id="line-12"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-13"></span><span class="hs-pragma">{-# LANGUAGE TemplateHaskell #-}</span><span>
</span><span id="line-14"></span><span class="hs-pragma">{-# LANGUAGE TupleSections #-}</span><span>
</span><span id="line-15"></span><span class="hs-pragma">{-# LANGUAGE TypeApplications #-}</span><span>
</span><span id="line-16"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies #-}</span><span>
</span><span id="line-17"></span><span>
</span><span id="line-18"></span><span class="hs-comment">-- |</span><span>
</span><span id="line-19"></span><span class="hs-comment">-- Module: Chainweb.Chainweb</span><span>
</span><span id="line-20"></span><span class="hs-comment">-- Copyright: Copyright &#169; 2018 Kadena LLC.</span><span>
</span><span id="line-21"></span><span class="hs-comment">-- License: MIT</span><span>
</span><span id="line-22"></span><span class="hs-comment">-- Maintainer: Lars Kuhtz &lt;lars@kadena.io&gt;</span><span>
</span><span id="line-23"></span><span class="hs-comment">-- Stability: experimental</span><span>
</span><span id="line-24"></span><span class="hs-comment">--</span><span>
</span><span id="line-25"></span><span class="hs-comment">-- This module provides the tools to initialize the different components of the</span><span>
</span><span id="line-26"></span><span class="hs-comment">-- chainweb consensus and run a chainweb-consensus node.</span><span>
</span><span id="line-27"></span><span class="hs-comment">--</span><span>
</span><span id="line-28"></span><span class="hs-comment">-- The overall pattern is that for each component @C@ there is</span><span>
</span><span id="line-29"></span><span class="hs-comment">--</span><span>
</span><span id="line-30"></span><span class="hs-comment">-- 1.  a function @withC@ that manages the resources of the component and passes</span><span>
</span><span id="line-31"></span><span class="hs-comment">--     a handle that encapsulates those resources to an inner computation, and</span><span>
</span><span id="line-32"></span><span class="hs-comment">--</span><span>
</span><span id="line-33"></span><span class="hs-comment">-- 2.  a function @runC@ that takes the resource handle of @C@ and starts the</span><span>
</span><span id="line-34"></span><span>    </span><span class="hs-comment">-- component.</span><span>
</span><span id="line-35"></span><span class="hs-comment">--</span><span>
</span><span id="line-36"></span><span class="hs-comment">-- This pattern allows to bootstrap components with mutual dependencies and</span><span>
</span><span id="line-37"></span><span class="hs-comment">-- resolve timing and ordering constraints for the startup of services.</span><span>
</span><span id="line-38"></span><span class="hs-comment">--</span><span>
</span><span id="line-39"></span><span class="hs-comment">-- Logging functions are initialized in the enviroment and passed as call backs</span><span>
</span><span id="line-40"></span><span class="hs-comment">-- to the components.</span><span>
</span><span id="line-41"></span><span class="hs-comment">--</span><span>
</span><span id="line-42"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Chainweb.Chainweb</span><span>
</span><span id="line-43"></span><span class="hs-special">(</span><span>
</span><span id="line-44"></span><span class="annot"><span class="hs-comment">-- * Pact Configuration</span></span><span>
</span><span id="line-45"></span><span>  </span><span class="annot"><a href="Chainweb.Chainweb.html#TransactionIndexConfig"><span class="hs-identifier">TransactionIndexConfig</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.Chainweb.html#defaultTransactionIndexConfig"><span class="hs-identifier">defaultTransactionIndexConfig</span></a></span><span>
</span><span id="line-47"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.Chainweb.html#pTransactionIndexConfig"><span class="hs-identifier">pTransactionIndexConfig</span></a></span><span>
</span><span id="line-48"></span><span>
</span><span id="line-49"></span><span class="annot"><span class="hs-comment">-- * Configuration</span></span><span>
</span><span id="line-50"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.Chainweb.html#ChainwebConfiguration"><span class="hs-identifier">ChainwebConfiguration</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-51"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.Chainweb.html#configNodeId"><span class="hs-identifier">configNodeId</span></a></span><span>
</span><span id="line-52"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.Chainweb.html#configChainwebVersion"><span class="hs-identifier">configChainwebVersion</span></a></span><span>
</span><span id="line-53"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.Chainweb.html#configMiner"><span class="hs-identifier">configMiner</span></a></span><span>
</span><span id="line-54"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.Chainweb.html#configCoordinator"><span class="hs-identifier">configCoordinator</span></a></span><span>
</span><span id="line-55"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.Chainweb.html#configHeaderStream"><span class="hs-identifier">configHeaderStream</span></a></span><span>
</span><span id="line-56"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.Chainweb.html#configReintroTxs"><span class="hs-identifier">configReintroTxs</span></a></span><span>
</span><span id="line-57"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.Chainweb.html#configP2p"><span class="hs-identifier">configP2p</span></a></span><span>
</span><span id="line-58"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.Chainweb.html#configTransactionIndex"><span class="hs-identifier">configTransactionIndex</span></a></span><span>
</span><span id="line-59"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.Chainweb.html#configBlockGasLimit"><span class="hs-identifier">configBlockGasLimit</span></a></span><span>
</span><span id="line-60"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.Chainweb.html#defaultChainwebConfiguration"><span class="hs-identifier">defaultChainwebConfiguration</span></a></span><span>
</span><span id="line-61"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.Chainweb.html#pChainwebConfiguration"><span class="hs-identifier">pChainwebConfiguration</span></a></span><span>
</span><span id="line-62"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.Chainweb.html#validateChainwebConfiguration"><span class="hs-identifier">validateChainwebConfiguration</span></a></span><span>
</span><span id="line-63"></span><span>
</span><span id="line-64"></span><span class="annot"><span class="hs-comment">-- * Chainweb Resources</span></span><span>
</span><span id="line-65"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.Chainweb.html#Chainweb"><span class="hs-identifier">Chainweb</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-66"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.Chainweb.html#chainwebChains"><span class="hs-identifier">chainwebChains</span></a></span><span>
</span><span id="line-67"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.Chainweb.html#chainwebCutResources"><span class="hs-identifier">chainwebCutResources</span></a></span><span>
</span><span id="line-68"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.Chainweb.html#chainwebHostAddress"><span class="hs-identifier">chainwebHostAddress</span></a></span><span>
</span><span id="line-69"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.Chainweb.html#chainwebMiner"><span class="hs-identifier">chainwebMiner</span></a></span><span>
</span><span id="line-70"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.Chainweb.html#chainwebCoordinator"><span class="hs-identifier">chainwebCoordinator</span></a></span><span>
</span><span id="line-71"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.Chainweb.html#chainwebHeaderStream"><span class="hs-identifier">chainwebHeaderStream</span></a></span><span>
</span><span id="line-72"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.Chainweb.html#chainwebLogger"><span class="hs-identifier">chainwebLogger</span></a></span><span>
</span><span id="line-73"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.Chainweb.html#chainwebSocket"><span class="hs-identifier">chainwebSocket</span></a></span><span>
</span><span id="line-74"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.Chainweb.html#chainwebPeer"><span class="hs-identifier">chainwebPeer</span></a></span><span>
</span><span id="line-75"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.Chainweb.html#chainwebPayloadDb"><span class="hs-identifier">chainwebPayloadDb</span></a></span><span>
</span><span id="line-76"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.Chainweb.html#chainwebPactData"><span class="hs-identifier">chainwebPactData</span></a></span><span>
</span><span id="line-77"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.Chainweb.html#chainwebThrottler"><span class="hs-identifier">chainwebThrottler</span></a></span><span>
</span><span id="line-78"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.Chainweb.html#chainwebConfig"><span class="hs-identifier">chainwebConfig</span></a></span><span>
</span><span id="line-79"></span><span>
</span><span id="line-80"></span><span class="annot"><span class="hs-comment">-- ** Mempool integration</span></span><span>
</span><span id="line-81"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.Transaction.html#ChainwebTransaction"><span class="hs-identifier">ChainwebTransaction</span></a></span><span>
</span><span id="line-82"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#chainwebTransactionConfig"><span class="hs-identifier">Mempool.chainwebTransactionConfig</span></a></span><span>
</span><span id="line-83"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.Chainweb.html#validatingMempoolConfig"><span class="hs-identifier">validatingMempoolConfig</span></a></span><span>
</span><span id="line-84"></span><span>
</span><span id="line-85"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.Chainweb.html#withChainweb"><span class="hs-identifier">withChainweb</span></a></span><span>
</span><span id="line-86"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.Chainweb.html#runChainweb"><span class="hs-identifier">runChainweb</span></a></span><span>
</span><span id="line-87"></span><span>
</span><span id="line-88"></span><span class="annot"><span class="hs-comment">-- * Miner</span></span><span>
</span><span id="line-89"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.Chainweb.MinerResources.html#runMiner"><span class="hs-identifier">runMiner</span></a></span><span>
</span><span id="line-90"></span><span>
</span><span id="line-91"></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-92"></span><span>
</span><span id="line-93"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Configuration.Utils</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Error</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Lens'</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">disabled</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(&lt;.&gt;)</span></span><span class="hs-special">)</span><span>
</span><span id="line-94"></span><span>
</span><span id="line-95"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Concurrent</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">threadDelay</span></span><span class="hs-special">)</span><span>
</span><span id="line-96"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Concurrent.Async</span></span><span>
</span><span id="line-97"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Concurrent.MVar</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">MVar</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">newEmptyMVar</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">putMVar</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">readMVar</span></span><span class="hs-special">)</span><span>
</span><span id="line-98"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Error.Util</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">note</span></span><span class="hs-special">)</span><span>
</span><span id="line-99"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Lens</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">(.=)</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(&lt;.&gt;)</span></span><span class="hs-special">)</span><span>
</span><span id="line-100"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span>
</span><span id="line-101"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Catch</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">throwM</span></span><span class="hs-special">)</span><span>
</span><span id="line-102"></span><span>
</span><span id="line-103"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Align</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">alignWith</span></span><span class="hs-special">)</span><span>
</span><span id="line-104"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Short</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">SB</span></span><span>
</span><span id="line-105"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.CAS</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">casLookupM</span></span><span class="hs-special">)</span><span>
</span><span id="line-106"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Foldable</span></span><span>
</span><span id="line-107"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Function</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">on</span></span><span class="hs-special">)</span><span>
</span><span id="line-108"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.HashMap.Strict</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HM</span></span><span>
</span><span id="line-109"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">sortBy</span></span><span class="hs-special">)</span><span>
</span><span id="line-110"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span>
</span><span id="line-111"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Monoid</span></span><span>
</span><span id="line-112"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-113"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.These</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">These</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-114"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Tuple.Strict</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">T2</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-115"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Vector</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">V</span></span><span>
</span><span id="line-116"></span><span>
</span><span id="line-117"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Generics</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">from</span></span><span class="hs-special">)</span><span>
</span><span id="line-118"></span><span>
</span><span id="line-119"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Network.HTTP.Client</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HTTP</span></span><span>
</span><span id="line-120"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Network.Socket</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Socket</span></span><span class="hs-special">)</span><span>
</span><span id="line-121"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Network.Wai</span></span><span>
</span><span id="line-122"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Network.Wai.Handler.Warp</span></span><span>
</span><span id="line-123"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Network.Wai.Middleware.Throttle</span></span><span>
</span><span id="line-124"></span><span>
</span><span id="line-125"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Numeric.Natural</span></span><span>
</span><span id="line-126"></span><span>
</span><span id="line-127"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Prelude</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">log</span></span><span class="hs-special">)</span><span>
</span><span id="line-128"></span><span>
</span><span id="line-129"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.Clock</span></span><span>
</span><span id="line-130"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.LogLevel</span></span><span>
</span><span id="line-131"></span><span>
</span><span id="line-132"></span><span class="hs-comment">-- internal modules</span><span>
</span><span id="line-133"></span><span>
</span><span id="line-134"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Pact.Types.ChainId</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">P</span></span><span>
</span><span id="line-135"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Pact.Types.ChainMeta</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">P</span></span><span>
</span><span id="line-136"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Pact.Types.Command</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">P</span></span><span>
</span><span id="line-137"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Pact.Types.Hash</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">P</span></span><span>
</span><span id="line-138"></span><span>
</span><span id="line-139"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Chainweb.BlockHeader.html"><span class="hs-identifier">Chainweb.BlockHeader</span></a></span><span>
</span><span id="line-140"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Chainweb.BlockHeaderDB.html"><span class="hs-identifier">Chainweb.BlockHeaderDB</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.BlockHeaderDB.Types.html#BlockHeaderDb"><span class="hs-identifier">BlockHeaderDb</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-141"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Chainweb.BlockHeaderDB.RestAPI.html"><span class="hs-identifier">Chainweb.BlockHeaderDB.RestAPI</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.BlockHeaderDB.RestAPI.html#HeaderStream"><span class="hs-identifier">HeaderStream</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-142"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Chainweb.ChainId.html"><span class="hs-identifier">Chainweb.ChainId</span></a></span><span>
</span><span id="line-143"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Chainweb.Chainweb.ChainResources.html"><span class="hs-identifier">Chainweb.Chainweb.ChainResources</span></a></span><span>
</span><span id="line-144"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Chainweb.Chainweb.CutResources.html"><span class="hs-identifier">Chainweb.Chainweb.CutResources</span></a></span><span>
</span><span id="line-145"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Chainweb.Chainweb.MinerResources.html"><span class="hs-identifier">Chainweb.Chainweb.MinerResources</span></a></span><span>
</span><span id="line-146"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Chainweb.Chainweb.PeerResources.html"><span class="hs-identifier">Chainweb.Chainweb.PeerResources</span></a></span><span>
</span><span id="line-147"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Chainweb.Cut.html"><span class="hs-identifier">Chainweb.Cut</span></a></span><span>
</span><span id="line-148"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Chainweb.CutDB.html"><span class="hs-identifier">Chainweb.CutDB</span></a></span><span>
</span><span id="line-149"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Chainweb.Graph.html"><span class="hs-identifier">Chainweb.Graph</span></a></span><span>
</span><span id="line-150"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Chainweb.HostAddress.html"><span class="hs-identifier">Chainweb.HostAddress</span></a></span><span>
</span><span id="line-151"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Chainweb.Logger.html"><span class="hs-identifier">Chainweb.Logger</span></a></span><span>
</span><span id="line-152"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Chainweb.Mempool.InMemTypes.html"><span class="hs-identifier">Chainweb.Mempool.InMemTypes</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Mempool</span></span><span>
</span><span id="line-153"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Chainweb.Mempool.Mempool.html"><span class="hs-identifier">Chainweb.Mempool.Mempool</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Mempool</span></span><span>
</span><span id="line-154"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Chainweb.Mempool.P2pConfig.html"><span class="hs-identifier">Chainweb.Mempool.P2pConfig</span></a></span><span>
</span><span id="line-155"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Chainweb.Miner.Config.html"><span class="hs-identifier">Chainweb.Miner.Config</span></a></span><span>
</span><span id="line-156"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Chainweb.NodeId.html"><span class="hs-identifier">Chainweb.NodeId</span></a></span><span>
</span><span id="line-157"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Chainweb.Pact.RestAPI.Server.html"><span class="hs-identifier">Chainweb.Pact.RestAPI.Server</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.Pact.RestAPI.Server.html#PactServerData"><span class="hs-identifier">PactServerData</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-158"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Chainweb.Pact.Utils.html"><span class="hs-identifier">Chainweb.Pact.Utils</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.Pact.Utils.html#fromPactChainId"><span class="hs-identifier">fromPactChainId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-159"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Chainweb.Payload.html"><span class="hs-identifier">Chainweb.Payload</span></a></span><span>
</span><span id="line-160"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Chainweb.Payload.PayloadStore.html"><span class="hs-identifier">Chainweb.Payload.PayloadStore</span></a></span><span>
</span><span id="line-161"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Chainweb.Payload.PayloadStore.RocksDB.html"><span class="hs-identifier">Chainweb.Payload.PayloadStore.RocksDB</span></a></span><span>
</span><span id="line-162"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Chainweb.RestAPI.html"><span class="hs-identifier">Chainweb.RestAPI</span></a></span><span>
</span><span id="line-163"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Chainweb.RestAPI.NetworkID.html"><span class="hs-identifier">Chainweb.RestAPI.NetworkID</span></a></span><span>
</span><span id="line-164"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Chainweb.Transaction.html"><span class="hs-identifier">Chainweb.Transaction</span></a></span><span>
</span><span id="line-165"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Chainweb.Utils.html"><span class="hs-identifier">Chainweb.Utils</span></a></span><span>
</span><span id="line-166"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Chainweb.Utils.RequestLog.html"><span class="hs-identifier">Chainweb.Utils.RequestLog</span></a></span><span>
</span><span id="line-167"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Chainweb.Version.html"><span class="hs-identifier">Chainweb.Version</span></a></span><span>
</span><span id="line-168"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Chainweb.WebBlockHeaderDB.html"><span class="hs-identifier">Chainweb.WebBlockHeaderDB</span></a></span><span>
</span><span id="line-169"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Chainweb.WebPactExecutionService.html"><span class="hs-identifier">Chainweb.WebPactExecutionService</span></a></span><span>
</span><span id="line-170"></span><span>
</span><span id="line-171"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.CAS.RocksDB</span></span><span>
</span><span id="line-172"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Data.LogMessage.html"><span class="hs-identifier">Data.LogMessage</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.LogMessage.html#LogFunctionText"><span class="hs-identifier">LogFunctionText</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-173"></span><span>
</span><span id="line-174"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="P2P.Node.Configuration.html"><span class="hs-identifier">P2P.Node.Configuration</span></a></span><span>
</span><span id="line-175"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="P2P.Node.PeerDB.html"><span class="hs-identifier">P2P.Node.PeerDB</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="P2P.Node.PeerDB.html#PeerDb"><span class="hs-identifier">PeerDb</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-176"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="P2P.Peer.html"><span class="hs-identifier">P2P.Peer</span></a></span><span>
</span><span id="line-177"></span><span>
</span><span id="line-178"></span><span class="hs-comment">-- -------------------------------------------------------------------------- --</span><span>
</span><span id="line-179"></span><span class="hs-comment">-- TransactionIndexConfig</span><span>
</span><span id="line-180"></span><span>
</span><span id="line-181"></span><span id="local-6989586621681510984"><span id="local-6989586621681510985"></span></span><span class="hs-keyword">data</span><span> </span><span id="TransactionIndexConfig"><span class="annot"><a href="Chainweb.Chainweb.html#TransactionIndexConfig"><span class="hs-identifier hs-var">TransactionIndexConfig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="TransactionIndexConfig"><span class="annot"><a href="Chainweb.Chainweb.html#TransactionIndexConfig"><span class="hs-identifier hs-var">TransactionIndexConfig</span></a></span></span><span>
</span><span id="line-182"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681510977"><span id="local-6989586621681510979"><span id="local-6989586621681510981"><span class="annot"><span class="annottext">Int -&gt; TransactionIndexConfig -&gt; ShowS
[TransactionIndexConfig] -&gt; ShowS
TransactionIndexConfig -&gt; String
(Int -&gt; TransactionIndexConfig -&gt; ShowS)
-&gt; (TransactionIndexConfig -&gt; String)
-&gt; ([TransactionIndexConfig] -&gt; ShowS)
-&gt; Show TransactionIndexConfig
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [TransactionIndexConfig] -&gt; ShowS
$cshowList :: [TransactionIndexConfig] -&gt; ShowS
show :: TransactionIndexConfig -&gt; String
$cshow :: TransactionIndexConfig -&gt; String
showsPrec :: Int -&gt; TransactionIndexConfig -&gt; ShowS
$cshowsPrec :: Int -&gt; TransactionIndexConfig -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681510972"><span id="local-6989586621681510974"><span class="annot"><span class="annottext">TransactionIndexConfig -&gt; TransactionIndexConfig -&gt; Bool
(TransactionIndexConfig -&gt; TransactionIndexConfig -&gt; Bool)
-&gt; (TransactionIndexConfig -&gt; TransactionIndexConfig -&gt; Bool)
-&gt; Eq TransactionIndexConfig
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: TransactionIndexConfig -&gt; TransactionIndexConfig -&gt; Bool
$c/= :: TransactionIndexConfig -&gt; TransactionIndexConfig -&gt; Bool
== :: TransactionIndexConfig -&gt; TransactionIndexConfig -&gt; Bool
$c== :: TransactionIndexConfig -&gt; TransactionIndexConfig -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(forall x. TransactionIndexConfig -&gt; Rep TransactionIndexConfig x)
-&gt; (forall x.
    Rep TransactionIndexConfig x -&gt; TransactionIndexConfig)
-&gt; Generic TransactionIndexConfig
forall x. Rep TransactionIndexConfig x -&gt; TransactionIndexConfig
forall x. TransactionIndexConfig -&gt; Rep TransactionIndexConfig x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep TransactionIndexConfig x -&gt; TransactionIndexConfig
$cfrom :: forall x. TransactionIndexConfig -&gt; Rep TransactionIndexConfig x
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></span><span class="hs-special">)</span><span>
</span><span id="line-183"></span><span>
</span><span id="line-184"></span><span class="hs-identifier">makeLenses</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">TransactionIndexConfig</span><span>
</span><span id="line-185"></span><span>
</span><span id="line-186"></span><span class="annot"><a href="Chainweb.Chainweb.html#defaultTransactionIndexConfig"><span class="hs-identifier hs-type">defaultTransactionIndexConfig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Chainweb.Chainweb.html#TransactionIndexConfig"><span class="hs-identifier hs-type">TransactionIndexConfig</span></a></span><span>
</span><span id="line-187"></span><span id="defaultTransactionIndexConfig"><span class="annot"><span class="annottext">defaultTransactionIndexConfig :: TransactionIndexConfig
</span><a href="Chainweb.Chainweb.html#defaultTransactionIndexConfig"><span class="hs-identifier hs-var hs-var">defaultTransactionIndexConfig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TransactionIndexConfig
</span><a href="Chainweb.Chainweb.html#TransactionIndexConfig"><span class="hs-identifier hs-var">TransactionIndexConfig</span></a></span><span>
</span><span id="line-188"></span><span>
</span><span id="line-189"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681510961"><span id="local-6989586621681510963"><span id="local-6989586621681510965"><span class="annot"><span class="hs-identifier hs-type">ToJSON</span></span><span> </span><span class="annot"><a href="Chainweb.Chainweb.html#TransactionIndexConfig"><span class="hs-identifier hs-type">TransactionIndexConfig</span></a></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-190"></span><span>    </span><span id="local-6989586621681510959"><span class="annot"><span class="annottext">toJSON :: TransactionIndexConfig -&gt; Value
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">toJSON</span></span></span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Pair] -&gt; Value
</span><span class="hs-identifier hs-var">object</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-191"></span><span>
</span><span id="line-192"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681510954"><span class="annot"><span class="hs-identifier hs-type">FromJSON</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.Chainweb.html#TransactionIndexConfig"><span class="hs-identifier hs-type">TransactionIndexConfig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Chainweb.Chainweb.html#TransactionIndexConfig"><span class="hs-identifier hs-type">TransactionIndexConfig</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-193"></span><span>    </span><span id="local-6989586621681510952"><span class="annot"><span class="annottext">parseJSON :: Value -&gt; Parser (TransactionIndexConfig -&gt; TransactionIndexConfig)
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">parseJSON</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
-&gt; (Object
    -&gt; Parser (TransactionIndexConfig -&gt; TransactionIndexConfig))
-&gt; Value
-&gt; Parser (TransactionIndexConfig -&gt; TransactionIndexConfig)
forall a. String -&gt; (Object -&gt; Parser a) -&gt; Value -&gt; Parser a
</span><span class="hs-identifier hs-var">withObject</span></span><span> </span><span class="annot"><span class="hs-string">&quot;TransactionIndexConfig&quot;</span></span><span> </span><span class="annot"><span class="annottext">((Object
  -&gt; Parser (TransactionIndexConfig -&gt; TransactionIndexConfig))
 -&gt; Value
 -&gt; Parser (TransactionIndexConfig -&gt; TransactionIndexConfig))
-&gt; (Object
    -&gt; Parser (TransactionIndexConfig -&gt; TransactionIndexConfig))
-&gt; Value
-&gt; Parser (TransactionIndexConfig -&gt; TransactionIndexConfig)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Parser (TransactionIndexConfig -&gt; TransactionIndexConfig)
-&gt; Object
-&gt; Parser (TransactionIndexConfig -&gt; TransactionIndexConfig)
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TransactionIndexConfig -&gt; TransactionIndexConfig)
-&gt; Parser (TransactionIndexConfig -&gt; TransactionIndexConfig)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">TransactionIndexConfig -&gt; TransactionIndexConfig
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span class="hs-special">)</span><span>
</span><span id="line-194"></span><span>
</span><span id="line-195"></span><span class="annot"><a href="Chainweb.Chainweb.html#pTransactionIndexConfig"><span class="hs-identifier hs-type">pTransactionIndexConfig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MParser</span></span><span> </span><span class="annot"><a href="Chainweb.Chainweb.html#TransactionIndexConfig"><span class="hs-identifier hs-type">TransactionIndexConfig</span></a></span><span>
</span><span id="line-196"></span><span id="pTransactionIndexConfig"><span class="annot"><span class="annottext">pTransactionIndexConfig :: MParser TransactionIndexConfig
</span><a href="Chainweb.Chainweb.html#pTransactionIndexConfig"><span class="hs-identifier hs-var hs-var">pTransactionIndexConfig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TransactionIndexConfig -&gt; TransactionIndexConfig)
-&gt; MParser TransactionIndexConfig
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">TransactionIndexConfig -&gt; TransactionIndexConfig
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-197"></span><span>
</span><span id="line-198"></span><span class="hs-comment">-- -------------------------------------------------------------------------- --</span><span>
</span><span id="line-199"></span><span class="hs-comment">-- Chainweb Configuration</span><span>
</span><span id="line-200"></span><span>
</span><span id="line-201"></span><span id="local-6989586621681510946"><span id="local-6989586621681510947"></span></span><span class="hs-keyword">data</span><span> </span><span id="ChainwebConfiguration"><span class="annot"><a href="Chainweb.Chainweb.html#ChainwebConfiguration"><span class="hs-identifier hs-var">ChainwebConfiguration</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ChainwebConfiguration"><span class="annot"><a href="Chainweb.Chainweb.html#ChainwebConfiguration"><span class="hs-identifier hs-var">ChainwebConfiguration</span></a></span></span><span>
</span><span id="line-202"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="_configChainwebVersion"><span class="annot"><span class="annottext">ChainwebConfiguration -&gt; ChainwebVersion
</span><a href="Chainweb.Chainweb.html#_configChainwebVersion"><span class="hs-identifier hs-var hs-var">_configChainwebVersion</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Chainweb.Version.html#ChainwebVersion"><span class="hs-identifier hs-type">ChainwebVersion</span></a></span><span>
</span><span id="line-203"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="_configNodeId"><span class="annot"><span class="annottext">ChainwebConfiguration -&gt; NodeId
</span><a href="Chainweb.Chainweb.html#_configNodeId"><span class="hs-identifier hs-var hs-var">_configNodeId</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Chainweb.NodeId.html#NodeId"><span class="hs-identifier hs-type">NodeId</span></a></span><span>
</span><span id="line-204"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="_configMiner"><span class="annot"><span class="annottext">ChainwebConfiguration -&gt; EnableConfig MinerConfig
</span><a href="Chainweb.Chainweb.html#_configMiner"><span class="hs-identifier hs-var hs-var">_configMiner</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.Utils.html#EnableConfig"><span class="hs-identifier hs-type">EnableConfig</span></a></span><span> </span><span class="annot"><a href="Chainweb.Miner.Config.html#MinerConfig"><span class="hs-identifier hs-type">MinerConfig</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-205"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="_configCoordinator"><span class="annot"><span class="annottext">ChainwebConfiguration -&gt; Bool
</span><a href="Chainweb.Chainweb.html#_configCoordinator"><span class="hs-identifier hs-var hs-var">_configCoordinator</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-206"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="_configHeaderStream"><span class="annot"><span class="annottext">ChainwebConfiguration -&gt; Bool
</span><a href="Chainweb.Chainweb.html#_configHeaderStream"><span class="hs-identifier hs-var hs-var">_configHeaderStream</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-207"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="_configReintroTxs"><span class="annot"><span class="annottext">ChainwebConfiguration -&gt; Bool
</span><a href="Chainweb.Chainweb.html#_configReintroTxs"><span class="hs-identifier hs-var hs-var">_configReintroTxs</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-208"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="_configP2p"><span class="annot"><span class="annottext">ChainwebConfiguration -&gt; P2pConfiguration
</span><a href="Chainweb.Chainweb.html#_configP2p"><span class="hs-identifier hs-var hs-var">_configP2p</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="P2P.Node.Configuration.html#P2pConfiguration"><span class="hs-identifier hs-type">P2pConfiguration</span></a></span><span>
</span><span id="line-209"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="_configTransactionIndex"><span class="annot"><span class="annottext">ChainwebConfiguration -&gt; EnableConfig TransactionIndexConfig
</span><a href="Chainweb.Chainweb.html#_configTransactionIndex"><span class="hs-identifier hs-var hs-var">_configTransactionIndex</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.Utils.html#EnableConfig"><span class="hs-identifier hs-type">EnableConfig</span></a></span><span> </span><span class="annot"><a href="Chainweb.Chainweb.html#TransactionIndexConfig"><span class="hs-identifier hs-type">TransactionIndexConfig</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-210"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="_configIncludeOrigin"><span class="annot"><span class="annottext">ChainwebConfiguration -&gt; Bool
</span><a href="Chainweb.Chainweb.html#_configIncludeOrigin"><span class="hs-identifier hs-var hs-var">_configIncludeOrigin</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-211"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="_configThrottleRate"><span class="annot"><span class="annottext">ChainwebConfiguration -&gt; Natural
</span><a href="Chainweb.Chainweb.html#_configThrottleRate"><span class="hs-identifier hs-var hs-var">_configThrottleRate</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Natural</span></span><span>
</span><span id="line-212"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="_configMempoolP2p"><span class="annot"><span class="annottext">ChainwebConfiguration -&gt; EnableConfig MempoolP2pConfig
</span><a href="Chainweb.Chainweb.html#_configMempoolP2p"><span class="hs-identifier hs-var hs-var">_configMempoolP2p</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.Utils.html#EnableConfig"><span class="hs-identifier hs-type">EnableConfig</span></a></span><span> </span><span class="annot"><a href="Chainweb.Mempool.P2pConfig.html#MempoolP2pConfig"><span class="hs-identifier hs-type">MempoolP2pConfig</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-213"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="_configPruneChainDatabase"><span class="annot"><span class="annottext">ChainwebConfiguration -&gt; Bool
</span><a href="Chainweb.Chainweb.html#_configPruneChainDatabase"><span class="hs-identifier hs-var hs-var">_configPruneChainDatabase</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-214"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="_configBlockGasLimit"><span class="annot"><span class="annottext">ChainwebConfiguration -&gt; GasLimit
</span><a href="Chainweb.Chainweb.html#_configBlockGasLimit"><span class="hs-identifier hs-var hs-var">_configBlockGasLimit</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Mempool.GasLimit</span></span><span>
</span><span id="line-215"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-216"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681510926"><span id="local-6989586621681510928"><span id="local-6989586621681510930"><span class="annot"><span class="annottext">Int -&gt; ChainwebConfiguration -&gt; ShowS
[ChainwebConfiguration] -&gt; ShowS
ChainwebConfiguration -&gt; String
(Int -&gt; ChainwebConfiguration -&gt; ShowS)
-&gt; (ChainwebConfiguration -&gt; String)
-&gt; ([ChainwebConfiguration] -&gt; ShowS)
-&gt; Show ChainwebConfiguration
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [ChainwebConfiguration] -&gt; ShowS
$cshowList :: [ChainwebConfiguration] -&gt; ShowS
show :: ChainwebConfiguration -&gt; String
$cshow :: ChainwebConfiguration -&gt; String
showsPrec :: Int -&gt; ChainwebConfiguration -&gt; ShowS
$cshowsPrec :: Int -&gt; ChainwebConfiguration -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681510922"><span id="local-6989586621681510924"><span class="annot"><span class="annottext">ChainwebConfiguration -&gt; ChainwebConfiguration -&gt; Bool
(ChainwebConfiguration -&gt; ChainwebConfiguration -&gt; Bool)
-&gt; (ChainwebConfiguration -&gt; ChainwebConfiguration -&gt; Bool)
-&gt; Eq ChainwebConfiguration
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: ChainwebConfiguration -&gt; ChainwebConfiguration -&gt; Bool
$c/= :: ChainwebConfiguration -&gt; ChainwebConfiguration -&gt; Bool
== :: ChainwebConfiguration -&gt; ChainwebConfiguration -&gt; Bool
$c== :: ChainwebConfiguration -&gt; ChainwebConfiguration -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(forall x. ChainwebConfiguration -&gt; Rep ChainwebConfiguration x)
-&gt; (forall x. Rep ChainwebConfiguration x -&gt; ChainwebConfiguration)
-&gt; Generic ChainwebConfiguration
forall x. Rep ChainwebConfiguration x -&gt; ChainwebConfiguration
forall x. ChainwebConfiguration -&gt; Rep ChainwebConfiguration x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep ChainwebConfiguration x -&gt; ChainwebConfiguration
$cfrom :: forall x. ChainwebConfiguration -&gt; Rep ChainwebConfiguration x
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></span><span class="hs-special">)</span><span>
</span><span id="line-217"></span><span>
</span><span id="line-218"></span><span id="configThrottleRate"><span id="configPruneChainDatabase"><span id="configMempoolP2p"><span id="configIncludeOrigin"><span id="configBlockGasLimit"><span id="configTransactionIndex"><span id="configP2p"><span id="configReintroTxs"><span id="configHeaderStream"><span id="configCoordinator"><span id="configMiner"><span id="configChainwebVersion"><span id="configNodeId"><span class="hs-identifier">makeLenses</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">ChainwebConfiguration</span></span></span></span></span></span></span></span></span></span></span></span></span></span><span>
</span><span id="line-219"></span><span>
</span><span id="line-220"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681510913"><span class="annot"><a href="Chainweb.Version.html#HasChainwebVersion"><span class="hs-identifier hs-type">HasChainwebVersion</span></a></span><span> </span><span class="annot"><a href="Chainweb.Chainweb.html#ChainwebConfiguration"><span class="hs-identifier hs-type">ChainwebConfiguration</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-221"></span><span>    </span><span id="local-6989586621681510911"><span class="annot"><span class="annottext">_chainwebVersion :: ChainwebConfiguration -&gt; ChainwebVersion
</span><a href="Chainweb.Version.html#_chainwebVersion"><span class="hs-identifier hs-var hs-var hs-var hs-var">_chainwebVersion</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ChainwebConfiguration -&gt; ChainwebVersion
</span><a href="Chainweb.Chainweb.html#_configChainwebVersion"><span class="hs-identifier hs-var hs-var">_configChainwebVersion</span></a></span><span>
</span><span id="line-222"></span><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Chainweb.Version.html#_chainwebVersion"><span class="hs-pragma hs-type">_chainwebVersion</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-223"></span><span>
</span><span id="line-224"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681510907"><span class="annot"><a href="Chainweb.Graph.html#HasChainGraph"><span class="hs-identifier hs-type">HasChainGraph</span></a></span><span> </span><span class="annot"><a href="Chainweb.Chainweb.html#ChainwebConfiguration"><span class="hs-identifier hs-type">ChainwebConfiguration</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-225"></span><span>    </span><span id="local-6989586621681510905"><span class="annot"><span class="annottext">_chainGraph :: ChainwebConfiguration -&gt; ChainGraph
</span><a href="Chainweb.Graph.html#_chainGraph"><span class="hs-identifier hs-var hs-var hs-var hs-var">_chainGraph</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ChainwebVersion -&gt; ChainGraph
forall a. HasChainGraph a =&gt; a -&gt; ChainGraph
</span><a href="Chainweb.Graph.html#_chainGraph"><span class="hs-identifier hs-var">_chainGraph</span></a></span><span> </span><span class="annot"><span class="annottext">(ChainwebVersion -&gt; ChainGraph)
-&gt; (ChainwebConfiguration -&gt; ChainwebVersion)
-&gt; ChainwebConfiguration
-&gt; ChainGraph
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ChainwebConfiguration -&gt; ChainwebVersion
forall a. HasChainwebVersion a =&gt; a -&gt; ChainwebVersion
</span><a href="Chainweb.Version.html#_chainwebVersion"><span class="hs-identifier hs-var">_chainwebVersion</span></a></span><span>
</span><span id="line-226"></span><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Chainweb.Graph.html#_chainGraph"><span class="hs-pragma hs-type">_chainGraph</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-227"></span><span>
</span><span id="line-228"></span><span id="local-6989586621681510902"><span class="annot"><a href="Chainweb.Chainweb.html#validateChainwebConfiguration"><span class="hs-identifier hs-type">validateChainwebConfiguration</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ConfigValidation</span></span><span> </span><span class="annot"><a href="Chainweb.Chainweb.html#ChainwebConfiguration"><span class="hs-identifier hs-type">ChainwebConfiguration</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681510902"><span class="hs-identifier hs-type">l</span></a></span></span><span>
</span><span id="line-229"></span><span id="validateChainwebConfiguration"><span class="annot"><span class="annottext">validateChainwebConfiguration :: ChainwebConfiguration -&gt; m ()
</span><a href="Chainweb.Chainweb.html#validateChainwebConfiguration"><span class="hs-identifier hs-var hs-var">validateChainwebConfiguration</span></a></span></span><span> </span><span id="local-6989586621681510901"><span class="annot"><span class="annottext">c :: ChainwebConfiguration
</span><a href="#local-6989586621681510901"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-230"></span><span>    </span><span class="annot"><span class="annottext">ConfigValidation MinerConfig l -&gt; EnableConfig MinerConfig -&gt; m ()
forall a (l :: * -&gt; *).
ConfigValidation a l -&gt; ConfigValidation (EnableConfig a) l
</span><a href="Chainweb.Utils.html#validateEnableConfig"><span class="hs-identifier hs-var">validateEnableConfig</span></a></span><span> </span><span class="annot"><span class="annottext">ConfigValidation MinerConfig l
forall (l :: * -&gt; *). ConfigValidation MinerConfig l
</span><a href="Chainweb.Miner.Config.html#validateMinerConfig"><span class="hs-identifier hs-var">validateMinerConfig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ChainwebConfiguration -&gt; EnableConfig MinerConfig
</span><a href="Chainweb.Chainweb.html#_configMiner"><span class="hs-identifier hs-var hs-var">_configMiner</span></a></span><span> </span><span class="annot"><span class="annottext">ChainwebConfiguration
</span><a href="#local-6989586621681510901"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-231"></span><span>
</span><span id="line-232"></span><span class="annot"><a href="Chainweb.Chainweb.html#defaultChainwebConfiguration"><span class="hs-identifier hs-type">defaultChainwebConfiguration</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Chainweb.Version.html#ChainwebVersion"><span class="hs-identifier hs-type">ChainwebVersion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Chainweb.Chainweb.html#ChainwebConfiguration"><span class="hs-identifier hs-type">ChainwebConfiguration</span></a></span><span>
</span><span id="line-233"></span><span id="defaultChainwebConfiguration"><span class="annot"><span class="annottext">defaultChainwebConfiguration :: ChainwebVersion -&gt; ChainwebConfiguration
</span><a href="Chainweb.Chainweb.html#defaultChainwebConfiguration"><span class="hs-identifier hs-var hs-var">defaultChainwebConfiguration</span></a></span></span><span> </span><span id="local-6989586621681510898"><span class="annot"><span class="annottext">v :: ChainwebVersion
</span><a href="#local-6989586621681510898"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">$WChainwebConfiguration :: ChainwebVersion
-&gt; NodeId
-&gt; EnableConfig MinerConfig
-&gt; Bool
-&gt; Bool
-&gt; Bool
-&gt; P2pConfiguration
-&gt; EnableConfig TransactionIndexConfig
-&gt; Bool
-&gt; Natural
-&gt; EnableConfig MempoolP2pConfig
-&gt; Bool
-&gt; GasLimit
-&gt; ChainwebConfiguration
</span><a href="Chainweb.Chainweb.html#%24WChainwebConfiguration"><span class="hs-identifier hs-type hs-type">ChainwebConfiguration</span></a></span><span>
</span><span id="line-234"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">_configChainwebVersion :: ChainwebVersion
</span><a href="Chainweb.Chainweb.html#_configChainwebVersion"><span class="hs-identifier hs-var">_configChainwebVersion</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ChainwebVersion
</span><a href="#local-6989586621681510898"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-235"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_configNodeId :: NodeId
</span><a href="Chainweb.Chainweb.html#_configNodeId"><span class="hs-identifier hs-var">_configNodeId</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; NodeId
</span><a href="Chainweb.NodeId.html#NodeId"><span class="hs-identifier hs-var">NodeId</span></a></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="hs-comment">-- FIXME</span><span>
</span><span id="line-236"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_configMiner :: EnableConfig MinerConfig
</span><a href="Chainweb.Chainweb.html#_configMiner"><span class="hs-identifier hs-var">_configMiner</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; MinerConfig -&gt; EnableConfig MinerConfig
forall a. Bool -&gt; a -&gt; EnableConfig a
</span><a href="Chainweb.Utils.html#EnableConfig"><span class="hs-identifier hs-var">EnableConfig</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">MinerConfig
</span><a href="Chainweb.Miner.Config.html#defaultMinerConfig"><span class="hs-identifier hs-var">defaultMinerConfig</span></a></span><span>
</span><span id="line-237"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_configCoordinator :: Bool
</span><a href="Chainweb.Chainweb.html#_configCoordinator"><span class="hs-identifier hs-var">_configCoordinator</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-238"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_configHeaderStream :: Bool
</span><a href="Chainweb.Chainweb.html#_configHeaderStream"><span class="hs-identifier hs-var">_configHeaderStream</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-239"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_configReintroTxs :: Bool
</span><a href="Chainweb.Chainweb.html#_configReintroTxs"><span class="hs-identifier hs-var">_configReintroTxs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-240"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_configP2p :: P2pConfiguration
</span><a href="Chainweb.Chainweb.html#_configP2p"><span class="hs-identifier hs-var">_configP2p</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">P2pConfiguration
</span><a href="P2P.Node.Configuration.html#defaultP2pConfiguration"><span class="hs-identifier hs-var">defaultP2pConfiguration</span></a></span><span>
</span><span id="line-241"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_configTransactionIndex :: EnableConfig TransactionIndexConfig
</span><a href="Chainweb.Chainweb.html#_configTransactionIndex"><span class="hs-identifier hs-var">_configTransactionIndex</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TransactionIndexConfig -&gt; EnableConfig TransactionIndexConfig
forall a. a -&gt; EnableConfig a
</span><a href="Chainweb.Utils.html#defaultEnableConfig"><span class="hs-identifier hs-var">defaultEnableConfig</span></a></span><span> </span><span class="annot"><span class="annottext">TransactionIndexConfig
</span><a href="Chainweb.Chainweb.html#defaultTransactionIndexConfig"><span class="hs-identifier hs-var">defaultTransactionIndexConfig</span></a></span><span>
</span><span id="line-242"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_configIncludeOrigin :: Bool
</span><a href="Chainweb.Chainweb.html#_configIncludeOrigin"><span class="hs-identifier hs-var">_configIncludeOrigin</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-243"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_configThrottleRate :: Natural
</span><a href="Chainweb.Chainweb.html#_configThrottleRate"><span class="hs-identifier hs-var">_configThrottleRate</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-number">1000</span></span><span>
</span><span id="line-244"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_configMempoolP2p :: EnableConfig MempoolP2pConfig
</span><a href="Chainweb.Chainweb.html#_configMempoolP2p"><span class="hs-identifier hs-var">_configMempoolP2p</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MempoolP2pConfig -&gt; EnableConfig MempoolP2pConfig
forall a. a -&gt; EnableConfig a
</span><a href="Chainweb.Utils.html#defaultEnableConfig"><span class="hs-identifier hs-var">defaultEnableConfig</span></a></span><span> </span><span class="annot"><span class="annottext">MempoolP2pConfig
</span><a href="Chainweb.Mempool.P2pConfig.html#defaultMempoolP2pConfig"><span class="hs-identifier hs-var">defaultMempoolP2pConfig</span></a></span><span>
</span><span id="line-245"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_configPruneChainDatabase :: Bool
</span><a href="Chainweb.Chainweb.html#_configPruneChainDatabase"><span class="hs-identifier hs-var">_configPruneChainDatabase</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-246"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_configBlockGasLimit :: GasLimit
</span><a href="Chainweb.Chainweb.html#_configBlockGasLimit"><span class="hs-identifier hs-var">_configBlockGasLimit</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-number">100000</span></span><span>
</span><span id="line-247"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-248"></span><span>
</span><span id="line-249"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681510884"><span id="local-6989586621681510886"><span id="local-6989586621681510888"><span class="annot"><span class="hs-identifier hs-type">ToJSON</span></span><span> </span><span class="annot"><a href="Chainweb.Chainweb.html#ChainwebConfiguration"><span class="hs-identifier hs-type">ChainwebConfiguration</span></a></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-250"></span><span>    </span><span id="local-6989586621681510883"><span class="annot"><span class="annottext">toJSON :: ChainwebConfiguration -&gt; Value
</span><a href="#local-6989586621681510883"><span class="hs-identifier hs-var hs-var hs-var hs-var">toJSON</span></a></span></span><span> </span><span id="local-6989586621681510882"><span class="annot"><span class="annottext">o :: ChainwebConfiguration
</span><a href="#local-6989586621681510882"><span class="hs-identifier hs-var">o</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Pair] -&gt; Value
</span><span class="hs-identifier hs-var">object</span></span><span>
</span><span id="line-251"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;chainwebVersion&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; ChainwebVersion -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Text -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="annot"><span class="annottext">ChainwebConfiguration -&gt; ChainwebVersion
</span><a href="Chainweb.Chainweb.html#_configChainwebVersion"><span class="hs-identifier hs-var hs-var">_configChainwebVersion</span></a></span><span> </span><span class="annot"><span class="annottext">ChainwebConfiguration
</span><a href="#local-6989586621681510882"><span class="hs-identifier hs-var">o</span></a></span><span>
</span><span id="line-252"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;nodeId&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; NodeId -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Text -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="annot"><span class="annottext">ChainwebConfiguration -&gt; NodeId
</span><a href="Chainweb.Chainweb.html#_configNodeId"><span class="hs-identifier hs-var hs-var">_configNodeId</span></a></span><span> </span><span class="annot"><span class="annottext">ChainwebConfiguration
</span><a href="#local-6989586621681510882"><span class="hs-identifier hs-var">o</span></a></span><span>
</span><span id="line-253"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;miner&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; EnableConfig MinerConfig -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Text -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="annot"><span class="annottext">ChainwebConfiguration -&gt; EnableConfig MinerConfig
</span><a href="Chainweb.Chainweb.html#_configMiner"><span class="hs-identifier hs-var hs-var">_configMiner</span></a></span><span> </span><span class="annot"><span class="annottext">ChainwebConfiguration
</span><a href="#local-6989586621681510882"><span class="hs-identifier hs-var">o</span></a></span><span>
</span><span id="line-254"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;miningCoordination&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Bool -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Text -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="annot"><span class="annottext">ChainwebConfiguration -&gt; Bool
</span><a href="Chainweb.Chainweb.html#_configCoordinator"><span class="hs-identifier hs-var hs-var">_configCoordinator</span></a></span><span> </span><span class="annot"><span class="annottext">ChainwebConfiguration
</span><a href="#local-6989586621681510882"><span class="hs-identifier hs-var">o</span></a></span><span>
</span><span id="line-255"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;headerStream&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Bool -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Text -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="annot"><span class="annottext">ChainwebConfiguration -&gt; Bool
</span><a href="Chainweb.Chainweb.html#_configHeaderStream"><span class="hs-identifier hs-var hs-var">_configHeaderStream</span></a></span><span> </span><span class="annot"><span class="annottext">ChainwebConfiguration
</span><a href="#local-6989586621681510882"><span class="hs-identifier hs-var">o</span></a></span><span>
</span><span id="line-256"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;reintroTxs&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Bool -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Text -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="annot"><span class="annottext">ChainwebConfiguration -&gt; Bool
</span><a href="Chainweb.Chainweb.html#_configReintroTxs"><span class="hs-identifier hs-var hs-var">_configReintroTxs</span></a></span><span> </span><span class="annot"><span class="annottext">ChainwebConfiguration
</span><a href="#local-6989586621681510882"><span class="hs-identifier hs-var">o</span></a></span><span>
</span><span id="line-257"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;p2p&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; P2pConfiguration -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Text -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="annot"><span class="annottext">ChainwebConfiguration -&gt; P2pConfiguration
</span><a href="Chainweb.Chainweb.html#_configP2p"><span class="hs-identifier hs-var hs-var">_configP2p</span></a></span><span> </span><span class="annot"><span class="annottext">ChainwebConfiguration
</span><a href="#local-6989586621681510882"><span class="hs-identifier hs-var">o</span></a></span><span>
</span><span id="line-258"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;transactionIndex&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; EnableConfig TransactionIndexConfig -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Text -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="annot"><span class="annottext">ChainwebConfiguration -&gt; EnableConfig TransactionIndexConfig
</span><a href="Chainweb.Chainweb.html#_configTransactionIndex"><span class="hs-identifier hs-var hs-var">_configTransactionIndex</span></a></span><span> </span><span class="annot"><span class="annottext">ChainwebConfiguration
</span><a href="#local-6989586621681510882"><span class="hs-identifier hs-var">o</span></a></span><span>
</span><span id="line-259"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;includeOrigin&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Bool -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Text -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="annot"><span class="annottext">ChainwebConfiguration -&gt; Bool
</span><a href="Chainweb.Chainweb.html#_configIncludeOrigin"><span class="hs-identifier hs-var hs-var">_configIncludeOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">ChainwebConfiguration
</span><a href="#local-6989586621681510882"><span class="hs-identifier hs-var">o</span></a></span><span>
</span><span id="line-260"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;throttleRate&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Natural -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Text -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="annot"><span class="annottext">ChainwebConfiguration -&gt; Natural
</span><a href="Chainweb.Chainweb.html#_configThrottleRate"><span class="hs-identifier hs-var hs-var">_configThrottleRate</span></a></span><span> </span><span class="annot"><span class="annottext">ChainwebConfiguration
</span><a href="#local-6989586621681510882"><span class="hs-identifier hs-var">o</span></a></span><span>
</span><span id="line-261"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;mempoolP2p&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; EnableConfig MempoolP2pConfig -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Text -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="annot"><span class="annottext">ChainwebConfiguration -&gt; EnableConfig MempoolP2pConfig
</span><a href="Chainweb.Chainweb.html#_configMempoolP2p"><span class="hs-identifier hs-var hs-var">_configMempoolP2p</span></a></span><span> </span><span class="annot"><span class="annottext">ChainwebConfiguration
</span><a href="#local-6989586621681510882"><span class="hs-identifier hs-var">o</span></a></span><span>
</span><span id="line-262"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;pruneChainDatabase&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Bool -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Text -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="annot"><span class="annottext">ChainwebConfiguration -&gt; Bool
</span><a href="Chainweb.Chainweb.html#_configPruneChainDatabase"><span class="hs-identifier hs-var hs-var">_configPruneChainDatabase</span></a></span><span> </span><span class="annot"><span class="annottext">ChainwebConfiguration
</span><a href="#local-6989586621681510882"><span class="hs-identifier hs-var">o</span></a></span><span>
</span><span id="line-263"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;blockGasLimit&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; GasLimit -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Text -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="annot"><span class="annottext">ChainwebConfiguration -&gt; GasLimit
</span><a href="Chainweb.Chainweb.html#_configBlockGasLimit"><span class="hs-identifier hs-var hs-var">_configBlockGasLimit</span></a></span><span> </span><span class="annot"><span class="annottext">ChainwebConfiguration
</span><a href="#local-6989586621681510882"><span class="hs-identifier hs-var">o</span></a></span><span>
</span><span id="line-264"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-265"></span><span>
</span><span id="line-266"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681510878"><span class="annot"><span class="hs-identifier hs-type">FromJSON</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.Chainweb.html#ChainwebConfiguration"><span class="hs-identifier hs-type">ChainwebConfiguration</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Chainweb.Chainweb.html#ChainwebConfiguration"><span class="hs-identifier hs-type">ChainwebConfiguration</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-267"></span><span>    </span><span id="local-6989586621681510877"><span class="annot"><span class="annottext">parseJSON :: Value -&gt; Parser (ChainwebConfiguration -&gt; ChainwebConfiguration)
</span><a href="#local-6989586621681510877"><span class="hs-identifier hs-var hs-var hs-var hs-var">parseJSON</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
-&gt; (Object
    -&gt; Parser (ChainwebConfiguration -&gt; ChainwebConfiguration))
-&gt; Value
-&gt; Parser (ChainwebConfiguration -&gt; ChainwebConfiguration)
forall a. String -&gt; (Object -&gt; Parser a) -&gt; Value -&gt; Parser a
</span><span class="hs-identifier hs-var">withObject</span></span><span> </span><span class="annot"><span class="hs-string">&quot;ChainwebConfig&quot;</span></span><span> </span><span class="annot"><span class="annottext">((Object
  -&gt; Parser (ChainwebConfiguration -&gt; ChainwebConfiguration))
 -&gt; Value
 -&gt; Parser (ChainwebConfiguration -&gt; ChainwebConfiguration))
-&gt; (Object
    -&gt; Parser (ChainwebConfiguration -&gt; ChainwebConfiguration))
-&gt; Value
-&gt; Parser (ChainwebConfiguration -&gt; ChainwebConfiguration)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681510876"><span class="annot"><span class="annottext">o :: Object
</span><a href="#local-6989586621681510876"><span class="hs-identifier hs-var">o</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ChainwebConfiguration -&gt; ChainwebConfiguration
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-268"></span><span>        </span><span class="annot"><span class="annottext">(ChainwebConfiguration -&gt; ChainwebConfiguration)
-&gt; Parser (ChainwebConfiguration -&gt; ChainwebConfiguration)
-&gt; Parser (ChainwebConfiguration -&gt; ChainwebConfiguration)
forall (f :: * -&gt; *) b c a.
Functor f =&gt;
(b -&gt; c) -&gt; f (a -&gt; b) -&gt; f (a -&gt; c)
</span><span class="hs-operator hs-var">&lt;$&lt;</span></span><span> </span><span class="annot"><span class="annottext">Lens' ChainwebConfiguration ChainwebVersion
</span><a href="Chainweb.Chainweb.html#configChainwebVersion"><span class="hs-identifier hs-var">configChainwebVersion</span></a></span><span> </span><span class="annot"><span class="annottext">Lens' ChainwebConfiguration ChainwebVersion
-&gt; Text
-&gt; Object
-&gt; Parser (ChainwebConfiguration -&gt; ChainwebConfiguration)
forall b a.
FromJSON b =&gt;
Lens' a b -&gt; Text -&gt; Object -&gt; Parser (a -&gt; a)
</span><span class="hs-operator hs-var">..:</span></span><span> </span><span class="annot"><span class="hs-string">&quot;chainwebVersion&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Object -&gt; Parser (ChainwebConfiguration -&gt; ChainwebConfiguration))
-&gt; Object
-&gt; Parser (ChainwebConfiguration -&gt; ChainwebConfiguration)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621681510876"><span class="hs-identifier hs-var">o</span></a></span><span>
</span><span id="line-269"></span><span>        </span><span class="annot"><span class="annottext">Parser (ChainwebConfiguration -&gt; ChainwebConfiguration)
-&gt; Parser (ChainwebConfiguration -&gt; ChainwebConfiguration)
-&gt; Parser (ChainwebConfiguration -&gt; ChainwebConfiguration)
forall (f :: * -&gt; *) b c a.
Applicative f =&gt;
f (b -&gt; c) -&gt; f (a -&gt; b) -&gt; f (a -&gt; c)
</span><span class="hs-operator hs-var">&lt;*&lt;</span></span><span> </span><span class="annot"><span class="annottext">Lens' ChainwebConfiguration NodeId
</span><a href="Chainweb.Chainweb.html#configNodeId"><span class="hs-identifier hs-var">configNodeId</span></a></span><span> </span><span class="annot"><span class="annottext">Lens' ChainwebConfiguration NodeId
-&gt; Text
-&gt; Object
-&gt; Parser (ChainwebConfiguration -&gt; ChainwebConfiguration)
forall b a.
FromJSON b =&gt;
Lens' a b -&gt; Text -&gt; Object -&gt; Parser (a -&gt; a)
</span><span class="hs-operator hs-var">..:</span></span><span> </span><span class="annot"><span class="hs-string">&quot;nodeId&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Object -&gt; Parser (ChainwebConfiguration -&gt; ChainwebConfiguration))
-&gt; Object
-&gt; Parser (ChainwebConfiguration -&gt; ChainwebConfiguration)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621681510876"><span class="hs-identifier hs-var">o</span></a></span><span>
</span><span id="line-270"></span><span>        </span><span class="annot"><span class="annottext">Parser (ChainwebConfiguration -&gt; ChainwebConfiguration)
-&gt; Parser (ChainwebConfiguration -&gt; ChainwebConfiguration)
-&gt; Parser (ChainwebConfiguration -&gt; ChainwebConfiguration)
forall (f :: * -&gt; *) b c a.
Applicative f =&gt;
f (b -&gt; c) -&gt; f (a -&gt; b) -&gt; f (a -&gt; c)
</span><span class="hs-operator hs-var">&lt;*&lt;</span></span><span> </span><span class="annot"><span class="annottext">Lens' ChainwebConfiguration (EnableConfig MinerConfig)
</span><a href="Chainweb.Chainweb.html#configMiner"><span class="hs-identifier hs-var">configMiner</span></a></span><span> </span><span class="annot"><span class="annottext">Lens' ChainwebConfiguration (EnableConfig MinerConfig)
-&gt; Text
-&gt; Object
-&gt; Parser (ChainwebConfiguration -&gt; ChainwebConfiguration)
forall b a.
FromJSON (b -&gt; b) =&gt;
Lens' a b -&gt; Text -&gt; Object -&gt; Parser (a -&gt; a)
</span><span class="hs-operator hs-var">%.:</span></span><span> </span><span class="annot"><span class="hs-string">&quot;miner&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Object -&gt; Parser (ChainwebConfiguration -&gt; ChainwebConfiguration))
-&gt; Object
-&gt; Parser (ChainwebConfiguration -&gt; ChainwebConfiguration)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621681510876"><span class="hs-identifier hs-var">o</span></a></span><span>
</span><span id="line-271"></span><span>        </span><span class="annot"><span class="annottext">Parser (ChainwebConfiguration -&gt; ChainwebConfiguration)
-&gt; Parser (ChainwebConfiguration -&gt; ChainwebConfiguration)
-&gt; Parser (ChainwebConfiguration -&gt; ChainwebConfiguration)
forall (f :: * -&gt; *) b c a.
Applicative f =&gt;
f (b -&gt; c) -&gt; f (a -&gt; b) -&gt; f (a -&gt; c)
</span><span class="hs-operator hs-var">&lt;*&lt;</span></span><span> </span><span class="annot"><span class="annottext">Lens' ChainwebConfiguration Bool
</span><a href="Chainweb.Chainweb.html#configCoordinator"><span class="hs-identifier hs-var">configCoordinator</span></a></span><span> </span><span class="annot"><span class="annottext">Lens' ChainwebConfiguration Bool
-&gt; Text
-&gt; Object
-&gt; Parser (ChainwebConfiguration -&gt; ChainwebConfiguration)
forall b a.
FromJSON b =&gt;
Lens' a b -&gt; Text -&gt; Object -&gt; Parser (a -&gt; a)
</span><span class="hs-operator hs-var">..:</span></span><span> </span><span class="annot"><span class="hs-string">&quot;miningCoordination&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Object -&gt; Parser (ChainwebConfiguration -&gt; ChainwebConfiguration))
-&gt; Object
-&gt; Parser (ChainwebConfiguration -&gt; ChainwebConfiguration)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621681510876"><span class="hs-identifier hs-var">o</span></a></span><span>
</span><span id="line-272"></span><span>        </span><span class="annot"><span class="annottext">Parser (ChainwebConfiguration -&gt; ChainwebConfiguration)
-&gt; Parser (ChainwebConfiguration -&gt; ChainwebConfiguration)
-&gt; Parser (ChainwebConfiguration -&gt; ChainwebConfiguration)
forall (f :: * -&gt; *) b c a.
Applicative f =&gt;
f (b -&gt; c) -&gt; f (a -&gt; b) -&gt; f (a -&gt; c)
</span><span class="hs-operator hs-var">&lt;*&lt;</span></span><span> </span><span class="annot"><span class="annottext">Lens' ChainwebConfiguration Bool
</span><a href="Chainweb.Chainweb.html#configHeaderStream"><span class="hs-identifier hs-var">configHeaderStream</span></a></span><span> </span><span class="annot"><span class="annottext">Lens' ChainwebConfiguration Bool
-&gt; Text
-&gt; Object
-&gt; Parser (ChainwebConfiguration -&gt; ChainwebConfiguration)
forall b a.
FromJSON b =&gt;
Lens' a b -&gt; Text -&gt; Object -&gt; Parser (a -&gt; a)
</span><span class="hs-operator hs-var">..:</span></span><span> </span><span class="annot"><span class="hs-string">&quot;headerStream&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Object -&gt; Parser (ChainwebConfiguration -&gt; ChainwebConfiguration))
-&gt; Object
-&gt; Parser (ChainwebConfiguration -&gt; ChainwebConfiguration)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621681510876"><span class="hs-identifier hs-var">o</span></a></span><span>
</span><span id="line-273"></span><span>        </span><span class="annot"><span class="annottext">Parser (ChainwebConfiguration -&gt; ChainwebConfiguration)
-&gt; Parser (ChainwebConfiguration -&gt; ChainwebConfiguration)
-&gt; Parser (ChainwebConfiguration -&gt; ChainwebConfiguration)
forall (f :: * -&gt; *) b c a.
Applicative f =&gt;
f (b -&gt; c) -&gt; f (a -&gt; b) -&gt; f (a -&gt; c)
</span><span class="hs-operator hs-var">&lt;*&lt;</span></span><span> </span><span class="annot"><span class="annottext">Lens' ChainwebConfiguration Bool
</span><a href="Chainweb.Chainweb.html#configReintroTxs"><span class="hs-identifier hs-var">configReintroTxs</span></a></span><span> </span><span class="annot"><span class="annottext">Lens' ChainwebConfiguration Bool
-&gt; Text
-&gt; Object
-&gt; Parser (ChainwebConfiguration -&gt; ChainwebConfiguration)
forall b a.
FromJSON b =&gt;
Lens' a b -&gt; Text -&gt; Object -&gt; Parser (a -&gt; a)
</span><span class="hs-operator hs-var">..:</span></span><span> </span><span class="annot"><span class="hs-string">&quot;reintroTxs&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Object -&gt; Parser (ChainwebConfiguration -&gt; ChainwebConfiguration))
-&gt; Object
-&gt; Parser (ChainwebConfiguration -&gt; ChainwebConfiguration)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621681510876"><span class="hs-identifier hs-var">o</span></a></span><span>
</span><span id="line-274"></span><span>        </span><span class="annot"><span class="annottext">Parser (ChainwebConfiguration -&gt; ChainwebConfiguration)
-&gt; Parser (ChainwebConfiguration -&gt; ChainwebConfiguration)
-&gt; Parser (ChainwebConfiguration -&gt; ChainwebConfiguration)
forall (f :: * -&gt; *) b c a.
Applicative f =&gt;
f (b -&gt; c) -&gt; f (a -&gt; b) -&gt; f (a -&gt; c)
</span><span class="hs-operator hs-var">&lt;*&lt;</span></span><span> </span><span class="annot"><span class="annottext">Lens' ChainwebConfiguration P2pConfiguration
</span><a href="Chainweb.Chainweb.html#configP2p"><span class="hs-identifier hs-var">configP2p</span></a></span><span> </span><span class="annot"><span class="annottext">Lens' ChainwebConfiguration P2pConfiguration
-&gt; Text
-&gt; Object
-&gt; Parser (ChainwebConfiguration -&gt; ChainwebConfiguration)
forall b a.
FromJSON (b -&gt; b) =&gt;
Lens' a b -&gt; Text -&gt; Object -&gt; Parser (a -&gt; a)
</span><span class="hs-operator hs-var">%.:</span></span><span> </span><span class="annot"><span class="hs-string">&quot;p2p&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Object -&gt; Parser (ChainwebConfiguration -&gt; ChainwebConfiguration))
-&gt; Object
-&gt; Parser (ChainwebConfiguration -&gt; ChainwebConfiguration)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621681510876"><span class="hs-identifier hs-var">o</span></a></span><span>
</span><span id="line-275"></span><span>        </span><span class="annot"><span class="annottext">Parser (ChainwebConfiguration -&gt; ChainwebConfiguration)
-&gt; Parser (ChainwebConfiguration -&gt; ChainwebConfiguration)
-&gt; Parser (ChainwebConfiguration -&gt; ChainwebConfiguration)
forall (f :: * -&gt; *) b c a.
Applicative f =&gt;
f (b -&gt; c) -&gt; f (a -&gt; b) -&gt; f (a -&gt; c)
</span><span class="hs-operator hs-var">&lt;*&lt;</span></span><span> </span><span class="annot"><span class="annottext">Lens' ChainwebConfiguration (EnableConfig TransactionIndexConfig)
</span><a href="Chainweb.Chainweb.html#configTransactionIndex"><span class="hs-identifier hs-var">configTransactionIndex</span></a></span><span> </span><span class="annot"><span class="annottext">Lens' ChainwebConfiguration (EnableConfig TransactionIndexConfig)
-&gt; Text
-&gt; Object
-&gt; Parser (ChainwebConfiguration -&gt; ChainwebConfiguration)
forall b a.
FromJSON (b -&gt; b) =&gt;
Lens' a b -&gt; Text -&gt; Object -&gt; Parser (a -&gt; a)
</span><span class="hs-operator hs-var">%.:</span></span><span> </span><span class="annot"><span class="hs-string">&quot;transactionIndex&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Object -&gt; Parser (ChainwebConfiguration -&gt; ChainwebConfiguration))
-&gt; Object
-&gt; Parser (ChainwebConfiguration -&gt; ChainwebConfiguration)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621681510876"><span class="hs-identifier hs-var">o</span></a></span><span>
</span><span id="line-276"></span><span>        </span><span class="annot"><span class="annottext">Parser (ChainwebConfiguration -&gt; ChainwebConfiguration)
-&gt; Parser (ChainwebConfiguration -&gt; ChainwebConfiguration)
-&gt; Parser (ChainwebConfiguration -&gt; ChainwebConfiguration)
forall (f :: * -&gt; *) b c a.
Applicative f =&gt;
f (b -&gt; c) -&gt; f (a -&gt; b) -&gt; f (a -&gt; c)
</span><span class="hs-operator hs-var">&lt;*&lt;</span></span><span> </span><span class="annot"><span class="annottext">Lens' ChainwebConfiguration Bool
</span><a href="Chainweb.Chainweb.html#configIncludeOrigin"><span class="hs-identifier hs-var">configIncludeOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">Lens' ChainwebConfiguration Bool
-&gt; Text
-&gt; Object
-&gt; Parser (ChainwebConfiguration -&gt; ChainwebConfiguration)
forall b a.
FromJSON b =&gt;
Lens' a b -&gt; Text -&gt; Object -&gt; Parser (a -&gt; a)
</span><span class="hs-operator hs-var">..:</span></span><span> </span><span class="annot"><span class="hs-string">&quot;includeOrigin&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Object -&gt; Parser (ChainwebConfiguration -&gt; ChainwebConfiguration))
-&gt; Object
-&gt; Parser (ChainwebConfiguration -&gt; ChainwebConfiguration)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621681510876"><span class="hs-identifier hs-var">o</span></a></span><span>
</span><span id="line-277"></span><span>        </span><span class="annot"><span class="annottext">Parser (ChainwebConfiguration -&gt; ChainwebConfiguration)
-&gt; Parser (ChainwebConfiguration -&gt; ChainwebConfiguration)
-&gt; Parser (ChainwebConfiguration -&gt; ChainwebConfiguration)
forall (f :: * -&gt; *) b c a.
Applicative f =&gt;
f (b -&gt; c) -&gt; f (a -&gt; b) -&gt; f (a -&gt; c)
</span><span class="hs-operator hs-var">&lt;*&lt;</span></span><span> </span><span class="annot"><span class="annottext">Lens' ChainwebConfiguration Natural
</span><a href="Chainweb.Chainweb.html#configThrottleRate"><span class="hs-identifier hs-var">configThrottleRate</span></a></span><span> </span><span class="annot"><span class="annottext">Lens' ChainwebConfiguration Natural
-&gt; Text
-&gt; Object
-&gt; Parser (ChainwebConfiguration -&gt; ChainwebConfiguration)
forall b a.
FromJSON b =&gt;
Lens' a b -&gt; Text -&gt; Object -&gt; Parser (a -&gt; a)
</span><span class="hs-operator hs-var">..:</span></span><span> </span><span class="annot"><span class="hs-string">&quot;throttleRate&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Object -&gt; Parser (ChainwebConfiguration -&gt; ChainwebConfiguration))
-&gt; Object
-&gt; Parser (ChainwebConfiguration -&gt; ChainwebConfiguration)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621681510876"><span class="hs-identifier hs-var">o</span></a></span><span>
</span><span id="line-278"></span><span>        </span><span class="annot"><span class="annottext">Parser (ChainwebConfiguration -&gt; ChainwebConfiguration)
-&gt; Parser (ChainwebConfiguration -&gt; ChainwebConfiguration)
-&gt; Parser (ChainwebConfiguration -&gt; ChainwebConfiguration)
forall (f :: * -&gt; *) b c a.
Applicative f =&gt;
f (b -&gt; c) -&gt; f (a -&gt; b) -&gt; f (a -&gt; c)
</span><span class="hs-operator hs-var">&lt;*&lt;</span></span><span> </span><span class="annot"><span class="annottext">Lens' ChainwebConfiguration (EnableConfig MempoolP2pConfig)
</span><a href="Chainweb.Chainweb.html#configMempoolP2p"><span class="hs-identifier hs-var">configMempoolP2p</span></a></span><span> </span><span class="annot"><span class="annottext">Lens' ChainwebConfiguration (EnableConfig MempoolP2pConfig)
-&gt; Text
-&gt; Object
-&gt; Parser (ChainwebConfiguration -&gt; ChainwebConfiguration)
forall b a.
FromJSON (b -&gt; b) =&gt;
Lens' a b -&gt; Text -&gt; Object -&gt; Parser (a -&gt; a)
</span><span class="hs-operator hs-var">%.:</span></span><span> </span><span class="annot"><span class="hs-string">&quot;mempoolP2p&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Object -&gt; Parser (ChainwebConfiguration -&gt; ChainwebConfiguration))
-&gt; Object
-&gt; Parser (ChainwebConfiguration -&gt; ChainwebConfiguration)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621681510876"><span class="hs-identifier hs-var">o</span></a></span><span>
</span><span id="line-279"></span><span>        </span><span class="annot"><span class="annottext">Parser (ChainwebConfiguration -&gt; ChainwebConfiguration)
-&gt; Parser (ChainwebConfiguration -&gt; ChainwebConfiguration)
-&gt; Parser (ChainwebConfiguration -&gt; ChainwebConfiguration)
forall (f :: * -&gt; *) b c a.
Applicative f =&gt;
f (b -&gt; c) -&gt; f (a -&gt; b) -&gt; f (a -&gt; c)
</span><span class="hs-operator hs-var">&lt;*&lt;</span></span><span> </span><span class="annot"><span class="annottext">Lens' ChainwebConfiguration Bool
</span><a href="Chainweb.Chainweb.html#configPruneChainDatabase"><span class="hs-identifier hs-var">configPruneChainDatabase</span></a></span><span> </span><span class="annot"><span class="annottext">Lens' ChainwebConfiguration Bool
-&gt; Text
-&gt; Object
-&gt; Parser (ChainwebConfiguration -&gt; ChainwebConfiguration)
forall b a.
FromJSON b =&gt;
Lens' a b -&gt; Text -&gt; Object -&gt; Parser (a -&gt; a)
</span><span class="hs-operator hs-var">..:</span></span><span> </span><span class="annot"><span class="hs-string">&quot;pruneChainDatabase&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Object -&gt; Parser (ChainwebConfiguration -&gt; ChainwebConfiguration))
-&gt; Object
-&gt; Parser (ChainwebConfiguration -&gt; ChainwebConfiguration)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621681510876"><span class="hs-identifier hs-var">o</span></a></span><span>
</span><span id="line-280"></span><span>        </span><span class="annot"><span class="annottext">Parser (ChainwebConfiguration -&gt; ChainwebConfiguration)
-&gt; Parser (ChainwebConfiguration -&gt; ChainwebConfiguration)
-&gt; Parser (ChainwebConfiguration -&gt; ChainwebConfiguration)
forall (f :: * -&gt; *) b c a.
Applicative f =&gt;
f (b -&gt; c) -&gt; f (a -&gt; b) -&gt; f (a -&gt; c)
</span><span class="hs-operator hs-var">&lt;*&lt;</span></span><span> </span><span class="annot"><span class="annottext">Lens' ChainwebConfiguration GasLimit
</span><a href="Chainweb.Chainweb.html#configBlockGasLimit"><span class="hs-identifier hs-var">configBlockGasLimit</span></a></span><span> </span><span class="annot"><span class="annottext">Lens' ChainwebConfiguration GasLimit
-&gt; Text
-&gt; Object
-&gt; Parser (ChainwebConfiguration -&gt; ChainwebConfiguration)
forall b a.
FromJSON b =&gt;
Lens' a b -&gt; Text -&gt; Object -&gt; Parser (a -&gt; a)
</span><span class="hs-operator hs-var">..:</span></span><span> </span><span class="annot"><span class="hs-string">&quot;blockGasLimit&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Object -&gt; Parser (ChainwebConfiguration -&gt; ChainwebConfiguration))
-&gt; Object
-&gt; Parser (ChainwebConfiguration -&gt; ChainwebConfiguration)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621681510876"><span class="hs-identifier hs-var">o</span></a></span><span>
</span><span id="line-281"></span><span>
</span><span id="line-282"></span><span class="annot"><a href="Chainweb.Chainweb.html#pChainwebConfiguration"><span class="hs-identifier hs-type">pChainwebConfiguration</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MParser</span></span><span> </span><span class="annot"><a href="Chainweb.Chainweb.html#ChainwebConfiguration"><span class="hs-identifier hs-type">ChainwebConfiguration</span></a></span><span>
</span><span id="line-283"></span><span id="pChainwebConfiguration"><span class="annot"><span class="annottext">pChainwebConfiguration :: MParser ChainwebConfiguration
</span><a href="Chainweb.Chainweb.html#pChainwebConfiguration"><span class="hs-identifier hs-var hs-var">pChainwebConfiguration</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ChainwebConfiguration -&gt; ChainwebConfiguration
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-284"></span><span>    </span><span class="annot"><span class="annottext">(ChainwebConfiguration -&gt; ChainwebConfiguration)
-&gt; MParser ChainwebConfiguration -&gt; MParser ChainwebConfiguration
forall (f :: * -&gt; *) b c a.
Functor f =&gt;
(b -&gt; c) -&gt; f (a -&gt; b) -&gt; f (a -&gt; c)
</span><span class="hs-operator hs-var">&lt;$&lt;</span></span><span> </span><span class="annot"><span class="annottext">Lens' ChainwebConfiguration ChainwebVersion
</span><a href="Chainweb.Chainweb.html#configChainwebVersion"><span class="hs-identifier hs-var">configChainwebVersion</span></a></span><span> </span><span class="annot"><span class="annottext">Lens' ChainwebConfiguration ChainwebVersion
-&gt; Parser ChainwebVersion -&gt; MParser ChainwebConfiguration
forall (f :: * -&gt; *) a b.
(Alternative f, Applicative f) =&gt;
Lens' a b -&gt; f b -&gt; f (a -&gt; a)
</span><span class="hs-operator hs-var">.::</span></span><span> </span><span class="annot"><span class="annottext">Mod OptionFields ChainwebVersion -&gt; Parser ChainwebVersion
forall a. HasTextRepresentation a =&gt; Mod OptionFields a -&gt; Parser a
</span><a href="Chainweb.Utils.html#textOption"><span class="hs-identifier hs-var">textOption</span></a></span><span>
</span><span id="line-285"></span><span>        </span><span class="annot"><span class="annottext">(Mod OptionFields ChainwebVersion -&gt; Parser ChainwebVersion)
-&gt; Mod OptionFields ChainwebVersion -&gt; Parser ChainwebVersion
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Mod OptionFields ChainwebVersion
forall (f :: * -&gt; *) a. HasName f =&gt; String -&gt; Mod f a
</span><span class="hs-identifier hs-var">long</span></span><span> </span><span class="annot"><span class="hs-string">&quot;chainweb-version&quot;</span></span><span>
</span><span id="line-286"></span><span>        </span><span class="annot"><span class="annottext">Mod OptionFields ChainwebVersion
-&gt; Mod OptionFields ChainwebVersion
-&gt; Mod OptionFields ChainwebVersion
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Mod OptionFields ChainwebVersion
forall (f :: * -&gt; *) a. HasName f =&gt; Char -&gt; Mod f a
</span><span class="hs-identifier hs-var">short</span></span><span> </span><span class="annot"><span class="hs-char">'v'</span></span><span>
</span><span id="line-287"></span><span>        </span><span class="annot"><span class="annottext">Mod OptionFields ChainwebVersion
-&gt; Mod OptionFields ChainwebVersion
-&gt; Mod OptionFields ChainwebVersion
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Mod OptionFields ChainwebVersion
forall (f :: * -&gt; *) a. String -&gt; Mod f a
</span><span class="hs-identifier hs-var">help</span></span><span> </span><span class="annot"><span class="hs-string">&quot;the chainweb version that this node is using&quot;</span></span><span>
</span><span id="line-288"></span><span>    </span><span class="annot"><span class="annottext">MParser ChainwebConfiguration
-&gt; MParser ChainwebConfiguration -&gt; MParser ChainwebConfiguration
forall (f :: * -&gt; *) b c a.
Applicative f =&gt;
f (b -&gt; c) -&gt; f (a -&gt; b) -&gt; f (a -&gt; c)
</span><span class="hs-operator hs-var">&lt;*&lt;</span></span><span> </span><span class="annot"><span class="annottext">Lens' ChainwebConfiguration NodeId
</span><a href="Chainweb.Chainweb.html#configNodeId"><span class="hs-identifier hs-var">configNodeId</span></a></span><span> </span><span class="annot"><span class="annottext">Lens' ChainwebConfiguration NodeId
-&gt; Parser NodeId -&gt; MParser ChainwebConfiguration
forall (f :: * -&gt; *) a b.
(Alternative f, Applicative f) =&gt;
Lens' a b -&gt; f b -&gt; f (a -&gt; a)
</span><span class="hs-operator hs-var">.::</span></span><span> </span><span class="annot"><span class="annottext">Mod OptionFields NodeId -&gt; Parser NodeId
forall a. HasTextRepresentation a =&gt; Mod OptionFields a -&gt; Parser a
</span><a href="Chainweb.Utils.html#textOption"><span class="hs-identifier hs-var">textOption</span></a></span><span>
</span><span id="line-289"></span><span>        </span><span class="annot"><span class="annottext">(Mod OptionFields NodeId -&gt; Parser NodeId)
-&gt; Mod OptionFields NodeId -&gt; Parser NodeId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Mod OptionFields NodeId
forall (f :: * -&gt; *) a. HasName f =&gt; String -&gt; Mod f a
</span><span class="hs-identifier hs-var">long</span></span><span> </span><span class="annot"><span class="hs-string">&quot;node-id&quot;</span></span><span>
</span><span id="line-290"></span><span>        </span><span class="annot"><span class="annottext">Mod OptionFields NodeId
-&gt; Mod OptionFields NodeId -&gt; Mod OptionFields NodeId
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Mod OptionFields NodeId
forall (f :: * -&gt; *) a. HasName f =&gt; Char -&gt; Mod f a
</span><span class="hs-identifier hs-var">short</span></span><span> </span><span class="annot"><span class="hs-char">'i'</span></span><span>
</span><span id="line-291"></span><span>        </span><span class="annot"><span class="annottext">Mod OptionFields NodeId
-&gt; Mod OptionFields NodeId -&gt; Mod OptionFields NodeId
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Mod OptionFields NodeId
forall (f :: * -&gt; *) a. String -&gt; Mod f a
</span><span class="hs-identifier hs-var">help</span></span><span> </span><span class="annot"><span class="hs-string">&quot;unique id of the node that is used as miner id in new blocks&quot;</span></span><span>
</span><span id="line-292"></span><span>    </span><span class="annot"><span class="annottext">MParser ChainwebConfiguration
-&gt; MParser ChainwebConfiguration -&gt; MParser ChainwebConfiguration
forall (f :: * -&gt; *) b c a.
Applicative f =&gt;
f (b -&gt; c) -&gt; f (a -&gt; b) -&gt; f (a -&gt; c)
</span><span class="hs-operator hs-var">&lt;*&lt;</span></span><span> </span><span class="annot"><span class="annottext">Lens' ChainwebConfiguration (EnableConfig MinerConfig)
</span><a href="Chainweb.Chainweb.html#configMiner"><span class="hs-identifier hs-var">configMiner</span></a></span><span> </span><span class="annot"><span class="annottext">Lens' ChainwebConfiguration (EnableConfig MinerConfig)
-&gt; Parser (EnableConfig MinerConfig -&gt; EnableConfig MinerConfig)
-&gt; MParser ChainwebConfiguration
forall (f :: * -&gt; *) a b.
(Alternative f, Applicative f) =&gt;
Lens' a b -&gt; f (b -&gt; b) -&gt; f (a -&gt; a)
</span><span class="hs-operator hs-var">%::</span></span><span> </span><span class="annot"><span class="annottext">String
-&gt; MParser MinerConfig
-&gt; Parser (EnableConfig MinerConfig -&gt; EnableConfig MinerConfig)
forall a. String -&gt; MParser a -&gt; MParser (EnableConfig a)
</span><a href="Chainweb.Utils.html#pEnableConfig"><span class="hs-identifier hs-var">pEnableConfig</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;mining&quot;</span></span><span> </span><span class="annot"><span class="annottext">MParser MinerConfig
</span><a href="Chainweb.Miner.Config.html#pMinerConfig"><span class="hs-identifier hs-var">pMinerConfig</span></a></span><span>
</span><span id="line-293"></span><span>    </span><span class="annot"><span class="annottext">MParser ChainwebConfiguration
-&gt; MParser ChainwebConfiguration -&gt; MParser ChainwebConfiguration
forall (f :: * -&gt; *) b c a.
Applicative f =&gt;
f (b -&gt; c) -&gt; f (a -&gt; b) -&gt; f (a -&gt; c)
</span><span class="hs-operator hs-var">&lt;*&lt;</span></span><span> </span><span class="annot"><span class="annottext">Lens' ChainwebConfiguration Bool
</span><a href="Chainweb.Chainweb.html#configCoordinator"><span class="hs-identifier hs-var">configCoordinator</span></a></span><span> </span><span class="annot"><span class="annottext">Lens' ChainwebConfiguration Bool
-&gt; Parser Bool -&gt; MParser ChainwebConfiguration
forall (f :: * -&gt; *) a b.
(Alternative f, Applicative f) =&gt;
Lens' a b -&gt; f b -&gt; f (a -&gt; a)
</span><span class="hs-operator hs-var">.::</span></span><span> </span><span class="annot"><span class="annottext">Mod FlagFields Bool -&gt; Parser Bool
</span><span class="hs-identifier hs-var">boolOption_</span></span><span>
</span><span id="line-294"></span><span>        </span><span class="annot"><span class="annottext">(Mod FlagFields Bool -&gt; Parser Bool)
-&gt; Mod FlagFields Bool -&gt; Parser Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Mod FlagFields Bool
forall (f :: * -&gt; *) a. HasName f =&gt; String -&gt; Mod f a
</span><span class="hs-identifier hs-var">long</span></span><span> </span><span class="annot"><span class="hs-string">&quot;mining-coordination&quot;</span></span><span>
</span><span id="line-295"></span><span>        </span><span class="annot"><span class="annottext">Mod FlagFields Bool -&gt; Mod FlagFields Bool -&gt; Mod FlagFields Bool
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Mod FlagFields Bool
forall (f :: * -&gt; *) a. String -&gt; Mod f a
</span><span class="hs-identifier hs-var">help</span></span><span> </span><span class="annot"><span class="hs-string">&quot;whether to enable external requests for mining work&quot;</span></span><span>
</span><span id="line-296"></span><span>    </span><span class="annot"><span class="annottext">MParser ChainwebConfiguration
-&gt; MParser ChainwebConfiguration -&gt; MParser ChainwebConfiguration
forall (f :: * -&gt; *) b c a.
Applicative f =&gt;
f (b -&gt; c) -&gt; f (a -&gt; b) -&gt; f (a -&gt; c)
</span><span class="hs-operator hs-var">&lt;*&lt;</span></span><span> </span><span class="annot"><span class="annottext">Lens' ChainwebConfiguration Bool
</span><a href="Chainweb.Chainweb.html#configHeaderStream"><span class="hs-identifier hs-var">configHeaderStream</span></a></span><span> </span><span class="annot"><span class="annottext">Lens' ChainwebConfiguration Bool
-&gt; Parser Bool -&gt; MParser ChainwebConfiguration
forall (f :: * -&gt; *) a b.
(Alternative f, Applicative f) =&gt;
Lens' a b -&gt; f b -&gt; f (a -&gt; a)
</span><span class="hs-operator hs-var">.::</span></span><span> </span><span class="annot"><span class="annottext">Mod FlagFields Bool -&gt; Parser Bool
</span><span class="hs-identifier hs-var">boolOption_</span></span><span>
</span><span id="line-297"></span><span>        </span><span class="annot"><span class="annottext">(Mod FlagFields Bool -&gt; Parser Bool)
-&gt; Mod FlagFields Bool -&gt; Parser Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Mod FlagFields Bool
forall (f :: * -&gt; *) a. HasName f =&gt; String -&gt; Mod f a
</span><span class="hs-identifier hs-var">long</span></span><span> </span><span class="annot"><span class="hs-string">&quot;header-stream&quot;</span></span><span>
</span><span id="line-298"></span><span>        </span><span class="annot"><span class="annottext">Mod FlagFields Bool -&gt; Mod FlagFields Bool -&gt; Mod FlagFields Bool
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Mod FlagFields Bool
forall (f :: * -&gt; *) a. String -&gt; Mod f a
</span><span class="hs-identifier hs-var">help</span></span><span> </span><span class="annot"><span class="hs-string">&quot;whether to enable an endpoint for streaming block updates&quot;</span></span><span>
</span><span id="line-299"></span><span>    </span><span class="annot"><span class="annottext">MParser ChainwebConfiguration
-&gt; MParser ChainwebConfiguration -&gt; MParser ChainwebConfiguration
forall (f :: * -&gt; *) b c a.
Applicative f =&gt;
f (b -&gt; c) -&gt; f (a -&gt; b) -&gt; f (a -&gt; c)
</span><span class="hs-operator hs-var">&lt;*&lt;</span></span><span> </span><span class="annot"><span class="annottext">Lens' ChainwebConfiguration Bool
</span><a href="Chainweb.Chainweb.html#configReintroTxs"><span class="hs-identifier hs-var">configReintroTxs</span></a></span><span> </span><span class="annot"><span class="annottext">Lens' ChainwebConfiguration Bool
-&gt; Parser Bool -&gt; MParser ChainwebConfiguration
forall (f :: * -&gt; *) a b.
(Alternative f, Applicative f) =&gt;
Lens' a b -&gt; f b -&gt; f (a -&gt; a)
</span><span class="hs-operator hs-var">.::</span></span><span> </span><span class="annot"><span class="annottext">Mod FlagFields Bool -&gt; Parser Bool
</span><span class="hs-identifier hs-var">enableDisableFlag</span></span><span>
</span><span id="line-300"></span><span>        </span><span class="annot"><span class="annottext">(Mod FlagFields Bool -&gt; Parser Bool)
-&gt; Mod FlagFields Bool -&gt; Parser Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Mod FlagFields Bool
forall (f :: * -&gt; *) a. HasName f =&gt; String -&gt; Mod f a
</span><span class="hs-identifier hs-var">long</span></span><span> </span><span class="annot"><span class="hs-string">&quot;tx-reintro&quot;</span></span><span>
</span><span id="line-301"></span><span>        </span><span class="annot"><span class="annottext">Mod FlagFields Bool -&gt; Mod FlagFields Bool -&gt; Mod FlagFields Bool
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Mod FlagFields Bool
forall (f :: * -&gt; *) a. String -&gt; Mod f a
</span><span class="hs-identifier hs-var">help</span></span><span> </span><span class="annot"><span class="hs-string">&quot;whether to enable transaction reintroduction from losing forks&quot;</span></span><span>
</span><span id="line-302"></span><span>    </span><span class="annot"><span class="annottext">MParser ChainwebConfiguration
-&gt; MParser ChainwebConfiguration -&gt; MParser ChainwebConfiguration
forall (f :: * -&gt; *) b c a.
Applicative f =&gt;
f (b -&gt; c) -&gt; f (a -&gt; b) -&gt; f (a -&gt; c)
</span><span class="hs-operator hs-var">&lt;*&lt;</span></span><span> </span><span class="annot"><span class="annottext">Lens' ChainwebConfiguration P2pConfiguration
</span><a href="Chainweb.Chainweb.html#configP2p"><span class="hs-identifier hs-var">configP2p</span></a></span><span> </span><span class="annot"><span class="annottext">Lens' ChainwebConfiguration P2pConfiguration
-&gt; Parser (P2pConfiguration -&gt; P2pConfiguration)
-&gt; MParser ChainwebConfiguration
forall (f :: * -&gt; *) a b.
(Alternative f, Applicative f) =&gt;
Lens' a b -&gt; f (b -&gt; b) -&gt; f (a -&gt; a)
</span><span class="hs-operator hs-var">%::</span></span><span> </span><span class="annot"><span class="annottext">Maybe NetworkId -&gt; Parser (P2pConfiguration -&gt; P2pConfiguration)
</span><a href="P2P.Node.Configuration.html#pP2pConfiguration"><span class="hs-identifier hs-var">pP2pConfiguration</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe NetworkId
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-303"></span><span>    </span><span class="annot"><span class="annottext">MParser ChainwebConfiguration
-&gt; MParser ChainwebConfiguration -&gt; MParser ChainwebConfiguration
forall (f :: * -&gt; *) b c a.
Applicative f =&gt;
f (b -&gt; c) -&gt; f (a -&gt; b) -&gt; f (a -&gt; c)
</span><span class="hs-operator hs-var">&lt;*&lt;</span></span><span> </span><span class="annot"><span class="annottext">Lens' ChainwebConfiguration (EnableConfig TransactionIndexConfig)
</span><a href="Chainweb.Chainweb.html#configTransactionIndex"><span class="hs-identifier hs-var">configTransactionIndex</span></a></span><span> </span><span class="annot"><span class="annottext">Lens' ChainwebConfiguration (EnableConfig TransactionIndexConfig)
-&gt; Parser
     (EnableConfig TransactionIndexConfig
      -&gt; EnableConfig TransactionIndexConfig)
-&gt; MParser ChainwebConfiguration
forall (f :: * -&gt; *) a b.
(Alternative f, Applicative f) =&gt;
Lens' a b -&gt; f (b -&gt; b) -&gt; f (a -&gt; a)
</span><span class="hs-operator hs-var">%::</span></span><span>
</span><span id="line-304"></span><span>        </span><span class="annot"><span class="annottext">String
-&gt; MParser TransactionIndexConfig
-&gt; Parser
     (EnableConfig TransactionIndexConfig
      -&gt; EnableConfig TransactionIndexConfig)
forall a. String -&gt; MParser a -&gt; MParser (EnableConfig a)
</span><a href="Chainweb.Utils.html#pEnableConfig"><span class="hs-identifier hs-var">pEnableConfig</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;transaction-index&quot;</span></span><span> </span><span class="annot"><span class="annottext">MParser TransactionIndexConfig
</span><a href="Chainweb.Chainweb.html#pTransactionIndexConfig"><span class="hs-identifier hs-var">pTransactionIndexConfig</span></a></span><span>
</span><span id="line-305"></span><span>    </span><span class="annot"><span class="annottext">MParser ChainwebConfiguration
-&gt; MParser ChainwebConfiguration -&gt; MParser ChainwebConfiguration
forall (f :: * -&gt; *) b c a.
Applicative f =&gt;
f (b -&gt; c) -&gt; f (a -&gt; b) -&gt; f (a -&gt; c)
</span><span class="hs-operator hs-var">&lt;*&lt;</span></span><span> </span><span class="annot"><span class="annottext">Lens' ChainwebConfiguration Bool
</span><a href="Chainweb.Chainweb.html#configIncludeOrigin"><span class="hs-identifier hs-var">configIncludeOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">Lens' ChainwebConfiguration Bool
-&gt; Parser Bool -&gt; MParser ChainwebConfiguration
forall (f :: * -&gt; *) a b.
(Alternative f, Applicative f) =&gt;
Lens' a b -&gt; f b -&gt; f (a -&gt; a)
</span><span class="hs-operator hs-var">.::</span></span><span> </span><span class="annot"><span class="annottext">Mod FlagFields Bool -&gt; Parser Bool
</span><span class="hs-identifier hs-var">enableDisableFlag</span></span><span>
</span><span id="line-306"></span><span>        </span><span class="annot"><span class="annottext">(Mod FlagFields Bool -&gt; Parser Bool)
-&gt; Mod FlagFields Bool -&gt; Parser Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Mod FlagFields Bool
forall (f :: * -&gt; *) a. HasName f =&gt; String -&gt; Mod f a
</span><span class="hs-identifier hs-var">long</span></span><span> </span><span class="annot"><span class="hs-string">&quot;include-origin&quot;</span></span><span>
</span><span id="line-307"></span><span>        </span><span class="annot"><span class="annottext">Mod FlagFields Bool -&gt; Mod FlagFields Bool -&gt; Mod FlagFields Bool
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Mod FlagFields Bool
forall (f :: * -&gt; *) a. String -&gt; Mod f a
</span><span class="hs-identifier hs-var">help</span></span><span> </span><span class="annot"><span class="hs-string">&quot;whether to include the local peer as origin when publishing cut hashes&quot;</span></span><span>
</span><span id="line-308"></span><span>    </span><span class="annot"><span class="annottext">MParser ChainwebConfiguration
-&gt; MParser ChainwebConfiguration -&gt; MParser ChainwebConfiguration
forall (f :: * -&gt; *) b c a.
Applicative f =&gt;
f (b -&gt; c) -&gt; f (a -&gt; b) -&gt; f (a -&gt; c)
</span><span class="hs-operator hs-var">&lt;*&lt;</span></span><span> </span><span class="annot"><span class="annottext">Lens' ChainwebConfiguration Natural
</span><a href="Chainweb.Chainweb.html#configThrottleRate"><span class="hs-identifier hs-var">configThrottleRate</span></a></span><span> </span><span class="annot"><span class="annottext">Lens' ChainwebConfiguration Natural
-&gt; Parser Natural -&gt; MParser ChainwebConfiguration
forall (f :: * -&gt; *) a b.
(Alternative f, Applicative f) =&gt;
Lens' a b -&gt; f b -&gt; f (a -&gt; a)
</span><span class="hs-operator hs-var">.::</span></span><span> </span><span class="annot"><span class="annottext">ReadM Natural -&gt; Mod OptionFields Natural -&gt; Parser Natural
forall a. ReadM a -&gt; Mod OptionFields a -&gt; Parser a
</span><span class="hs-identifier hs-var">option</span></span><span> </span><span class="annot"><span class="annottext">ReadM Natural
forall a. Read a =&gt; ReadM a
</span><span class="hs-identifier hs-var">auto</span></span><span>
</span><span id="line-309"></span><span>        </span><span class="annot"><span class="annottext">(Mod OptionFields Natural -&gt; Parser Natural)
-&gt; Mod OptionFields Natural -&gt; Parser Natural
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Mod OptionFields Natural
forall (f :: * -&gt; *) a. HasName f =&gt; String -&gt; Mod f a
</span><span class="hs-identifier hs-var">long</span></span><span> </span><span class="annot"><span class="hs-string">&quot;throttle-rate&quot;</span></span><span>
</span><span id="line-310"></span><span>        </span><span class="annot"><span class="annottext">Mod OptionFields Natural
-&gt; Mod OptionFields Natural -&gt; Mod OptionFields Natural
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Mod OptionFields Natural
forall (f :: * -&gt; *) a. String -&gt; Mod f a
</span><span class="hs-identifier hs-var">help</span></span><span> </span><span class="annot"><span class="hs-string">&quot;how many requests per second are accepted from another node before it is being throttled&quot;</span></span><span>
</span><span id="line-311"></span><span>    </span><span class="annot"><span class="annottext">MParser ChainwebConfiguration
-&gt; MParser ChainwebConfiguration -&gt; MParser ChainwebConfiguration
forall (f :: * -&gt; *) b c a.
Applicative f =&gt;
f (b -&gt; c) -&gt; f (a -&gt; b) -&gt; f (a -&gt; c)
</span><span class="hs-operator hs-var">&lt;*&lt;</span></span><span> </span><span class="annot"><span class="annottext">Lens' ChainwebConfiguration (EnableConfig MempoolP2pConfig)
</span><a href="Chainweb.Chainweb.html#configMempoolP2p"><span class="hs-identifier hs-var">configMempoolP2p</span></a></span><span> </span><span class="annot"><span class="annottext">Lens' ChainwebConfiguration (EnableConfig MempoolP2pConfig)
-&gt; Parser
     (EnableConfig MempoolP2pConfig -&gt; EnableConfig MempoolP2pConfig)
-&gt; MParser ChainwebConfiguration
forall (f :: * -&gt; *) a b.
(Alternative f, Applicative f) =&gt;
Lens' a b -&gt; f (b -&gt; b) -&gt; f (a -&gt; a)
</span><span class="hs-operator hs-var">%::</span></span><span>
</span><span id="line-312"></span><span>        </span><span class="annot"><span class="annottext">String
-&gt; MParser MempoolP2pConfig
-&gt; Parser
     (EnableConfig MempoolP2pConfig -&gt; EnableConfig MempoolP2pConfig)
forall a. String -&gt; MParser a -&gt; MParser (EnableConfig a)
</span><a href="Chainweb.Utils.html#pEnableConfig"><span class="hs-identifier hs-var">pEnableConfig</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;mempool-p2p&quot;</span></span><span> </span><span class="annot"><span class="annottext">MParser MempoolP2pConfig
</span><a href="Chainweb.Mempool.P2pConfig.html#pMempoolP2pConfig"><span class="hs-identifier hs-var">pMempoolP2pConfig</span></a></span><span>
</span><span id="line-313"></span><span>    </span><span class="annot"><span class="annottext">MParser ChainwebConfiguration
-&gt; MParser ChainwebConfiguration -&gt; MParser ChainwebConfiguration
forall (f :: * -&gt; *) b c a.
Applicative f =&gt;
f (b -&gt; c) -&gt; f (a -&gt; b) -&gt; f (a -&gt; c)
</span><span class="hs-operator hs-var">&lt;*&lt;</span></span><span> </span><span class="annot"><span class="annottext">Lens' ChainwebConfiguration Bool
</span><a href="Chainweb.Chainweb.html#configPruneChainDatabase"><span class="hs-identifier hs-var">configPruneChainDatabase</span></a></span><span> </span><span class="annot"><span class="annottext">Lens' ChainwebConfiguration Bool
-&gt; Parser Bool -&gt; MParser ChainwebConfiguration
forall (f :: * -&gt; *) a b.
(Alternative f, Applicative f) =&gt;
Lens' a b -&gt; f b -&gt; f (a -&gt; a)
</span><span class="hs-operator hs-var">.::</span></span><span> </span><span class="annot"><span class="annottext">Mod FlagFields Bool -&gt; Parser Bool
</span><span class="hs-identifier hs-var">enableDisableFlag</span></span><span>
</span><span id="line-314"></span><span>        </span><span class="annot"><span class="annottext">(Mod FlagFields Bool -&gt; Parser Bool)
-&gt; Mod FlagFields Bool -&gt; Parser Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Mod FlagFields Bool
forall (f :: * -&gt; *) a. HasName f =&gt; String -&gt; Mod f a
</span><span class="hs-identifier hs-var">long</span></span><span> </span><span class="annot"><span class="hs-string">&quot;prune-chain-database&quot;</span></span><span>
</span><span id="line-315"></span><span>        </span><span class="annot"><span class="annottext">Mod FlagFields Bool -&gt; Mod FlagFields Bool -&gt; Mod FlagFields Bool
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Mod FlagFields Bool
forall (f :: * -&gt; *) a. String -&gt; Mod f a
</span><span class="hs-identifier hs-var">help</span></span><span> </span><span class="annot"><span class="hs-string">&quot;prune the chain database for all chains on startup&quot;</span></span><span>
</span><span id="line-316"></span><span>    </span><span class="annot"><span class="annottext">MParser ChainwebConfiguration
-&gt; MParser ChainwebConfiguration -&gt; MParser ChainwebConfiguration
forall (f :: * -&gt; *) b c a.
Applicative f =&gt;
f (b -&gt; c) -&gt; f (a -&gt; b) -&gt; f (a -&gt; c)
</span><span class="hs-operator hs-var">&lt;*&lt;</span></span><span> </span><span class="annot"><span class="annottext">Lens' ChainwebConfiguration GasLimit
</span><a href="Chainweb.Chainweb.html#configBlockGasLimit"><span class="hs-identifier hs-var">configBlockGasLimit</span></a></span><span> </span><span class="annot"><span class="annottext">Lens' ChainwebConfiguration GasLimit
-&gt; Parser GasLimit -&gt; MParser ChainwebConfiguration
forall (f :: * -&gt; *) a b.
(Alternative f, Applicative f) =&gt;
Lens' a b -&gt; f b -&gt; f (a -&gt; a)
</span><span class="hs-operator hs-var">.::</span></span><span> </span><span class="annot"><span class="annottext">Mod OptionFields GasLimit -&gt; Parser GasLimit
forall a. FromJSON a =&gt; Mod OptionFields a -&gt; Parser a
</span><a href="Chainweb.Utils.html#jsonOption"><span class="hs-identifier hs-var">jsonOption</span></a></span><span>
</span><span id="line-317"></span><span>        </span><span class="annot"><span class="annottext">(Mod OptionFields GasLimit -&gt; Parser GasLimit)
-&gt; Mod OptionFields GasLimit -&gt; Parser GasLimit
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Mod OptionFields GasLimit
forall (f :: * -&gt; *) a. HasName f =&gt; String -&gt; Mod f a
</span><span class="hs-identifier hs-var">long</span></span><span> </span><span class="annot"><span class="hs-string">&quot;block-gas-limit&quot;</span></span><span>
</span><span id="line-318"></span><span>        </span><span class="annot"><span class="annottext">Mod OptionFields GasLimit
-&gt; Mod OptionFields GasLimit -&gt; Mod OptionFields GasLimit
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Mod OptionFields GasLimit
forall (f :: * -&gt; *) a. String -&gt; Mod f a
</span><span class="hs-identifier hs-var">help</span></span><span> </span><span class="annot"><span class="hs-string">&quot;the sum of all transaction gas fees in a block must not exceed this number&quot;</span></span><span>
</span><span id="line-319"></span><span>
</span><span id="line-320"></span><span class="hs-comment">-- -------------------------------------------------------------------------- --</span><span>
</span><span id="line-321"></span><span class="hs-comment">-- Chainweb Resources</span><span>
</span><span id="line-322"></span><span>
</span><span id="line-323"></span><span class="hs-keyword">data</span><span> </span><span id="Chainweb"><span class="annot"><a href="Chainweb.Chainweb.html#Chainweb"><span class="hs-identifier hs-var">Chainweb</span></a></span></span><span> </span><span id="local-6989586621681511303"><span class="annot"><a href="#local-6989586621681511303"><span class="hs-identifier hs-type">logger</span></a></span></span><span> </span><span id="local-6989586621681511302"><span class="annot"><a href="#local-6989586621681511302"><span class="hs-identifier hs-type">cas</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Chainweb"><span class="annot"><a href="Chainweb.Chainweb.html#Chainweb"><span class="hs-identifier hs-var">Chainweb</span></a></span></span><span>
</span><span id="line-324"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="_chainwebHostAddress"><span class="annot"><span class="annottext">Chainweb logger cas -&gt; HostAddress
</span><a href="Chainweb.Chainweb.html#_chainwebHostAddress"><span class="hs-identifier hs-var hs-var">_chainwebHostAddress</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Chainweb.HostAddress.html#HostAddress"><span class="hs-identifier hs-type">HostAddress</span></a></span><span>
</span><span id="line-325"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="_chainwebChains"><span class="annot"><span class="annottext">Chainweb logger cas -&gt; HashMap ChainId (ChainResources logger)
</span><a href="Chainweb.Chainweb.html#_chainwebChains"><span class="hs-identifier hs-var hs-var">_chainwebChains</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HM.HashMap</span></span><span> </span><span class="annot"><a href="Chainweb.ChainId.html#ChainId"><span class="hs-identifier hs-type">ChainId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.Chainweb.ChainResources.html#ChainResources"><span class="hs-identifier hs-type">ChainResources</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681511303"><span class="hs-identifier hs-type">logger</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-326"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="_chainwebCutResources"><span class="annot"><span class="annottext">Chainweb logger cas -&gt; CutResources logger cas
</span><a href="Chainweb.Chainweb.html#_chainwebCutResources"><span class="hs-identifier hs-var hs-var">_chainwebCutResources</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.Chainweb.CutResources.html#CutResources"><span class="hs-identifier hs-type">CutResources</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681511303"><span class="hs-identifier hs-type">logger</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681511302"><span class="hs-identifier hs-type">cas</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-327"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="_chainwebMiner"><span class="annot"><span class="annottext">Chainweb logger cas -&gt; Maybe (MinerResources logger cas)
</span><a href="Chainweb.Chainweb.html#_chainwebMiner"><span class="hs-identifier hs-var hs-var">_chainwebMiner</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.Chainweb.MinerResources.html#MinerResources"><span class="hs-identifier hs-type">MinerResources</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681511303"><span class="hs-identifier hs-type">logger</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681511302"><span class="hs-identifier hs-type">cas</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-328"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="_chainwebCoordinator"><span class="annot"><span class="annottext">Chainweb logger cas -&gt; Maybe (MiningCoordination logger cas)
</span><a href="Chainweb.Chainweb.html#_chainwebCoordinator"><span class="hs-identifier hs-var hs-var">_chainwebCoordinator</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.Chainweb.MinerResources.html#MiningCoordination"><span class="hs-identifier hs-type">MiningCoordination</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681511303"><span class="hs-identifier hs-type">logger</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681511302"><span class="hs-identifier hs-type">cas</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-329"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="_chainwebHeaderStream"><span class="annot"><span class="annottext">Chainweb logger cas -&gt; HeaderStream
</span><a href="Chainweb.Chainweb.html#_chainwebHeaderStream"><span class="hs-identifier hs-var hs-var">_chainwebHeaderStream</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Chainweb.BlockHeaderDB.RestAPI.html#HeaderStream"><span class="hs-identifier hs-type">HeaderStream</span></a></span><span>
</span><span id="line-330"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="_chainwebLogger"><span class="annot"><span class="annottext">Chainweb logger cas -&gt; logger
</span><a href="Chainweb.Chainweb.html#_chainwebLogger"><span class="hs-identifier hs-var hs-var">_chainwebLogger</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="#local-6989586621681511303"><span class="hs-identifier hs-type">logger</span></a></span><span>
</span><span id="line-331"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="_chainwebPeer"><span class="annot"><span class="annottext">Chainweb logger cas -&gt; PeerResources logger
</span><a href="Chainweb.Chainweb.html#_chainwebPeer"><span class="hs-identifier hs-var hs-var">_chainwebPeer</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.Chainweb.PeerResources.html#PeerResources"><span class="hs-identifier hs-type">PeerResources</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681511303"><span class="hs-identifier hs-type">logger</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-332"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="_chainwebPayloadDb"><span class="annot"><span class="annottext">Chainweb logger cas -&gt; PayloadDb cas
</span><a href="Chainweb.Chainweb.html#_chainwebPayloadDb"><span class="hs-identifier hs-var hs-var">_chainwebPayloadDb</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.Payload.PayloadStore.Types.html#PayloadDb"><span class="hs-identifier hs-type">PayloadDb</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681511302"><span class="hs-identifier hs-type">cas</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-333"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="_chainwebManager"><span class="annot"><span class="annottext">Chainweb logger cas -&gt; Manager
</span><a href="Chainweb.Chainweb.html#_chainwebManager"><span class="hs-identifier hs-var hs-var">_chainwebManager</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">HTTP.Manager</span></span><span>
</span><span id="line-334"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="_chainwebPactData"><span class="annot"><span class="annottext">Chainweb logger cas -&gt; [(ChainId, PactServerData logger cas)]
</span><a href="Chainweb.Chainweb.html#_chainwebPactData"><span class="hs-identifier hs-var hs-var">_chainwebPactData</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.ChainId.html#ChainId"><span class="hs-identifier hs-type">ChainId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.Pact.RestAPI.Server.html#PactServerData"><span class="hs-identifier hs-type">PactServerData</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681511303"><span class="hs-identifier hs-type">logger</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681511302"><span class="hs-identifier hs-type">cas</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-335"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="_chainwebThrottler"><span class="annot"><span class="annottext">Chainweb logger cas -&gt; Throttle Address
</span><a href="Chainweb.Chainweb.html#_chainwebThrottler"><span class="hs-identifier hs-var hs-var">_chainwebThrottler</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Throttle</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Address</span></span><span class="hs-special">)</span><span>
</span><span id="line-336"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="_chainwebConfig"><span class="annot"><span class="annottext">Chainweb logger cas -&gt; ChainwebConfiguration
</span><a href="Chainweb.Chainweb.html#_chainwebConfig"><span class="hs-identifier hs-var hs-var">_chainwebConfig</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Chainweb.Chainweb.html#ChainwebConfiguration"><span class="hs-identifier hs-type">ChainwebConfiguration</span></a></span><span>
</span><span id="line-337"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-338"></span><span>
</span><span id="line-339"></span><span id="chainwebManager"><span id="chainwebConfig"><span id="chainwebThrottler"><span id="chainwebPactData"><span id="chainwebPayloadDb"><span id="chainwebPeer"><span id="chainwebLogger"><span id="chainwebHeaderStream"><span id="chainwebCoordinator"><span id="chainwebMiner"><span id="chainwebHostAddress"><span id="chainwebCutResources"><span id="chainwebChains"><span id="local-6989586621681511302"><span id="local-6989586621681511303"><span class="hs-identifier">makeLenses</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">Chainweb</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span>
</span><span id="line-340"></span><span>
</span><span id="line-341"></span><span id="local-6989586621681510839"><span id="local-6989586621681510840"><span class="annot"><a href="Chainweb.Chainweb.html#chainwebSocket"><span class="hs-identifier hs-type">chainwebSocket</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Getter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.Chainweb.html#Chainweb"><span class="hs-identifier hs-type">Chainweb</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681510840"><span class="hs-identifier hs-type">logger</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681510839"><span class="hs-identifier hs-type">cas</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Socket</span></span></span></span><span>
</span><span id="line-342"></span><span id="chainwebSocket"><span class="annot"><span class="annottext">chainwebSocket :: (Socket -&gt; f Socket)
-&gt; Chainweb logger cas -&gt; f (Chainweb logger cas)
</span><a href="Chainweb.Chainweb.html#chainwebSocket"><span class="hs-identifier hs-var hs-var">chainwebSocket</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(PeerResources logger -&gt; f (PeerResources logger))
-&gt; Chainweb logger cas -&gt; f (Chainweb logger cas)
forall logger (cas :: * -&gt; *).
Lens' (Chainweb logger cas) (PeerResources logger)
</span><a href="Chainweb.Chainweb.html#chainwebPeer"><span class="hs-identifier hs-var">chainwebPeer</span></a></span><span> </span><span class="annot"><span class="annottext">((PeerResources logger -&gt; f (PeerResources logger))
 -&gt; Chainweb logger cas -&gt; f (Chainweb logger cas))
-&gt; ((Socket -&gt; f Socket)
    -&gt; PeerResources logger -&gt; f (PeerResources logger))
-&gt; (Socket -&gt; f Socket)
-&gt; Chainweb logger cas
-&gt; f (Chainweb logger cas)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Socket -&gt; f Socket)
-&gt; PeerResources logger -&gt; f (PeerResources logger)
forall logger. Lens' (PeerResources logger) Socket
</span><a href="Chainweb.Chainweb.PeerResources.html#peerResSocket"><span class="hs-identifier hs-var">peerResSocket</span></a></span><span>
</span><span id="line-343"></span><span>
</span><span id="line-344"></span><span id="local-6989586621681510836"><span id="local-6989586621681510837"><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681510833"><span class="annot"><a href="Chainweb.Version.html#HasChainwebVersion"><span class="hs-identifier hs-type">HasChainwebVersion</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.Chainweb.html#Chainweb"><span class="hs-identifier hs-type">Chainweb</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681510837"><span class="hs-identifier hs-type">logger</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681510836"><span class="hs-identifier hs-type">cas</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-345"></span><span>    </span><span id="local-6989586621681510832"><span class="annot"><span class="annottext">_chainwebVersion :: Chainweb logger cas -&gt; ChainwebVersion
</span><a href="#local-6989586621681510832"><span class="hs-identifier hs-var hs-var hs-var hs-var">_chainwebVersion</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CutResources logger cas -&gt; ChainwebVersion
forall a. HasChainwebVersion a =&gt; a -&gt; ChainwebVersion
</span><a href="Chainweb.Version.html#_chainwebVersion"><span class="hs-identifier hs-var">_chainwebVersion</span></a></span><span> </span><span class="annot"><span class="annottext">(CutResources logger cas -&gt; ChainwebVersion)
-&gt; (Chainweb logger cas -&gt; CutResources logger cas)
-&gt; Chainweb logger cas
-&gt; ChainwebVersion
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Chainweb logger cas -&gt; CutResources logger cas
forall logger (cas :: * -&gt; *).
Chainweb logger cas -&gt; CutResources logger cas
</span><a href="Chainweb.Chainweb.html#_chainwebCutResources"><span class="hs-identifier hs-var hs-var">_chainwebCutResources</span></a></span><span>
</span><span id="line-346"></span><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Chainweb.Version.html#_chainwebVersion"><span class="hs-pragma hs-type">_chainwebVersion</span></a></span><span> </span><span class="hs-pragma">#-}</span></span></span><span>
</span><span id="line-347"></span><span>
</span><span id="line-348"></span><span id="local-6989586621681510830"><span id="local-6989586621681510831"><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681510827"><span class="annot"><a href="Chainweb.Graph.html#HasChainGraph"><span class="hs-identifier hs-type">HasChainGraph</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.Chainweb.html#Chainweb"><span class="hs-identifier hs-type">Chainweb</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681510831"><span class="hs-identifier hs-type">logger</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681510830"><span class="hs-identifier hs-type">cas</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-349"></span><span>    </span><span id="local-6989586621681510826"><span class="annot"><span class="annottext">_chainGraph :: Chainweb logger cas -&gt; ChainGraph
</span><a href="#local-6989586621681510826"><span class="hs-identifier hs-var hs-var hs-var hs-var">_chainGraph</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ChainwebVersion -&gt; ChainGraph
forall a. HasChainGraph a =&gt; a -&gt; ChainGraph
</span><a href="Chainweb.Graph.html#_chainGraph"><span class="hs-identifier hs-var">_chainGraph</span></a></span><span> </span><span class="annot"><span class="annottext">(ChainwebVersion -&gt; ChainGraph)
-&gt; (Chainweb logger cas -&gt; ChainwebVersion)
-&gt; Chainweb logger cas
-&gt; ChainGraph
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Chainweb logger cas -&gt; ChainwebVersion
forall a. HasChainwebVersion a =&gt; a -&gt; ChainwebVersion
</span><a href="Chainweb.Version.html#_chainwebVersion"><span class="hs-identifier hs-var">_chainwebVersion</span></a></span><span>
</span><span id="line-350"></span><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Chainweb.Graph.html#_chainGraph"><span class="hs-pragma hs-type">_chainGraph</span></a></span><span> </span><span class="hs-pragma">#-}</span></span></span><span>
</span><span id="line-351"></span><span>
</span><span id="line-352"></span><span class="hs-comment">-- Intializes all local chainweb components but doesn't start any networking.</span><span>
</span><span id="line-353"></span><span class="hs-comment">--</span><span>
</span><span id="line-354"></span><span id="local-6989586621681510824"><span id="local-6989586621681510825"><span class="annot"><a href="Chainweb.Chainweb.html#withChainweb"><span class="hs-identifier hs-type">withChainweb</span></a></span><span>
</span><span id="line-355"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Chainweb.Logger.html#Logger"><span class="hs-identifier hs-type">Logger</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681510825"><span class="hs-identifier hs-type">logger</span></a></span><span>
</span><span id="line-356"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Chainweb.Chainweb.html#ChainwebConfiguration"><span class="hs-identifier hs-type">ChainwebConfiguration</span></a></span><span>
</span><span id="line-357"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681510825"><span class="hs-identifier hs-type">logger</span></a></span><span>
</span><span id="line-358"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">RocksDb</span></span><span>
</span><span id="line-359"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span>
</span><span id="line-360"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-361"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.Chainweb.html#Chainweb"><span class="hs-identifier hs-type">Chainweb</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681510825"><span class="hs-identifier hs-type">logger</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">RocksDbCas</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621681510824"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-362"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621681510824"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-363"></span><span id="withChainweb"><span class="annot"><span class="annottext">withChainweb :: ChainwebConfiguration
-&gt; logger
-&gt; RocksDb
-&gt; Maybe String
-&gt; Bool
-&gt; (Chainweb logger RocksDbCas -&gt; IO a)
-&gt; IO a
</span><a href="Chainweb.Chainweb.html#withChainweb"><span class="hs-identifier hs-var hs-var">withChainweb</span></a></span></span><span> </span><span id="local-6989586621681510822"><span class="annot"><span class="annottext">c :: ChainwebConfiguration
</span><a href="#local-6989586621681510822"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621681510821"><span class="annot"><span class="annottext">logger :: logger
</span><a href="#local-6989586621681510821"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621681510820"><span class="annot"><span class="annottext">rocksDb :: RocksDb
</span><a href="#local-6989586621681510820"><span class="hs-identifier hs-var">rocksDb</span></a></span></span><span> </span><span id="local-6989586621681510819"><span class="annot"><span class="annottext">dbDir :: Maybe String
</span><a href="#local-6989586621681510819"><span class="hs-identifier hs-var">dbDir</span></a></span></span><span> </span><span id="local-6989586621681510818"><span class="annot"><span class="annottext">resetDb :: Bool
</span><a href="#local-6989586621681510818"><span class="hs-identifier hs-var">resetDb</span></a></span></span><span> </span><span id="local-6989586621681510817"><span class="annot"><span class="annottext">inner :: Chainweb logger RocksDbCas -&gt; IO a
</span><a href="#local-6989586621681510817"><span class="hs-identifier hs-var">inner</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-364"></span><span>    </span><span class="annot"><span class="annottext">ChainwebVersion
-&gt; P2pConfiguration
-&gt; logger
-&gt; (logger -&gt; PeerResources logger -&gt; IO a)
-&gt; IO a
forall logger a.
Logger logger =&gt;
ChainwebVersion
-&gt; P2pConfiguration
-&gt; logger
-&gt; (logger -&gt; PeerResources logger -&gt; IO a)
-&gt; IO a
</span><a href="Chainweb.Chainweb.PeerResources.html#withPeerResources"><span class="hs-identifier hs-var">withPeerResources</span></a></span><span> </span><span class="annot"><span class="annottext">ChainwebVersion
</span><a href="#local-6989586621681510815"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Getting P2pConfiguration ChainwebConfiguration P2pConfiguration
-&gt; ChainwebConfiguration -&gt; P2pConfiguration
forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">view</span></span><span> </span><span class="annot"><span class="annottext">Getting P2pConfiguration ChainwebConfiguration P2pConfiguration
Lens' ChainwebConfiguration P2pConfiguration
</span><a href="Chainweb.Chainweb.html#configP2p"><span class="hs-identifier hs-var">configP2p</span></a></span><span> </span><span class="annot"><span class="annottext">ChainwebConfiguration
</span><a href="#local-6989586621681510813"><span class="hs-identifier hs-var">conf</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">logger
</span><a href="#local-6989586621681510821"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">((logger -&gt; PeerResources logger -&gt; IO a) -&gt; IO a)
-&gt; (logger -&gt; PeerResources logger -&gt; IO a) -&gt; IO a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681510812"><span class="annot"><span class="annottext">logger' :: logger
</span><a href="#local-6989586621681510812"><span class="hs-identifier hs-var">logger'</span></a></span></span><span> </span><span id="local-6989586621681510811"><span class="annot"><span class="annottext">peer :: PeerResources logger
</span><a href="#local-6989586621681510811"><span class="hs-identifier hs-var">peer</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-365"></span><span>        </span><span class="annot"><span class="annottext">ChainwebConfiguration
-&gt; logger
-&gt; PeerResources logger
-&gt; RocksDb
-&gt; Maybe String
-&gt; Maybe NodeId
-&gt; Bool
-&gt; (Chainweb logger RocksDbCas -&gt; IO a)
-&gt; IO a
forall logger a.
Logger logger =&gt;
ChainwebConfiguration
-&gt; logger
-&gt; PeerResources logger
-&gt; RocksDb
-&gt; Maybe String
-&gt; Maybe NodeId
-&gt; Bool
-&gt; (Chainweb logger RocksDbCas -&gt; IO a)
-&gt; IO a
</span><a href="Chainweb.Chainweb.html#withChainwebInternal"><span class="hs-identifier hs-var">withChainwebInternal</span></a></span><span>
</span><span id="line-366"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ASetter
  ChainwebConfiguration
  ChainwebConfiguration
  P2pConfiguration
  P2pConfiguration
-&gt; P2pConfiguration
-&gt; ChainwebConfiguration
-&gt; ChainwebConfiguration
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-identifier hs-var">set</span></span><span> </span><span class="annot"><span class="annottext">ASetter
  ChainwebConfiguration
  ChainwebConfiguration
  P2pConfiguration
  P2pConfiguration
Lens' ChainwebConfiguration P2pConfiguration
</span><a href="Chainweb.Chainweb.html#configP2p"><span class="hs-identifier hs-var">configP2p</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PeerResources logger -&gt; P2pConfiguration
forall logger. PeerResources logger -&gt; P2pConfiguration
</span><a href="Chainweb.Chainweb.PeerResources.html#_peerResConfig"><span class="hs-identifier hs-var hs-var">_peerResConfig</span></a></span><span> </span><span class="annot"><span class="annottext">PeerResources logger
</span><a href="#local-6989586621681510811"><span class="hs-identifier hs-var">peer</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ChainwebConfiguration
</span><a href="#local-6989586621681510813"><span class="hs-identifier hs-var">conf</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-367"></span><span>            </span><span class="annot"><span class="annottext">logger
</span><a href="#local-6989586621681510812"><span class="hs-identifier hs-var">logger'</span></a></span><span>
</span><span id="line-368"></span><span>            </span><span class="annot"><span class="annottext">PeerResources logger
</span><a href="#local-6989586621681510811"><span class="hs-identifier hs-var">peer</span></a></span><span>
</span><span id="line-369"></span><span>            </span><span class="annot"><span class="annottext">RocksDb
</span><a href="#local-6989586621681510820"><span class="hs-identifier hs-var">rocksDb</span></a></span><span>
</span><span id="line-370"></span><span>            </span><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621681510819"><span class="hs-identifier hs-var">dbDir</span></a></span><span>
</span><span id="line-371"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NodeId -&gt; Maybe NodeId
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ChainwebConfiguration -&gt; NodeId
</span><a href="Chainweb.Chainweb.html#_configNodeId"><span class="hs-identifier hs-var hs-var">_configNodeId</span></a></span><span> </span><span class="annot"><span class="annottext">ChainwebConfiguration
</span><a href="#local-6989586621681510822"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-372"></span><span>            </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681510818"><span class="hs-identifier hs-var">resetDb</span></a></span><span>
</span><span id="line-373"></span><span>            </span><span class="annot"><span class="annottext">Chainweb logger RocksDbCas -&gt; IO a
</span><a href="#local-6989586621681510817"><span class="hs-identifier hs-var">inner</span></a></span><span>
</span><span id="line-374"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-375"></span><span>    </span><span id="local-6989586621681510815"><span class="annot"><span class="annottext">v :: ChainwebVersion
</span><a href="#local-6989586621681510815"><span class="hs-identifier hs-var hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ChainwebConfiguration -&gt; ChainwebVersion
forall a. HasChainwebVersion a =&gt; a -&gt; ChainwebVersion
</span><a href="Chainweb.Version.html#_chainwebVersion"><span class="hs-identifier hs-var">_chainwebVersion</span></a></span><span> </span><span class="annot"><span class="annottext">ChainwebConfiguration
</span><a href="#local-6989586621681510822"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-376"></span><span>
</span><span id="line-377"></span><span>    </span><span class="hs-comment">-- Here we inject the hard-coded bootstrap peer infos for the configured</span><span>
</span><span id="line-378"></span><span>    </span><span class="hs-comment">-- chainweb version into the configuration.</span><span>
</span><span id="line-379"></span><span>    </span><span id="local-6989586621681510813"><span class="annot"><span class="annottext">conf :: ChainwebConfiguration
</span><a href="#local-6989586621681510813"><span class="hs-identifier hs-var hs-var">conf</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">P2pConfiguration -&gt; Bool
</span><a href="P2P.Node.Configuration.html#_p2pConfigIgnoreBootstrapNodes"><span class="hs-identifier hs-var hs-var">_p2pConfigIgnoreBootstrapNodes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ChainwebConfiguration -&gt; P2pConfiguration
</span><a href="Chainweb.Chainweb.html#_configP2p"><span class="hs-identifier hs-var hs-var">_configP2p</span></a></span><span> </span><span class="annot"><span class="annottext">ChainwebConfiguration
</span><a href="#local-6989586621681510822"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ChainwebConfiguration
</span><a href="#local-6989586621681510822"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-380"></span><span>         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ASetter
  ChainwebConfiguration
  ChainwebConfiguration
  P2pConfiguration
  P2pConfiguration
Lens' ChainwebConfiguration P2pConfiguration
</span><a href="Chainweb.Chainweb.html#configP2p"><span class="hs-identifier hs-var">configP2p</span></a></span><span> </span><span class="annot"><span class="annottext">ASetter
  ChainwebConfiguration
  ChainwebConfiguration
  P2pConfiguration
  P2pConfiguration
-&gt; (([PeerInfo] -&gt; Identity [PeerInfo])
    -&gt; P2pConfiguration -&gt; Identity P2pConfiguration)
-&gt; ([PeerInfo] -&gt; Identity [PeerInfo])
-&gt; ChainwebConfiguration
-&gt; Identity ChainwebConfiguration
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">([PeerInfo] -&gt; Identity [PeerInfo])
-&gt; P2pConfiguration -&gt; Identity P2pConfiguration
Lens' P2pConfiguration [PeerInfo]
</span><a href="P2P.Node.Configuration.html#p2pConfigKnownPeers"><span class="hs-identifier hs-var">p2pConfigKnownPeers</span></a></span><span> </span><span class="annot"><span class="annottext">(([PeerInfo] -&gt; Identity [PeerInfo])
 -&gt; ChainwebConfiguration -&gt; Identity ChainwebConfiguration)
-&gt; [PeerInfo] -&gt; ChainwebConfiguration -&gt; ChainwebConfiguration
forall a s t. Monoid a =&gt; ASetter s t a a -&gt; a -&gt; s -&gt; t
</span><span class="hs-operator hs-var">&lt;&gt;~</span></span><span> </span><span class="annot"><span class="annottext">ChainwebVersion -&gt; [PeerInfo]
</span><a href="P2P.Peer.html#bootstrapPeerInfos"><span class="hs-identifier hs-var">bootstrapPeerInfos</span></a></span><span> </span><span class="annot"><span class="annottext">ChainwebVersion
</span><a href="#local-6989586621681510815"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">(ChainwebConfiguration -&gt; ChainwebConfiguration)
-&gt; ChainwebConfiguration -&gt; ChainwebConfiguration
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ChainwebConfiguration
</span><a href="#local-6989586621681510822"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-381"></span><span>
</span><span id="line-382"></span><span class="hs-comment">-- TODO: The type InMempoolConfig contains parameters that should be</span><span>
</span><span id="line-383"></span><span class="hs-comment">-- configurable as well as parameters that are determined by the chainweb</span><span>
</span><span id="line-384"></span><span class="hs-comment">-- version or the chainweb protocol. These should be separated in to two</span><span>
</span><span id="line-385"></span><span class="hs-comment">-- different types.</span><span>
</span><span id="line-386"></span><span>
</span><span id="line-387"></span><span class="annot"><a href="Chainweb.Chainweb.html#validatingMempoolConfig"><span class="hs-identifier hs-type">validatingMempoolConfig</span></a></span><span>
</span><span id="line-388"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Chainweb.ChainId.html#ChainId"><span class="hs-identifier hs-type">ChainId</span></a></span><span>
</span><span id="line-389"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Chainweb.Version.html#ChainwebVersion"><span class="hs-identifier hs-type">ChainwebVersion</span></a></span><span>
</span><span id="line-390"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Mempool.GasLimit</span></span><span>
</span><span id="line-391"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MVar</span></span><span> </span><span class="annot"><a href="Chainweb.WebPactExecutionService.Types.html#PactExecutionService"><span class="hs-identifier hs-type">PactExecutionService</span></a></span><span>
</span><span id="line-392"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Chainweb.Mempool.InMemTypes.html#InMemConfig"><span class="hs-identifier hs-type">Mempool.InMemConfig</span></a></span><span> </span><span class="annot"><a href="Chainweb.Transaction.html#ChainwebTransaction"><span class="hs-identifier hs-type">ChainwebTransaction</span></a></span><span>
</span><span id="line-393"></span><span id="validatingMempoolConfig"><span class="annot"><span class="annottext">validatingMempoolConfig :: ChainId
-&gt; ChainwebVersion
-&gt; GasLimit
-&gt; MVar PactExecutionService
-&gt; InMemConfig ChainwebTransaction
</span><a href="Chainweb.Chainweb.html#validatingMempoolConfig"><span class="hs-identifier hs-var hs-var">validatingMempoolConfig</span></a></span></span><span> </span><span id="local-6989586621681510803"><span class="annot"><span class="annottext">cid :: ChainId
</span><a href="#local-6989586621681510803"><span class="hs-identifier hs-var">cid</span></a></span></span><span> </span><span id="local-6989586621681510802"><span class="annot"><span class="annottext">v :: ChainwebVersion
</span><a href="#local-6989586621681510802"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621681510801"><span class="annot"><span class="annottext">gl :: GasLimit
</span><a href="#local-6989586621681510801"><span class="hs-identifier hs-var">gl</span></a></span></span><span> </span><span id="local-6989586621681510800"><span class="annot"><span class="annottext">mv :: MVar PactExecutionService
</span><a href="#local-6989586621681510800"><span class="hs-identifier hs-var">mv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">$WInMemConfig :: forall t.
TransactionConfig t
-&gt; GasLimit
-&gt; Int
-&gt; (t -&gt; Either InsertError t)
-&gt; (Vector (T2 TransactionHash t)
    -&gt; IO
         (Vector
            (Either (T2 TransactionHash InsertError) (T2 TransactionHash t))))
-&gt; InMemConfig t
</span><a href="Chainweb.Mempool.InMemTypes.html#%24WInMemConfig"><span class="hs-identifier hs-type hs-type">Mempool.InMemConfig</span></a></span><span>
</span><span id="line-394"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">_inmemTxCfg :: TransactionConfig ChainwebTransaction
</span><a href="Chainweb.Mempool.InMemTypes.html#_inmemTxCfg"><span class="hs-identifier hs-var">Mempool._inmemTxCfg</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TransactionConfig ChainwebTransaction
</span><a href="#local-6989586621681510796"><span class="hs-identifier hs-var">txcfg</span></a></span><span>
</span><span id="line-395"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_inmemTxBlockSizeLimit :: GasLimit
</span><a href="Chainweb.Mempool.InMemTypes.html#_inmemTxBlockSizeLimit"><span class="hs-identifier hs-var">Mempool._inmemTxBlockSizeLimit</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GasLimit
</span><a href="#local-6989586621681510801"><span class="hs-identifier hs-var">gl</span></a></span><span>
</span><span id="line-396"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_inmemMaxRecentItems :: Int
</span><a href="Chainweb.Mempool.InMemTypes.html#_inmemMaxRecentItems"><span class="hs-identifier hs-var">Mempool._inmemMaxRecentItems</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681510793"><span class="hs-identifier hs-var">maxRecentLog</span></a></span><span>
</span><span id="line-397"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_inmemPreInsertPureChecks :: ChainwebTransaction -&gt; Either InsertError ChainwebTransaction
</span><a href="Chainweb.Mempool.InMemTypes.html#_inmemPreInsertPureChecks"><span class="hs-identifier hs-var">Mempool._inmemPreInsertPureChecks</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ChainwebTransaction -&gt; Either InsertError ChainwebTransaction
</span><a href="#local-6989586621681510791"><span class="hs-identifier hs-var">preInsertSingle</span></a></span><span>
</span><span id="line-398"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_inmemPreInsertBatchChecks :: Vector (T2 TransactionHash ChainwebTransaction)
-&gt; IO
     (Vector
        (Either
           (T2 TransactionHash InsertError)
           (T2 TransactionHash ChainwebTransaction)))
</span><a href="Chainweb.Mempool.InMemTypes.html#_inmemPreInsertBatchChecks"><span class="hs-identifier hs-var">Mempool._inmemPreInsertBatchChecks</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector (T2 TransactionHash ChainwebTransaction)
-&gt; IO
     (Vector
        (Either
           (T2 TransactionHash InsertError)
           (T2 TransactionHash ChainwebTransaction)))
</span><a href="#local-6989586621681510789"><span class="hs-identifier hs-var">preInsertBatch</span></a></span><span>
</span><span id="line-399"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-400"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-401"></span><span>    </span><span id="local-6989586621681510796"><span class="annot"><span class="annottext">txcfg :: TransactionConfig ChainwebTransaction
</span><a href="#local-6989586621681510796"><span class="hs-identifier hs-var hs-var">txcfg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TransactionConfig ChainwebTransaction
</span><a href="Chainweb.Mempool.Mempool.html#chainwebTransactionConfig"><span class="hs-identifier hs-var">Mempool.chainwebTransactionConfig</span></a></span><span>
</span><span id="line-402"></span><span>    </span><span id="local-6989586621681510793"><span class="annot"><span class="annottext">maxRecentLog :: Int
</span><a href="#local-6989586621681510793"><span class="hs-identifier hs-var hs-var">maxRecentLog</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-number">2048</span></span><span>
</span><span id="line-403"></span><span>
</span><span id="line-404"></span><span>    </span><span id="local-6989586621681511219"><span class="annot"><a href="#local-6989586621681510788"><span class="hs-identifier hs-type">toDupeResult</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621681511219"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#InsertError"><span class="hs-identifier hs-type">Mempool.InsertError</span></a></span></span><span>
</span><span id="line-405"></span><span>    </span><span id="local-6989586621681510788"><span class="annot"><span class="annottext">toDupeResult :: Maybe a -&gt; Maybe InsertError
</span><a href="#local-6989586621681510788"><span class="hs-identifier hs-var hs-var">toDupeResult</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a -&gt; InsertError) -&gt; Maybe a -&gt; Maybe InsertError
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InsertError -&gt; a -&gt; InsertError
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">InsertError
</span><a href="Chainweb.Mempool.Mempool.html#InsertErrorDuplicate"><span class="hs-identifier hs-var">Mempool.InsertErrorDuplicate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-406"></span><span>
</span><span id="line-407"></span><span>    </span><span class="annot"><a href="#local-6989586621681510791"><span class="hs-identifier hs-type">preInsertSingle</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Chainweb.Transaction.html#ChainwebTransaction"><span class="hs-identifier hs-type">ChainwebTransaction</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#InsertError"><span class="hs-identifier hs-type">Mempool.InsertError</span></a></span><span> </span><span class="annot"><a href="Chainweb.Transaction.html#ChainwebTransaction"><span class="hs-identifier hs-type">ChainwebTransaction</span></a></span><span>
</span><span id="line-408"></span><span>    </span><span id="local-6989586621681510791"><span class="annot"><span class="annottext">preInsertSingle :: ChainwebTransaction -&gt; Either InsertError ChainwebTransaction
</span><a href="#local-6989586621681510791"><span class="hs-identifier hs-var hs-var">preInsertSingle</span></a></span></span><span> </span><span id="local-6989586621681510786"><span class="annot"><span class="annottext">tx :: ChainwebTransaction
</span><a href="#local-6989586621681510786"><span class="hs-identifier hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ChainwebTransaction -&gt; Either InsertError ChainwebTransaction
</span><a href="#local-6989586621681510785"><span class="hs-identifier hs-var">checkMetadata</span></a></span><span> </span><span class="annot"><span class="annottext">ChainwebTransaction
</span><a href="#local-6989586621681510786"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-409"></span><span>
</span><span id="line-410"></span><span>    </span><span class="hs-comment">-- | Validation: All checks that should occur before a TX is inserted into</span><span>
</span><span id="line-411"></span><span>    </span><span class="hs-comment">-- the mempool. A rejection at this stage means that something is</span><span>
</span><span id="line-412"></span><span>    </span><span class="hs-comment">-- fundamentally wrong/illegal with the TX, and that it should be rejected</span><span>
</span><span id="line-413"></span><span>    </span><span class="hs-comment">-- completely and not gossiped to other peers.</span><span>
</span><span id="line-414"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-415"></span><span>    </span><span class="hs-comment">-- We expect this to be called in two places: once when a new Pact</span><span>
</span><span id="line-416"></span><span>    </span><span class="hs-comment">-- Transaction is submitted via the @send@ endpoint, and once when a new TX</span><span>
</span><span id="line-417"></span><span>    </span><span class="hs-comment">-- is gossiped to us from a peer's mempool.</span><span>
</span><span id="line-418"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-419"></span><span>    </span><span class="annot"><a href="#local-6989586621681510789"><span class="hs-identifier hs-type">preInsertBatch</span></a></span><span>
</span><span id="line-420"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">V.Vector</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">T2</span></span><span> </span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#TransactionHash"><span class="hs-identifier hs-type">Mempool.TransactionHash</span></a></span><span> </span><span class="annot"><a href="Chainweb.Transaction.html#ChainwebTransaction"><span class="hs-identifier hs-type">ChainwebTransaction</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-421"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">V.Vector</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">T2</span></span><span> </span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#TransactionHash"><span class="hs-identifier hs-type">Mempool.TransactionHash</span></a></span><span> </span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#InsertError"><span class="hs-identifier hs-type">Mempool.InsertError</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-422"></span><span>                                </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">T2</span></span><span> </span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#TransactionHash"><span class="hs-identifier hs-type">Mempool.TransactionHash</span></a></span><span> </span><span class="annot"><a href="Chainweb.Transaction.html#ChainwebTransaction"><span class="hs-identifier hs-type">ChainwebTransaction</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-423"></span><span>    </span><span id="local-6989586621681510789"><span class="annot"><span class="annottext">preInsertBatch :: Vector (T2 TransactionHash ChainwebTransaction)
-&gt; IO
     (Vector
        (Either
           (T2 TransactionHash InsertError)
           (T2 TransactionHash ChainwebTransaction)))
</span><a href="#local-6989586621681510789"><span class="hs-identifier hs-var hs-var">preInsertBatch</span></a></span></span><span> </span><span id="local-6989586621681510784"><span class="annot"><span class="annottext">txs :: Vector (T2 TransactionHash ChainwebTransaction)
</span><a href="#local-6989586621681510784"><span class="hs-identifier hs-var">txs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-424"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681510783"><span class="annot"><span class="annottext">hashes :: Vector (TypedHash 'Blake2b_256)
</span><a href="#local-6989586621681510783"><span class="hs-identifier hs-var hs-var">hashes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(T2 TransactionHash ChainwebTransaction -&gt; TypedHash 'Blake2b_256)
-&gt; Vector (T2 TransactionHash ChainwebTransaction)
-&gt; Vector (TypedHash 'Blake2b_256)
forall a b. (a -&gt; b) -&gt; Vector a -&gt; Vector b
</span><span class="hs-identifier hs-var">V.map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TransactionHash -&gt; TypedHash 'Blake2b_256
forall (h :: HashAlgo). TransactionHash -&gt; TypedHash h
</span><a href="#local-6989586621681510781"><span class="hs-identifier hs-var">toPactHash</span></a></span><span> </span><span class="annot"><span class="annottext">(TransactionHash -&gt; TypedHash 'Blake2b_256)
-&gt; (T2 TransactionHash ChainwebTransaction -&gt; TransactionHash)
-&gt; T2 TransactionHash ChainwebTransaction
-&gt; TypedHash 'Blake2b_256
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">T2 TransactionHash ChainwebTransaction -&gt; TransactionHash
forall a b. T2 a b -&gt; a
</span><span class="hs-identifier hs-var">sfst</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Vector (T2 TransactionHash ChainwebTransaction)
</span><a href="#local-6989586621681510784"><span class="hs-identifier hs-var">txs</span></a></span><span>
</span><span id="line-425"></span><span>        </span><span id="local-6989586621681510779"><span class="annot"><span class="annottext">PactExecutionService
</span><a href="#local-6989586621681510779"><span class="hs-identifier hs-var">pex</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MVar PactExecutionService -&gt; IO PactExecutionService
forall a. MVar a -&gt; IO a
</span><span class="hs-identifier hs-var">readMVar</span></span><span> </span><span class="annot"><span class="annottext">MVar PactExecutionService
</span><a href="#local-6989586621681510800"><span class="hs-identifier hs-var">mv</span></a></span><span>
</span><span id="line-426"></span><span>        </span><span id="local-6989586621681510778"><span class="annot"><span class="annottext">Vector (Maybe (T2 BlockHeight BlockHash))
</span><a href="#local-6989586621681510778"><span class="hs-identifier hs-var">rs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PactExecutionService
-&gt; Either ChainId BlockHeader
-&gt; Vector (TypedHash 'Blake2b_256)
-&gt; IO
     (Either PactException (Vector (Maybe (T2 BlockHeight BlockHash))))
</span><a href="Chainweb.WebPactExecutionService.Types.html#_pactLookup"><span class="hs-identifier hs-var hs-var">_pactLookup</span></a></span><span> </span><span class="annot"><span class="annottext">PactExecutionService
</span><a href="#local-6989586621681510779"><span class="hs-identifier hs-var">pex</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ChainId -&gt; Either ChainId BlockHeader
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">ChainId
</span><a href="#local-6989586621681510803"><span class="hs-identifier hs-var">cid</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Vector (TypedHash 'Blake2b_256)
</span><a href="#local-6989586621681510783"><span class="hs-identifier hs-var">hashes</span></a></span><span> </span><span class="annot"><span class="annottext">IO
  (Either PactException (Vector (Maybe (T2 BlockHeight BlockHash))))
-&gt; (Either
      PactException (Vector (Maybe (T2 BlockHeight BlockHash)))
    -&gt; IO (Vector (Maybe (T2 BlockHeight BlockHash))))
-&gt; IO (Vector (Maybe (T2 BlockHeight BlockHash)))
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">(PactException -&gt; IO (Vector (Maybe (T2 BlockHeight BlockHash))))
-&gt; (Vector (Maybe (T2 BlockHeight BlockHash))
    -&gt; IO (Vector (Maybe (T2 BlockHeight BlockHash))))
-&gt; Either PactException (Vector (Maybe (T2 BlockHeight BlockHash)))
-&gt; IO (Vector (Maybe (T2 BlockHeight BlockHash)))
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><span class="hs-identifier hs-var">either</span></span><span> </span><span class="annot"><span class="annottext">PactException -&gt; IO (Vector (Maybe (T2 BlockHeight BlockHash)))
forall (m :: * -&gt; *) e a. (MonadThrow m, Exception e) =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwM</span></span><span> </span><span class="annot"><span class="annottext">Vector (Maybe (T2 BlockHeight BlockHash))
-&gt; IO (Vector (Maybe (T2 BlockHeight BlockHash)))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span>
</span><span id="line-427"></span><span>        </span><span class="annot"><span class="annottext">Vector
  (Either
     (T2 TransactionHash InsertError)
     (T2 TransactionHash ChainwebTransaction))
-&gt; IO
     (Vector
        (Either
           (T2 TransactionHash InsertError)
           (T2 TransactionHash ChainwebTransaction)))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Vector
   (Either
      (T2 TransactionHash InsertError)
      (T2 TransactionHash ChainwebTransaction))
 -&gt; IO
      (Vector
         (Either
            (T2 TransactionHash InsertError)
            (T2 TransactionHash ChainwebTransaction))))
-&gt; Vector
     (Either
        (T2 TransactionHash InsertError)
        (T2 TransactionHash ChainwebTransaction))
-&gt; IO
     (Vector
        (Either
           (T2 TransactionHash InsertError)
           (T2 TransactionHash ChainwebTransaction)))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(These
   (Maybe (T2 BlockHeight BlockHash))
   (T2 TransactionHash ChainwebTransaction)
 -&gt; Either
      (T2 TransactionHash InsertError)
      (T2 TransactionHash ChainwebTransaction))
-&gt; Vector (Maybe (T2 BlockHeight BlockHash))
-&gt; Vector (T2 TransactionHash ChainwebTransaction)
-&gt; Vector
     (Either
        (T2 TransactionHash InsertError)
        (T2 TransactionHash ChainwebTransaction))
forall (f :: * -&gt; *) a b c.
Semialign f =&gt;
(These a b -&gt; c) -&gt; f a -&gt; f b -&gt; f c
</span><span class="hs-identifier hs-var">alignWith</span></span><span> </span><span class="annot"><span class="annottext">These
  (Maybe (T2 BlockHeight BlockHash))
  (T2 TransactionHash ChainwebTransaction)
-&gt; Either
     (T2 TransactionHash InsertError)
     (T2 TransactionHash ChainwebTransaction)
forall a b.
These (Maybe a) (T2 TransactionHash b)
-&gt; Either (T2 TransactionHash InsertError) (T2 TransactionHash b)
</span><a href="#local-6989586621681510775"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Vector (Maybe (T2 BlockHeight BlockHash))
</span><a href="#local-6989586621681510778"><span class="hs-identifier hs-var">rs</span></a></span><span> </span><span class="annot"><span class="annottext">Vector (T2 TransactionHash ChainwebTransaction)
</span><a href="#local-6989586621681510784"><span class="hs-identifier hs-var">txs</span></a></span><span>
</span><span id="line-428"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-429"></span><span>        </span><span id="local-6989586621681510775"><span class="annot"><span class="annottext">f :: These (Maybe a) (T2 TransactionHash b)
-&gt; Either (T2 TransactionHash InsertError) (T2 TransactionHash b)
</span><a href="#local-6989586621681510775"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">These</span></span><span> </span><span id="local-6989586621681510773"><span class="annot"><span class="annottext">r :: Maybe a
</span><a href="#local-6989586621681510773"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">T2</span></span><span> </span><span id="local-6989586621681510771"><span class="annot"><span class="annottext">h :: TransactionHash
</span><a href="#local-6989586621681510771"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span id="local-6989586621681510770"><span class="annot"><span class="annottext">t :: b
</span><a href="#local-6989586621681510770"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Either (T2 TransactionHash InsertError) (T2 TransactionHash b)
-&gt; (InsertError
    -&gt; Either (T2 TransactionHash InsertError) (T2 TransactionHash b))
-&gt; Maybe InsertError
-&gt; Either (T2 TransactionHash InsertError) (T2 TransactionHash b)
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">T2 TransactionHash b
-&gt; Either (T2 TransactionHash InsertError) (T2 TransactionHash b)
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TransactionHash -&gt; b -&gt; T2 TransactionHash b
forall a b. a -&gt; b -&gt; T2 a b
</span><span class="hs-identifier hs-var">T2</span></span><span> </span><span class="annot"><span class="annottext">TransactionHash
</span><a href="#local-6989586621681510771"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621681510770"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">T2 TransactionHash InsertError
-&gt; Either (T2 TransactionHash InsertError) (T2 TransactionHash b)
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">(T2 TransactionHash InsertError
 -&gt; Either (T2 TransactionHash InsertError) (T2 TransactionHash b))
-&gt; (InsertError -&gt; T2 TransactionHash InsertError)
-&gt; InsertError
-&gt; Either (T2 TransactionHash InsertError) (T2 TransactionHash b)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TransactionHash -&gt; InsertError -&gt; T2 TransactionHash InsertError
forall a b. a -&gt; b -&gt; T2 a b
</span><span class="hs-identifier hs-var">T2</span></span><span> </span><span class="annot"><span class="annottext">TransactionHash
</span><a href="#local-6989586621681510771"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe InsertError
 -&gt; Either (T2 TransactionHash InsertError) (T2 TransactionHash b))
-&gt; Maybe InsertError
-&gt; Either (T2 TransactionHash InsertError) (T2 TransactionHash b)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe a -&gt; Maybe InsertError
forall a. Maybe a -&gt; Maybe InsertError
</span><a href="#local-6989586621681510788"><span class="hs-identifier hs-var">toDupeResult</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe a
</span><a href="#local-6989586621681510773"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-430"></span><span>        </span><span class="annot"><a href="#local-6989586621681510775"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">That</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">T2</span></span><span> </span><span id="local-6989586621681510767"><span class="annot"><span class="annottext">h :: TransactionHash
</span><a href="#local-6989586621681510767"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">T2 TransactionHash InsertError
-&gt; Either (T2 TransactionHash InsertError) (T2 TransactionHash b)
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TransactionHash -&gt; InsertError -&gt; T2 TransactionHash InsertError
forall a b. a -&gt; b -&gt; T2 a b
</span><span class="hs-identifier hs-var">T2</span></span><span> </span><span class="annot"><span class="annottext">TransactionHash
</span><a href="#local-6989586621681510767"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">(InsertError -&gt; T2 TransactionHash InsertError)
-&gt; InsertError -&gt; T2 TransactionHash InsertError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; InsertError
</span><a href="Chainweb.Mempool.Mempool.html#InsertErrorOther"><span class="hs-identifier hs-var">Mempool.InsertErrorOther</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;preInsertBatch: align mismatch 0&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-431"></span><span>        </span><span class="annot"><a href="#local-6989586621681510775"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">This</span></span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">T2 TransactionHash InsertError
-&gt; Either (T2 TransactionHash InsertError) (T2 TransactionHash b)
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TransactionHash -&gt; InsertError -&gt; T2 TransactionHash InsertError
forall a b. a -&gt; b -&gt; T2 a b
</span><span class="hs-identifier hs-var">T2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShortByteString -&gt; TransactionHash
</span><a href="Chainweb.Mempool.Mempool.html#TransactionHash"><span class="hs-identifier hs-var">Mempool.TransactionHash</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; InsertError
</span><a href="Chainweb.Mempool.Mempool.html#InsertErrorOther"><span class="hs-identifier hs-var">Mempool.InsertErrorOther</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;preInsertBatch: align mismatch 1&quot;</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-432"></span><span>
</span><span id="line-433"></span><span>    </span><span id="local-6989586621681511251"><span class="annot"><a href="#local-6989586621681510781"><span class="hs-identifier hs-type">toPactHash</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#TransactionHash"><span class="hs-identifier hs-type">Mempool.TransactionHash</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">P.TypedHash</span></span><span> </span><span class="annot"><a href="#local-6989586621681511251"><span class="hs-identifier hs-type">h</span></a></span></span><span>
</span><span id="line-434"></span><span>    </span><span id="local-6989586621681510781"><span class="annot"><span class="annottext">toPactHash :: TransactionHash -&gt; TypedHash h
</span><a href="#local-6989586621681510781"><span class="hs-identifier hs-var hs-var">toPactHash</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#TransactionHash"><span class="hs-identifier hs-type">Mempool.TransactionHash</span></a></span><span> </span><span id="local-6989586621681510763"><span class="annot"><span class="annottext">h :: ShortByteString
</span><a href="#local-6989586621681510763"><span class="hs-identifier hs-var">h</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; TypedHash h
forall (h :: HashAlgo). ByteString -&gt; TypedHash h
</span><span class="hs-identifier hs-var">P.TypedHash</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; TypedHash h) -&gt; ByteString -&gt; TypedHash h
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ShortByteString -&gt; ByteString
</span><span class="hs-identifier hs-var">SB.fromShort</span></span><span> </span><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621681510763"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-435"></span><span>
</span><span id="line-436"></span><span>    </span><span class="hs-comment">-- | Validation: Is this TX associated with the correct `ChainId`?</span><span>
</span><span id="line-437"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-438"></span><span>    </span><span class="annot"><a href="#local-6989586621681510785"><span class="hs-identifier hs-type">checkMetadata</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Chainweb.Transaction.html#ChainwebTransaction"><span class="hs-identifier hs-type">ChainwebTransaction</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#InsertError"><span class="hs-identifier hs-type">Mempool.InsertError</span></a></span><span> </span><span class="annot"><a href="Chainweb.Transaction.html#ChainwebTransaction"><span class="hs-identifier hs-type">ChainwebTransaction</span></a></span><span>
</span><span id="line-439"></span><span>    </span><span id="local-6989586621681510785"><span class="annot"><span class="annottext">checkMetadata :: ChainwebTransaction -&gt; Either InsertError ChainwebTransaction
</span><a href="#local-6989586621681510785"><span class="hs-identifier hs-var hs-var">checkMetadata</span></a></span></span><span> </span><span id="local-6989586621681510760"><span class="annot"><span class="annottext">tx :: ChainwebTransaction
</span><a href="#local-6989586621681510760"><span class="hs-identifier hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-440"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621681510759"><span class="annot"><span class="annottext">pay :: Payload PublicMeta ParsedCode
</span><a href="#local-6989586621681510759"><span class="hs-identifier hs-var hs-var">pay</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PayloadWithText -&gt; Payload PublicMeta ParsedCode
</span><a href="Chainweb.Transaction.html#payloadObj"><span class="hs-identifier hs-var">payloadObj</span></a></span><span> </span><span class="annot"><span class="annottext">(PayloadWithText -&gt; Payload PublicMeta ParsedCode)
-&gt; (ChainwebTransaction -&gt; PayloadWithText)
-&gt; ChainwebTransaction
-&gt; Payload PublicMeta ParsedCode
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ChainwebTransaction -&gt; PayloadWithText
forall a. Command a -&gt; a
</span><span class="hs-identifier hs-var hs-var">P._cmdPayload</span></span><span> </span><span class="annot"><span class="annottext">(ChainwebTransaction -&gt; Payload PublicMeta ParsedCode)
-&gt; ChainwebTransaction -&gt; Payload PublicMeta ParsedCode
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ChainwebTransaction
</span><a href="#local-6989586621681510760"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-441"></span><span>            </span><span id="local-6989586621681510756"><span class="annot"><span class="annottext">pcid :: ChainId
</span><a href="#local-6989586621681510756"><span class="hs-identifier hs-var hs-var">pcid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PublicMeta -&gt; ChainId
</span><span class="hs-identifier hs-var hs-var">P._pmChainId</span></span><span> </span><span class="annot"><span class="annottext">(PublicMeta -&gt; ChainId) -&gt; PublicMeta -&gt; ChainId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Payload PublicMeta ParsedCode -&gt; PublicMeta
forall m c. Payload m c -&gt; m
</span><span class="hs-identifier hs-var hs-var">P._pMeta</span></span><span> </span><span class="annot"><span class="annottext">Payload PublicMeta ParsedCode
</span><a href="#local-6989586621681510759"><span class="hs-identifier hs-var">pay</span></a></span><span>
</span><span id="line-442"></span><span>            </span><span id="local-6989586621681510753"><span class="annot"><span class="annottext">sigs :: Int
</span><a href="#local-6989586621681510753"><span class="hs-identifier hs-var hs-var">sigs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[UserSig] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ChainwebTransaction -&gt; [UserSig]
forall a. Command a -&gt; [UserSig]
</span><span class="hs-identifier hs-var hs-var">P._cmdSigs</span></span><span> </span><span class="annot"><span class="annottext">ChainwebTransaction
</span><a href="#local-6989586621681510760"><span class="hs-identifier hs-var">tx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-443"></span><span>            </span><span id="local-6989586621681510750"><span class="annot"><span class="annottext">ver :: Maybe ChainwebVersion
</span><a href="#local-6989586621681510750"><span class="hs-identifier hs-var hs-var">ver</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Payload PublicMeta ParsedCode -&gt; Maybe NetworkId
forall m c. Payload m c -&gt; Maybe NetworkId
</span><span class="hs-identifier hs-var hs-var">P._pNetworkId</span></span><span> </span><span class="annot"><span class="annottext">Payload PublicMeta ParsedCode
</span><a href="#local-6989586621681510759"><span class="hs-identifier hs-var">pay</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe NetworkId
-&gt; (NetworkId -&gt; Maybe ChainwebVersion) -&gt; Maybe ChainwebVersion
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
(HasTextRepresentation ChainwebVersion, MonadThrow m) =&gt;
Text -&gt; m ChainwebVersion
forall a (m :: * -&gt; *).
(HasTextRepresentation a, MonadThrow m) =&gt;
Text -&gt; m a
</span><a href="Chainweb.Utils.html#fromText"><span class="hs-identifier hs-var">fromText</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Chainweb.Version.html#ChainwebVersion"><span class="hs-identifier hs-type">ChainwebVersion</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Maybe ChainwebVersion)
-&gt; (NetworkId -&gt; Text) -&gt; NetworkId -&gt; Maybe ChainwebVersion
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">NetworkId -&gt; Text
</span><span class="hs-identifier hs-var hs-var">P._networkId</span></span><span>
</span><span id="line-444"></span><span>        </span><span id="local-6989586621681510746"><span class="annot"><span class="annottext">ChainId
</span><a href="#local-6989586621681510746"><span class="hs-identifier hs-var">tcid</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">InsertError -&gt; Maybe ChainId -&gt; Either InsertError ChainId
forall a b. a -&gt; Maybe b -&gt; Either a b
</span><span class="hs-identifier hs-var">note</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; InsertError
</span><a href="Chainweb.Mempool.Mempool.html#InsertErrorOther"><span class="hs-identifier hs-var">Mempool.InsertErrorOther</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Unparsable ChainId&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe ChainId -&gt; Either InsertError ChainId)
-&gt; Maybe ChainId -&gt; Either InsertError ChainId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ChainId -&gt; Maybe ChainId
forall (m :: * -&gt; *). MonadThrow m =&gt; ChainId -&gt; m ChainId
</span><a href="Chainweb.Pact.Utils.html#fromPactChainId"><span class="hs-identifier hs-var">fromPactChainId</span></a></span><span> </span><span class="annot"><span class="annottext">ChainId
</span><a href="#local-6989586621681510756"><span class="hs-identifier hs-var">pcid</span></a></span><span>
</span><span id="line-445"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ChainId
</span><a href="#local-6989586621681510746"><span class="hs-identifier hs-var">tcid</span></a></span><span> </span><span class="annot"><span class="annottext">ChainId -&gt; ChainId -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">ChainId
</span><a href="#local-6989586621681510803"><span class="hs-identifier hs-var">cid</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">InsertError -&gt; Either InsertError ChainwebTransaction
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">InsertError
</span><a href="Chainweb.Mempool.Mempool.html#InsertErrorMetadataMismatch"><span class="hs-identifier hs-var">Mempool.InsertErrorMetadataMismatch</span></a></span><span>
</span><span id="line-446"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681510753"><span class="hs-identifier hs-var">sigs</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="hs-number">100</span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">InsertError -&gt; Either InsertError ChainwebTransaction
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">(InsertError -&gt; Either InsertError ChainwebTransaction)
-&gt; InsertError -&gt; Either InsertError ChainwebTransaction
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; InsertError
</span><a href="Chainweb.Mempool.Mempool.html#InsertErrorOther"><span class="hs-identifier hs-var">Mempool.InsertErrorOther</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Too many signatures&quot;</span></span><span>
</span><span id="line-447"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Maybe ChainwebVersion
</span><a href="#local-6989586621681510750"><span class="hs-identifier hs-var">ver</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ChainwebVersion -&gt; Maybe ChainwebVersion -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">ChainwebVersion -&gt; Maybe ChainwebVersion
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">ChainwebVersion
</span><a href="#local-6989586621681510802"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">InsertError -&gt; Either InsertError ChainwebTransaction
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">InsertError
</span><a href="Chainweb.Mempool.Mempool.html#InsertErrorMetadataMismatch"><span class="hs-identifier hs-var">Mempool.InsertErrorMetadataMismatch</span></a></span><span>
</span><span id="line-448"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ChainwebTransaction -&gt; Either InsertError ChainwebTransaction
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">ChainwebTransaction
</span><a href="#local-6989586621681510760"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-449"></span><span>
</span><span id="line-450"></span><span class="hs-comment">-- Intializes all local chainweb components but doesn't start any networking.</span><span>
</span><span id="line-451"></span><span class="hs-comment">--</span><span>
</span><span id="line-452"></span><span class="annot"><a href="Chainweb.Chainweb.html#withChainwebInternal"><span class="hs-identifier hs-type">withChainwebInternal</span></a></span><span>
</span><span id="line-453"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621681511282"><span class="annot"><a href="#local-6989586621681511282"><span class="hs-identifier hs-type">logger</span></a></span></span><span> </span><span id="local-6989586621681511281"><span class="annot"><a href="#local-6989586621681511281"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-454"></span><span>    </span><span class="hs-operator">.</span><span>  </span><span class="annot"><a href="Chainweb.Logger.html#Logger"><span class="hs-identifier hs-type">Logger</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681511282"><span class="hs-identifier hs-type">logger</span></a></span><span>
</span><span id="line-455"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Chainweb.Chainweb.html#ChainwebConfiguration"><span class="hs-identifier hs-type">ChainwebConfiguration</span></a></span><span>
</span><span id="line-456"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681511282"><span class="hs-identifier hs-type">logger</span></a></span><span>
</span><span id="line-457"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Chainweb.Chainweb.PeerResources.html#PeerResources"><span class="hs-identifier hs-type">PeerResources</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681511282"><span class="hs-identifier hs-type">logger</span></a></span><span>
</span><span id="line-458"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">RocksDb</span></span><span>
</span><span id="line-459"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span>
</span><span id="line-460"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Chainweb.NodeId.html#NodeId"><span class="hs-identifier hs-type">NodeId</span></a></span><span>
</span><span id="line-461"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-462"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.Chainweb.html#Chainweb"><span class="hs-identifier hs-type">Chainweb</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681511282"><span class="hs-identifier hs-type">logger</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">RocksDbCas</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621681511281"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-463"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621681511281"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-464"></span><span id="withChainwebInternal"><span class="annot"><span class="annottext">withChainwebInternal :: ChainwebConfiguration
-&gt; logger
-&gt; PeerResources logger
-&gt; RocksDb
-&gt; Maybe String
-&gt; Maybe NodeId
-&gt; Bool
-&gt; (Chainweb logger RocksDbCas -&gt; IO a)
-&gt; IO a
</span><a href="Chainweb.Chainweb.html#withChainwebInternal"><span class="hs-identifier hs-var hs-var">withChainwebInternal</span></a></span></span><span> </span><span id="local-6989586621681510742"><span class="annot"><span class="annottext">conf :: ChainwebConfiguration
</span><a href="#local-6989586621681510742"><span class="hs-identifier hs-var">conf</span></a></span></span><span> </span><span id="local-6989586621681510741"><span class="annot"><span class="annottext">logger :: logger
</span><a href="#local-6989586621681510741"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621681510740"><span class="annot"><span class="annottext">peer :: PeerResources logger
</span><a href="#local-6989586621681510740"><span class="hs-identifier hs-var">peer</span></a></span></span><span> </span><span id="local-6989586621681510739"><span class="annot"><span class="annottext">rocksDb :: RocksDb
</span><a href="#local-6989586621681510739"><span class="hs-identifier hs-var">rocksDb</span></a></span></span><span> </span><span id="local-6989586621681510738"><span class="annot"><span class="annottext">dbDir :: Maybe String
</span><a href="#local-6989586621681510738"><span class="hs-identifier hs-var">dbDir</span></a></span></span><span> </span><span id="local-6989586621681510737"><span class="annot"><span class="annottext">nodeid :: Maybe NodeId
</span><a href="#local-6989586621681510737"><span class="hs-identifier hs-var">nodeid</span></a></span></span><span> </span><span id="local-6989586621681510736"><span class="annot"><span class="annottext">resetDb :: Bool
</span><a href="#local-6989586621681510736"><span class="hs-identifier hs-var">resetDb</span></a></span></span><span> </span><span id="local-6989586621681510735"><span class="annot"><span class="annottext">inner :: Chainweb logger RocksDbCas -&gt; IO a
</span><a href="#local-6989586621681510735"><span class="hs-identifier hs-var">inner</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-465"></span><span>    </span><span class="annot"><span class="annottext">ChainwebVersion -&gt; PayloadDb RocksDbCas -&gt; IO ()
forall (cas :: * -&gt; *).
PayloadCas cas =&gt;
ChainwebVersion -&gt; PayloadDb cas -&gt; IO ()
</span><a href="Chainweb.Payload.PayloadStore.html#initializePayloadDb"><span class="hs-identifier hs-var">initializePayloadDb</span></a></span><span> </span><span class="annot"><span class="annottext">ChainwebVersion
</span><a href="#local-6989586621681510733"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">PayloadDb RocksDbCas
</span><a href="#local-6989586621681510732"><span class="hs-identifier hs-var">payloadDb</span></a></span><span>
</span><span id="line-466"></span><span>    </span><span id="local-6989586621681510731"><span class="annot"><span class="annottext">MVar (CutDb RocksDbCas)
</span><a href="#local-6989586621681510731"><span class="hs-identifier hs-var">cdbv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (MVar (CutDb RocksDbCas))
forall a. IO (MVar a)
</span><span class="hs-identifier hs-var">newEmptyMVar</span></span><span>
</span><span id="line-467"></span><span>    </span><span class="annot"><span class="annottext">(forall c. ChainId -&gt; (ChainResources logger -&gt; IO c) -&gt; IO c)
-&gt; ([ChainResources logger] -&gt; IO a) -&gt; [ChainId] -&gt; IO a
forall a b (t :: * -&gt; *) d.
Traversable t =&gt;
(forall c. a -&gt; (b -&gt; IO c) -&gt; IO c)
-&gt; (t b -&gt; IO d) -&gt; t a -&gt; IO d
</span><a href="Chainweb.Utils.html#concurrentWith"><span class="hs-identifier hs-var">concurrentWith</span></a></span><span>
</span><span id="line-468"></span><span>        </span><span class="hs-comment">-- initialize chains concurrently</span><span>
</span><span id="line-469"></span><span>        </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621681510729"><span class="annot"><span class="annottext">cid :: ChainId
</span><a href="#local-6989586621681510729"><span class="hs-identifier hs-var">cid</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-470"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681510728"><span class="annot"><span class="annottext">mcfg :: MVar PactExecutionService -&gt; InMemConfig ChainwebTransaction
</span><a href="#local-6989586621681510728"><span class="hs-identifier hs-var hs-var">mcfg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ChainId
-&gt; ChainwebVersion
-&gt; GasLimit
-&gt; MVar PactExecutionService
-&gt; InMemConfig ChainwebTransaction
</span><a href="Chainweb.Chainweb.html#validatingMempoolConfig"><span class="hs-identifier hs-var">validatingMempoolConfig</span></a></span><span> </span><span class="annot"><span class="annottext">ChainId
</span><a href="#local-6989586621681510729"><span class="hs-identifier hs-var">cid</span></a></span><span> </span><span class="annot"><span class="annottext">ChainwebVersion
</span><a href="#local-6989586621681510733"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ChainwebConfiguration -&gt; GasLimit
</span><a href="Chainweb.Chainweb.html#_configBlockGasLimit"><span class="hs-identifier hs-var hs-var">_configBlockGasLimit</span></a></span><span> </span><span class="annot"><span class="annottext">ChainwebConfiguration
</span><a href="#local-6989586621681510742"><span class="hs-identifier hs-var">conf</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-471"></span><span>            </span><span class="annot"><span class="annottext">ChainwebVersion
-&gt; ChainId
-&gt; RocksDb
-&gt; PeerResources logger
-&gt; logger
-&gt; (MVar PactExecutionService -&gt; InMemConfig ChainwebTransaction)
-&gt; MVar (CutDb RocksDbCas)
-&gt; PayloadDb RocksDbCas
-&gt; Bool
-&gt; Maybe String
-&gt; Maybe NodeId
-&gt; Bool
-&gt; (ChainResources logger -&gt; IO c)
-&gt; IO c
forall logger (cas :: * -&gt; *) a.
(Logger logger, PayloadCas cas) =&gt;
ChainwebVersion
-&gt; ChainId
-&gt; RocksDb
-&gt; PeerResources logger
-&gt; logger
-&gt; (MVar PactExecutionService -&gt; InMemConfig ChainwebTransaction)
-&gt; MVar (CutDb cas)
-&gt; PayloadDb cas
-&gt; Bool
-&gt; Maybe String
-&gt; Maybe NodeId
-&gt; Bool
-&gt; (ChainResources logger -&gt; IO a)
-&gt; IO a
</span><a href="Chainweb.Chainweb.ChainResources.html#withChainResources"><span class="hs-identifier hs-var">withChainResources</span></a></span><span> </span><span class="annot"><span class="annottext">ChainwebVersion
</span><a href="#local-6989586621681510733"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">ChainId
</span><a href="#local-6989586621681510729"><span class="hs-identifier hs-var">cid</span></a></span><span> </span><span class="annot"><span class="annottext">RocksDb
</span><a href="#local-6989586621681510739"><span class="hs-identifier hs-var">rocksDb</span></a></span><span> </span><span class="annot"><span class="annottext">PeerResources logger
</span><a href="#local-6989586621681510740"><span class="hs-identifier hs-var">peer</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ChainId -&gt; logger
</span><a href="#local-6989586621681510726"><span class="hs-identifier hs-var">chainLogger</span></a></span><span> </span><span class="annot"><span class="annottext">ChainId
</span><a href="#local-6989586621681510729"><span class="hs-identifier hs-var">cid</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-472"></span><span>                     </span><span class="annot"><span class="annottext">MVar PactExecutionService -&gt; InMemConfig ChainwebTransaction
</span><a href="#local-6989586621681510728"><span class="hs-identifier hs-var">mcfg</span></a></span><span> </span><span class="annot"><span class="annottext">MVar (CutDb RocksDbCas)
</span><a href="#local-6989586621681510731"><span class="hs-identifier hs-var">cdbv</span></a></span><span> </span><span class="annot"><span class="annottext">PayloadDb RocksDbCas
</span><a href="#local-6989586621681510732"><span class="hs-identifier hs-var">payloadDb</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681510725"><span class="hs-identifier hs-var">prune</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621681510738"><span class="hs-identifier hs-var">dbDir</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe NodeId
</span><a href="#local-6989586621681510737"><span class="hs-identifier hs-var">nodeid</span></a></span><span>
</span><span id="line-473"></span><span>                     </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681510736"><span class="hs-identifier hs-var">resetDb</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-474"></span><span>
</span><span id="line-475"></span><span>        </span><span class="hs-comment">-- initialize global resources after all chain resources are initialized</span><span>
</span><span id="line-476"></span><span>        </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621681510724"><span class="annot"><span class="annottext">cs :: [ChainResources logger]
</span><a href="#local-6989586621681510724"><span class="hs-identifier hs-var">cs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HashMap ChainId (ChainResources logger)
-&gt; MVar (CutDb RocksDbCas) -&gt; IO a
</span><a href="#local-6989586621681510723"><span class="hs-identifier hs-var">global</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(ChainId, ChainResources logger)]
-&gt; HashMap ChainId (ChainResources logger)
forall k v. (Eq k, Hashable k) =&gt; [(k, v)] -&gt; HashMap k v
</span><span class="hs-identifier hs-var">HM.fromList</span></span><span> </span><span class="annot"><span class="annottext">([(ChainId, ChainResources logger)]
 -&gt; HashMap ChainId (ChainResources logger))
-&gt; [(ChainId, ChainResources logger)]
-&gt; HashMap ChainId (ChainResources logger)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[ChainId]
-&gt; [ChainResources logger] -&gt; [(ChainId, ChainResources logger)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="annot"><span class="annottext">[ChainId]
</span><a href="#local-6989586621681510721"><span class="hs-identifier hs-var">cidsList</span></a></span><span> </span><span class="annot"><span class="annottext">[ChainResources logger]
</span><a href="#local-6989586621681510724"><span class="hs-identifier hs-var">cs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">MVar (CutDb RocksDbCas)
</span><a href="#local-6989586621681510731"><span class="hs-identifier hs-var">cdbv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-477"></span><span>        </span><span class="annot"><span class="annottext">[ChainId]
</span><a href="#local-6989586621681510721"><span class="hs-identifier hs-var">cidsList</span></a></span><span>
</span><span id="line-478"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-479"></span><span>    </span><span class="annot"><a href="#local-6989586621681510725"><span class="hs-identifier hs-type">prune</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-480"></span><span>    </span><span id="local-6989586621681510725"><span class="annot"><span class="annottext">prune :: Bool
</span><a href="#local-6989586621681510725"><span class="hs-identifier hs-var hs-var">prune</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ChainwebConfiguration -&gt; Bool
</span><a href="Chainweb.Chainweb.html#_configPruneChainDatabase"><span class="hs-identifier hs-var hs-var">_configPruneChainDatabase</span></a></span><span> </span><span class="annot"><span class="annottext">ChainwebConfiguration
</span><a href="#local-6989586621681510742"><span class="hs-identifier hs-var">conf</span></a></span><span>
</span><span id="line-481"></span><span>
</span><span id="line-482"></span><span>    </span><span class="annot"><a href="#local-6989586621681510721"><span class="hs-identifier hs-type">cidsList</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Chainweb.ChainId.html#ChainId"><span class="hs-identifier hs-type">ChainId</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-483"></span><span>    </span><span id="local-6989586621681510721"><span class="annot"><span class="annottext">cidsList :: [ChainId]
</span><a href="#local-6989586621681510721"><span class="hs-identifier hs-var hs-var">cidsList</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashSet ChainId -&gt; [ChainId]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">HashSet ChainId
</span><a href="#local-6989586621681510719"><span class="hs-identifier hs-var">cids</span></a></span><span>
</span><span id="line-484"></span><span>
</span><span id="line-485"></span><span>    </span><span class="annot"><a href="#local-6989586621681510732"><span class="hs-identifier hs-type">payloadDb</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Chainweb.Payload.PayloadStore.Types.html#PayloadDb"><span class="hs-identifier hs-type">PayloadDb</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">RocksDbCas</span></span><span>
</span><span id="line-486"></span><span>    </span><span id="local-6989586621681510732"><span class="annot"><span class="annottext">payloadDb :: PayloadDb RocksDbCas
</span><a href="#local-6989586621681510732"><span class="hs-identifier hs-var hs-var">payloadDb</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RocksDb -&gt; PayloadDb RocksDbCas
</span><a href="Chainweb.Payload.PayloadStore.RocksDB.html#newPayloadDb"><span class="hs-identifier hs-var">newPayloadDb</span></a></span><span> </span><span class="annot"><span class="annottext">RocksDb
</span><a href="#local-6989586621681510739"><span class="hs-identifier hs-var">rocksDb</span></a></span><span>
</span><span id="line-487"></span><span>
</span><span id="line-488"></span><span>    </span><span class="annot"><a href="#local-6989586621681510726"><span class="hs-identifier hs-type">chainLogger</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Chainweb.ChainId.html#ChainId"><span class="hs-identifier hs-type">ChainId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681511282"><span class="hs-identifier hs-type">logger</span></a></span><span>
</span><span id="line-489"></span><span>    </span><span id="local-6989586621681510726"><span class="annot"><span class="annottext">chainLogger :: ChainId -&gt; logger
</span><a href="#local-6989586621681510726"><span class="hs-identifier hs-var hs-var">chainLogger</span></a></span></span><span> </span><span id="local-6989586621681510717"><span class="annot"><span class="annottext">cid :: ChainId
</span><a href="#local-6989586621681510717"><span class="hs-identifier hs-var">cid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Text, Text) -&gt; logger -&gt; logger
forall logger. Logger logger =&gt; (Text, Text) -&gt; logger -&gt; logger
</span><a href="Chainweb.Logger.html#addLabel"><span class="hs-identifier hs-var">addLabel</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;chain&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ChainId -&gt; Text
forall a. HasTextRepresentation a =&gt; a -&gt; Text
</span><a href="Chainweb.Utils.html#toText"><span class="hs-identifier hs-var">toText</span></a></span><span> </span><span class="annot"><span class="annottext">ChainId
</span><a href="#local-6989586621681510717"><span class="hs-identifier hs-var">cid</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">logger
</span><a href="#local-6989586621681510741"><span class="hs-identifier hs-var">logger</span></a></span><span>
</span><span id="line-490"></span><span>
</span><span id="line-491"></span><span>    </span><span class="annot"><a href="#local-6989586621681510714"><span class="hs-identifier hs-type">logg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.LogMessage.html#LogFunctionText"><span class="hs-identifier hs-type">LogFunctionText</span></a></span><span>
</span><span id="line-492"></span><span>    </span><span id="local-6989586621681510714"><span class="annot"><span class="annottext">logg :: LogFunctionText
</span><a href="#local-6989586621681510714"><span class="hs-identifier hs-var hs-var">logg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">logger -&gt; LogFunctionText
forall l. Logger l =&gt; l -&gt; LogFunctionText
</span><a href="Chainweb.Logger.html#logFunctionText"><span class="hs-identifier hs-var">logFunctionText</span></a></span><span> </span><span class="annot"><span class="annottext">logger
</span><a href="#local-6989586621681510741"><span class="hs-identifier hs-var">logger</span></a></span><span>
</span><span id="line-493"></span><span>
</span><span id="line-494"></span><span>    </span><span class="hs-comment">-- Initialize global resources</span><span>
</span><span id="line-495"></span><span>    </span><span class="annot"><a href="#local-6989586621681510723"><span class="hs-identifier hs-type">global</span></a></span><span>
</span><span id="line-496"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HM.HashMap</span></span><span> </span><span class="annot"><a href="Chainweb.ChainId.html#ChainId"><span class="hs-identifier hs-type">ChainId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.Chainweb.ChainResources.html#ChainResources"><span class="hs-identifier hs-type">ChainResources</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681511282"><span class="hs-identifier hs-type">logger</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-497"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MVar</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.CutDB.Types.html#CutDb"><span class="hs-identifier hs-type">CutDb</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">RocksDbCas</span></span><span class="hs-special">)</span><span>
</span><span id="line-498"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621681511281"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-499"></span><span>    </span><span id="local-6989586621681510723"><span class="annot"><span class="annottext">global :: HashMap ChainId (ChainResources logger)
-&gt; MVar (CutDb RocksDbCas) -&gt; IO a
</span><a href="#local-6989586621681510723"><span class="hs-identifier hs-var hs-var">global</span></a></span></span><span> </span><span id="local-6989586621681510712"><span class="annot"><span class="annottext">cs :: HashMap ChainId (ChainResources logger)
</span><a href="#local-6989586621681510712"><span class="hs-identifier hs-var">cs</span></a></span></span><span> </span><span id="local-6989586621681510711"><span class="annot"><span class="annottext">cdbv :: MVar (CutDb RocksDbCas)
</span><a href="#local-6989586621681510711"><span class="hs-identifier hs-var">cdbv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-500"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621681510710"><span class="annot"><span class="annottext">webchain :: WebBlockHeaderDb
</span><a href="#local-6989586621681510710"><span class="hs-identifier hs-var hs-var">webchain</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ChainwebVersion
-&gt; HashMap ChainId BlockHeaderDb -&gt; WebBlockHeaderDb
</span><a href="Chainweb.WebBlockHeaderDB.html#mkWebBlockHeaderDb"><span class="hs-identifier hs-var">mkWebBlockHeaderDb</span></a></span><span> </span><span class="annot"><span class="annottext">ChainwebVersion
</span><a href="#local-6989586621681510733"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ChainResources logger -&gt; BlockHeaderDb)
-&gt; HashMap ChainId (ChainResources logger)
-&gt; HashMap ChainId BlockHeaderDb
forall v1 v2 k. (v1 -&gt; v2) -&gt; HashMap k v1 -&gt; HashMap k v2
</span><span class="hs-identifier hs-var">HM.map</span></span><span> </span><span class="annot"><span class="annottext">ChainResources logger -&gt; BlockHeaderDb
forall logger. ChainResources logger -&gt; BlockHeaderDb
</span><a href="Chainweb.Chainweb.ChainResources.html#_chainResBlockHeaderDb"><span class="hs-identifier hs-var hs-var">_chainResBlockHeaderDb</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap ChainId (ChainResources logger)
</span><a href="#local-6989586621681510712"><span class="hs-identifier hs-var">cs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-501"></span><span>            </span><span class="hs-glyph">!</span><span id="local-6989586621681510706"><span class="annot"><span class="annottext">pact :: WebPactExecutionService
</span><a href="#local-6989586621681510706"><span class="hs-identifier hs-var hs-var">pact</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashMap ChainId PactExecutionService -&gt; WebPactExecutionService
</span><a href="Chainweb.WebPactExecutionService.html#mkWebPactExecutionService"><span class="hs-identifier hs-var">mkWebPactExecutionService</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ChainResources logger -&gt; PactExecutionService)
-&gt; HashMap ChainId (ChainResources logger)
-&gt; HashMap ChainId PactExecutionService
forall v1 v2 k. (v1 -&gt; v2) -&gt; HashMap k v1 -&gt; HashMap k v2
</span><span class="hs-identifier hs-var">HM.map</span></span><span> </span><span class="annot"><span class="annottext">ChainResources logger -&gt; PactExecutionService
forall logger. ChainResources logger -&gt; PactExecutionService
</span><a href="Chainweb.Chainweb.ChainResources.html#_chainResPact"><span class="hs-identifier hs-var hs-var">_chainResPact</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap ChainId (ChainResources logger)
</span><a href="#local-6989586621681510712"><span class="hs-identifier hs-var">cs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-502"></span><span>            </span><span class="hs-glyph">!</span><span id="local-6989586621681510703"><span class="annot"><span class="annottext">cutLogger :: logger
</span><a href="#local-6989586621681510703"><span class="hs-identifier hs-var hs-var">cutLogger</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; logger -&gt; logger
forall logger. Logger logger =&gt; Text -&gt; logger -&gt; logger
</span><a href="Chainweb.Logger.html#setComponent"><span class="hs-identifier hs-var">setComponent</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;cut&quot;</span></span><span> </span><span class="annot"><span class="annottext">logger
</span><a href="#local-6989586621681510741"><span class="hs-identifier hs-var">logger</span></a></span><span>
</span><span id="line-503"></span><span>            </span><span class="hs-glyph">!</span><span id="local-6989586621681510701"><span class="annot"><span class="annottext">mgr :: Manager
</span><a href="#local-6989586621681510701"><span class="hs-identifier hs-var hs-var">mgr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PeerResources logger -&gt; Manager
forall logger. PeerResources logger -&gt; Manager
</span><a href="Chainweb.Chainweb.PeerResources.html#_peerResManager"><span class="hs-identifier hs-var hs-var">_peerResManager</span></a></span><span> </span><span class="annot"><span class="annottext">PeerResources logger
</span><a href="#local-6989586621681510740"><span class="hs-identifier hs-var">peer</span></a></span><span>
</span><span id="line-504"></span><span>
</span><span id="line-505"></span><span>        </span><span class="annot"><span class="annottext">LogFunctionText
</span><a href="#local-6989586621681510714"><span class="hs-identifier hs-var">logg</span></a></span><span> </span><span class="annot"><span class="annottext">LogLevel
</span><span class="hs-identifier hs-var">Info</span></span><span> </span><span class="annot"><span class="hs-string">&quot;start initializing cut resources&quot;</span></span><span>
</span><span id="line-506"></span><span>
</span><span id="line-507"></span><span>        </span><span class="annot"><span class="annottext">CutDbConfig
-&gt; PeerResources logger
-&gt; logger
-&gt; RocksDb
-&gt; WebBlockHeaderDb
-&gt; PayloadDb RocksDbCas
-&gt; Manager
-&gt; WebPactExecutionService
-&gt; (CutResources logger RocksDbCas -&gt; IO a)
-&gt; IO a
forall logger (cas :: * -&gt; *) a.
(Logger logger, PayloadCas cas) =&gt;
CutDbConfig
-&gt; PeerResources logger
-&gt; logger
-&gt; RocksDb
-&gt; WebBlockHeaderDb
-&gt; PayloadDb cas
-&gt; Manager
-&gt; WebPactExecutionService
-&gt; (CutResources logger cas -&gt; IO a)
-&gt; IO a
</span><a href="Chainweb.Chainweb.CutResources.html#withCutResources"><span class="hs-identifier hs-var">withCutResources</span></a></span><span> </span><span class="annot"><span class="annottext">CutDbConfig
</span><a href="#local-6989586621681510697"><span class="hs-identifier hs-var">cutConfig</span></a></span><span> </span><span class="annot"><span class="annottext">PeerResources logger
</span><a href="#local-6989586621681510740"><span class="hs-identifier hs-var">peer</span></a></span><span> </span><span class="annot"><span class="annottext">logger
</span><a href="#local-6989586621681510703"><span class="hs-identifier hs-var">cutLogger</span></a></span><span> </span><span class="annot"><span class="annottext">RocksDb
</span><a href="#local-6989586621681510739"><span class="hs-identifier hs-var">rocksDb</span></a></span><span> </span><span class="annot"><span class="annottext">WebBlockHeaderDb
</span><a href="#local-6989586621681510710"><span class="hs-identifier hs-var">webchain</span></a></span><span> </span><span class="annot"><span class="annottext">PayloadDb RocksDbCas
</span><a href="#local-6989586621681510732"><span class="hs-identifier hs-var">payloadDb</span></a></span><span> </span><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621681510701"><span class="hs-identifier hs-var">mgr</span></a></span><span> </span><span class="annot"><span class="annottext">WebPactExecutionService
</span><a href="#local-6989586621681510706"><span class="hs-identifier hs-var">pact</span></a></span><span> </span><span class="annot"><span class="annottext">((CutResources logger RocksDbCas -&gt; IO a) -&gt; IO a)
-&gt; (CutResources logger RocksDbCas -&gt; IO a) -&gt; IO a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681510696"><span class="annot"><span class="annottext">cuts :: CutResources logger RocksDbCas
</span><a href="#local-6989586621681510696"><span class="hs-identifier hs-var">cuts</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-508"></span><span>            </span><span class="annot"><span class="annottext">LogFunctionText
</span><a href="#local-6989586621681510714"><span class="hs-identifier hs-var">logg</span></a></span><span> </span><span class="annot"><span class="annottext">LogLevel
</span><span class="hs-identifier hs-var">Info</span></span><span> </span><span class="annot"><span class="hs-string">&quot;finished initializing cut resources&quot;</span></span><span>
</span><span id="line-509"></span><span>
</span><span id="line-510"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621681510695"><span class="annot"><span class="annottext">mLogger :: logger
</span><a href="#local-6989586621681510695"><span class="hs-identifier hs-var hs-var">mLogger</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; logger -&gt; logger
forall logger. Logger logger =&gt; Text -&gt; logger -&gt; logger
</span><a href="Chainweb.Logger.html#setComponent"><span class="hs-identifier hs-var">setComponent</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;miner&quot;</span></span><span> </span><span class="annot"><span class="annottext">logger
</span><a href="#local-6989586621681510741"><span class="hs-identifier hs-var">logger</span></a></span><span>
</span><span id="line-511"></span><span>                </span><span class="hs-glyph">!</span><span id="local-6989586621681510694"><span class="annot"><span class="annottext">mConf :: EnableConfig MinerConfig
</span><a href="#local-6989586621681510694"><span class="hs-identifier hs-var hs-var">mConf</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ChainwebConfiguration -&gt; EnableConfig MinerConfig
</span><a href="Chainweb.Chainweb.html#_configMiner"><span class="hs-identifier hs-var hs-var">_configMiner</span></a></span><span> </span><span class="annot"><span class="annottext">ChainwebConfiguration
</span><a href="#local-6989586621681510742"><span class="hs-identifier hs-var">conf</span></a></span><span>
</span><span id="line-512"></span><span>                </span><span class="hs-glyph">!</span><span id="local-6989586621681510693"><span class="annot"><span class="annottext">mCutDb :: CutDb RocksDbCas
</span><a href="#local-6989586621681510693"><span class="hs-identifier hs-var hs-var">mCutDb</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CutResources logger RocksDbCas -&gt; CutDb RocksDbCas
forall logger (cas :: * -&gt; *). CutResources logger cas -&gt; CutDb cas
</span><a href="Chainweb.Chainweb.CutResources.html#_cutResCutDb"><span class="hs-identifier hs-var hs-var">_cutResCutDb</span></a></span><span> </span><span class="annot"><span class="annottext">CutResources logger RocksDbCas
</span><a href="#local-6989586621681510696"><span class="hs-identifier hs-var">cuts</span></a></span><span>
</span><span id="line-513"></span><span>
</span><span id="line-514"></span><span>            </span><span class="hs-comment">-- initialize throttler</span><span>
</span><span id="line-515"></span><span>            </span><span id="local-6989586621681510691"><span class="annot"><span class="annottext">Throttle Address
</span><a href="#local-6989586621681510691"><span class="hs-identifier hs-var">throttler</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ThrottleSettings -&gt; IO (Throttle Address)
</span><span class="hs-identifier hs-var">initThrottler</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TimeSpec -&gt; ThrottleSettings
</span><span class="hs-identifier hs-var">defaultThrottleSettings</span></span><span> </span><span class="annot"><span class="annottext">(TimeSpec -&gt; ThrottleSettings) -&gt; TimeSpec -&gt; ThrottleSettings
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int64 -&gt; Int64 -&gt; TimeSpec
</span><span class="hs-identifier hs-var">TimeSpec</span></span><span> </span><span class="annot"><span class="hs-number">4</span></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-516"></span><span>                </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">throttleSettingsRate :: Double
</span><span class="hs-identifier hs-var">throttleSettingsRate</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="Chainweb.Utils.html#int"><span class="hs-identifier hs-var">int</span></a></span><span> </span><span class="annot"><span class="annottext">(Natural -&gt; Double) -&gt; Natural -&gt; Double
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ChainwebConfiguration -&gt; Natural
</span><a href="Chainweb.Chainweb.html#_configThrottleRate"><span class="hs-identifier hs-var hs-var">_configThrottleRate</span></a></span><span> </span><span class="annot"><span class="annottext">ChainwebConfiguration
</span><a href="#local-6989586621681510742"><span class="hs-identifier hs-var">conf</span></a></span><span>
</span><span id="line-517"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">throttleSettingsPeriod :: Double
</span><span class="hs-identifier hs-var">throttleSettingsPeriod</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="annot"><span class="annottext">Double
forall a. Fractional a =&gt; a
</span><a href="Chainweb.Utils.html#micro"><span class="hs-identifier hs-var">micro</span></a></span><span> </span><span class="hs-comment">-- 1 second (measured in usec)</span><span>
</span><span id="line-518"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">throttleSettingsBurst :: Word64
</span><span class="hs-identifier hs-var">throttleSettingsBurst</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Word64
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="Chainweb.Utils.html#int"><span class="hs-identifier hs-var">int</span></a></span><span> </span><span class="annot"><span class="annottext">(Natural -&gt; Word64) -&gt; Natural -&gt; Word64
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ChainwebConfiguration -&gt; Natural
</span><a href="Chainweb.Chainweb.html#_configThrottleRate"><span class="hs-identifier hs-var hs-var">_configThrottleRate</span></a></span><span> </span><span class="annot"><span class="annottext">ChainwebConfiguration
</span><a href="#local-6989586621681510742"><span class="hs-identifier hs-var">conf</span></a></span><span>
</span><span id="line-519"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">throttleSettingsIsThrottled :: Request -&gt; Bool
</span><a href="#local-6989586621681510681"><span class="hs-identifier hs-var">throttleSettingsIsThrottled</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Request -&gt; Bool
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-520"></span><span>                </span><span class="hs-comment">-- , throttleSettingsIsThrottled = \r -&gt; any (flip elem (pathInfo r))</span><span>
</span><span id="line-521"></span><span>                </span><span class="hs-comment">--     [ &quot;cut&quot;</span><span>
</span><span id="line-522"></span><span>                </span><span class="hs-comment">--     , &quot;header&quot;</span><span>
</span><span id="line-523"></span><span>                </span><span class="hs-comment">--     , &quot;payload&quot;</span><span>
</span><span id="line-524"></span><span>                </span><span class="hs-comment">--     , &quot;mempool&quot;</span><span>
</span><span id="line-525"></span><span>                </span><span class="hs-comment">--     , &quot;peer&quot;</span><span>
</span><span id="line-526"></span><span>                </span><span class="hs-comment">--     ]</span><span>
</span><span id="line-527"></span><span>                </span><span class="hs-special">}</span><span>
</span><span id="line-528"></span><span>
</span><span id="line-529"></span><span>            </span><span class="hs-comment">-- update the cutdb mvar used by pact service with cutdb</span><span>
</span><span id="line-530"></span><span>            </span><span class="annot"><span class="annottext">IO () -&gt; IO ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">MVar (CutDb RocksDbCas) -&gt; CutDb RocksDbCas -&gt; IO ()
forall a. MVar a -&gt; a -&gt; IO ()
</span><span class="hs-identifier hs-var">putMVar</span></span><span> </span><span class="annot"><span class="annottext">MVar (CutDb RocksDbCas)
</span><a href="#local-6989586621681510711"><span class="hs-identifier hs-var">cdbv</span></a></span><span> </span><span class="annot"><span class="annottext">CutDb RocksDbCas
</span><a href="#local-6989586621681510693"><span class="hs-identifier hs-var">mCutDb</span></a></span><span>
</span><span id="line-531"></span><span>
</span><span id="line-532"></span><span>            </span><span class="hs-comment">-- synchronize pact dbs with latest cut before we start the server</span><span>
</span><span id="line-533"></span><span>            </span><span class="hs-comment">-- and clients and begin mining.</span><span>
</span><span id="line-534"></span><span>            </span><span class="hs-comment">--</span><span>
</span><span id="line-535"></span><span>            </span><span class="hs-comment">-- This is a consistency check that validates the blocks in the</span><span>
</span><span id="line-536"></span><span>            </span><span class="hs-comment">-- current cut. If it fails in exception is raised. Also, if it</span><span>
</span><span id="line-537"></span><span>            </span><span class="hs-comment">-- takes long (why would it?) we want this to happen before we go</span><span>
</span><span id="line-538"></span><span>            </span><span class="hs-comment">-- online.</span><span>
</span><span id="line-539"></span><span>            </span><span class="hs-comment">--</span><span>
</span><span id="line-540"></span><span>            </span><span class="annot"><span class="annottext">LogFunctionText
</span><a href="#local-6989586621681510714"><span class="hs-identifier hs-var">logg</span></a></span><span> </span><span class="annot"><span class="annottext">LogLevel
</span><span class="hs-identifier hs-var">Info</span></span><span> </span><span class="annot"><span class="hs-string">&quot;start synchronizing Pact DBs&quot;</span></span><span>
</span><span id="line-541"></span><span>            </span><span class="annot"><span class="annottext">HashMap ChainId (ChainResources logger)
-&gt; CutDb RocksDbCas -&gt; IO ()
forall (cas :: * -&gt; *).
HashMap ChainId (ChainResources logger) -&gt; CutDb cas -&gt; IO ()
</span><a href="#local-6989586621681510678"><span class="hs-identifier hs-var">synchronizePactDb</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap ChainId (ChainResources logger)
</span><a href="#local-6989586621681510712"><span class="hs-identifier hs-var">cs</span></a></span><span> </span><span class="annot"><span class="annottext">CutDb RocksDbCas
</span><a href="#local-6989586621681510693"><span class="hs-identifier hs-var">mCutDb</span></a></span><span>
</span><span id="line-542"></span><span>            </span><span class="annot"><span class="annottext">LogFunctionText
</span><a href="#local-6989586621681510714"><span class="hs-identifier hs-var">logg</span></a></span><span> </span><span class="annot"><span class="annottext">LogLevel
</span><span class="hs-identifier hs-var">Info</span></span><span> </span><span class="annot"><span class="hs-string">&quot;finished synchronizing Pact DBs&quot;</span></span><span>
</span><span id="line-543"></span><span>
</span><span id="line-544"></span><span>            </span><span class="annot"><span class="annottext">HashMap ChainId (ChainResources logger)
-&gt; CutResources logger RocksDbCas
-&gt; ([(ChainId,
      (CutResources logger RocksDbCas, ChainResources logger))]
    -&gt; IO a)
-&gt; IO a
forall (cas :: * -&gt; *) b.
HashMap ChainId (ChainResources logger)
-&gt; CutResources logger cas
-&gt; ([(ChainId, (CutResources logger cas, ChainResources logger))]
    -&gt; IO b)
-&gt; IO b
</span><a href="#local-6989586621681510677"><span class="hs-identifier hs-var">withPactData</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap ChainId (ChainResources logger)
</span><a href="#local-6989586621681510712"><span class="hs-identifier hs-var">cs</span></a></span><span> </span><span class="annot"><span class="annottext">CutResources logger RocksDbCas
</span><a href="#local-6989586621681510696"><span class="hs-identifier hs-var">cuts</span></a></span><span> </span><span class="annot"><span class="annottext">(([(ChainId,
    (CutResources logger RocksDbCas, ChainResources logger))]
  -&gt; IO a)
 -&gt; IO a)
-&gt; ([(ChainId,
      (CutResources logger RocksDbCas, ChainResources logger))]
    -&gt; IO a)
-&gt; IO a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681510676"><span class="annot"><span class="annottext">pactData :: [(ChainId,
  (CutResources logger RocksDbCas, ChainResources logger))]
</span><a href="#local-6989586621681510676"><span class="hs-identifier hs-var">pactData</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-545"></span><span>                </span><span class="annot"><span class="annottext">LogFunctionText
</span><a href="#local-6989586621681510714"><span class="hs-identifier hs-var">logg</span></a></span><span> </span><span class="annot"><span class="annottext">LogLevel
</span><span class="hs-identifier hs-var">Info</span></span><span> </span><span class="annot"><span class="hs-string">&quot;start initializing miner resources&quot;</span></span><span>
</span><span id="line-546"></span><span>                </span><span class="annot"><span class="annottext">logger
-&gt; Bool
-&gt; CutDb RocksDbCas
-&gt; (Maybe (MiningCoordination logger RocksDbCas) -&gt; IO a)
-&gt; IO a
forall logger (cas :: * -&gt; *) a.
Logger logger =&gt;
logger
-&gt; Bool
-&gt; CutDb cas
-&gt; (Maybe (MiningCoordination logger cas) -&gt; IO a)
-&gt; IO a
</span><a href="Chainweb.Chainweb.MinerResources.html#withMiningCoordination"><span class="hs-identifier hs-var">withMiningCoordination</span></a></span><span> </span><span class="annot"><span class="annottext">logger
</span><a href="#local-6989586621681510695"><span class="hs-identifier hs-var">mLogger</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ChainwebConfiguration -&gt; Bool
</span><a href="Chainweb.Chainweb.html#_configCoordinator"><span class="hs-identifier hs-var hs-var">_configCoordinator</span></a></span><span> </span><span class="annot"><span class="annottext">ChainwebConfiguration
</span><a href="#local-6989586621681510742"><span class="hs-identifier hs-var">conf</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CutDb RocksDbCas
</span><a href="#local-6989586621681510693"><span class="hs-identifier hs-var">mCutDb</span></a></span><span> </span><span class="annot"><span class="annottext">((Maybe (MiningCoordination logger RocksDbCas) -&gt; IO a) -&gt; IO a)
-&gt; (Maybe (MiningCoordination logger RocksDbCas) -&gt; IO a) -&gt; IO a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681510674"><span class="annot"><span class="annottext">mc :: Maybe (MiningCoordination logger RocksDbCas)
</span><a href="#local-6989586621681510674"><span class="hs-identifier hs-var">mc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-547"></span><span>                    </span><span class="annot"><span class="annottext">logger
-&gt; EnableConfig MinerConfig
-&gt; CutDb RocksDbCas
-&gt; (Maybe (MinerResources logger RocksDbCas) -&gt; IO a)
-&gt; IO a
forall logger (cas :: * -&gt; *) a.
logger
-&gt; EnableConfig MinerConfig
-&gt; CutDb cas
-&gt; (Maybe (MinerResources logger cas) -&gt; IO a)
-&gt; IO a
</span><a href="Chainweb.Chainweb.MinerResources.html#withMinerResources"><span class="hs-identifier hs-var">withMinerResources</span></a></span><span> </span><span class="annot"><span class="annottext">logger
</span><a href="#local-6989586621681510695"><span class="hs-identifier hs-var">mLogger</span></a></span><span> </span><span class="annot"><span class="annottext">EnableConfig MinerConfig
</span><a href="#local-6989586621681510694"><span class="hs-identifier hs-var">mConf</span></a></span><span> </span><span class="annot"><span class="annottext">CutDb RocksDbCas
</span><a href="#local-6989586621681510693"><span class="hs-identifier hs-var">mCutDb</span></a></span><span> </span><span class="annot"><span class="annottext">((Maybe (MinerResources logger RocksDbCas) -&gt; IO a) -&gt; IO a)
-&gt; (Maybe (MinerResources logger RocksDbCas) -&gt; IO a) -&gt; IO a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681510672"><span class="annot"><span class="annottext">m :: Maybe (MinerResources logger RocksDbCas)
</span><a href="#local-6989586621681510672"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-548"></span><span>                        </span><span class="annot"><span class="annottext">LogFunctionText
</span><a href="#local-6989586621681510714"><span class="hs-identifier hs-var">logg</span></a></span><span> </span><span class="annot"><span class="annottext">LogLevel
</span><span class="hs-identifier hs-var">Info</span></span><span> </span><span class="annot"><span class="hs-string">&quot;finished initializing miner resources&quot;</span></span><span>
</span><span id="line-549"></span><span>                        </span><span class="annot"><span class="annottext">Chainweb logger RocksDbCas -&gt; IO a
</span><a href="#local-6989586621681510735"><span class="hs-identifier hs-var">inner</span></a></span><span> </span><span class="annot"><span class="annottext">$WChainweb :: forall logger (cas :: * -&gt; *).
HostAddress
-&gt; HashMap ChainId (ChainResources logger)
-&gt; CutResources logger cas
-&gt; Maybe (MinerResources logger cas)
-&gt; Maybe (MiningCoordination logger cas)
-&gt; HeaderStream
-&gt; logger
-&gt; PeerResources logger
-&gt; PayloadDb cas
-&gt; Manager
-&gt; [(ChainId, PactServerData logger cas)]
-&gt; Throttle Address
-&gt; ChainwebConfiguration
-&gt; Chainweb logger cas
</span><a href="Chainweb.Chainweb.html#%24WChainweb"><span class="hs-identifier hs-type hs-type">Chainweb</span></a></span><span>
</span><span id="line-550"></span><span>                            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">_chainwebHostAddress :: HostAddress
</span><a href="Chainweb.Chainweb.html#_chainwebHostAddress"><span class="hs-identifier hs-var">_chainwebHostAddress</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PeerConfig -&gt; HostAddress
</span><a href="P2P.Peer.html#_peerConfigAddr"><span class="hs-identifier hs-var hs-var">_peerConfigAddr</span></a></span><span> </span><span class="annot"><span class="annottext">(PeerConfig -&gt; HostAddress) -&gt; PeerConfig -&gt; HostAddress
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">P2pConfiguration -&gt; PeerConfig
</span><a href="P2P.Node.Configuration.html#_p2pConfigPeer"><span class="hs-identifier hs-var hs-var">_p2pConfigPeer</span></a></span><span> </span><span class="annot"><span class="annottext">(P2pConfiguration -&gt; PeerConfig) -&gt; P2pConfiguration -&gt; PeerConfig
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ChainwebConfiguration -&gt; P2pConfiguration
</span><a href="Chainweb.Chainweb.html#_configP2p"><span class="hs-identifier hs-var hs-var">_configP2p</span></a></span><span> </span><span class="annot"><span class="annottext">ChainwebConfiguration
</span><a href="#local-6989586621681510742"><span class="hs-identifier hs-var">conf</span></a></span><span>
</span><span id="line-551"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_chainwebChains :: HashMap ChainId (ChainResources logger)
</span><a href="Chainweb.Chainweb.html#_chainwebChains"><span class="hs-identifier hs-var">_chainwebChains</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashMap ChainId (ChainResources logger)
</span><a href="#local-6989586621681510712"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-552"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_chainwebCutResources :: CutResources logger RocksDbCas
</span><a href="Chainweb.Chainweb.html#_chainwebCutResources"><span class="hs-identifier hs-var">_chainwebCutResources</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CutResources logger RocksDbCas
</span><a href="#local-6989586621681510696"><span class="hs-identifier hs-var">cuts</span></a></span><span>
</span><span id="line-553"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_chainwebMiner :: Maybe (MinerResources logger RocksDbCas)
</span><a href="Chainweb.Chainweb.html#_chainwebMiner"><span class="hs-identifier hs-var">_chainwebMiner</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (MinerResources logger RocksDbCas)
</span><a href="#local-6989586621681510672"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-554"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_chainwebCoordinator :: Maybe (MiningCoordination logger RocksDbCas)
</span><a href="Chainweb.Chainweb.html#_chainwebCoordinator"><span class="hs-identifier hs-var">_chainwebCoordinator</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (MiningCoordination logger RocksDbCas)
</span><a href="#local-6989586621681510674"><span class="hs-identifier hs-var">mc</span></a></span><span>
</span><span id="line-555"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_chainwebHeaderStream :: HeaderStream
</span><a href="Chainweb.Chainweb.html#_chainwebHeaderStream"><span class="hs-identifier hs-var">_chainwebHeaderStream</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; HeaderStream
</span><a href="Chainweb.BlockHeaderDB.RestAPI.html#HeaderStream"><span class="hs-identifier hs-var">HeaderStream</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; HeaderStream) -&gt; Bool -&gt; HeaderStream
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ChainwebConfiguration -&gt; Bool
</span><a href="Chainweb.Chainweb.html#_configHeaderStream"><span class="hs-identifier hs-var hs-var">_configHeaderStream</span></a></span><span> </span><span class="annot"><span class="annottext">ChainwebConfiguration
</span><a href="#local-6989586621681510742"><span class="hs-identifier hs-var">conf</span></a></span><span>
</span><span id="line-556"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_chainwebLogger :: logger
</span><a href="Chainweb.Chainweb.html#_chainwebLogger"><span class="hs-identifier hs-var">_chainwebLogger</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">logger
</span><a href="#local-6989586621681510741"><span class="hs-identifier hs-var">logger</span></a></span><span>
</span><span id="line-557"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_chainwebPeer :: PeerResources logger
</span><a href="Chainweb.Chainweb.html#_chainwebPeer"><span class="hs-identifier hs-var">_chainwebPeer</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PeerResources logger
</span><a href="#local-6989586621681510740"><span class="hs-identifier hs-var">peer</span></a></span><span>
</span><span id="line-558"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_chainwebPayloadDb :: PayloadDb RocksDbCas
</span><a href="Chainweb.Chainweb.html#_chainwebPayloadDb"><span class="hs-identifier hs-var">_chainwebPayloadDb</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PayloadDb RocksDbCas
</span><a href="#local-6989586621681510732"><span class="hs-identifier hs-var">payloadDb</span></a></span><span>
</span><span id="line-559"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_chainwebManager :: Manager
</span><a href="Chainweb.Chainweb.html#_chainwebManager"><span class="hs-identifier hs-var">_chainwebManager</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621681510701"><span class="hs-identifier hs-var">mgr</span></a></span><span>
</span><span id="line-560"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_chainwebPactData :: [(ChainId,
  (CutResources logger RocksDbCas, ChainResources logger))]
</span><a href="Chainweb.Chainweb.html#_chainwebPactData"><span class="hs-identifier hs-var">_chainwebPactData</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(ChainId,
  (CutResources logger RocksDbCas, ChainResources logger))]
</span><a href="#local-6989586621681510676"><span class="hs-identifier hs-var">pactData</span></a></span><span>
</span><span id="line-561"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_chainwebThrottler :: Throttle Address
</span><a href="Chainweb.Chainweb.html#_chainwebThrottler"><span class="hs-identifier hs-var">_chainwebThrottler</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Throttle Address
</span><a href="#local-6989586621681510691"><span class="hs-identifier hs-var">throttler</span></a></span><span>
</span><span id="line-562"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_chainwebConfig :: ChainwebConfiguration
</span><a href="Chainweb.Chainweb.html#_chainwebConfig"><span class="hs-identifier hs-var">_chainwebConfig</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ChainwebConfiguration
</span><a href="#local-6989586621681510742"><span class="hs-identifier hs-var">conf</span></a></span><span>
</span><span id="line-563"></span><span>                            </span><span class="hs-special">}</span><span>
</span><span id="line-564"></span><span>
</span><span id="line-565"></span><span>    </span><span id="local-6989586621681511140"><span id="local-6989586621681511141"><span class="annot"><a href="#local-6989586621681510677"><span class="hs-identifier hs-type">withPactData</span></a></span><span>
</span><span id="line-566"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HM.HashMap</span></span><span> </span><span class="annot"><a href="Chainweb.ChainId.html#ChainId"><span class="hs-identifier hs-type">ChainId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.Chainweb.ChainResources.html#ChainResources"><span class="hs-identifier hs-type">ChainResources</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681511282"><span class="hs-identifier hs-type">logger</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-567"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Chainweb.Chainweb.CutResources.html#CutResources"><span class="hs-identifier hs-type">CutResources</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681511282"><span class="hs-identifier hs-type">logger</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681511141"><span class="hs-identifier hs-type">cas</span></a></span><span>
</span><span id="line-568"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.ChainId.html#ChainId"><span class="hs-identifier hs-type">ChainId</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.Chainweb.CutResources.html#CutResources"><span class="hs-identifier hs-type">CutResources</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681511282"><span class="hs-identifier hs-type">logger</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681511141"><span class="hs-identifier hs-type">cas</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.Chainweb.ChainResources.html#ChainResources"><span class="hs-identifier hs-type">ChainResources</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681511282"><span class="hs-identifier hs-type">logger</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621681511140"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-569"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621681511140"><span class="hs-identifier hs-type">b</span></a></span></span></span><span>
</span><span id="line-570"></span><span>    </span><span id="local-6989586621681510677"><span class="annot"><span class="annottext">withPactData :: HashMap ChainId (ChainResources logger)
-&gt; CutResources logger cas
-&gt; ([(ChainId, (CutResources logger cas, ChainResources logger))]
    -&gt; IO b)
-&gt; IO b
</span><a href="#local-6989586621681510677"><span class="hs-identifier hs-var hs-var">withPactData</span></a></span></span><span> </span><span id="local-6989586621681510667"><span class="annot"><span class="annottext">cs :: HashMap ChainId (ChainResources logger)
</span><a href="#local-6989586621681510667"><span class="hs-identifier hs-var">cs</span></a></span></span><span> </span><span id="local-6989586621681510666"><span class="annot"><span class="annottext">cuts :: CutResources logger cas
</span><a href="#local-6989586621681510666"><span class="hs-identifier hs-var">cuts</span></a></span></span><span> </span><span id="local-6989586621681510665"><span class="annot"><span class="annottext">m :: [(ChainId, (CutResources logger cas, ChainResources logger))]
-&gt; IO b
</span><a href="#local-6989586621681510665"><span class="hs-identifier hs-var">m</span></a></span></span><span>
</span><span id="line-571"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">EnableConfig TransactionIndexConfig -&gt; Bool
forall a. EnableConfig a -&gt; Bool
</span><a href="Chainweb.Utils.html#_enableConfigEnabled"><span class="hs-identifier hs-var hs-var">_enableConfigEnabled</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ChainwebConfiguration -&gt; EnableConfig TransactionIndexConfig
</span><a href="Chainweb.Chainweb.html#_configTransactionIndex"><span class="hs-identifier hs-var hs-var">_configTransactionIndex</span></a></span><span> </span><span class="annot"><span class="annottext">ChainwebConfiguration
</span><a href="#local-6989586621681510742"><span class="hs-identifier hs-var">conf</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-572"></span><span>              </span><span class="hs-comment">-- TODO: delete this knob</span><span>
</span><span id="line-573"></span><span>              </span><span class="annot"><span class="annottext">LogFunctionText
</span><a href="#local-6989586621681510714"><span class="hs-identifier hs-var">logg</span></a></span><span> </span><span class="annot"><span class="annottext">LogLevel
</span><span class="hs-identifier hs-var">Info</span></span><span> </span><span class="annot"><span class="hs-string">&quot;Transaction index enabled&quot;</span></span><span>
</span><span id="line-574"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681510663"><span class="annot"><span class="annottext">l :: [(ChainId, ChainResources logger)]
</span><a href="#local-6989586621681510663"><span class="hs-identifier hs-var hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((ChainId, ChainResources logger)
 -&gt; (ChainId, ChainResources logger) -&gt; Ordering)
-&gt; [(ChainId, ChainResources logger)]
-&gt; [(ChainId, ChainResources logger)]
forall a. (a -&gt; a -&gt; Ordering) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">sortBy</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ChainId -&gt; ChainId -&gt; Ordering
forall a. Ord a =&gt; a -&gt; a -&gt; Ordering
</span><span class="hs-identifier hs-var">compare</span></span><span> </span><span class="annot"><span class="annottext">(ChainId -&gt; ChainId -&gt; Ordering)
-&gt; ((ChainId, ChainResources logger) -&gt; ChainId)
-&gt; (ChainId, ChainResources logger)
-&gt; (ChainId, ChainResources logger)
-&gt; Ordering
forall b c a. (b -&gt; b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; a -&gt; c
</span><span class="hs-operator hs-var">`on`</span></span><span> </span><span class="annot"><span class="annottext">(ChainId, ChainResources logger) -&gt; ChainId
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashMap ChainId (ChainResources logger)
-&gt; [(ChainId, ChainResources logger)]
forall k v. HashMap k v -&gt; [(k, v)]
</span><span class="hs-identifier hs-var">HM.toList</span></span><span> </span><span class="annot"><span class="annottext">HashMap ChainId (ChainResources logger)
</span><a href="#local-6989586621681510667"><span class="hs-identifier hs-var">cs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-575"></span><span>              </span><span class="annot"><span class="annottext">[(ChainId, (CutResources logger cas, ChainResources logger))]
-&gt; IO b
</span><a href="#local-6989586621681510665"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">([(ChainId, (CutResources logger cas, ChainResources logger))]
 -&gt; IO b)
-&gt; [(ChainId, (CutResources logger cas, ChainResources logger))]
-&gt; IO b
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((ChainId, ChainResources logger)
 -&gt; (ChainId, (CutResources logger cas, ChainResources logger)))
-&gt; [(ChainId, ChainResources logger)]
-&gt; [(ChainId, (CutResources logger cas, ChainResources logger))]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621681510660"><span class="annot"><span class="annottext">c :: ChainId
</span><a href="#local-6989586621681510660"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681510659"><span class="annot"><span class="annottext">cr :: ChainResources logger
</span><a href="#local-6989586621681510659"><span class="hs-identifier hs-var">cr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ChainId
</span><a href="#local-6989586621681510660"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CutResources logger cas
</span><a href="#local-6989586621681510666"><span class="hs-identifier hs-var">cuts</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ChainResources logger
</span><a href="#local-6989586621681510659"><span class="hs-identifier hs-var">cr</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(ChainId, ChainResources logger)]
</span><a href="#local-6989586621681510663"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-576"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-577"></span><span>              </span><span class="annot"><span class="annottext">LogFunctionText
</span><a href="#local-6989586621681510714"><span class="hs-identifier hs-var">logg</span></a></span><span> </span><span class="annot"><span class="annottext">LogLevel
</span><span class="hs-identifier hs-var">Info</span></span><span> </span><span class="annot"><span class="hs-string">&quot;Transaction index disabled&quot;</span></span><span>
</span><span id="line-578"></span><span>              </span><span class="annot"><span class="annottext">[(ChainId, (CutResources logger cas, ChainResources logger))]
-&gt; IO b
</span><a href="#local-6989586621681510665"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-579"></span><span>
</span><span id="line-580"></span><span>    </span><span id="local-6989586621681510733"><span class="annot"><span class="annottext">v :: ChainwebVersion
</span><a href="#local-6989586621681510733"><span class="hs-identifier hs-var hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ChainwebConfiguration -&gt; ChainwebVersion
</span><a href="Chainweb.Chainweb.html#_configChainwebVersion"><span class="hs-identifier hs-var hs-var">_configChainwebVersion</span></a></span><span> </span><span class="annot"><span class="annottext">ChainwebConfiguration
</span><a href="#local-6989586621681510742"><span class="hs-identifier hs-var">conf</span></a></span><span>
</span><span id="line-581"></span><span>    </span><span id="local-6989586621681510719"><span class="annot"><span class="annottext">cids :: HashSet ChainId
</span><a href="#local-6989586621681510719"><span class="hs-identifier hs-var hs-var">cids</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ChainwebVersion -&gt; HashSet ChainId
forall v. HasChainwebVersion v =&gt; v -&gt; HashSet ChainId
</span><a href="Chainweb.Version.html#chainIds"><span class="hs-identifier hs-var">chainIds</span></a></span><span> </span><span class="annot"><span class="annottext">ChainwebVersion
</span><a href="#local-6989586621681510733"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-582"></span><span>
</span><span id="line-583"></span><span>    </span><span class="hs-comment">-- FIXME: make this configurable</span><span>
</span><span id="line-584"></span><span>    </span><span class="annot"><a href="#local-6989586621681510697"><span class="hs-identifier hs-type">cutConfig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Chainweb.CutDB.html#CutDbConfig"><span class="hs-identifier hs-type">CutDbConfig</span></a></span><span>
</span><span id="line-585"></span><span>    </span><span id="local-6989586621681510697"><span class="annot"><span class="annottext">cutConfig :: CutDbConfig
</span><a href="#local-6989586621681510697"><span class="hs-identifier hs-var hs-var">cutConfig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ChainwebVersion -&gt; CutDbConfig
</span><a href="Chainweb.CutDB.html#defaultCutDbConfig"><span class="hs-identifier hs-var">defaultCutDbConfig</span></a></span><span> </span><span class="annot"><span class="annottext">ChainwebVersion
</span><a href="#local-6989586621681510733"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-586"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">_cutDbConfigLogLevel :: LogLevel
</span><a href="Chainweb.CutDB.html#_cutDbConfigLogLevel"><span class="hs-identifier hs-var">_cutDbConfigLogLevel</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LogLevel
</span><span class="hs-identifier hs-var">Info</span></span><span>
</span><span id="line-587"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_cutDbConfigTelemetryLevel :: LogLevel
</span><a href="Chainweb.CutDB.html#_cutDbConfigTelemetryLevel"><span class="hs-identifier hs-var">_cutDbConfigTelemetryLevel</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LogLevel
</span><span class="hs-identifier hs-var">Info</span></span><span>
</span><span id="line-588"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_cutDbConfigUseOrigin :: Bool
</span><a href="Chainweb.CutDB.html#_cutDbConfigUseOrigin"><span class="hs-identifier hs-var">_cutDbConfigUseOrigin</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ChainwebConfiguration -&gt; Bool
</span><a href="Chainweb.Chainweb.html#_configIncludeOrigin"><span class="hs-identifier hs-var hs-var">_configIncludeOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">ChainwebConfiguration
</span><a href="#local-6989586621681510742"><span class="hs-identifier hs-var">conf</span></a></span><span>
</span><span id="line-589"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-590"></span><span>
</span><span id="line-591"></span><span>    </span><span id="local-6989586621681511142"><span class="annot"><a href="#local-6989586621681510678"><span class="hs-identifier hs-type">synchronizePactDb</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HM.HashMap</span></span><span> </span><span class="annot"><a href="Chainweb.ChainId.html#ChainId"><span class="hs-identifier hs-type">ChainId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.Chainweb.ChainResources.html#ChainResources"><span class="hs-identifier hs-type">ChainResources</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681511282"><span class="hs-identifier hs-type">logger</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Chainweb.CutDB.Types.html#CutDb"><span class="hs-identifier hs-type">CutDb</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681511142"><span class="hs-identifier hs-type">cas</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-592"></span><span>    </span><span id="local-6989586621681510678"><span class="annot"><span class="annottext">synchronizePactDb :: HashMap ChainId (ChainResources logger) -&gt; CutDb cas -&gt; IO ()
</span><a href="#local-6989586621681510678"><span class="hs-identifier hs-var hs-var">synchronizePactDb</span></a></span></span><span> </span><span id="local-6989586621681510653"><span class="annot"><span class="annottext">cs :: HashMap ChainId (ChainResources logger)
</span><a href="#local-6989586621681510653"><span class="hs-identifier hs-var">cs</span></a></span></span><span> </span><span id="local-6989586621681510652"><span class="annot"><span class="annottext">cutDb :: CutDb cas
</span><a href="#local-6989586621681510652"><span class="hs-identifier hs-var">cutDb</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-593"></span><span>        </span><span id="local-6989586621681510651"><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681510651"><span class="hs-identifier hs-var">currentCut</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CutDb cas -&gt; IO Cut
forall (cas :: * -&gt; *). CutDb cas -&gt; IO Cut
</span><a href="Chainweb.CutDB.html#_cut"><span class="hs-identifier hs-var">_cut</span></a></span><span> </span><span class="annot"><span class="annottext">CutDb cas
</span><a href="#local-6989586621681510652"><span class="hs-identifier hs-var">cutDb</span></a></span><span>
</span><span id="line-594"></span><span>        </span><span class="annot"><span class="annottext">((BlockHeader, ChainResources logger) -&gt; IO ())
-&gt; [(BlockHeader, ChainResources logger)] -&gt; IO ()
forall (f :: * -&gt; *) a b. Foldable f =&gt; (a -&gt; IO b) -&gt; f a -&gt; IO ()
</span><span class="hs-identifier hs-var">mapConcurrently_</span></span><span> </span><span class="annot"><span class="annottext">(BlockHeader, ChainResources logger) -&gt; IO ()
</span><a href="#local-6989586621681510648"><span class="hs-identifier hs-var">syncOne</span></a></span><span> </span><span class="annot"><span class="annottext">([(BlockHeader, ChainResources logger)] -&gt; IO ())
-&gt; [(BlockHeader, ChainResources logger)] -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HashMap ChainId BlockHeader
-&gt; [(BlockHeader, ChainResources logger)]
forall b. HashMap ChainId b -&gt; [(b, ChainResources logger)]
</span><a href="#local-6989586621681510647"><span class="hs-identifier hs-var">mergeCutResources</span></a></span><span> </span><span class="annot"><span class="annottext">(HashMap ChainId BlockHeader
 -&gt; [(BlockHeader, ChainResources logger)])
-&gt; HashMap ChainId BlockHeader
-&gt; [(BlockHeader, ChainResources logger)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Cut -&gt; HashMap ChainId BlockHeader
</span><a href="Chainweb.Cut.html#_cutMap"><span class="hs-identifier hs-var">_cutMap</span></a></span><span> </span><span class="annot"><span class="annottext">Cut
</span><a href="#local-6989586621681510651"><span class="hs-identifier hs-var">currentCut</span></a></span><span>
</span><span id="line-595"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-596"></span><span>        </span><span id="local-6989586621681511113"><span class="annot"><a href="#local-6989586621681510647"><span class="hs-identifier hs-type">mergeCutResources</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HM.HashMap</span></span><span> </span><span class="annot"><a href="Chainweb.ChainId.html#ChainId"><span class="hs-identifier hs-type">ChainId</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681511113"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681511113"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.Chainweb.ChainResources.html#ChainResources"><span class="hs-identifier hs-type">ChainResources</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681511282"><span class="hs-identifier hs-type">logger</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span></span><span>
</span><span id="line-597"></span><span>        </span><span id="local-6989586621681510647"><span class="annot"><span class="annottext">mergeCutResources :: HashMap ChainId b -&gt; [(b, ChainResources logger)]
</span><a href="#local-6989586621681510647"><span class="hs-identifier hs-var hs-var">mergeCutResources</span></a></span></span><span> </span><span id="local-6989586621681510645"><span class="annot"><span class="annottext">c :: HashMap ChainId b
</span><a href="#local-6989586621681510645"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-598"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681510644"><span class="annot"><span class="annottext">f :: ChainId -&gt; b -&gt; (b, ChainResources logger)
</span><a href="#local-6989586621681510644"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span id="local-6989586621681510643"><span class="annot"><span class="annottext">cid :: ChainId
</span><a href="#local-6989586621681510643"><span class="hs-identifier hs-var">cid</span></a></span></span><span> </span><span id="local-6989586621681510642"><span class="annot"><span class="annottext">bh :: b
</span><a href="#local-6989586621681510642"><span class="hs-identifier hs-var">bh</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621681510642"><span class="hs-identifier hs-var">bh</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe (ChainResources logger) -&gt; ChainResources logger
forall a. HasCallStack =&gt; Maybe a -&gt; a
</span><a href="Chainweb.Utils.html#fromJuste"><span class="hs-identifier hs-var">fromJuste</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe (ChainResources logger) -&gt; ChainResources logger)
-&gt; Maybe (ChainResources logger) -&gt; ChainResources logger
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ChainId
-&gt; HashMap ChainId (ChainResources logger)
-&gt; Maybe (ChainResources logger)
forall k v. (Eq k, Hashable k) =&gt; k -&gt; HashMap k v -&gt; Maybe v
</span><span class="hs-identifier hs-var">HM.lookup</span></span><span> </span><span class="annot"><span class="annottext">ChainId
</span><a href="#local-6989586621681510643"><span class="hs-identifier hs-var">cid</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap ChainId (ChainResources logger)
</span><a href="#local-6989586621681510653"><span class="hs-identifier hs-var">cs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-599"></span><span>            </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">((ChainId, (b, ChainResources logger))
 -&gt; (b, ChainResources logger))
-&gt; [(ChainId, (b, ChainResources logger))]
-&gt; [(b, ChainResources logger)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(ChainId, (b, ChainResources logger)) -&gt; (b, ChainResources logger)
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">([(ChainId, (b, ChainResources logger))]
 -&gt; [(b, ChainResources logger)])
-&gt; [(ChainId, (b, ChainResources logger))]
-&gt; [(b, ChainResources logger)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HashMap ChainId (b, ChainResources logger)
-&gt; [(ChainId, (b, ChainResources logger))]
forall k v. HashMap k v -&gt; [(k, v)]
</span><span class="hs-identifier hs-var">HM.toList</span></span><span> </span><span class="annot"><span class="annottext">(HashMap ChainId (b, ChainResources logger)
 -&gt; [(ChainId, (b, ChainResources logger))])
-&gt; HashMap ChainId (b, ChainResources logger)
-&gt; [(ChainId, (b, ChainResources logger))]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(ChainId -&gt; b -&gt; (b, ChainResources logger))
-&gt; HashMap ChainId b -&gt; HashMap ChainId (b, ChainResources logger)
forall k v1 v2. (k -&gt; v1 -&gt; v2) -&gt; HashMap k v1 -&gt; HashMap k v2
</span><span class="hs-identifier hs-var">HM.mapWithKey</span></span><span> </span><span class="annot"><span class="annottext">ChainId -&gt; b -&gt; (b, ChainResources logger)
</span><a href="#local-6989586621681510644"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap ChainId b
</span><a href="#local-6989586621681510645"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-600"></span><span>
</span><span id="line-601"></span><span>        </span><span class="annot"><a href="#local-6989586621681510648"><span class="hs-identifier hs-type">syncOne</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.BlockHeader.html#BlockHeader"><span class="hs-identifier hs-type">BlockHeader</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.Chainweb.ChainResources.html#ChainResources"><span class="hs-identifier hs-type">ChainResources</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681511282"><span class="hs-identifier hs-type">logger</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-602"></span><span>        </span><span id="local-6989586621681510648"><span class="annot"><span class="annottext">syncOne :: (BlockHeader, ChainResources logger) -&gt; IO ()
</span><a href="#local-6989586621681510648"><span class="hs-identifier hs-var hs-var">syncOne</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681510638"><span class="annot"><span class="annottext">bh :: BlockHeader
</span><a href="#local-6989586621681510638"><span class="hs-identifier hs-var">bh</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681510637"><span class="annot"><span class="annottext">cr :: ChainResources logger
</span><a href="#local-6989586621681510637"><span class="hs-identifier hs-var">cr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-603"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681510636"><span class="annot"><span class="annottext">pact :: PactExecutionService
</span><a href="#local-6989586621681510636"><span class="hs-identifier hs-var hs-var">pact</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ChainResources logger -&gt; PactExecutionService
forall logger. ChainResources logger -&gt; PactExecutionService
</span><a href="Chainweb.Chainweb.ChainResources.html#_chainResPact"><span class="hs-identifier hs-var hs-var">_chainResPact</span></a></span><span> </span><span class="annot"><span class="annottext">ChainResources logger
</span><a href="#local-6989586621681510637"><span class="hs-identifier hs-var">cr</span></a></span><span>
</span><span id="line-604"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681510635"><span class="annot"><span class="annottext">logCr :: LogFunctionText
</span><a href="#local-6989586621681510635"><span class="hs-identifier hs-var hs-var">logCr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">logger -&gt; LogFunctionText
forall l. Logger l =&gt; l -&gt; LogFunctionText
</span><a href="Chainweb.Logger.html#logFunctionText"><span class="hs-identifier hs-var">logFunctionText</span></a></span><span> </span><span class="annot"><span class="annottext">(logger -&gt; LogFunctionText) -&gt; logger -&gt; LogFunctionText
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ChainResources logger -&gt; logger
forall logger. ChainResources logger -&gt; logger
</span><a href="Chainweb.Chainweb.ChainResources.html#_chainResLogger"><span class="hs-identifier hs-var hs-var">_chainResLogger</span></a></span><span> </span><span class="annot"><span class="annottext">ChainResources logger
</span><a href="#local-6989586621681510637"><span class="hs-identifier hs-var">cr</span></a></span><span>
</span><span id="line-605"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681510633"><span class="annot"><span class="annottext">hsh :: BlockHash
</span><a href="#local-6989586621681510633"><span class="hs-identifier hs-var hs-var">hsh</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BlockHeader -&gt; BlockHash
</span><a href="Chainweb.BlockHeader.html#_blockHash"><span class="hs-identifier hs-var hs-var">_blockHash</span></a></span><span> </span><span class="annot"><span class="annottext">BlockHeader
</span><a href="#local-6989586621681510638"><span class="hs-identifier hs-var">bh</span></a></span><span>
</span><span id="line-606"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681510631"><span class="annot"><span class="annottext">h :: BlockHeight
</span><a href="#local-6989586621681510631"><span class="hs-identifier hs-var hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BlockHeader -&gt; BlockHeight
</span><a href="Chainweb.BlockHeader.html#_blockHeight"><span class="hs-identifier hs-var hs-var">_blockHeight</span></a></span><span> </span><span class="annot"><span class="annottext">BlockHeader
</span><a href="#local-6989586621681510638"><span class="hs-identifier hs-var">bh</span></a></span><span>
</span><span id="line-607"></span><span>            </span><span class="annot"><span class="annottext">LogFunctionText
</span><a href="#local-6989586621681510635"><span class="hs-identifier hs-var">logCr</span></a></span><span> </span><span class="annot"><span class="annottext">LogLevel
</span><span class="hs-identifier hs-var">Info</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; IO ()) -&gt; Text -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;pact db synchronizing to block &quot;</span></span><span>
</span><span id="line-608"></span><span>                      </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(BlockHeight, BlockHash) -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BlockHeight
</span><a href="#local-6989586621681510631"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">BlockHash
</span><a href="#local-6989586621681510633"><span class="hs-identifier hs-var">hsh</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-609"></span><span>            </span><span id="local-6989586621681510627"><span class="annot"><span class="annottext">PayloadData
</span><a href="#local-6989586621681510627"><span class="hs-identifier hs-var">payload</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PayloadWithOutputs -&gt; PayloadData
</span><a href="Chainweb.Payload.html#payloadWithOutputsToPayloadData"><span class="hs-identifier hs-var">payloadWithOutputsToPayloadData</span></a></span><span>
</span><span id="line-610"></span><span>                       </span><span class="annot"><span class="annottext">(PayloadWithOutputs -&gt; PayloadData)
-&gt; IO PayloadWithOutputs -&gt; IO PayloadData
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">PayloadDb RocksDbCas
-&gt; CasKeyType (CasValueType (PayloadDb RocksDbCas))
-&gt; IO (CasValueType (PayloadDb RocksDbCas))
forall a.
IsCas a =&gt;
a -&gt; CasKeyType (CasValueType a) -&gt; IO (CasValueType a)
</span><span class="hs-identifier hs-var">casLookupM</span></span><span> </span><span class="annot"><span class="annottext">PayloadDb RocksDbCas
</span><a href="#local-6989586621681510732"><span class="hs-identifier hs-var">payloadDb</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BlockHeader -&gt; BlockPayloadHash
</span><a href="Chainweb.BlockHeader.html#_blockPayloadHash"><span class="hs-identifier hs-var hs-var">_blockPayloadHash</span></a></span><span> </span><span class="annot"><span class="annottext">BlockHeader
</span><a href="#local-6989586621681510638"><span class="hs-identifier hs-var">bh</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-611"></span><span>            </span><span class="annot"><span class="annottext">IO PayloadWithOutputs -&gt; IO ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span> </span><span class="annot"><span class="annottext">(IO PayloadWithOutputs -&gt; IO ()) -&gt; IO PayloadWithOutputs -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PactExecutionService
-&gt; BlockHeader -&gt; PayloadData -&gt; IO PayloadWithOutputs
</span><a href="Chainweb.WebPactExecutionService.Types.html#_pactValidateBlock"><span class="hs-identifier hs-var hs-var">_pactValidateBlock</span></a></span><span> </span><span class="annot"><span class="annottext">PactExecutionService
</span><a href="#local-6989586621681510636"><span class="hs-identifier hs-var">pact</span></a></span><span> </span><span class="annot"><span class="annottext">BlockHeader
</span><a href="#local-6989586621681510638"><span class="hs-identifier hs-var">bh</span></a></span><span> </span><span class="annot"><span class="annottext">PayloadData
</span><a href="#local-6989586621681510627"><span class="hs-identifier hs-var">payload</span></a></span><span>
</span><span id="line-612"></span><span>            </span><span class="annot"><span class="annottext">LogFunctionText
</span><a href="#local-6989586621681510635"><span class="hs-identifier hs-var">logCr</span></a></span><span> </span><span class="annot"><span class="annottext">LogLevel
</span><span class="hs-identifier hs-var">Info</span></span><span> </span><span class="annot"><span class="hs-string">&quot;pact db synchronized&quot;</span></span><span>
</span><span id="line-613"></span><span>
</span><span id="line-614"></span><span class="hs-comment">-- | Starts server and runs all network clients</span><span>
</span><span id="line-615"></span><span class="hs-comment">--</span><span>
</span><span id="line-616"></span><span class="annot"><a href="Chainweb.Chainweb.html#runChainweb"><span class="hs-identifier hs-type">runChainweb</span></a></span><span>
</span><span id="line-617"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621681510622"><span class="annot"><a href="#local-6989586621681510622"><span class="hs-identifier hs-type">logger</span></a></span></span><span> </span><span id="local-6989586621681510621"><span class="annot"><a href="#local-6989586621681510621"><span class="hs-identifier hs-type">cas</span></a></span></span><span>
</span><span id="line-618"></span><span>    </span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Chainweb.Logger.html#Logger"><span class="hs-identifier hs-type">Logger</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681510622"><span class="hs-identifier hs-type">logger</span></a></span><span>
</span><span id="line-619"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Chainweb.Payload.PayloadStore.Types.html#PayloadCas"><span class="hs-identifier hs-type">PayloadCas</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681510621"><span class="hs-identifier hs-type">cas</span></a></span><span>
</span><span id="line-620"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Chainweb.Chainweb.html#Chainweb"><span class="hs-identifier hs-type">Chainweb</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681510622"><span class="hs-identifier hs-type">logger</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681510621"><span class="hs-identifier hs-type">cas</span></a></span><span>
</span><span id="line-621"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-622"></span><span id="runChainweb"><span class="annot"><span class="annottext">runChainweb :: Chainweb logger cas -&gt; IO ()
</span><a href="Chainweb.Chainweb.html#runChainweb"><span class="hs-identifier hs-var hs-var">runChainweb</span></a></span></span><span> </span><span id="local-6989586621681510620"><span class="annot"><span class="annottext">cw :: Chainweb logger cas
</span><a href="#local-6989586621681510620"><span class="hs-identifier hs-var">cw</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-623"></span><span>    </span><span class="annot"><span class="annottext">LogFunctionText
</span><a href="#local-6989586621681510619"><span class="hs-identifier hs-var">logg</span></a></span><span> </span><span class="annot"><span class="annottext">LogLevel
</span><span class="hs-identifier hs-var">Info</span></span><span> </span><span class="annot"><span class="hs-string">&quot;start chainweb node&quot;</span></span><span>
</span><span id="line-624"></span><span>    </span><span class="annot"><span class="annottext">IO () -&gt; IO () -&gt; IO ()
forall a b. IO a -&gt; IO b -&gt; IO ()
</span><span class="hs-identifier hs-var">concurrently_</span></span><span>
</span><span id="line-625"></span><span>        </span><span class="hs-comment">-- 1. Start serving Rest API</span><span>
</span><span id="line-626"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Middleware -&gt; IO ()
</span><a href="#local-6989586621681510617"><span class="hs-identifier hs-var">serve</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Throttle Address -&gt; Middleware
forall a. (Eq a, Hashable a) =&gt; Throttle a -&gt; Middleware
</span><span class="hs-identifier hs-var">throttle</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Chainweb logger cas -&gt; Throttle Address
forall logger (cas :: * -&gt; *).
Chainweb logger cas -&gt; Throttle Address
</span><a href="Chainweb.Chainweb.html#_chainwebThrottler"><span class="hs-identifier hs-var hs-var">_chainwebThrottler</span></a></span><span> </span><span class="annot"><span class="annottext">Chainweb logger cas
</span><a href="#local-6989586621681510620"><span class="hs-identifier hs-var">cw</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Middleware -&gt; Middleware -&gt; Middleware
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Middleware
</span><a href="#local-6989586621681510615"><span class="hs-identifier hs-var">httpLog</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-627"></span><span>        </span><span class="hs-comment">-- 2. Start Clients (with a delay of 500ms)</span><span>
</span><span id="line-628"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; IO ()
</span><span class="hs-identifier hs-var">threadDelay</span></span><span> </span><span class="annot"><span class="hs-number">500000</span></span><span> </span><span class="annot"><span class="annottext">IO () -&gt; IO () -&gt; IO ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621681510614"><span class="hs-identifier hs-var">clients</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-629"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-630"></span><span>    </span><span class="annot"><a href="#local-6989586621681510614"><span class="hs-identifier hs-type">clients</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-631"></span><span>    </span><span id="local-6989586621681510614"><span class="annot"><span class="annottext">clients :: IO ()
</span><a href="#local-6989586621681510614"><span class="hs-identifier hs-var hs-var">clients</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-632"></span><span>        </span><span id="local-6989586621681510613"><span class="annot"><span class="annottext">[IO ()]
</span><a href="#local-6989586621681510613"><span class="hs-identifier hs-var">mpClients</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO [IO ()]
</span><a href="#local-6989586621681510612"><span class="hs-identifier hs-var">mempoolSyncClients</span></a></span><span>
</span><span id="line-633"></span><span>        </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; [IO ()] -&gt; IO ()
forall (f :: * -&gt; *) a b. Foldable f =&gt; (a -&gt; IO b) -&gt; f a -&gt; IO ()
</span><span class="hs-identifier hs-var">mapConcurrently_</span></span><span> </span><span class="annot"><span class="annottext">IO () -&gt; IO ()
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="annot"><span class="annottext">([IO ()] -&gt; IO ()) -&gt; [IO ()] -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[[IO ()]] -&gt; [IO ()]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span>
</span><span id="line-634"></span><span>              </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[IO ()]
</span><a href="#local-6989586621681510610"><span class="hs-identifier hs-var">miner</span></a></span><span>
</span><span id="line-635"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Manager -&gt; CutResources logger cas -&gt; [IO ()]
forall logger (cas :: * -&gt; *).
Logger logger =&gt;
Manager -&gt; CutResources logger cas -&gt; [IO ()]
</span><a href="Chainweb.Chainweb.CutResources.html#cutNetworks"><span class="hs-identifier hs-var">cutNetworks</span></a></span><span> </span><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621681510608"><span class="hs-identifier hs-var">mgr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Chainweb logger cas -&gt; CutResources logger cas
forall logger (cas :: * -&gt; *).
Chainweb logger cas -&gt; CutResources logger cas
</span><a href="Chainweb.Chainweb.html#_chainwebCutResources"><span class="hs-identifier hs-var hs-var">_chainwebCutResources</span></a></span><span> </span><span class="annot"><span class="annottext">Chainweb logger cas
</span><a href="#local-6989586621681510620"><span class="hs-identifier hs-var">cw</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-636"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[IO ()]
</span><a href="#local-6989586621681510613"><span class="hs-identifier hs-var">mpClients</span></a></span><span>
</span><span id="line-637"></span><span>              </span><span class="hs-special">]</span><span>
</span><span id="line-638"></span><span>
</span><span id="line-639"></span><span>    </span><span class="annot"><a href="#local-6989586621681510619"><span class="hs-identifier hs-type">logg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.LogMessage.html#LogFunctionText"><span class="hs-identifier hs-type">LogFunctionText</span></a></span><span>
</span><span id="line-640"></span><span>    </span><span id="local-6989586621681510619"><span class="annot"><span class="annottext">logg :: LogFunctionText
</span><a href="#local-6989586621681510619"><span class="hs-identifier hs-var hs-var">logg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">logger -&gt; LogFunctionText
forall l. Logger l =&gt; l -&gt; LogFunctionText
</span><a href="Chainweb.Logger.html#logFunctionText"><span class="hs-identifier hs-var">logFunctionText</span></a></span><span> </span><span class="annot"><span class="annottext">(logger -&gt; LogFunctionText) -&gt; logger -&gt; LogFunctionText
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Chainweb logger cas -&gt; logger
forall logger (cas :: * -&gt; *). Chainweb logger cas -&gt; logger
</span><a href="Chainweb.Chainweb.html#_chainwebLogger"><span class="hs-identifier hs-var hs-var">_chainwebLogger</span></a></span><span> </span><span class="annot"><span class="annottext">Chainweb logger cas
</span><a href="#local-6989586621681510620"><span class="hs-identifier hs-var">cw</span></a></span><span>
</span><span id="line-641"></span><span>
</span><span id="line-642"></span><span>    </span><span class="hs-comment">-- chains</span><span>
</span><span id="line-643"></span><span>    </span><span class="annot"><a href="#local-6989586621681510607"><span class="hs-identifier hs-type">chains</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.ChainId.html#ChainId"><span class="hs-identifier hs-type">ChainId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.Chainweb.ChainResources.html#ChainResources"><span class="hs-identifier hs-type">ChainResources</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681510622"><span class="hs-identifier hs-type">logger</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-644"></span><span>    </span><span id="local-6989586621681510607"><span class="annot"><span class="annottext">chains :: [(ChainId, ChainResources logger)]
</span><a href="#local-6989586621681510607"><span class="hs-identifier hs-var hs-var">chains</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashMap ChainId (ChainResources logger)
-&gt; [(ChainId, ChainResources logger)]
forall k v. HashMap k v -&gt; [(k, v)]
</span><span class="hs-identifier hs-var">HM.toList</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Chainweb logger cas -&gt; HashMap ChainId (ChainResources logger)
forall logger (cas :: * -&gt; *).
Chainweb logger cas -&gt; HashMap ChainId (ChainResources logger)
</span><a href="Chainweb.Chainweb.html#_chainwebChains"><span class="hs-identifier hs-var hs-var">_chainwebChains</span></a></span><span> </span><span class="annot"><span class="annottext">Chainweb logger cas
</span><a href="#local-6989586621681510620"><span class="hs-identifier hs-var">cw</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-645"></span><span>
</span><span id="line-646"></span><span>    </span><span class="annot"><a href="#local-6989586621681510606"><span class="hs-identifier hs-type">chainVals</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Chainweb.Chainweb.ChainResources.html#ChainResources"><span class="hs-identifier hs-type">ChainResources</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681510622"><span class="hs-identifier hs-type">logger</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-647"></span><span>    </span><span id="local-6989586621681510606"><span class="annot"><span class="annottext">chainVals :: [ChainResources logger]
</span><a href="#local-6989586621681510606"><span class="hs-identifier hs-var hs-var">chainVals</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((ChainId, ChainResources logger) -&gt; ChainResources logger)
-&gt; [(ChainId, ChainResources logger)] -&gt; [ChainResources logger]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(ChainId, ChainResources logger) -&gt; ChainResources logger
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">[(ChainId, ChainResources logger)]
</span><a href="#local-6989586621681510607"><span class="hs-identifier hs-var">chains</span></a></span><span>
</span><span id="line-648"></span><span>
</span><span id="line-649"></span><span>    </span><span class="hs-comment">-- collect server resources</span><span>
</span><span id="line-650"></span><span>    </span><span class="annot"><a href="#local-6989586621681510605"><span class="hs-identifier hs-type">proj</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621681511076"><span class="annot"><a href="#local-6989586621681511076"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.Chainweb.ChainResources.html#ChainResources"><span class="hs-identifier hs-type">ChainResources</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681510622"><span class="hs-identifier hs-type">logger</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681511076"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.ChainId.html#ChainId"><span class="hs-identifier hs-type">ChainId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621681511076"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-651"></span><span>    </span><span id="local-6989586621681510605"><span class="annot"><span class="annottext">proj :: (ChainResources logger -&gt; a) -&gt; [(ChainId, a)]
</span><a href="#local-6989586621681510605"><span class="hs-identifier hs-var hs-var">proj</span></a></span></span><span> </span><span id="local-6989586621681510604"><span class="annot"><span class="annottext">f :: ChainResources logger -&gt; a
</span><a href="#local-6989586621681510604"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(((ChainId, ChainResources logger) -&gt; (ChainId, a))
 -&gt; [(ChainId, ChainResources logger)] -&gt; [(ChainId, a)])
-&gt; [(ChainId, ChainResources logger)]
-&gt; ((ChainId, ChainResources logger) -&gt; (ChainId, a))
-&gt; [(ChainId, a)]
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">((ChainId, ChainResources logger) -&gt; (ChainId, a))
-&gt; [(ChainId, ChainResources logger)] -&gt; [(ChainId, a)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">[(ChainId, ChainResources logger)]
</span><a href="#local-6989586621681510607"><span class="hs-identifier hs-var">chains</span></a></span><span> </span><span class="annot"><span class="annottext">(((ChainId, ChainResources logger) -&gt; (ChainId, a))
 -&gt; [(ChainId, a)])
-&gt; ((ChainId, ChainResources logger) -&gt; (ChainId, a))
-&gt; [(ChainId, a)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621681510602"><span class="annot"><span class="annottext">k :: ChainId
</span><a href="#local-6989586621681510602"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681510601"><span class="annot"><span class="annottext">ch :: ChainResources logger
</span><a href="#local-6989586621681510601"><span class="hs-identifier hs-var">ch</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ChainId
</span><a href="#local-6989586621681510602"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ChainResources logger -&gt; a
</span><a href="#local-6989586621681510604"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">ChainResources logger
</span><a href="#local-6989586621681510601"><span class="hs-identifier hs-var">ch</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-652"></span><span>
</span><span id="line-653"></span><span>    </span><span class="annot"><a href="#local-6989586621681510600"><span class="hs-identifier hs-type">chainDbsToServe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.ChainId.html#ChainId"><span class="hs-identifier hs-type">ChainId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.BlockHeaderDB.Types.html#BlockHeaderDb"><span class="hs-identifier hs-type">BlockHeaderDb</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-654"></span><span>    </span><span id="local-6989586621681510600"><span class="annot"><span class="annottext">chainDbsToServe :: [(ChainId, BlockHeaderDb)]
</span><a href="#local-6989586621681510600"><span class="hs-identifier hs-var hs-var">chainDbsToServe</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ChainResources logger -&gt; BlockHeaderDb)
-&gt; [(ChainId, BlockHeaderDb)]
forall a. (ChainResources logger -&gt; a) -&gt; [(ChainId, a)]
</span><a href="#local-6989586621681510605"><span class="hs-identifier hs-var">proj</span></a></span><span> </span><span class="annot"><span class="annottext">ChainResources logger -&gt; BlockHeaderDb
forall logger. ChainResources logger -&gt; BlockHeaderDb
</span><a href="Chainweb.Chainweb.ChainResources.html#_chainResBlockHeaderDb"><span class="hs-identifier hs-var hs-var">_chainResBlockHeaderDb</span></a></span><span>
</span><span id="line-655"></span><span>
</span><span id="line-656"></span><span>    </span><span class="hs-comment">-- | KILLSWITCH: The logic here involving `txSilenceEndDate` here is to be</span><span>
</span><span id="line-657"></span><span>    </span><span class="hs-comment">-- removed in a future version of Chain. This disables the Mempool API</span><span>
</span><span id="line-658"></span><span>    </span><span class="hs-comment">-- entirely during the TX blackout period.</span><span>
</span><span id="line-659"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-660"></span><span>    </span><span class="annot"><a href="#local-6989586621681510599"><span class="hs-identifier hs-type">mempoolsToServe</span></a></span><span>
</span><span id="line-661"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Chainweb.Version.html#ChainwebVersion"><span class="hs-identifier hs-type">ChainwebVersion</span></a></span><span>
</span><span id="line-662"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.ChainId.html#ChainId"><span class="hs-identifier hs-type">ChainId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#MempoolBackend"><span class="hs-identifier hs-type">Mempool.MempoolBackend</span></a></span><span> </span><span class="annot"><a href="Chainweb.Transaction.html#ChainwebTransaction"><span class="hs-identifier hs-type">ChainwebTransaction</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-663"></span><span>    </span><span id="local-6989586621681510599"><span class="annot"><span class="annottext">mempoolsToServe :: ChainwebVersion -&gt; [(ChainId, MempoolBackend ChainwebTransaction)]
</span><a href="#local-6989586621681510599"><span class="hs-identifier hs-var hs-var">mempoolsToServe</span></a></span></span><span> </span><span id="local-6989586621681510598"><span class="annot"><span class="annottext">v :: ChainwebVersion
</span><a href="#local-6989586621681510598"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ChainwebVersion -&gt; Maybe (Time Micros)
</span><a href="Chainweb.Version.html#txSilenceEndDate"><span class="hs-identifier hs-var">txSilenceEndDate</span></a></span><span> </span><span class="annot"><span class="annottext">ChainwebVersion
</span><a href="#local-6989586621681510598"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-664"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-665"></span><span>        </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(ChainResources logger -&gt; MempoolBackend ChainwebTransaction)
-&gt; [(ChainId, MempoolBackend ChainwebTransaction)]
forall a. (ChainResources logger -&gt; a) -&gt; [(ChainId, a)]
</span><a href="#local-6989586621681510605"><span class="hs-identifier hs-var">proj</span></a></span><span> </span><span class="annot"><span class="annottext">ChainResources logger -&gt; MempoolBackend ChainwebTransaction
forall logger.
ChainResources logger -&gt; MempoolBackend ChainwebTransaction
</span><a href="Chainweb.Chainweb.ChainResources.html#_chainResMempool"><span class="hs-identifier hs-var hs-var">_chainResMempool</span></a></span><span>
</span><span id="line-666"></span><span>
</span><span id="line-667"></span><span>    </span><span class="annot"><a href="#local-6989586621681510595"><span class="hs-identifier hs-type">chainP2pToServe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.RestAPI.NetworkID.html#NetworkId"><span class="hs-identifier hs-type">NetworkId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="P2P.Node.PeerDB.html#PeerDb"><span class="hs-identifier hs-type">PeerDb</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-668"></span><span>    </span><span id="local-6989586621681510595"><span class="annot"><span class="annottext">chainP2pToServe :: [(NetworkId, PeerDb)]
</span><a href="#local-6989586621681510595"><span class="hs-identifier hs-var hs-var">chainP2pToServe</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-669"></span><span>        </span><span class="annot"><span class="annottext">(ChainId -&gt; NetworkId)
-&gt; (ChainResources logger -&gt; PeerDb)
-&gt; (ChainId, ChainResources logger)
-&gt; (NetworkId, PeerDb)
forall (p :: * -&gt; * -&gt; *) a b c d.
Bifunctor p =&gt;
(a -&gt; b) -&gt; (c -&gt; d) -&gt; p a c -&gt; p b d
</span><span class="hs-identifier hs-var">bimap</span></span><span> </span><span class="annot"><span class="annottext">ChainId -&gt; NetworkId
</span><a href="Chainweb.RestAPI.NetworkID.html#ChainNetwork"><span class="hs-identifier hs-var">ChainNetwork</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PeerResources logger -&gt; PeerDb
forall logger. PeerResources logger -&gt; PeerDb
</span><a href="Chainweb.Chainweb.PeerResources.html#_peerResDb"><span class="hs-identifier hs-var hs-var">_peerResDb</span></a></span><span> </span><span class="annot"><span class="annottext">(PeerResources logger -&gt; PeerDb)
-&gt; (ChainResources logger -&gt; PeerResources logger)
-&gt; ChainResources logger
-&gt; PeerDb
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ChainResources logger -&gt; PeerResources logger
forall logger. ChainResources logger -&gt; PeerResources logger
</span><a href="Chainweb.Chainweb.ChainResources.html#_chainResPeer"><span class="hs-identifier hs-var hs-var">_chainResPeer</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((ChainId, ChainResources logger) -&gt; (NetworkId, PeerDb))
-&gt; [(ChainId, ChainResources logger)] -&gt; [(NetworkId, PeerDb)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">HashMap ChainId (ChainResources logger)
-&gt; [(ChainId, ChainResources logger)]
forall i (f :: * -&gt; *) a. FoldableWithIndex i f =&gt; f a -&gt; [(i, a)]
</span><span class="hs-identifier hs-var">itoList</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Chainweb logger cas -&gt; HashMap ChainId (ChainResources logger)
forall logger (cas :: * -&gt; *).
Chainweb logger cas -&gt; HashMap ChainId (ChainResources logger)
</span><a href="Chainweb.Chainweb.html#_chainwebChains"><span class="hs-identifier hs-var hs-var">_chainwebChains</span></a></span><span> </span><span class="annot"><span class="annottext">Chainweb logger cas
</span><a href="#local-6989586621681510620"><span class="hs-identifier hs-var">cw</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-670"></span><span>
</span><span id="line-671"></span><span>    </span><span class="annot"><a href="#local-6989586621681510589"><span class="hs-identifier hs-type">memP2pToServe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.RestAPI.NetworkID.html#NetworkId"><span class="hs-identifier hs-type">NetworkId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="P2P.Node.PeerDB.html#PeerDb"><span class="hs-identifier hs-type">PeerDb</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-672"></span><span>    </span><span id="local-6989586621681510589"><span class="annot"><span class="annottext">memP2pToServe :: [(NetworkId, PeerDb)]
</span><a href="#local-6989586621681510589"><span class="hs-identifier hs-var hs-var">memP2pToServe</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-673"></span><span>        </span><span class="annot"><span class="annottext">(ChainId -&gt; NetworkId)
-&gt; (ChainResources logger -&gt; PeerDb)
-&gt; (ChainId, ChainResources logger)
-&gt; (NetworkId, PeerDb)
forall (p :: * -&gt; * -&gt; *) a b c d.
Bifunctor p =&gt;
(a -&gt; b) -&gt; (c -&gt; d) -&gt; p a c -&gt; p b d
</span><span class="hs-identifier hs-var">bimap</span></span><span> </span><span class="annot"><span class="annottext">ChainId -&gt; NetworkId
</span><a href="Chainweb.RestAPI.NetworkID.html#MempoolNetwork"><span class="hs-identifier hs-var">MempoolNetwork</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PeerResources logger -&gt; PeerDb
forall logger. PeerResources logger -&gt; PeerDb
</span><a href="Chainweb.Chainweb.PeerResources.html#_peerResDb"><span class="hs-identifier hs-var hs-var">_peerResDb</span></a></span><span> </span><span class="annot"><span class="annottext">(PeerResources logger -&gt; PeerDb)
-&gt; (ChainResources logger -&gt; PeerResources logger)
-&gt; ChainResources logger
-&gt; PeerDb
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ChainResources logger -&gt; PeerResources logger
forall logger. ChainResources logger -&gt; PeerResources logger
</span><a href="Chainweb.Chainweb.ChainResources.html#_chainResPeer"><span class="hs-identifier hs-var hs-var">_chainResPeer</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((ChainId, ChainResources logger) -&gt; (NetworkId, PeerDb))
-&gt; [(ChainId, ChainResources logger)] -&gt; [(NetworkId, PeerDb)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">HashMap ChainId (ChainResources logger)
-&gt; [(ChainId, ChainResources logger)]
forall i (f :: * -&gt; *) a. FoldableWithIndex i f =&gt; f a -&gt; [(i, a)]
</span><span class="hs-identifier hs-var">itoList</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Chainweb logger cas -&gt; HashMap ChainId (ChainResources logger)
forall logger (cas :: * -&gt; *).
Chainweb logger cas -&gt; HashMap ChainId (ChainResources logger)
</span><a href="Chainweb.Chainweb.html#_chainwebChains"><span class="hs-identifier hs-var hs-var">_chainwebChains</span></a></span><span> </span><span class="annot"><span class="annottext">Chainweb logger cas
</span><a href="#local-6989586621681510620"><span class="hs-identifier hs-var">cw</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-674"></span><span>
</span><span id="line-675"></span><span>    </span><span class="annot"><a href="#local-6989586621681510587"><span class="hs-identifier hs-type">payloadDbsToServe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.ChainId.html#ChainId"><span class="hs-identifier hs-type">ChainId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.Payload.PayloadStore.Types.html#PayloadDb"><span class="hs-identifier hs-type">PayloadDb</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681510621"><span class="hs-identifier hs-type">cas</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-676"></span><span>    </span><span id="local-6989586621681510587"><span class="annot"><span class="annottext">payloadDbsToServe :: [(ChainId, PayloadDb cas)]
</span><a href="#local-6989586621681510587"><span class="hs-identifier hs-var hs-var">payloadDbsToServe</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashMap ChainId (PayloadDb cas) -&gt; [(ChainId, PayloadDb cas)]
forall i (f :: * -&gt; *) a. FoldableWithIndex i f =&gt; f a -&gt; [(i, a)]
</span><span class="hs-identifier hs-var">itoList</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Getting (PayloadDb cas) (Chainweb logger cas) (PayloadDb cas)
-&gt; Chainweb logger cas -&gt; PayloadDb cas
forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">view</span></span><span> </span><span class="annot"><span class="annottext">Getting (PayloadDb cas) (Chainweb logger cas) (PayloadDb cas)
forall logger (cas :: * -&gt; *).
Lens' (Chainweb logger cas) (PayloadDb cas)
</span><a href="Chainweb.Chainweb.html#chainwebPayloadDb"><span class="hs-identifier hs-var">chainwebPayloadDb</span></a></span><span> </span><span class="annot"><span class="annottext">Chainweb logger cas
</span><a href="#local-6989586621681510620"><span class="hs-identifier hs-var">cw</span></a></span><span> </span><span class="annot"><span class="annottext">PayloadDb cas
-&gt; HashMap ChainId (ChainResources logger)
-&gt; HashMap ChainId (PayloadDb cas)
forall (f :: * -&gt; *) a b. Functor f =&gt; a -&gt; f b -&gt; f a
</span><span class="hs-operator hs-var">&lt;$</span></span><span> </span><span class="annot"><span class="annottext">Chainweb logger cas -&gt; HashMap ChainId (ChainResources logger)
forall logger (cas :: * -&gt; *).
Chainweb logger cas -&gt; HashMap ChainId (ChainResources logger)
</span><a href="Chainweb.Chainweb.html#_chainwebChains"><span class="hs-identifier hs-var hs-var">_chainwebChains</span></a></span><span> </span><span class="annot"><span class="annottext">Chainweb logger cas
</span><a href="#local-6989586621681510620"><span class="hs-identifier hs-var">cw</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-677"></span><span>
</span><span id="line-678"></span><span>    </span><span class="annot"><a href="#local-6989586621681510585"><span class="hs-identifier hs-type">pactDbsToServe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.ChainId.html#ChainId"><span class="hs-identifier hs-type">ChainId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.Pact.RestAPI.Server.html#PactServerData"><span class="hs-identifier hs-type">PactServerData</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681510622"><span class="hs-identifier hs-type">logger</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681510621"><span class="hs-identifier hs-type">cas</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-679"></span><span>    </span><span id="local-6989586621681510585"><span class="annot"><span class="annottext">pactDbsToServe :: [(ChainId, PactServerData logger cas)]
</span><a href="#local-6989586621681510585"><span class="hs-identifier hs-var hs-var">pactDbsToServe</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Chainweb logger cas -&gt; [(ChainId, PactServerData logger cas)]
forall logger (cas :: * -&gt; *).
Chainweb logger cas -&gt; [(ChainId, PactServerData logger cas)]
</span><a href="Chainweb.Chainweb.html#_chainwebPactData"><span class="hs-identifier hs-var hs-var">_chainwebPactData</span></a></span><span> </span><span class="annot"><span class="annottext">Chainweb logger cas
</span><a href="#local-6989586621681510620"><span class="hs-identifier hs-var">cw</span></a></span><span>
</span><span id="line-680"></span><span>
</span><span id="line-681"></span><span>    </span><span class="annot"><a href="#local-6989586621681510584"><span class="hs-identifier hs-type">serverSettings</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Settings</span></span><span>
</span><span id="line-682"></span><span>    </span><span id="local-6989586621681510584"><span class="annot"><span class="annottext">serverSettings :: Settings
</span><a href="#local-6989586621681510584"><span class="hs-identifier hs-var hs-var">serverSettings</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Maybe Request -&gt; SomeException -&gt; IO ()) -&gt; Settings -&gt; Settings
</span><span class="hs-identifier hs-var">setOnException</span></span><span>
</span><span id="line-683"></span><span>        </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621681510582"><span class="annot"><span class="annottext">r :: Maybe Request
</span><a href="#local-6989586621681510582"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621681510581"><span class="annot"><span class="annottext">e :: SomeException
</span><a href="#local-6989586621681510581"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; IO () -&gt; IO ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SomeException -&gt; Bool
</span><span class="hs-identifier hs-var">defaultShouldDisplayException</span></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621681510581"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LogFunctionText
</span><a href="#local-6989586621681510619"><span class="hs-identifier hs-var">logg</span></a></span><span> </span><span class="annot"><span class="annottext">LogLevel
</span><span class="hs-identifier hs-var">Error</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; IO ()) -&gt; Text -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe Request -&gt; SomeException -&gt; Text
forall p a a.
(Semigroup p, IsString p, Show a, Show a) =&gt;
Maybe a -&gt; a -&gt; p
</span><a href="#local-6989586621681510577"><span class="hs-identifier hs-var">loggServerError</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Request
</span><a href="#local-6989586621681510582"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621681510581"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-684"></span><span>        </span><span class="annot"><span class="annottext">(Settings -&gt; Settings) -&gt; Settings -&gt; Settings
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Peer -&gt; Settings
</span><a href="Chainweb.Chainweb.PeerResources.html#peerServerSettings"><span class="hs-identifier hs-var">peerServerSettings</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PeerResources logger -&gt; Peer
forall logger. PeerResources logger -&gt; Peer
</span><a href="Chainweb.Chainweb.PeerResources.html#_peerResPeer"><span class="hs-identifier hs-var hs-var">_peerResPeer</span></a></span><span> </span><span class="annot"><span class="annottext">(PeerResources logger -&gt; Peer) -&gt; PeerResources logger -&gt; Peer
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Chainweb logger cas -&gt; PeerResources logger
forall logger (cas :: * -&gt; *).
Chainweb logger cas -&gt; PeerResources logger
</span><a href="Chainweb.Chainweb.html#_chainwebPeer"><span class="hs-identifier hs-var hs-var">_chainwebPeer</span></a></span><span> </span><span class="annot"><span class="annottext">Chainweb logger cas
</span><a href="#local-6989586621681510620"><span class="hs-identifier hs-var">cw</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-685"></span><span>
</span><span id="line-686"></span><span>    </span><span class="annot"><a href="#local-6989586621681510617"><span class="hs-identifier hs-type">serve</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Middleware</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-687"></span><span>    </span><span id="local-6989586621681510617"><span class="annot"><span class="annottext">serve :: Middleware -&gt; IO ()
</span><a href="#local-6989586621681510617"><span class="hs-identifier hs-var hs-var">serve</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Settings
-&gt; X509CertChainPem
-&gt; X509KeyPem
-&gt; Socket
-&gt; ChainwebVersion
-&gt; ChainwebServerDbs ChainwebTransaction logger cas
-&gt; Maybe (MiningCoordination logger cas)
-&gt; HeaderStream
-&gt; Middleware
-&gt; IO ()
forall t (cas :: * -&gt; *) logger.
(Show t, PayloadCas cas, Logger logger) =&gt;
Settings
-&gt; X509CertChainPem
-&gt; X509KeyPem
-&gt; Socket
-&gt; ChainwebVersion
-&gt; ChainwebServerDbs t logger cas
-&gt; Maybe (MiningCoordination logger cas)
-&gt; HeaderStream
-&gt; Middleware
-&gt; IO ()
</span><a href="Chainweb.RestAPI.html#serveChainwebSocketTls"><span class="hs-identifier hs-var">serveChainwebSocketTls</span></a></span><span>
</span><span id="line-688"></span><span>        </span><span class="annot"><span class="annottext">Settings
</span><a href="#local-6989586621681510584"><span class="hs-identifier hs-var">serverSettings</span></a></span><span>
</span><span id="line-689"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Peer -&gt; X509CertChainPem
</span><a href="P2P.Peer.html#_peerCertificateChain"><span class="hs-identifier hs-var hs-var">_peerCertificateChain</span></a></span><span> </span><span class="annot"><span class="annottext">(Peer -&gt; X509CertChainPem) -&gt; Peer -&gt; X509CertChainPem
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PeerResources logger -&gt; Peer
forall logger. PeerResources logger -&gt; Peer
</span><a href="Chainweb.Chainweb.PeerResources.html#_peerResPeer"><span class="hs-identifier hs-var hs-var">_peerResPeer</span></a></span><span> </span><span class="annot"><span class="annottext">(PeerResources logger -&gt; Peer) -&gt; PeerResources logger -&gt; Peer
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Chainweb logger cas -&gt; PeerResources logger
forall logger (cas :: * -&gt; *).
Chainweb logger cas -&gt; PeerResources logger
</span><a href="Chainweb.Chainweb.html#_chainwebPeer"><span class="hs-identifier hs-var hs-var">_chainwebPeer</span></a></span><span> </span><span class="annot"><span class="annottext">Chainweb logger cas
</span><a href="#local-6989586621681510620"><span class="hs-identifier hs-var">cw</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-690"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Peer -&gt; X509KeyPem
</span><a href="P2P.Peer.html#_peerKey"><span class="hs-identifier hs-var hs-var">_peerKey</span></a></span><span> </span><span class="annot"><span class="annottext">(Peer -&gt; X509KeyPem) -&gt; Peer -&gt; X509KeyPem
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PeerResources logger -&gt; Peer
forall logger. PeerResources logger -&gt; Peer
</span><a href="Chainweb.Chainweb.PeerResources.html#_peerResPeer"><span class="hs-identifier hs-var hs-var">_peerResPeer</span></a></span><span> </span><span class="annot"><span class="annottext">(PeerResources logger -&gt; Peer) -&gt; PeerResources logger -&gt; Peer
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Chainweb logger cas -&gt; PeerResources logger
forall logger (cas :: * -&gt; *).
Chainweb logger cas -&gt; PeerResources logger
</span><a href="Chainweb.Chainweb.html#_chainwebPeer"><span class="hs-identifier hs-var hs-var">_chainwebPeer</span></a></span><span> </span><span class="annot"><span class="annottext">Chainweb logger cas
</span><a href="#local-6989586621681510620"><span class="hs-identifier hs-var">cw</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-691"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PeerResources logger -&gt; Socket
forall logger. PeerResources logger -&gt; Socket
</span><a href="Chainweb.Chainweb.PeerResources.html#_peerResSocket"><span class="hs-identifier hs-var hs-var">_peerResSocket</span></a></span><span> </span><span class="annot"><span class="annottext">(PeerResources logger -&gt; Socket) -&gt; PeerResources logger -&gt; Socket
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Chainweb logger cas -&gt; PeerResources logger
forall logger (cas :: * -&gt; *).
Chainweb logger cas -&gt; PeerResources logger
</span><a href="Chainweb.Chainweb.html#_chainwebPeer"><span class="hs-identifier hs-var hs-var">_chainwebPeer</span></a></span><span> </span><span class="annot"><span class="annottext">Chainweb logger cas
</span><a href="#local-6989586621681510620"><span class="hs-identifier hs-var">cw</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-692"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Chainweb logger cas -&gt; ChainwebVersion
forall a. HasChainwebVersion a =&gt; a -&gt; ChainwebVersion
</span><a href="Chainweb.Version.html#_chainwebVersion"><span class="hs-identifier hs-var">_chainwebVersion</span></a></span><span> </span><span class="annot"><span class="annottext">Chainweb logger cas
</span><a href="#local-6989586621681510620"><span class="hs-identifier hs-var">cw</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-693"></span><span>        </span><span class="annot"><span class="annottext">$WChainwebServerDbs :: forall t logger (cas :: * -&gt; *).
Maybe (CutDb cas)
-&gt; [(ChainId, BlockHeaderDb)]
-&gt; [(ChainId, MempoolBackend t)]
-&gt; [(ChainId, PayloadDb cas)]
-&gt; [(NetworkId, PeerDb)]
-&gt; [(ChainId, PactServerData logger cas)]
-&gt; ChainwebServerDbs t logger cas
</span><a href="Chainweb.RestAPI.html#%24WChainwebServerDbs"><span class="hs-identifier hs-type hs-type">ChainwebServerDbs</span></a></span><span>
</span><span id="line-694"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">_chainwebServerCutDb :: Maybe (CutDb cas)
</span><a href="Chainweb.RestAPI.html#_chainwebServerCutDb"><span class="hs-identifier hs-var">_chainwebServerCutDb</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CutDb cas -&gt; Maybe (CutDb cas)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">CutDb cas
</span><a href="#local-6989586621681510567"><span class="hs-identifier hs-var">cutDb</span></a></span><span>
</span><span id="line-695"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_chainwebServerBlockHeaderDbs :: [(ChainId, BlockHeaderDb)]
</span><a href="Chainweb.RestAPI.html#_chainwebServerBlockHeaderDbs"><span class="hs-identifier hs-var">_chainwebServerBlockHeaderDbs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(ChainId, BlockHeaderDb)]
</span><a href="#local-6989586621681510600"><span class="hs-identifier hs-var">chainDbsToServe</span></a></span><span>
</span><span id="line-696"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_chainwebServerMempools :: [(ChainId, MempoolBackend ChainwebTransaction)]
</span><a href="Chainweb.RestAPI.html#_chainwebServerMempools"><span class="hs-identifier hs-var">_chainwebServerMempools</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ChainwebVersion -&gt; [(ChainId, MempoolBackend ChainwebTransaction)]
</span><a href="#local-6989586621681510599"><span class="hs-identifier hs-var">mempoolsToServe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Chainweb logger cas -&gt; ChainwebVersion
forall a. HasChainwebVersion a =&gt; a -&gt; ChainwebVersion
</span><a href="Chainweb.Version.html#_chainwebVersion"><span class="hs-identifier hs-var">_chainwebVersion</span></a></span><span> </span><span class="annot"><span class="annottext">Chainweb logger cas
</span><a href="#local-6989586621681510620"><span class="hs-identifier hs-var">cw</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-697"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_chainwebServerPayloadDbs :: [(ChainId, PayloadDb cas)]
</span><a href="Chainweb.RestAPI.html#_chainwebServerPayloadDbs"><span class="hs-identifier hs-var">_chainwebServerPayloadDbs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(ChainId, PayloadDb cas)]
</span><a href="#local-6989586621681510587"><span class="hs-identifier hs-var">payloadDbsToServe</span></a></span><span>
</span><span id="line-698"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_chainwebServerPeerDbs :: [(NetworkId, PeerDb)]
</span><a href="Chainweb.RestAPI.html#_chainwebServerPeerDbs"><span class="hs-identifier hs-var">_chainwebServerPeerDbs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NetworkId
</span><a href="Chainweb.RestAPI.NetworkID.html#CutNetwork"><span class="hs-identifier hs-var">CutNetwork</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PeerDb
</span><a href="#local-6989586621681510561"><span class="hs-identifier hs-var">cutPeerDb</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(NetworkId, PeerDb)
-&gt; [(NetworkId, PeerDb)] -&gt; [(NetworkId, PeerDb)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[(NetworkId, PeerDb)]
</span><a href="#local-6989586621681510595"><span class="hs-identifier hs-var">chainP2pToServe</span></a></span><span> </span><span class="annot"><span class="annottext">[(NetworkId, PeerDb)]
-&gt; [(NetworkId, PeerDb)] -&gt; [(NetworkId, PeerDb)]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[(NetworkId, PeerDb)]
</span><a href="#local-6989586621681510589"><span class="hs-identifier hs-var">memP2pToServe</span></a></span><span>
</span><span id="line-699"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_chainwebServerPactDbs :: [(ChainId, PactServerData logger cas)]
</span><a href="Chainweb.RestAPI.html#_chainwebServerPactDbs"><span class="hs-identifier hs-var">_chainwebServerPactDbs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(ChainId, PactServerData logger cas)]
</span><a href="#local-6989586621681510585"><span class="hs-identifier hs-var">pactDbsToServe</span></a></span><span>
</span><span id="line-700"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-701"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Chainweb logger cas -&gt; Maybe (MiningCoordination logger cas)
forall logger (cas :: * -&gt; *).
Chainweb logger cas -&gt; Maybe (MiningCoordination logger cas)
</span><a href="Chainweb.Chainweb.html#_chainwebCoordinator"><span class="hs-identifier hs-var hs-var">_chainwebCoordinator</span></a></span><span> </span><span class="annot"><span class="annottext">Chainweb logger cas
</span><a href="#local-6989586621681510620"><span class="hs-identifier hs-var">cw</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-702"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Chainweb logger cas -&gt; HeaderStream
forall logger (cas :: * -&gt; *). Chainweb logger cas -&gt; HeaderStream
</span><a href="Chainweb.Chainweb.html#_chainwebHeaderStream"><span class="hs-identifier hs-var hs-var">_chainwebHeaderStream</span></a></span><span> </span><span class="annot"><span class="annottext">Chainweb logger cas
</span><a href="#local-6989586621681510620"><span class="hs-identifier hs-var">cw</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-703"></span><span>
</span><span id="line-704"></span><span>    </span><span class="hs-comment">-- HTTP Request Logger</span><span>
</span><span id="line-705"></span><span>
</span><span id="line-706"></span><span>    </span><span class="annot"><a href="#local-6989586621681510615"><span class="hs-identifier hs-type">httpLog</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Middleware</span></span><span>
</span><span id="line-707"></span><span>    </span><span id="local-6989586621681510615"><span class="annot"><span class="annottext">httpLog :: Middleware
</span><a href="#local-6989586621681510615"><span class="hs-identifier hs-var hs-var">httpLog</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">logger -&gt; Middleware
forall l. Logger l =&gt; l -&gt; Middleware
</span><a href="Chainweb.Utils.RequestLog.html#requestResponseLogger"><span class="hs-identifier hs-var">requestResponseLogger</span></a></span><span> </span><span class="annot"><span class="annottext">(logger -&gt; Middleware) -&gt; logger -&gt; Middleware
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; logger -&gt; logger
forall logger. Logger logger =&gt; Text -&gt; logger -&gt; logger
</span><a href="Chainweb.Logger.html#setComponent"><span class="hs-identifier hs-var">setComponent</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;http&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Chainweb logger cas -&gt; logger
forall logger (cas :: * -&gt; *). Chainweb logger cas -&gt; logger
</span><a href="Chainweb.Chainweb.html#_chainwebLogger"><span class="hs-identifier hs-var hs-var">_chainwebLogger</span></a></span><span> </span><span class="annot"><span class="annottext">Chainweb logger cas
</span><a href="#local-6989586621681510620"><span class="hs-identifier hs-var">cw</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-708"></span><span>
</span><span id="line-709"></span><span>    </span><span id="local-6989586621681510577"><span class="annot"><span class="annottext">loggServerError :: Maybe a -&gt; a -&gt; p
</span><a href="#local-6989586621681510577"><span class="hs-identifier hs-var hs-var">loggServerError</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621681510558"><span class="annot"><span class="annottext">r :: a
</span><a href="#local-6989586621681510558"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681510557"><span class="annot"><span class="annottext">e :: a
</span><a href="#local-6989586621681510557"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-string">&quot;HTTP server error: &quot;</span></span><span> </span><span class="annot"><span class="annottext">p -&gt; p -&gt; p
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; p
forall a b. (Show a, IsString b) =&gt; a -&gt; b
</span><a href="Chainweb.Utils.html#sshow"><span class="hs-identifier hs-var">sshow</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681510557"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">p -&gt; p -&gt; p
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="hs-string">&quot;. Request: &quot;</span></span><span> </span><span class="annot"><span class="annottext">p -&gt; p -&gt; p
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; p
forall a b. (Show a, IsString b) =&gt; a -&gt; b
</span><a href="Chainweb.Utils.html#sshow"><span class="hs-identifier hs-var">sshow</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681510558"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-710"></span><span>    </span><span class="annot"><a href="#local-6989586621681510577"><span class="hs-identifier hs-var">loggServerError</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span> </span><span id="local-6989586621681510555"><span class="annot"><span class="annottext">e :: a
</span><a href="#local-6989586621681510555"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-string">&quot;HTTP server error: &quot;</span></span><span> </span><span class="annot"><span class="annottext">p -&gt; p -&gt; p
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; p
forall a b. (Show a, IsString b) =&gt; a -&gt; b
</span><a href="Chainweb.Utils.html#sshow"><span class="hs-identifier hs-var">sshow</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681510555"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-711"></span><span>
</span><span id="line-712"></span><span>    </span><span class="hs-comment">-- Cut DB and Miner</span><span>
</span><span id="line-713"></span><span>
</span><span id="line-714"></span><span>    </span><span class="annot"><a href="#local-6989586621681510567"><span class="hs-identifier hs-type">cutDb</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Chainweb.CutDB.Types.html#CutDb"><span class="hs-identifier hs-type">CutDb</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681510621"><span class="hs-identifier hs-type">cas</span></a></span><span>
</span><span id="line-715"></span><span>    </span><span id="local-6989586621681510567"><span class="annot"><span class="annottext">cutDb :: CutDb cas
</span><a href="#local-6989586621681510567"><span class="hs-identifier hs-var hs-var">cutDb</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CutResources logger cas -&gt; CutDb cas
forall logger (cas :: * -&gt; *). CutResources logger cas -&gt; CutDb cas
</span><a href="Chainweb.Chainweb.CutResources.html#_cutResCutDb"><span class="hs-identifier hs-var hs-var">_cutResCutDb</span></a></span><span> </span><span class="annot"><span class="annottext">(CutResources logger cas -&gt; CutDb cas)
-&gt; CutResources logger cas -&gt; CutDb cas
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Chainweb logger cas -&gt; CutResources logger cas
forall logger (cas :: * -&gt; *).
Chainweb logger cas -&gt; CutResources logger cas
</span><a href="Chainweb.Chainweb.html#_chainwebCutResources"><span class="hs-identifier hs-var hs-var">_chainwebCutResources</span></a></span><span> </span><span class="annot"><span class="annottext">Chainweb logger cas
</span><a href="#local-6989586621681510620"><span class="hs-identifier hs-var">cw</span></a></span><span>
</span><span id="line-716"></span><span>
</span><span id="line-717"></span><span>    </span><span class="annot"><a href="#local-6989586621681510561"><span class="hs-identifier hs-type">cutPeerDb</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="P2P.Node.PeerDB.html#PeerDb"><span class="hs-identifier hs-type">PeerDb</span></a></span><span>
</span><span id="line-718"></span><span>    </span><span id="local-6989586621681510561"><span class="annot"><span class="annottext">cutPeerDb :: PeerDb
</span><a href="#local-6989586621681510561"><span class="hs-identifier hs-var hs-var">cutPeerDb</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PeerResources logger -&gt; PeerDb
forall logger. PeerResources logger -&gt; PeerDb
</span><a href="Chainweb.Chainweb.PeerResources.html#_peerResDb"><span class="hs-identifier hs-var hs-var">_peerResDb</span></a></span><span> </span><span class="annot"><span class="annottext">(PeerResources logger -&gt; PeerDb) -&gt; PeerResources logger -&gt; PeerDb
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CutResources logger cas -&gt; PeerResources logger
forall logger (cas :: * -&gt; *).
CutResources logger cas -&gt; PeerResources logger
</span><a href="Chainweb.Chainweb.CutResources.html#_cutResPeer"><span class="hs-identifier hs-var hs-var">_cutResPeer</span></a></span><span> </span><span class="annot"><span class="annottext">(CutResources logger cas -&gt; PeerResources logger)
-&gt; CutResources logger cas -&gt; PeerResources logger
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Chainweb logger cas -&gt; CutResources logger cas
forall logger (cas :: * -&gt; *).
Chainweb logger cas -&gt; CutResources logger cas
</span><a href="Chainweb.Chainweb.html#_chainwebCutResources"><span class="hs-identifier hs-var hs-var">_chainwebCutResources</span></a></span><span> </span><span class="annot"><span class="annottext">Chainweb logger cas
</span><a href="#local-6989586621681510620"><span class="hs-identifier hs-var">cw</span></a></span><span>
</span><span id="line-719"></span><span>
</span><span id="line-720"></span><span>    </span><span class="annot"><a href="#local-6989586621681510610"><span class="hs-identifier hs-type">miner</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-721"></span><span>    </span><span id="local-6989586621681510610"><span class="annot"><span class="annottext">miner :: [IO ()]
</span><a href="#local-6989586621681510610"><span class="hs-identifier hs-var hs-var">miner</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[IO ()]
-&gt; (MinerResources logger cas -&gt; [IO ()])
-&gt; Maybe (MinerResources logger cas)
-&gt; [IO ()]
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621681510553"><span class="annot"><span class="annottext">m :: MinerResources logger cas
</span><a href="#local-6989586621681510553"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">ChainwebVersion -&gt; MinerResources logger cas -&gt; IO ()
forall logger (cas :: * -&gt; *).
(Logger logger, PayloadCas cas) =&gt;
ChainwebVersion -&gt; MinerResources logger cas -&gt; IO ()
</span><a href="Chainweb.Chainweb.MinerResources.html#runMiner"><span class="hs-identifier hs-var">runMiner</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Chainweb logger cas -&gt; ChainwebVersion
forall a. HasChainwebVersion a =&gt; a -&gt; ChainwebVersion
</span><a href="Chainweb.Version.html#_chainwebVersion"><span class="hs-identifier hs-var">_chainwebVersion</span></a></span><span> </span><span class="annot"><span class="annottext">Chainweb logger cas
</span><a href="#local-6989586621681510620"><span class="hs-identifier hs-var">cw</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">MinerResources logger cas
</span><a href="#local-6989586621681510553"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe (MinerResources logger cas) -&gt; [IO ()])
-&gt; Maybe (MinerResources logger cas) -&gt; [IO ()]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Chainweb logger cas -&gt; Maybe (MinerResources logger cas)
forall logger (cas :: * -&gt; *).
Chainweb logger cas -&gt; Maybe (MinerResources logger cas)
</span><a href="Chainweb.Chainweb.html#_chainwebMiner"><span class="hs-identifier hs-var hs-var">_chainwebMiner</span></a></span><span> </span><span class="annot"><span class="annottext">Chainweb logger cas
</span><a href="#local-6989586621681510620"><span class="hs-identifier hs-var">cw</span></a></span><span>
</span><span id="line-722"></span><span>
</span><span id="line-723"></span><span>    </span><span class="hs-comment">-- Configure Clients</span><span>
</span><span id="line-724"></span><span>
</span><span id="line-725"></span><span>    </span><span class="annot"><a href="#local-6989586621681510608"><span class="hs-identifier hs-type">mgr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HTTP.Manager</span></span><span>
</span><span id="line-726"></span><span>    </span><span id="local-6989586621681510608"><span class="annot"><span class="annottext">mgr :: Manager
</span><a href="#local-6989586621681510608"><span class="hs-identifier hs-var hs-var">mgr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Getting Manager (Chainweb logger cas) Manager
-&gt; Chainweb logger cas -&gt; Manager
forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">view</span></span><span> </span><span class="annot"><span class="annottext">Getting Manager (Chainweb logger cas) Manager
forall logger (cas :: * -&gt; *). Lens' (Chainweb logger cas) Manager
</span><a href="Chainweb.Chainweb.html#chainwebManager"><span class="hs-identifier hs-var">chainwebManager</span></a></span><span> </span><span class="annot"><span class="annottext">Chainweb logger cas
</span><a href="#local-6989586621681510620"><span class="hs-identifier hs-var">cw</span></a></span><span>
</span><span id="line-727"></span><span>
</span><span id="line-728"></span><span>    </span><span class="hs-comment">-- Mempool</span><span>
</span><span id="line-729"></span><span>
</span><span id="line-730"></span><span>    </span><span class="annot"><a href="#local-6989586621681510552"><span class="hs-identifier hs-type">mempoolP2pConfig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Chainweb.Utils.html#EnableConfig"><span class="hs-identifier hs-type">EnableConfig</span></a></span><span> </span><span class="annot"><a href="Chainweb.Mempool.P2pConfig.html#MempoolP2pConfig"><span class="hs-identifier hs-type">MempoolP2pConfig</span></a></span><span>
</span><span id="line-731"></span><span>    </span><span id="local-6989586621681510552"><span class="annot"><span class="annottext">mempoolP2pConfig :: EnableConfig MempoolP2pConfig
</span><a href="#local-6989586621681510552"><span class="hs-identifier hs-var hs-var">mempoolP2pConfig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ChainwebConfiguration -&gt; EnableConfig MempoolP2pConfig
</span><a href="Chainweb.Chainweb.html#_configMempoolP2p"><span class="hs-identifier hs-var hs-var">_configMempoolP2p</span></a></span><span> </span><span class="annot"><span class="annottext">(ChainwebConfiguration -&gt; EnableConfig MempoolP2pConfig)
-&gt; ChainwebConfiguration -&gt; EnableConfig MempoolP2pConfig
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Chainweb logger cas -&gt; ChainwebConfiguration
forall logger (cas :: * -&gt; *).
Chainweb logger cas -&gt; ChainwebConfiguration
</span><a href="Chainweb.Chainweb.html#_chainwebConfig"><span class="hs-identifier hs-var hs-var">_chainwebConfig</span></a></span><span> </span><span class="annot"><span class="annottext">Chainweb logger cas
</span><a href="#local-6989586621681510620"><span class="hs-identifier hs-var">cw</span></a></span><span>
</span><span id="line-732"></span><span>
</span><span id="line-733"></span><span>    </span><span class="hs-comment">-- Decide whether to enable the mempool sync clients</span><span>
</span><span id="line-734"></span><span>    </span><span class="hs-comment">-- | KILLSWITCH: Reenable the mempool sync for Mainnet.</span><span>
</span><span id="line-735"></span><span>    </span><span class="annot"><a href="#local-6989586621681510612"><span class="hs-identifier hs-type">mempoolSyncClients</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-736"></span><span>    </span><span id="local-6989586621681510612"><span class="annot"><span class="annottext">mempoolSyncClients :: IO [IO ()]
</span><a href="#local-6989586621681510612"><span class="hs-identifier hs-var hs-var">mempoolSyncClients</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">EnableConfig MempoolP2pConfig -&gt; Maybe MempoolP2pConfig
forall a. EnableConfig a -&gt; Maybe a
</span><a href="Chainweb.Utils.html#enabledConfig"><span class="hs-identifier hs-var">enabledConfig</span></a></span><span> </span><span class="annot"><span class="annottext">EnableConfig MempoolP2pConfig
</span><a href="#local-6989586621681510552"><span class="hs-identifier hs-var">mempoolP2pConfig</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-737"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO [IO ()]
forall a. IO [a]
</span><a href="#local-6989586621681510550"><span class="hs-identifier hs-var">disabled</span></a></span><span>
</span><span id="line-738"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621681510549"><span class="annot"><span class="annottext">c :: MempoolP2pConfig
</span><a href="#local-6989586621681510549"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Chainweb logger cas -&gt; ChainwebVersion
forall a. HasChainwebVersion a =&gt; a -&gt; ChainwebVersion
</span><a href="Chainweb.Version.html#_chainwebVersion"><span class="hs-identifier hs-var">_chainwebVersion</span></a></span><span> </span><span class="annot"><span class="annottext">Chainweb logger cas
</span><a href="#local-6989586621681510620"><span class="hs-identifier hs-var">cw</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-739"></span><span>            </span><span class="annot"><a href="Chainweb.Version.html#Test"><span class="hs-identifier hs-type">Test</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO [IO ()]
forall a. IO [a]
</span><a href="#local-6989586621681510550"><span class="hs-identifier hs-var">disabled</span></a></span><span>
</span><span id="line-740"></span><span>            </span><span class="annot"><a href="Chainweb.Version.html#TimedConsensus"><span class="hs-identifier hs-type">TimedConsensus</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO [IO ()]
forall a. IO [a]
</span><a href="#local-6989586621681510550"><span class="hs-identifier hs-var">disabled</span></a></span><span>
</span><span id="line-741"></span><span>            </span><span class="annot"><a href="Chainweb.Version.html#PowConsensus"><span class="hs-identifier hs-type">PowConsensus</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO [IO ()]
forall a. IO [a]
</span><a href="#local-6989586621681510550"><span class="hs-identifier hs-var">disabled</span></a></span><span>
</span><span id="line-742"></span><span>            </span><span class="annot"><a href="Chainweb.Version.html#TimedCPM"><span class="hs-identifier hs-type">TimedCPM</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MempoolP2pConfig -&gt; IO [IO ()]
</span><a href="#local-6989586621681510544"><span class="hs-identifier hs-var">enabled</span></a></span><span> </span><span class="annot"><span class="annottext">MempoolP2pConfig
</span><a href="#local-6989586621681510549"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-743"></span><span>            </span><span class="annot"><a href="Chainweb.Version.html#FastTimedCPM"><span class="hs-identifier hs-type">FastTimedCPM</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MempoolP2pConfig -&gt; IO [IO ()]
</span><a href="#local-6989586621681510544"><span class="hs-identifier hs-var">enabled</span></a></span><span> </span><span class="annot"><span class="annottext">MempoolP2pConfig
</span><a href="#local-6989586621681510549"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-744"></span><span>            </span><span class="annot"><a href="Chainweb.Version.html#Development"><span class="hs-identifier hs-type">Development</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MempoolP2pConfig -&gt; IO [IO ()]
</span><a href="#local-6989586621681510544"><span class="hs-identifier hs-var">enabled</span></a></span><span> </span><span class="annot"><span class="annottext">MempoolP2pConfig
</span><a href="#local-6989586621681510549"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-745"></span><span>            </span><span class="annot"><a href="Chainweb.Version.html#Testnet02"><span class="hs-identifier hs-type">Testnet02</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MempoolP2pConfig -&gt; IO [IO ()]
</span><a href="#local-6989586621681510544"><span class="hs-identifier hs-var">enabled</span></a></span><span> </span><span class="annot"><span class="annottext">MempoolP2pConfig
</span><a href="#local-6989586621681510549"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-746"></span><span>            </span><span class="annot"><a href="Chainweb.Version.html#Mainnet01"><span class="hs-identifier hs-type">Mainnet01</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO [IO ()]
forall a. IO [a]
</span><a href="#local-6989586621681510550"><span class="hs-identifier hs-var">disabled</span></a></span><span>
</span><span id="line-747"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-748"></span><span>        </span><span id="local-6989586621681510550"><span class="annot"><span class="annottext">disabled :: IO [a]
</span><a href="#local-6989586621681510550"><span class="hs-identifier hs-var hs-var">disabled</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-749"></span><span>            </span><span class="annot"><span class="annottext">LogFunctionText
</span><a href="#local-6989586621681510619"><span class="hs-identifier hs-var">logg</span></a></span><span> </span><span class="annot"><span class="annottext">LogLevel
</span><span class="hs-identifier hs-var">Info</span></span><span> </span><span class="annot"><span class="hs-string">&quot;Mempool p2p sync disabled&quot;</span></span><span>
</span><span id="line-750"></span><span>            </span><span class="annot"><span class="annottext">[a] -&gt; IO [a]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-751"></span><span>        </span><span id="local-6989586621681510544"><span class="annot"><span class="annottext">enabled :: MempoolP2pConfig -&gt; IO [IO ()]
</span><a href="#local-6989586621681510544"><span class="hs-identifier hs-var hs-var">enabled</span></a></span></span><span> </span><span id="local-6989586621681510539"><span class="annot"><span class="annottext">conf :: MempoolP2pConfig
</span><a href="#local-6989586621681510539"><span class="hs-identifier hs-var">conf</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-752"></span><span>            </span><span class="annot"><span class="annottext">LogFunctionText
</span><a href="#local-6989586621681510619"><span class="hs-identifier hs-var">logg</span></a></span><span> </span><span class="annot"><span class="annottext">LogLevel
</span><span class="hs-identifier hs-var">Info</span></span><span> </span><span class="annot"><span class="hs-string">&quot;Mempool p2p sync enabled&quot;</span></span><span>
</span><span id="line-753"></span><span>            </span><span class="annot"><span class="annottext">[IO ()] -&gt; IO [IO ()]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">([IO ()] -&gt; IO [IO ()]) -&gt; [IO ()] -&gt; IO [IO ()]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(ChainResources logger -&gt; IO ())
-&gt; [ChainResources logger] -&gt; [IO ()]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Manager -&gt; MempoolP2pConfig -&gt; ChainResources logger -&gt; IO ()
forall logger.
Logger logger =&gt;
Manager -&gt; MempoolP2pConfig -&gt; ChainResources logger -&gt; IO ()
</span><a href="Chainweb.Chainweb.ChainResources.html#runMempoolSyncClient"><span class="hs-identifier hs-var">runMempoolSyncClient</span></a></span><span> </span><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621681510608"><span class="hs-identifier hs-var">mgr</span></a></span><span> </span><span class="annot"><span class="annottext">MempoolP2pConfig
</span><a href="#local-6989586621681510539"><span class="hs-identifier hs-var">conf</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[ChainResources logger]
</span><a href="#local-6989586621681510606"><span class="hs-identifier hs-var">chainVals</span></a></span><span>
</span><span id="line-754"></span></pre></body></html>