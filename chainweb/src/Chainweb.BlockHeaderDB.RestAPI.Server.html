<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE BangPatterns #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE DataKinds #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE KindSignatures #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE TypeApplications #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies #-}</span><span>
</span><span id="line-10"></span><span>
</span><span id="line-11"></span><span class="hs-comment">-- |</span><span>
</span><span id="line-12"></span><span class="hs-comment">-- Module: Chainweb.BlockHeaderDB.RestAPI.Server</span><span>
</span><span id="line-13"></span><span class="hs-comment">-- Copyright: Copyright &#169; 2018 Kadena LLC.</span><span>
</span><span id="line-14"></span><span class="hs-comment">-- License: MIT</span><span>
</span><span id="line-15"></span><span class="hs-comment">-- Maintainer: Lars Kuhtz &lt;lars@kadena.io&gt;</span><span>
</span><span id="line-16"></span><span class="hs-comment">-- Stability: experimental</span><span>
</span><span id="line-17"></span><span class="hs-comment">--</span><span>
</span><span id="line-18"></span><span class="hs-comment">-- TODO</span><span>
</span><span id="line-19"></span><span class="hs-comment">--</span><span>
</span><span id="line-20"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Chainweb.BlockHeaderDB.RestAPI.Server</span><span>
</span><span id="line-21"></span><span class="hs-special">(</span><span>
</span><span id="line-22"></span><span>  </span><span class="annot"><a href="Chainweb.BlockHeaderDB.RestAPI.Server.html#someBlockHeaderDbServer"><span class="hs-identifier">someBlockHeaderDbServer</span></a></span><span>
</span><span id="line-23"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.BlockHeaderDB.RestAPI.Server.html#someBlockHeaderDbServers"><span class="hs-identifier">someBlockHeaderDbServers</span></a></span><span>
</span><span id="line-24"></span><span>
</span><span id="line-25"></span><span class="annot"><span class="hs-comment">-- * Single Chain Server</span></span><span>
</span><span id="line-26"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.BlockHeaderDB.RestAPI.Server.html#blockHeaderDbApp"><span class="hs-identifier">blockHeaderDbApp</span></a></span><span>
</span><span id="line-27"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.BlockHeaderDB.RestAPI.Server.html#blockHeaderDbApiLayout"><span class="hs-identifier">blockHeaderDbApiLayout</span></a></span><span>
</span><span id="line-28"></span><span>
</span><span id="line-29"></span><span class="annot"><span class="hs-comment">-- * Header Stream Server</span></span><span>
</span><span id="line-30"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.BlockHeaderDB.RestAPI.Server.html#someHeaderStreamServer"><span class="hs-identifier">someHeaderStreamServer</span></a></span><span>
</span><span id="line-31"></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-32"></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Applicative</span></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Lens</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">children</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(.=)</span></span><span class="hs-special">)</span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Catch</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">E</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Handler</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">catches</span></span><span class="hs-special">)</span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Except</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">MonadError</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.IO.Class</span></span><span>
</span><span id="line-39"></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Aeson</span></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Binary.Builder</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">fromByteString</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">fromLazyByteString</span></span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BS</span></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Base16</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">B16</span></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Short</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">fromShort</span></span><span class="hs-special">)</span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.CAS</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">casLookupM</span></span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Foldable</span></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Functor.Of</span></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.IORef</span></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Proxy</span></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text.Encoding</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">decodeUtf8</span></span><span class="hs-special">)</span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text.IO</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-52"></span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Network.Wai.EventSource</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ServerEvent</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">eventSourceAppIO</span></span><span class="hs-special">)</span><span>
</span><span id="line-54"></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Prelude</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">lookup</span></span><span class="hs-special">)</span><span>
</span><span id="line-56"></span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Servant.API</span></span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Servant.Server</span></span><span>
</span><span id="line-59"></span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Streaming.Prelude</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">SP</span></span><span>
</span><span id="line-61"></span><span>
</span><span id="line-62"></span><span class="hs-comment">-- internal modules</span><span>
</span><span id="line-63"></span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Chainweb.BlockHeader.html"><span class="hs-identifier">Chainweb.BlockHeader</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.BlockHeader.html#BlockHeader"><span class="hs-identifier">BlockHeader</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.BlockHeader.html#ObjectEncoded"><span class="hs-identifier">ObjectEncoded</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.BlockHeader.html#_blockPow"><span class="hs-identifier">_blockPow</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Chainweb.BlockHeader.Validation.html"><span class="hs-identifier">Chainweb.BlockHeader.Validation</span></a></span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Chainweb.BlockHeaderDB.html"><span class="hs-identifier">Chainweb.BlockHeaderDB</span></a></span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Chainweb.BlockHeaderDB.RestAPI.html"><span class="hs-identifier">Chainweb.BlockHeaderDB.RestAPI</span></a></span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Chainweb.ChainId.html"><span class="hs-identifier">Chainweb.ChainId</span></a></span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Chainweb.CutDB.html"><span class="hs-identifier">Chainweb.CutDB</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.CutDB.Types.html#CutDb"><span class="hs-identifier">CutDb</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.CutDB.html#blockDiffStream"><span class="hs-identifier">blockDiffStream</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.CutDB.html#cutDbPayloadStore"><span class="hs-identifier">cutDbPayloadStore</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Chainweb.Difficulty.html"><span class="hs-identifier">Chainweb.Difficulty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.Difficulty.html#showTargetHex"><span class="hs-identifier">showTargetHex</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Chainweb.Payload.html"><span class="hs-identifier">Chainweb.Payload</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.Payload.html#PayloadWithOutputs"><span class="hs-identifier">PayloadWithOutputs</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Chainweb.Payload.PayloadStore.Types.html"><span class="hs-identifier">Chainweb.Payload.PayloadStore.Types</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.Payload.PayloadStore.Types.html#PayloadCas"><span class="hs-identifier">PayloadCas</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.Payload.PayloadStore.Types.html#PayloadDb"><span class="hs-identifier">PayloadDb</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Chainweb.PowHash.html"><span class="hs-identifier">Chainweb.PowHash</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.PowHash.html#powHashBytes"><span class="hs-identifier">powHashBytes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-74"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Chainweb.RestAPI.Orphans.html"><span class="hs-identifier">Chainweb.RestAPI.Orphans</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-75"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Chainweb.RestAPI.Utils.html"><span class="hs-identifier">Chainweb.RestAPI.Utils</span></a></span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Chainweb.Sync.WebBlockHeaderStore.html"><span class="hs-identifier">Chainweb.Sync.WebBlockHeaderStore</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.Sync.WebBlockHeaderStore.Types.html#_webBlockPayloadStoreCas"><span class="hs-identifier">_webBlockPayloadStoreCas</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-77"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Chainweb.TreeDB.html"><span class="hs-identifier">Chainweb.TreeDB</span></a></span><span>
</span><span id="line-78"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Chainweb.Utils.html"><span class="hs-identifier">Chainweb.Utils</span></a></span><span>
</span><span id="line-79"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Chainweb.Utils.Paging.html"><span class="hs-identifier">Chainweb.Utils.Paging</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.Utils.Paging.html#properties"><span class="hs-identifier">properties</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-80"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Chainweb.Version.html"><span class="hs-identifier">Chainweb.Version</span></a></span><span>
</span><span id="line-81"></span><span>
</span><span id="line-82"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Data.Singletons.html"><span class="hs-identifier">Data.Singletons</span></a></span><span>
</span><span id="line-83"></span><span>
</span><span id="line-84"></span><span class="hs-comment">-- -------------------------------------------------------------------------- --</span><span>
</span><span id="line-85"></span><span class="hs-comment">-- Handler Tools</span><span>
</span><span id="line-86"></span><span>
</span><span id="line-87"></span><span id="local-6989586621681510121"><span id="local-6989586621681510122"><span class="annot"><a href="Chainweb.BlockHeaderDB.RestAPI.Server.html#checkKey"><span class="hs-identifier hs-type">checkKey</span></a></span><span>
</span><span id="line-88"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ServerError</span></span><span> </span><span class="annot"><a href="#local-6989586621681510122"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-89"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621681510122"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-90"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Chainweb.TreeDB.html#TreeDb"><span class="hs-identifier hs-type">TreeDb</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681510121"><span class="hs-identifier hs-type">db</span></a></span><span>
</span><span id="line-91"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ToJSON</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.TreeDB.html#DbKey"><span class="hs-identifier hs-type">DbKey</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681510121"><span class="hs-identifier hs-type">db</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-92"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681510121"><span class="hs-identifier hs-type">db</span></a></span><span>
</span><span id="line-93"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Chainweb.TreeDB.html#DbKey"><span class="hs-identifier hs-type">DbKey</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681510121"><span class="hs-identifier hs-type">db</span></a></span><span>
</span><span id="line-94"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681510122"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.TreeDB.html#DbKey"><span class="hs-identifier hs-type">DbKey</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681510121"><span class="hs-identifier hs-type">db</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-95"></span><span id="checkKey"><span class="annot"><span class="annottext">checkKey :: db -&gt; DbKey db -&gt; m (DbKey db)
</span><a href="Chainweb.BlockHeaderDB.RestAPI.Server.html#checkKey"><span class="hs-identifier hs-var hs-var">checkKey</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621681509894"><span class="annot"><span class="annottext">db
</span><a href="#local-6989586621681509894"><span class="hs-identifier hs-var">db</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621681509893"><span class="annot"><span class="annottext">DbKey db
</span><a href="#local-6989586621681509893"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO (Maybe (DbEntry db)) -&gt; m (Maybe (DbEntry db))
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">db -&gt; DbKey db -&gt; IO (Maybe (DbEntry db))
forall db. TreeDb db =&gt; db -&gt; DbKey db -&gt; IO (Maybe (DbEntry db))
</span><a href="Chainweb.TreeDB.html#lookup"><span class="hs-identifier hs-var">lookup</span></a></span><span> </span><span class="annot"><span class="annottext">db
</span><a href="#local-6989586621681509894"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="annot"><span class="annottext">DbKey db
</span><a href="#local-6989586621681509893"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">m (Maybe (DbEntry db))
-&gt; (Maybe (DbEntry db) -&gt; m (DbKey db)) -&gt; m (DbKey db)
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-96"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ServerError -&gt; m (DbKey db)
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(ServerError -&gt; m (DbKey db)) -&gt; ServerError -&gt; m (DbKey db)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Value -&gt; ServerError
forall msg. ToJSON msg =&gt; msg -&gt; ServerError
</span><a href="Chainweb.BlockHeaderDB.RestAPI.Server.html#err404Msg"><span class="hs-identifier hs-var">err404Msg</span></a></span><span> </span><span class="annot"><span class="annottext">(Value -&gt; ServerError) -&gt; Value -&gt; ServerError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Pair] -&gt; Value
</span><span class="hs-identifier hs-var">object</span></span><span>
</span><span id="line-97"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;reason&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; String -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Text -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;key not found&quot;</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">)</span><span>
</span><span id="line-98"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;key&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; DbKey db -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Text -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="annot"><span class="annottext">DbKey db
</span><a href="#local-6989586621681509893"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-99"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-100"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DbKey db -&gt; m (DbKey db)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">DbKey db
</span><a href="#local-6989586621681509893"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-101"></span><span>
</span><span id="line-102"></span><span id="local-6989586621681510149"><span class="annot"><a href="Chainweb.BlockHeaderDB.RestAPI.Server.html#err404Msg"><span class="hs-identifier hs-type">err404Msg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ToJSON</span></span><span> </span><span class="annot"><a href="#local-6989586621681510149"><span class="hs-identifier hs-type">msg</span></a></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681510149"><span class="hs-identifier hs-type">msg</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ServerError</span></span></span><span>
</span><span id="line-103"></span><span id="err404Msg"><span class="annot"><span class="annottext">err404Msg :: msg -&gt; ServerError
</span><a href="Chainweb.BlockHeaderDB.RestAPI.Server.html#err404Msg"><span class="hs-identifier hs-var hs-var">err404Msg</span></a></span></span><span> </span><span id="local-6989586621681509886"><span class="annot"><span class="annottext">msg :: msg
</span><a href="#local-6989586621681509886"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ServerError :: Int -&gt; String -&gt; ByteString -&gt; [Header] -&gt; ServerError
</span><span class="hs-identifier hs-type hs-type">ServerError</span></span><span>
</span><span id="line-104"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">errHTTPCode :: Int
</span><span class="hs-identifier hs-var">errHTTPCode</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-number">404</span></span><span>
</span><span id="line-105"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">errReasonPhrase :: String
</span><span class="hs-identifier hs-var">errReasonPhrase</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-string">&quot;Not Found&quot;</span></span><span>
</span><span id="line-106"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">errBody :: ByteString
</span><span class="hs-identifier hs-var">errBody</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">msg -&gt; ByteString
forall a. ToJSON a =&gt; a -&gt; ByteString
</span><span class="hs-identifier hs-var">encode</span></span><span> </span><span class="annot"><span class="annottext">msg
</span><a href="#local-6989586621681509886"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-107"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">errHeaders :: [Header]
</span><span class="hs-identifier hs-var">errHeaders</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-108"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-109"></span><span>
</span><span id="line-110"></span><span class="hs-comment">-- | Confirm if keys comprising the given bounds exist within a `TreeDb`.</span><span>
</span><span id="line-111"></span><span class="hs-comment">--</span><span>
</span><span id="line-112"></span><span id="local-6989586621681510101"><span id="local-6989586621681510102"><span class="annot"><a href="Chainweb.BlockHeaderDB.RestAPI.Server.html#checkBounds"><span class="hs-identifier hs-type">checkBounds</span></a></span><span>
</span><span id="line-113"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ServerError</span></span><span> </span><span class="annot"><a href="#local-6989586621681510102"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-114"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621681510102"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-115"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ToJSON</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.TreeDB.html#DbKey"><span class="hs-identifier hs-type">DbKey</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681510101"><span class="hs-identifier hs-type">db</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-116"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Chainweb.TreeDB.html#TreeDb"><span class="hs-identifier hs-type">TreeDb</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681510101"><span class="hs-identifier hs-type">db</span></a></span><span>
</span><span id="line-117"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681510101"><span class="hs-identifier hs-type">db</span></a></span><span>
</span><span id="line-118"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Chainweb.TreeDB.html#BranchBounds"><span class="hs-identifier hs-type">BranchBounds</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681510101"><span class="hs-identifier hs-type">db</span></a></span><span>
</span><span id="line-119"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681510102"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.TreeDB.html#BranchBounds"><span class="hs-identifier hs-type">BranchBounds</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681510101"><span class="hs-identifier hs-type">db</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-120"></span><span id="checkBounds"><span class="annot"><span class="annottext">checkBounds :: db -&gt; BranchBounds db -&gt; m (BranchBounds db)
</span><a href="Chainweb.BlockHeaderDB.RestAPI.Server.html#checkBounds"><span class="hs-identifier hs-var hs-var">checkBounds</span></a></span></span><span> </span><span id="local-6989586621681509877"><span class="annot"><span class="annottext">db :: db
</span><a href="#local-6989586621681509877"><span class="hs-identifier hs-var">db</span></a></span></span><span> </span><span id="local-6989586621681509876"><span class="annot"><span class="annottext">b :: BranchBounds db
</span><a href="#local-6989586621681509876"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BranchBounds db
</span><a href="#local-6989586621681509876"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-121"></span><span>    </span><span class="annot"><span class="annottext">BranchBounds db -&gt; m () -&gt; m (BranchBounds db)
forall (f :: * -&gt; *) a b. Functor f =&gt; a -&gt; f b -&gt; f a
</span><span class="hs-operator hs-var">&lt;$</span></span><span> </span><span class="annot"><span class="annottext">(UpperBound (Key (DbEntry db)) -&gt; m (Key (DbEntry db)))
-&gt; HashSet (UpperBound (Key (DbEntry db))) -&gt; m ()
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f ()
</span><span class="hs-identifier hs-var">traverse_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">db -&gt; Key (DbEntry db) -&gt; m (Key (DbEntry db))
forall (m :: * -&gt; *) db.
(MonadError ServerError m, MonadIO m, TreeDb db,
 ToJSON (DbKey db)) =&gt;
db -&gt; DbKey db -&gt; m (DbKey db)
</span><a href="Chainweb.BlockHeaderDB.RestAPI.Server.html#checkKey"><span class="hs-identifier hs-var">checkKey</span></a></span><span> </span><span class="annot"><span class="annottext">db
</span><a href="#local-6989586621681509877"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="annot"><span class="annottext">(Key (DbEntry db) -&gt; m (Key (DbEntry db)))
-&gt; (UpperBound (Key (DbEntry db)) -&gt; Key (DbEntry db))
-&gt; UpperBound (Key (DbEntry db))
-&gt; m (Key (DbEntry db))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">UpperBound (Key (DbEntry db)) -&gt; Key (DbEntry db)
forall k. UpperBound k -&gt; k
</span><a href="Chainweb.TreeDB.html#_getUpperBound"><span class="hs-identifier hs-var hs-var">_getUpperBound</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BranchBounds db -&gt; HashSet (UpperBound (Key (DbEntry db)))
forall db. BranchBounds db -&gt; HashSet (UpperBound (DbKey db))
</span><a href="Chainweb.TreeDB.html#_branchBoundsUpper"><span class="hs-identifier hs-var hs-var">_branchBoundsUpper</span></a></span><span> </span><span class="annot"><span class="annottext">BranchBounds db
</span><a href="#local-6989586621681509876"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-122"></span><span>
</span><span id="line-123"></span><span class="hs-comment">-- -------------------------------------------------------------------------- --</span><span>
</span><span id="line-124"></span><span class="hs-comment">-- Handlers</span><span>
</span><span id="line-125"></span><span>
</span><span id="line-126"></span><span id="local-6989586621681510081"><span class="annot"><a href="Chainweb.BlockHeaderDB.RestAPI.Server.html#defaultKeyLimit"><span class="hs-identifier hs-type">defaultKeyLimit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Num</span></span><span> </span><span class="annot"><a href="#local-6989586621681510081"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681510081"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-127"></span><span id="defaultKeyLimit"><span class="annot"><span class="annottext">defaultKeyLimit :: a
</span><a href="Chainweb.BlockHeaderDB.RestAPI.Server.html#defaultKeyLimit"><span class="hs-identifier hs-var hs-var">defaultKeyLimit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-number">4096</span></span><span>
</span><span id="line-128"></span><span>
</span><span id="line-129"></span><span id="local-6989586621681509869"><span class="annot"><a href="Chainweb.BlockHeaderDB.RestAPI.Server.html#defaultEntryLimit"><span class="hs-identifier hs-type">defaultEntryLimit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Num</span></span><span> </span><span class="annot"><a href="#local-6989586621681509869"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681509869"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-130"></span><span id="defaultEntryLimit"><span class="annot"><span class="annottext">defaultEntryLimit :: a
</span><a href="Chainweb.BlockHeaderDB.RestAPI.Server.html#defaultEntryLimit"><span class="hs-identifier hs-var hs-var">defaultEntryLimit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-number">360</span></span><span>
</span><span id="line-131"></span><span>
</span><span id="line-132"></span><span class="hs-comment">-- | Query Branch Hashes of the database.</span><span>
</span><span id="line-133"></span><span class="hs-comment">--</span><span>
</span><span id="line-134"></span><span class="hs-comment">-- Cf. &quot;Chainweb.BlockHeaderDB.RestAPI&quot; for more details</span><span>
</span><span id="line-135"></span><span class="hs-comment">--</span><span>
</span><span id="line-136"></span><span id="local-6989586621681510037"><span class="annot"><a href="Chainweb.BlockHeaderDB.RestAPI.Server.html#branchHashesHandler"><span class="hs-identifier hs-type">branchHashesHandler</span></a></span><span>
</span><span id="line-137"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Chainweb.TreeDB.html#TreeDb"><span class="hs-identifier hs-type">TreeDb</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681510037"><span class="hs-identifier hs-type">db</span></a></span><span>
</span><span id="line-138"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ToJSON</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.TreeDB.html#DbKey"><span class="hs-identifier hs-type">DbKey</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681510037"><span class="hs-identifier hs-type">db</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-139"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681510037"><span class="hs-identifier hs-type">db</span></a></span><span>
</span><span id="line-140"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Chainweb.Utils.Paging.html#Limit"><span class="hs-identifier hs-type">Limit</span></a></span><span>
</span><span id="line-141"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.Utils.Paging.html#NextItem"><span class="hs-identifier hs-type">NextItem</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.TreeDB.html#DbKey"><span class="hs-identifier hs-type">DbKey</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681510037"><span class="hs-identifier hs-type">db</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-142"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Chainweb.TreeDB.html#MinRank"><span class="hs-identifier hs-type">MinRank</span></a></span><span>
</span><span id="line-143"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Chainweb.TreeDB.html#MaxRank"><span class="hs-identifier hs-type">MaxRank</span></a></span><span>
</span><span id="line-144"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Chainweb.TreeDB.html#BranchBounds"><span class="hs-identifier hs-type">BranchBounds</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681510037"><span class="hs-identifier hs-type">db</span></a></span><span>
</span><span id="line-145"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Handler</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.Utils.Paging.html#Page"><span class="hs-identifier hs-type">Page</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.Utils.Paging.html#NextItem"><span class="hs-identifier hs-type">NextItem</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.TreeDB.html#DbKey"><span class="hs-identifier hs-type">DbKey</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681510037"><span class="hs-identifier hs-type">db</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.TreeDB.html#DbKey"><span class="hs-identifier hs-type">DbKey</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681510037"><span class="hs-identifier hs-type">db</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-146"></span><span id="branchHashesHandler"><span class="annot"><span class="annottext">branchHashesHandler :: db
-&gt; Maybe Limit
-&gt; Maybe (NextItem (DbKey db))
-&gt; Maybe MinRank
-&gt; Maybe MaxRank
-&gt; BranchBounds db
-&gt; Handler (Page (NextItem (DbKey db)) (DbKey db))
</span><a href="Chainweb.BlockHeaderDB.RestAPI.Server.html#branchHashesHandler"><span class="hs-identifier hs-var hs-var">branchHashesHandler</span></a></span></span><span> </span><span id="local-6989586621681509866"><span class="annot"><span class="annottext">db :: db
</span><a href="#local-6989586621681509866"><span class="hs-identifier hs-var">db</span></a></span></span><span> </span><span id="local-6989586621681509865"><span class="annot"><span class="annottext">limit :: Maybe Limit
</span><a href="#local-6989586621681509865"><span class="hs-identifier hs-var">limit</span></a></span></span><span> </span><span id="local-6989586621681509864"><span class="annot"><span class="annottext">next :: Maybe (NextItem (DbKey db))
</span><a href="#local-6989586621681509864"><span class="hs-identifier hs-var">next</span></a></span></span><span> </span><span id="local-6989586621681509863"><span class="annot"><span class="annottext">minr :: Maybe MinRank
</span><a href="#local-6989586621681509863"><span class="hs-identifier hs-var">minr</span></a></span></span><span> </span><span id="local-6989586621681509862"><span class="annot"><span class="annottext">maxr :: Maybe MaxRank
</span><a href="#local-6989586621681509862"><span class="hs-identifier hs-var">maxr</span></a></span></span><span> </span><span id="local-6989586621681509861"><span class="annot"><span class="annottext">bounds :: BranchBounds db
</span><a href="#local-6989586621681509861"><span class="hs-identifier hs-var">bounds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-147"></span><span>    </span><span id="local-6989586621681509860"><span class="annot"><span class="annottext">Maybe (NextItem (DbKey db))
</span><a href="#local-6989586621681509860"><span class="hs-identifier hs-var">nextChecked</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(NextItem (DbKey db) -&gt; Handler (NextItem (DbKey db)))
-&gt; Maybe (NextItem (DbKey db))
-&gt; Handler (Maybe (NextItem (DbKey db)))
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(DbKey db -&gt; Handler (DbKey db))
-&gt; NextItem (DbKey db) -&gt; Handler (NextItem (DbKey db))
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="annot"><span class="annottext">((DbKey db -&gt; Handler (DbKey db))
 -&gt; NextItem (DbKey db) -&gt; Handler (NextItem (DbKey db)))
-&gt; (DbKey db -&gt; Handler (DbKey db))
-&gt; NextItem (DbKey db)
-&gt; Handler (NextItem (DbKey db))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">db -&gt; DbKey db -&gt; Handler (DbKey db)
forall (m :: * -&gt; *) db.
(MonadError ServerError m, MonadIO m, TreeDb db,
 ToJSON (DbKey db)) =&gt;
db -&gt; DbKey db -&gt; m (DbKey db)
</span><a href="Chainweb.BlockHeaderDB.RestAPI.Server.html#checkKey"><span class="hs-identifier hs-var">checkKey</span></a></span><span> </span><span class="annot"><span class="annottext">db
</span><a href="#local-6989586621681509866"><span class="hs-identifier hs-var">db</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe (NextItem (DbKey db))
</span><a href="#local-6989586621681509864"><span class="hs-identifier hs-var">next</span></a></span><span>
</span><span id="line-148"></span><span>    </span><span id="local-6989586621681509858"><span class="annot"><span class="annottext">BranchBounds db
</span><a href="#local-6989586621681509858"><span class="hs-identifier hs-var">checkedBounds</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">db -&gt; BranchBounds db -&gt; Handler (BranchBounds db)
forall (m :: * -&gt; *) db.
(MonadError ServerError m, MonadIO m, ToJSON (DbKey db),
 TreeDb db) =&gt;
db -&gt; BranchBounds db -&gt; m (BranchBounds db)
</span><a href="Chainweb.BlockHeaderDB.RestAPI.Server.html#checkBounds"><span class="hs-identifier hs-var">checkBounds</span></a></span><span> </span><span class="annot"><span class="annottext">db
</span><a href="#local-6989586621681509866"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="annot"><span class="annottext">BranchBounds db
</span><a href="#local-6989586621681509861"><span class="hs-identifier hs-var">bounds</span></a></span><span>
</span><span id="line-149"></span><span>    </span><span class="annot"><span class="annottext">IO (Page (NextItem (DbKey db)) (DbKey db))
-&gt; Handler (Page (NextItem (DbKey db)) (DbKey db))
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span>
</span><span id="line-150"></span><span>        </span><span class="annot"><span class="annottext">(IO (Page (NextItem (DbKey db)) (DbKey db))
 -&gt; Handler (Page (NextItem (DbKey db)) (DbKey db)))
-&gt; IO (Page (NextItem (DbKey db)) (DbKey db))
-&gt; Handler (Page (NextItem (DbKey db)) (DbKey db))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">db
-&gt; Maybe (NextItem (DbKey db))
-&gt; Maybe Limit
-&gt; Maybe MinRank
-&gt; Maybe MaxRank
-&gt; HashSet (LowerBound (DbKey db))
-&gt; HashSet (UpperBound (DbKey db))
-&gt; (Stream (Of (DbKey db)) IO (Natural, Eos)
    -&gt; IO (Page (NextItem (DbKey db)) (DbKey db)))
-&gt; IO (Page (NextItem (DbKey db)) (DbKey db))
forall db a.
TreeDb db =&gt;
db
-&gt; Maybe (NextItem (DbKey db))
-&gt; Maybe Limit
-&gt; Maybe MinRank
-&gt; Maybe MaxRank
-&gt; HashSet (LowerBound (DbKey db))
-&gt; HashSet (UpperBound (DbKey db))
-&gt; (Stream (Of (DbKey db)) IO (Natural, Eos) -&gt; IO a)
-&gt; IO a
</span><a href="Chainweb.TreeDB.html#branchKeys"><span class="hs-identifier hs-var">branchKeys</span></a></span><span> </span><span class="annot"><span class="annottext">db
</span><a href="#local-6989586621681509866"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (NextItem (DbKey db))
</span><a href="#local-6989586621681509860"><span class="hs-identifier hs-var">nextChecked</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Limit -&gt; Limit
forall a. Enum a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">succ</span></span><span> </span><span class="annot"><span class="annottext">(Limit -&gt; Limit) -&gt; Maybe Limit -&gt; Maybe Limit
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe Limit
</span><a href="#local-6989586621681509854"><span class="hs-identifier hs-var">effectiveLimit</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe MinRank
</span><a href="#local-6989586621681509863"><span class="hs-identifier hs-var">minr</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe MaxRank
</span><a href="#local-6989586621681509862"><span class="hs-identifier hs-var">maxr</span></a></span><span>
</span><span id="line-151"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BranchBounds db -&gt; HashSet (LowerBound (DbKey db))
forall db. BranchBounds db -&gt; HashSet (LowerBound (DbKey db))
</span><a href="Chainweb.TreeDB.html#_branchBoundsLower"><span class="hs-identifier hs-var hs-var">_branchBoundsLower</span></a></span><span> </span><span class="annot"><span class="annottext">BranchBounds db
</span><a href="#local-6989586621681509858"><span class="hs-identifier hs-var">checkedBounds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-152"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BranchBounds db -&gt; HashSet (UpperBound (DbKey db))
forall db. BranchBounds db -&gt; HashSet (UpperBound (DbKey db))
</span><a href="Chainweb.TreeDB.html#_branchBoundsUpper"><span class="hs-identifier hs-var hs-var">_branchBoundsUpper</span></a></span><span> </span><span class="annot"><span class="annottext">BranchBounds db
</span><a href="#local-6989586621681509858"><span class="hs-identifier hs-var">checkedBounds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-153"></span><span>        </span><span class="annot"><span class="annottext">((Stream (Of (DbKey db)) IO (Natural, Eos)
  -&gt; IO (Page (NextItem (DbKey db)) (DbKey db)))
 -&gt; IO (Page (NextItem (DbKey db)) (DbKey db)))
-&gt; (Stream (Of (DbKey db)) IO (Natural, Eos)
    -&gt; IO (Page (NextItem (DbKey db)) (DbKey db)))
-&gt; IO (Page (NextItem (DbKey db)) (DbKey db))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(DbKey db -&gt; DbKey db)
-&gt; Maybe Limit
-&gt; Stream (Of (DbKey db)) IO ()
-&gt; IO (Page (NextItem (DbKey db)) (DbKey db))
forall (m :: * -&gt; *) a k.
Monad m =&gt;
(a -&gt; k)
-&gt; Maybe Limit -&gt; Stream (Of a) m () -&gt; m (Page (NextItem k) a)
</span><a href="Chainweb.Utils.Paging.html#finiteStreamToPage"><span class="hs-identifier hs-var">finiteStreamToPage</span></a></span><span> </span><span class="annot"><span class="annottext">DbKey db -&gt; DbKey db
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="annot"><span class="annottext">Maybe Limit
</span><a href="#local-6989586621681509854"><span class="hs-identifier hs-var">effectiveLimit</span></a></span><span> </span><span class="annot"><span class="annottext">(Stream (Of (DbKey db)) IO ()
 -&gt; IO (Page (NextItem (DbKey db)) (DbKey db)))
-&gt; (Stream (Of (DbKey db)) IO (Natural, Eos)
    -&gt; Stream (Of (DbKey db)) IO ())
-&gt; Stream (Of (DbKey db)) IO (Natural, Eos)
-&gt; IO (Page (NextItem (DbKey db)) (DbKey db))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Stream (Of (DbKey db)) IO (Natural, Eos)
-&gt; Stream (Of (DbKey db)) IO ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span>
</span><span id="line-154"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-155"></span><span>    </span><span id="local-6989586621681509854"><span class="annot"><span class="annottext">effectiveLimit :: Maybe Limit
</span><a href="#local-6989586621681509854"><span class="hs-identifier hs-var hs-var">effectiveLimit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Limit
</span><a href="#local-6989586621681509865"><span class="hs-identifier hs-var">limit</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Limit -&gt; Maybe Limit -&gt; Maybe Limit
forall (f :: * -&gt; *) a. Alternative f =&gt; f a -&gt; f a -&gt; f a
</span><span class="hs-operator hs-var">&lt;|&gt;</span></span><span> </span><span class="annot"><span class="annottext">Limit -&gt; Maybe Limit
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Limit
forall a. Num a =&gt; a
</span><a href="Chainweb.BlockHeaderDB.RestAPI.Server.html#defaultKeyLimit"><span class="hs-identifier hs-var">defaultKeyLimit</span></a></span><span>
</span><span id="line-156"></span><span>
</span><span id="line-157"></span><span class="hs-comment">-- | Query Branch Headers of the database.</span><span>
</span><span id="line-158"></span><span class="hs-comment">--</span><span>
</span><span id="line-159"></span><span class="hs-comment">-- Cf. &quot;Chainweb.BlockHeaderDB.RestAPI&quot; for more details</span><span>
</span><span id="line-160"></span><span class="hs-comment">--</span><span>
</span><span id="line-161"></span><span id="local-6989586621681510036"><span class="annot"><a href="Chainweb.BlockHeaderDB.RestAPI.Server.html#branchHeadersHandler"><span class="hs-identifier hs-type">branchHeadersHandler</span></a></span><span>
</span><span id="line-162"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Chainweb.TreeDB.html#TreeDb"><span class="hs-identifier hs-type">TreeDb</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681510036"><span class="hs-identifier hs-type">db</span></a></span><span>
</span><span id="line-163"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ToJSON</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.TreeDB.html#DbKey"><span class="hs-identifier hs-type">DbKey</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681510036"><span class="hs-identifier hs-type">db</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-164"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681510036"><span class="hs-identifier hs-type">db</span></a></span><span>
</span><span id="line-165"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Chainweb.Utils.Paging.html#Limit"><span class="hs-identifier hs-type">Limit</span></a></span><span>
</span><span id="line-166"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.Utils.Paging.html#NextItem"><span class="hs-identifier hs-type">NextItem</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.TreeDB.html#DbKey"><span class="hs-identifier hs-type">DbKey</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681510036"><span class="hs-identifier hs-type">db</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-167"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Chainweb.TreeDB.html#MinRank"><span class="hs-identifier hs-type">MinRank</span></a></span><span>
</span><span id="line-168"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Chainweb.TreeDB.html#MaxRank"><span class="hs-identifier hs-type">MaxRank</span></a></span><span>
</span><span id="line-169"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Chainweb.TreeDB.html#BranchBounds"><span class="hs-identifier hs-type">BranchBounds</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681510036"><span class="hs-identifier hs-type">db</span></a></span><span>
</span><span id="line-170"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Handler</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.Utils.Paging.html#Page"><span class="hs-identifier hs-type">Page</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.Utils.Paging.html#NextItem"><span class="hs-identifier hs-type">NextItem</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.TreeDB.html#DbKey"><span class="hs-identifier hs-type">DbKey</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681510036"><span class="hs-identifier hs-type">db</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.TreeDB.html#DbEntry"><span class="hs-identifier hs-type">DbEntry</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681510036"><span class="hs-identifier hs-type">db</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-171"></span><span id="branchHeadersHandler"><span class="annot"><span class="annottext">branchHeadersHandler :: db
-&gt; Maybe Limit
-&gt; Maybe (NextItem (DbKey db))
-&gt; Maybe MinRank
-&gt; Maybe MaxRank
-&gt; BranchBounds db
-&gt; Handler (Page (NextItem (DbKey db)) (DbEntry db))
</span><a href="Chainweb.BlockHeaderDB.RestAPI.Server.html#branchHeadersHandler"><span class="hs-identifier hs-var hs-var">branchHeadersHandler</span></a></span></span><span> </span><span id="local-6989586621681509847"><span class="annot"><span class="annottext">db :: db
</span><a href="#local-6989586621681509847"><span class="hs-identifier hs-var">db</span></a></span></span><span> </span><span id="local-6989586621681509846"><span class="annot"><span class="annottext">limit :: Maybe Limit
</span><a href="#local-6989586621681509846"><span class="hs-identifier hs-var">limit</span></a></span></span><span> </span><span id="local-6989586621681509845"><span class="annot"><span class="annottext">next :: Maybe (NextItem (DbKey db))
</span><a href="#local-6989586621681509845"><span class="hs-identifier hs-var">next</span></a></span></span><span> </span><span id="local-6989586621681509844"><span class="annot"><span class="annottext">minr :: Maybe MinRank
</span><a href="#local-6989586621681509844"><span class="hs-identifier hs-var">minr</span></a></span></span><span> </span><span id="local-6989586621681509843"><span class="annot"><span class="annottext">maxr :: Maybe MaxRank
</span><a href="#local-6989586621681509843"><span class="hs-identifier hs-var">maxr</span></a></span></span><span> </span><span id="local-6989586621681509842"><span class="annot"><span class="annottext">bounds :: BranchBounds db
</span><a href="#local-6989586621681509842"><span class="hs-identifier hs-var">bounds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-172"></span><span>    </span><span id="local-6989586621681509841"><span class="annot"><span class="annottext">Maybe (NextItem (DbKey db))
</span><a href="#local-6989586621681509841"><span class="hs-identifier hs-var">nextChecked</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(NextItem (DbKey db) -&gt; Handler (NextItem (DbKey db)))
-&gt; Maybe (NextItem (DbKey db))
-&gt; Handler (Maybe (NextItem (DbKey db)))
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(DbKey db -&gt; Handler (DbKey db))
-&gt; NextItem (DbKey db) -&gt; Handler (NextItem (DbKey db))
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="annot"><span class="annottext">((DbKey db -&gt; Handler (DbKey db))
 -&gt; NextItem (DbKey db) -&gt; Handler (NextItem (DbKey db)))
-&gt; (DbKey db -&gt; Handler (DbKey db))
-&gt; NextItem (DbKey db)
-&gt; Handler (NextItem (DbKey db))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">db -&gt; DbKey db -&gt; Handler (DbKey db)
forall (m :: * -&gt; *) db.
(MonadError ServerError m, MonadIO m, TreeDb db,
 ToJSON (DbKey db)) =&gt;
db -&gt; DbKey db -&gt; m (DbKey db)
</span><a href="Chainweb.BlockHeaderDB.RestAPI.Server.html#checkKey"><span class="hs-identifier hs-var">checkKey</span></a></span><span> </span><span class="annot"><span class="annottext">db
</span><a href="#local-6989586621681509847"><span class="hs-identifier hs-var">db</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe (NextItem (DbKey db))
</span><a href="#local-6989586621681509845"><span class="hs-identifier hs-var">next</span></a></span><span>
</span><span id="line-173"></span><span>    </span><span id="local-6989586621681509840"><span class="annot"><span class="annottext">BranchBounds db
</span><a href="#local-6989586621681509840"><span class="hs-identifier hs-var">checkedBounds</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">db -&gt; BranchBounds db -&gt; Handler (BranchBounds db)
forall (m :: * -&gt; *) db.
(MonadError ServerError m, MonadIO m, ToJSON (DbKey db),
 TreeDb db) =&gt;
db -&gt; BranchBounds db -&gt; m (BranchBounds db)
</span><a href="Chainweb.BlockHeaderDB.RestAPI.Server.html#checkBounds"><span class="hs-identifier hs-var">checkBounds</span></a></span><span> </span><span class="annot"><span class="annottext">db
</span><a href="#local-6989586621681509847"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="annot"><span class="annottext">BranchBounds db
</span><a href="#local-6989586621681509842"><span class="hs-identifier hs-var">bounds</span></a></span><span>
</span><span id="line-174"></span><span>    </span><span class="annot"><span class="annottext">IO (Page (NextItem (DbKey db)) (DbEntry db))
-&gt; Handler (Page (NextItem (DbKey db)) (DbEntry db))
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span>
</span><span id="line-175"></span><span>        </span><span class="annot"><span class="annottext">(IO (Page (NextItem (DbKey db)) (DbEntry db))
 -&gt; Handler (Page (NextItem (DbKey db)) (DbEntry db)))
-&gt; IO (Page (NextItem (DbKey db)) (DbEntry db))
-&gt; Handler (Page (NextItem (DbKey db)) (DbEntry db))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">db
-&gt; Maybe (NextItem (DbKey db))
-&gt; Maybe Limit
-&gt; Maybe MinRank
-&gt; Maybe MaxRank
-&gt; HashSet (LowerBound (DbKey db))
-&gt; HashSet (UpperBound (DbKey db))
-&gt; (Stream (Of (DbEntry db)) IO (Natural, Eos)
    -&gt; IO (Page (NextItem (DbKey db)) (DbEntry db)))
-&gt; IO (Page (NextItem (DbKey db)) (DbEntry db))
forall db a.
TreeDb db =&gt;
db
-&gt; Maybe (NextItem (DbKey db))
-&gt; Maybe Limit
-&gt; Maybe MinRank
-&gt; Maybe MaxRank
-&gt; HashSet (LowerBound (DbKey db))
-&gt; HashSet (UpperBound (DbKey db))
-&gt; (Stream (Of (DbEntry db)) IO (Natural, Eos) -&gt; IO a)
-&gt; IO a
</span><a href="Chainweb.TreeDB.html#branchEntries"><span class="hs-identifier hs-var">branchEntries</span></a></span><span> </span><span class="annot"><span class="annottext">db
</span><a href="#local-6989586621681509847"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (NextItem (DbKey db))
</span><a href="#local-6989586621681509841"><span class="hs-identifier hs-var">nextChecked</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Limit -&gt; Limit
forall a. Enum a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">succ</span></span><span> </span><span class="annot"><span class="annottext">(Limit -&gt; Limit) -&gt; Maybe Limit -&gt; Maybe Limit
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe Limit
</span><a href="#local-6989586621681509838"><span class="hs-identifier hs-var">effectiveLimit</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe MinRank
</span><a href="#local-6989586621681509844"><span class="hs-identifier hs-var">minr</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe MaxRank
</span><a href="#local-6989586621681509843"><span class="hs-identifier hs-var">maxr</span></a></span><span>
</span><span id="line-176"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BranchBounds db -&gt; HashSet (LowerBound (DbKey db))
forall db. BranchBounds db -&gt; HashSet (LowerBound (DbKey db))
</span><a href="Chainweb.TreeDB.html#_branchBoundsLower"><span class="hs-identifier hs-var hs-var">_branchBoundsLower</span></a></span><span> </span><span class="annot"><span class="annottext">BranchBounds db
</span><a href="#local-6989586621681509840"><span class="hs-identifier hs-var">checkedBounds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-177"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BranchBounds db -&gt; HashSet (UpperBound (DbKey db))
forall db. BranchBounds db -&gt; HashSet (UpperBound (DbKey db))
</span><a href="Chainweb.TreeDB.html#_branchBoundsUpper"><span class="hs-identifier hs-var hs-var">_branchBoundsUpper</span></a></span><span> </span><span class="annot"><span class="annottext">BranchBounds db
</span><a href="#local-6989586621681509840"><span class="hs-identifier hs-var">checkedBounds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-178"></span><span>        </span><span class="annot"><span class="annottext">((Stream (Of (DbEntry db)) IO (Natural, Eos)
  -&gt; IO (Page (NextItem (DbKey db)) (DbEntry db)))
 -&gt; IO (Page (NextItem (DbKey db)) (DbEntry db)))
-&gt; (Stream (Of (DbEntry db)) IO (Natural, Eos)
    -&gt; IO (Page (NextItem (DbKey db)) (DbEntry db)))
-&gt; IO (Page (NextItem (DbKey db)) (DbEntry db))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(DbEntry db -&gt; DbKey db)
-&gt; Maybe Limit
-&gt; Stream (Of (DbEntry db)) IO ()
-&gt; IO (Page (NextItem (DbKey db)) (DbEntry db))
forall (m :: * -&gt; *) a k.
Monad m =&gt;
(a -&gt; k)
-&gt; Maybe Limit -&gt; Stream (Of a) m () -&gt; m (Page (NextItem k) a)
</span><a href="Chainweb.Utils.Paging.html#finiteStreamToPage"><span class="hs-identifier hs-var">finiteStreamToPage</span></a></span><span> </span><span class="annot"><span class="annottext">DbEntry db -&gt; DbKey db
forall e. TreeDbEntry e =&gt; e -&gt; Key e
</span><a href="Chainweb.TreeDB.html#key"><span class="hs-identifier hs-var">key</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Limit
</span><a href="#local-6989586621681509838"><span class="hs-identifier hs-var">effectiveLimit</span></a></span><span> </span><span class="annot"><span class="annottext">(Stream (Of (DbEntry db)) IO ()
 -&gt; IO (Page (NextItem (DbKey db)) (DbEntry db)))
-&gt; (Stream (Of (DbEntry db)) IO (Natural, Eos)
    -&gt; Stream (Of (DbEntry db)) IO ())
-&gt; Stream (Of (DbEntry db)) IO (Natural, Eos)
-&gt; IO (Page (NextItem (DbKey db)) (DbEntry db))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Stream (Of (DbEntry db)) IO (Natural, Eos)
-&gt; Stream (Of (DbEntry db)) IO ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span>
</span><span id="line-179"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-180"></span><span>    </span><span id="local-6989586621681509838"><span class="annot"><span class="annottext">effectiveLimit :: Maybe Limit
</span><a href="#local-6989586621681509838"><span class="hs-identifier hs-var hs-var">effectiveLimit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Limit
</span><a href="#local-6989586621681509846"><span class="hs-identifier hs-var">limit</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Limit -&gt; Maybe Limit -&gt; Maybe Limit
forall (f :: * -&gt; *) a. Alternative f =&gt; f a -&gt; f a -&gt; f a
</span><span class="hs-operator hs-var">&lt;|&gt;</span></span><span> </span><span class="annot"><span class="annottext">Limit -&gt; Maybe Limit
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Limit
forall a. Num a =&gt; a
</span><a href="Chainweb.BlockHeaderDB.RestAPI.Server.html#defaultKeyLimit"><span class="hs-identifier hs-var">defaultKeyLimit</span></a></span><span>
</span><span id="line-181"></span><span>
</span><span id="line-182"></span><span class="hs-comment">-- | Every `TreeDb` key within a given range.</span><span>
</span><span id="line-183"></span><span class="hs-comment">--</span><span>
</span><span id="line-184"></span><span class="hs-comment">-- Cf. &quot;Chainweb.BlockHeaderDB.RestAPI&quot; for more details</span><span>
</span><span id="line-185"></span><span class="hs-comment">--</span><span>
</span><span id="line-186"></span><span id="local-6989586621681510045"><span class="annot"><a href="Chainweb.BlockHeaderDB.RestAPI.Server.html#hashesHandler"><span class="hs-identifier hs-type">hashesHandler</span></a></span><span>
</span><span id="line-187"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Chainweb.TreeDB.html#TreeDb"><span class="hs-identifier hs-type">TreeDb</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681510045"><span class="hs-identifier hs-type">db</span></a></span><span>
</span><span id="line-188"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ToJSON</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.TreeDB.html#DbKey"><span class="hs-identifier hs-type">DbKey</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681510045"><span class="hs-identifier hs-type">db</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-189"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681510045"><span class="hs-identifier hs-type">db</span></a></span><span>
</span><span id="line-190"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Chainweb.Utils.Paging.html#Limit"><span class="hs-identifier hs-type">Limit</span></a></span><span>
</span><span id="line-191"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.Utils.Paging.html#NextItem"><span class="hs-identifier hs-type">NextItem</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.TreeDB.html#DbKey"><span class="hs-identifier hs-type">DbKey</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681510045"><span class="hs-identifier hs-type">db</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-192"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Chainweb.TreeDB.html#MinRank"><span class="hs-identifier hs-type">MinRank</span></a></span><span>
</span><span id="line-193"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Chainweb.TreeDB.html#MaxRank"><span class="hs-identifier hs-type">MaxRank</span></a></span><span>
</span><span id="line-194"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Handler</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.Utils.Paging.html#Page"><span class="hs-identifier hs-type">Page</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.Utils.Paging.html#NextItem"><span class="hs-identifier hs-type">NextItem</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.TreeDB.html#DbKey"><span class="hs-identifier hs-type">DbKey</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681510045"><span class="hs-identifier hs-type">db</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.TreeDB.html#DbKey"><span class="hs-identifier hs-type">DbKey</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681510045"><span class="hs-identifier hs-type">db</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-195"></span><span id="hashesHandler"><span class="annot"><span class="annottext">hashesHandler :: db
-&gt; Maybe Limit
-&gt; Maybe (NextItem (DbKey db))
-&gt; Maybe MinRank
-&gt; Maybe MaxRank
-&gt; Handler (Page (NextItem (DbKey db)) (DbKey db))
</span><a href="Chainweb.BlockHeaderDB.RestAPI.Server.html#hashesHandler"><span class="hs-identifier hs-var hs-var">hashesHandler</span></a></span></span><span> </span><span id="local-6989586621681509835"><span class="annot"><span class="annottext">db :: db
</span><a href="#local-6989586621681509835"><span class="hs-identifier hs-var">db</span></a></span></span><span> </span><span id="local-6989586621681509834"><span class="annot"><span class="annottext">limit :: Maybe Limit
</span><a href="#local-6989586621681509834"><span class="hs-identifier hs-var">limit</span></a></span></span><span> </span><span id="local-6989586621681509833"><span class="annot"><span class="annottext">next :: Maybe (NextItem (DbKey db))
</span><a href="#local-6989586621681509833"><span class="hs-identifier hs-var">next</span></a></span></span><span> </span><span id="local-6989586621681509832"><span class="annot"><span class="annottext">minr :: Maybe MinRank
</span><a href="#local-6989586621681509832"><span class="hs-identifier hs-var">minr</span></a></span></span><span> </span><span id="local-6989586621681509831"><span class="annot"><span class="annottext">maxr :: Maybe MaxRank
</span><a href="#local-6989586621681509831"><span class="hs-identifier hs-var">maxr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-196"></span><span>    </span><span id="local-6989586621681509830"><span class="annot"><span class="annottext">Maybe (NextItem (DbKey db))
</span><a href="#local-6989586621681509830"><span class="hs-identifier hs-var">nextChecked</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(NextItem (DbKey db) -&gt; Handler (NextItem (DbKey db)))
-&gt; Maybe (NextItem (DbKey db))
-&gt; Handler (Maybe (NextItem (DbKey db)))
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(DbKey db -&gt; Handler (DbKey db))
-&gt; NextItem (DbKey db) -&gt; Handler (NextItem (DbKey db))
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="annot"><span class="annottext">((DbKey db -&gt; Handler (DbKey db))
 -&gt; NextItem (DbKey db) -&gt; Handler (NextItem (DbKey db)))
-&gt; (DbKey db -&gt; Handler (DbKey db))
-&gt; NextItem (DbKey db)
-&gt; Handler (NextItem (DbKey db))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">db -&gt; DbKey db -&gt; Handler (DbKey db)
forall (m :: * -&gt; *) db.
(MonadError ServerError m, MonadIO m, TreeDb db,
 ToJSON (DbKey db)) =&gt;
db -&gt; DbKey db -&gt; m (DbKey db)
</span><a href="Chainweb.BlockHeaderDB.RestAPI.Server.html#checkKey"><span class="hs-identifier hs-var">checkKey</span></a></span><span> </span><span class="annot"><span class="annottext">db
</span><a href="#local-6989586621681509835"><span class="hs-identifier hs-var">db</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe (NextItem (DbKey db))
</span><a href="#local-6989586621681509833"><span class="hs-identifier hs-var">next</span></a></span><span>
</span><span id="line-197"></span><span>    </span><span class="annot"><span class="annottext">IO (Page (NextItem (DbKey db)) (DbKey db))
-&gt; Handler (Page (NextItem (DbKey db)) (DbKey db))
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span>
</span><span id="line-198"></span><span>        </span><span class="annot"><span class="annottext">(IO (Page (NextItem (DbKey db)) (DbKey db))
 -&gt; Handler (Page (NextItem (DbKey db)) (DbKey db)))
-&gt; IO (Page (NextItem (DbKey db)) (DbKey db))
-&gt; Handler (Page (NextItem (DbKey db)) (DbKey db))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">db
-&gt; Maybe (NextItem (DbKey db))
-&gt; Maybe Limit
-&gt; Maybe MinRank
-&gt; Maybe MaxRank
-&gt; (Stream (Of (DbKey db)) IO (Natural, Eos)
    -&gt; IO (Page (NextItem (DbKey db)) (DbKey db)))
-&gt; IO (Page (NextItem (DbKey db)) (DbKey db))
forall db a.
TreeDb db =&gt;
db
-&gt; Maybe (NextItem (DbKey db))
-&gt; Maybe Limit
-&gt; Maybe MinRank
-&gt; Maybe MaxRank
-&gt; (Stream (Of (DbKey db)) IO (Natural, Eos) -&gt; IO a)
-&gt; IO a
</span><a href="Chainweb.TreeDB.html#keys"><span class="hs-identifier hs-var">keys</span></a></span><span> </span><span class="annot"><span class="annottext">db
</span><a href="#local-6989586621681509835"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (NextItem (DbKey db))
</span><a href="#local-6989586621681509830"><span class="hs-identifier hs-var">nextChecked</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Limit -&gt; Limit
forall a. Enum a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">succ</span></span><span> </span><span class="annot"><span class="annottext">(Limit -&gt; Limit) -&gt; Maybe Limit -&gt; Maybe Limit
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe Limit
</span><a href="#local-6989586621681509828"><span class="hs-identifier hs-var">effectiveLimit</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe MinRank
</span><a href="#local-6989586621681509832"><span class="hs-identifier hs-var">minr</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe MaxRank
</span><a href="#local-6989586621681509831"><span class="hs-identifier hs-var">maxr</span></a></span><span>
</span><span id="line-199"></span><span>        </span><span class="annot"><span class="annottext">((Stream (Of (DbKey db)) IO (Natural, Eos)
  -&gt; IO (Page (NextItem (DbKey db)) (DbKey db)))
 -&gt; IO (Page (NextItem (DbKey db)) (DbKey db)))
-&gt; (Stream (Of (DbKey db)) IO (Natural, Eos)
    -&gt; IO (Page (NextItem (DbKey db)) (DbKey db)))
-&gt; IO (Page (NextItem (DbKey db)) (DbKey db))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(DbKey db -&gt; DbKey db)
-&gt; Maybe Limit
-&gt; Stream (Of (DbKey db)) IO ()
-&gt; IO (Page (NextItem (DbKey db)) (DbKey db))
forall (m :: * -&gt; *) a k.
MonadThrow m =&gt;
(a -&gt; k)
-&gt; Maybe Limit -&gt; Stream (Of a) m () -&gt; m (Page (NextItem k) a)
</span><a href="Chainweb.Utils.Paging.html#finitePrefixOfInfiniteStreamToPage"><span class="hs-identifier hs-var">finitePrefixOfInfiniteStreamToPage</span></a></span><span> </span><span class="annot"><span class="annottext">DbKey db -&gt; DbKey db
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="annot"><span class="annottext">Maybe Limit
</span><a href="#local-6989586621681509828"><span class="hs-identifier hs-var">effectiveLimit</span></a></span><span>
</span><span id="line-200"></span><span>        </span><span class="annot"><span class="annottext">(Stream (Of (DbKey db)) IO ()
 -&gt; IO (Page (NextItem (DbKey db)) (DbKey db)))
-&gt; (Stream (Of (DbKey db)) IO (Natural, Eos)
    -&gt; Stream (Of (DbKey db)) IO ())
-&gt; Stream (Of (DbKey db)) IO (Natural, Eos)
-&gt; IO (Page (NextItem (DbKey db)) (DbKey db))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Stream (Of (DbKey db)) IO (Natural, Eos)
-&gt; Stream (Of (DbKey db)) IO ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span>
</span><span id="line-201"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-202"></span><span>    </span><span id="local-6989586621681509828"><span class="annot"><span class="annottext">effectiveLimit :: Maybe Limit
</span><a href="#local-6989586621681509828"><span class="hs-identifier hs-var hs-var">effectiveLimit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Limit
</span><a href="#local-6989586621681509834"><span class="hs-identifier hs-var">limit</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Limit -&gt; Maybe Limit -&gt; Maybe Limit
forall (f :: * -&gt; *) a. Alternative f =&gt; f a -&gt; f a -&gt; f a
</span><span class="hs-operator hs-var">&lt;|&gt;</span></span><span> </span><span class="annot"><span class="annottext">Limit -&gt; Maybe Limit
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Limit
forall a. Num a =&gt; a
</span><a href="Chainweb.BlockHeaderDB.RestAPI.Server.html#defaultKeyLimit"><span class="hs-identifier hs-var">defaultKeyLimit</span></a></span><span>
</span><span id="line-203"></span><span>
</span><span id="line-204"></span><span class="hs-comment">-- | Every `TreeDb` entry within a given range.</span><span>
</span><span id="line-205"></span><span class="hs-comment">--</span><span>
</span><span id="line-206"></span><span class="hs-comment">-- Cf. &quot;Chainweb.BlockHeaderDB.RestAPI&quot; for more details</span><span>
</span><span id="line-207"></span><span class="hs-comment">--</span><span>
</span><span id="line-208"></span><span id="local-6989586621681510040"><span class="annot"><a href="Chainweb.BlockHeaderDB.RestAPI.Server.html#headersHandler"><span class="hs-identifier hs-type">headersHandler</span></a></span><span>
</span><span id="line-209"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Chainweb.TreeDB.html#TreeDb"><span class="hs-identifier hs-type">TreeDb</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681510040"><span class="hs-identifier hs-type">db</span></a></span><span>
</span><span id="line-210"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ToJSON</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.TreeDB.html#DbKey"><span class="hs-identifier hs-type">DbKey</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681510040"><span class="hs-identifier hs-type">db</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-211"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681510040"><span class="hs-identifier hs-type">db</span></a></span><span>
</span><span id="line-212"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Chainweb.Utils.Paging.html#Limit"><span class="hs-identifier hs-type">Limit</span></a></span><span>
</span><span id="line-213"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.Utils.Paging.html#NextItem"><span class="hs-identifier hs-type">NextItem</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.TreeDB.html#DbKey"><span class="hs-identifier hs-type">DbKey</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681510040"><span class="hs-identifier hs-type">db</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-214"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Chainweb.TreeDB.html#MinRank"><span class="hs-identifier hs-type">MinRank</span></a></span><span>
</span><span id="line-215"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Chainweb.TreeDB.html#MaxRank"><span class="hs-identifier hs-type">MaxRank</span></a></span><span>
</span><span id="line-216"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Handler</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.Utils.Paging.html#Page"><span class="hs-identifier hs-type">Page</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.Utils.Paging.html#NextItem"><span class="hs-identifier hs-type">NextItem</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.TreeDB.html#DbKey"><span class="hs-identifier hs-type">DbKey</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681510040"><span class="hs-identifier hs-type">db</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.TreeDB.html#DbEntry"><span class="hs-identifier hs-type">DbEntry</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681510040"><span class="hs-identifier hs-type">db</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-217"></span><span id="headersHandler"><span class="annot"><span class="annottext">headersHandler :: db
-&gt; Maybe Limit
-&gt; Maybe (NextItem (DbKey db))
-&gt; Maybe MinRank
-&gt; Maybe MaxRank
-&gt; Handler (Page (NextItem (DbKey db)) (DbEntry db))
</span><a href="Chainweb.BlockHeaderDB.RestAPI.Server.html#headersHandler"><span class="hs-identifier hs-var hs-var">headersHandler</span></a></span></span><span> </span><span id="local-6989586621681509825"><span class="annot"><span class="annottext">db :: db
</span><a href="#local-6989586621681509825"><span class="hs-identifier hs-var">db</span></a></span></span><span> </span><span id="local-6989586621681509824"><span class="annot"><span class="annottext">limit :: Maybe Limit
</span><a href="#local-6989586621681509824"><span class="hs-identifier hs-var">limit</span></a></span></span><span> </span><span id="local-6989586621681509823"><span class="annot"><span class="annottext">next :: Maybe (NextItem (DbKey db))
</span><a href="#local-6989586621681509823"><span class="hs-identifier hs-var">next</span></a></span></span><span> </span><span id="local-6989586621681509822"><span class="annot"><span class="annottext">minr :: Maybe MinRank
</span><a href="#local-6989586621681509822"><span class="hs-identifier hs-var">minr</span></a></span></span><span> </span><span id="local-6989586621681509821"><span class="annot"><span class="annottext">maxr :: Maybe MaxRank
</span><a href="#local-6989586621681509821"><span class="hs-identifier hs-var">maxr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-218"></span><span>    </span><span id="local-6989586621681509820"><span class="annot"><span class="annottext">Maybe (NextItem (DbKey db))
</span><a href="#local-6989586621681509820"><span class="hs-identifier hs-var">nextChecked</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(NextItem (DbKey db) -&gt; Handler (NextItem (DbKey db)))
-&gt; Maybe (NextItem (DbKey db))
-&gt; Handler (Maybe (NextItem (DbKey db)))
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(DbKey db -&gt; Handler (DbKey db))
-&gt; NextItem (DbKey db) -&gt; Handler (NextItem (DbKey db))
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="annot"><span class="annottext">((DbKey db -&gt; Handler (DbKey db))
 -&gt; NextItem (DbKey db) -&gt; Handler (NextItem (DbKey db)))
-&gt; (DbKey db -&gt; Handler (DbKey db))
-&gt; NextItem (DbKey db)
-&gt; Handler (NextItem (DbKey db))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">db -&gt; DbKey db -&gt; Handler (DbKey db)
forall (m :: * -&gt; *) db.
(MonadError ServerError m, MonadIO m, TreeDb db,
 ToJSON (DbKey db)) =&gt;
db -&gt; DbKey db -&gt; m (DbKey db)
</span><a href="Chainweb.BlockHeaderDB.RestAPI.Server.html#checkKey"><span class="hs-identifier hs-var">checkKey</span></a></span><span> </span><span class="annot"><span class="annottext">db
</span><a href="#local-6989586621681509825"><span class="hs-identifier hs-var">db</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe (NextItem (DbKey db))
</span><a href="#local-6989586621681509823"><span class="hs-identifier hs-var">next</span></a></span><span>
</span><span id="line-219"></span><span>    </span><span class="annot"><span class="annottext">IO (Page (NextItem (DbKey db)) (DbEntry db))
-&gt; Handler (Page (NextItem (DbKey db)) (DbEntry db))
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span>
</span><span id="line-220"></span><span>        </span><span class="annot"><span class="annottext">(IO (Page (NextItem (DbKey db)) (DbEntry db))
 -&gt; Handler (Page (NextItem (DbKey db)) (DbEntry db)))
-&gt; IO (Page (NextItem (DbKey db)) (DbEntry db))
-&gt; Handler (Page (NextItem (DbKey db)) (DbEntry db))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">db
-&gt; Maybe (NextItem (DbKey db))
-&gt; Maybe Limit
-&gt; Maybe MinRank
-&gt; Maybe MaxRank
-&gt; (Stream (Of (DbEntry db)) IO (Natural, Eos)
    -&gt; IO (Page (NextItem (DbKey db)) (DbEntry db)))
-&gt; IO (Page (NextItem (DbKey db)) (DbEntry db))
forall db a.
TreeDb db =&gt;
db
-&gt; Maybe (NextItem (DbKey db))
-&gt; Maybe Limit
-&gt; Maybe MinRank
-&gt; Maybe MaxRank
-&gt; (Stream (Of (DbEntry db)) IO (Natural, Eos) -&gt; IO a)
-&gt; IO a
</span><a href="Chainweb.TreeDB.html#entries"><span class="hs-identifier hs-var">entries</span></a></span><span> </span><span class="annot"><span class="annottext">db
</span><a href="#local-6989586621681509825"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (NextItem (DbKey db))
</span><a href="#local-6989586621681509820"><span class="hs-identifier hs-var">nextChecked</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Limit -&gt; Limit
forall a. Enum a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">succ</span></span><span> </span><span class="annot"><span class="annottext">(Limit -&gt; Limit) -&gt; Maybe Limit -&gt; Maybe Limit
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe Limit
</span><a href="#local-6989586621681509818"><span class="hs-identifier hs-var">effectiveLimit</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe MinRank
</span><a href="#local-6989586621681509822"><span class="hs-identifier hs-var">minr</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe MaxRank
</span><a href="#local-6989586621681509821"><span class="hs-identifier hs-var">maxr</span></a></span><span>
</span><span id="line-221"></span><span>        </span><span class="annot"><span class="annottext">((Stream (Of (DbEntry db)) IO (Natural, Eos)
  -&gt; IO (Page (NextItem (DbKey db)) (DbEntry db)))
 -&gt; IO (Page (NextItem (DbKey db)) (DbEntry db)))
-&gt; (Stream (Of (DbEntry db)) IO (Natural, Eos)
    -&gt; IO (Page (NextItem (DbKey db)) (DbEntry db)))
-&gt; IO (Page (NextItem (DbKey db)) (DbEntry db))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(DbEntry db -&gt; DbKey db)
-&gt; Maybe Limit
-&gt; Stream (Of (DbEntry db)) IO ()
-&gt; IO (Page (NextItem (DbKey db)) (DbEntry db))
forall (m :: * -&gt; *) a k.
MonadThrow m =&gt;
(a -&gt; k)
-&gt; Maybe Limit -&gt; Stream (Of a) m () -&gt; m (Page (NextItem k) a)
</span><a href="Chainweb.Utils.Paging.html#finitePrefixOfInfiniteStreamToPage"><span class="hs-identifier hs-var">finitePrefixOfInfiniteStreamToPage</span></a></span><span> </span><span class="annot"><span class="annottext">DbEntry db -&gt; DbKey db
forall e. TreeDbEntry e =&gt; e -&gt; Key e
</span><a href="Chainweb.TreeDB.html#key"><span class="hs-identifier hs-var">key</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Limit
</span><a href="#local-6989586621681509818"><span class="hs-identifier hs-var">effectiveLimit</span></a></span><span> </span><span class="annot"><span class="annottext">(Stream (Of (DbEntry db)) IO ()
 -&gt; IO (Page (NextItem (DbKey db)) (DbEntry db)))
-&gt; (Stream (Of (DbEntry db)) IO (Natural, Eos)
    -&gt; Stream (Of (DbEntry db)) IO ())
-&gt; Stream (Of (DbEntry db)) IO (Natural, Eos)
-&gt; IO (Page (NextItem (DbKey db)) (DbEntry db))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Stream (Of (DbEntry db)) IO (Natural, Eos)
-&gt; Stream (Of (DbEntry db)) IO ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span>
</span><span id="line-222"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-223"></span><span>    </span><span id="local-6989586621681509818"><span class="annot"><span class="annottext">effectiveLimit :: Maybe Limit
</span><a href="#local-6989586621681509818"><span class="hs-identifier hs-var hs-var">effectiveLimit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Limit
</span><a href="#local-6989586621681509824"><span class="hs-identifier hs-var">limit</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Limit -&gt; Maybe Limit -&gt; Maybe Limit
forall (f :: * -&gt; *) a. Alternative f =&gt; f a -&gt; f a -&gt; f a
</span><span class="hs-operator hs-var">&lt;|&gt;</span></span><span> </span><span class="annot"><span class="annottext">Limit -&gt; Maybe Limit
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Limit
forall a. Num a =&gt; a
</span><a href="Chainweb.BlockHeaderDB.RestAPI.Server.html#defaultEntryLimit"><span class="hs-identifier hs-var">defaultEntryLimit</span></a></span><span>
</span><span id="line-224"></span><span>
</span><span id="line-225"></span><span class="hs-comment">-- | Query a single 'BlockHeader' by its 'BlockHash'</span><span>
</span><span id="line-226"></span><span class="hs-comment">--</span><span>
</span><span id="line-227"></span><span class="hs-comment">-- Cf. &quot;Chainweb.BlockHeaderDB.RestAPI&quot; for more details</span><span>
</span><span id="line-228"></span><span class="hs-comment">--</span><span>
</span><span id="line-229"></span><span id="local-6989586621681510039"><span class="annot"><a href="Chainweb.BlockHeaderDB.RestAPI.Server.html#headerHandler"><span class="hs-identifier hs-type">headerHandler</span></a></span><span>
</span><span id="line-230"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ToJSON</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.TreeDB.html#DbKey"><span class="hs-identifier hs-type">DbKey</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681510039"><span class="hs-identifier hs-type">db</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-231"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Chainweb.TreeDB.html#TreeDb"><span class="hs-identifier hs-type">TreeDb</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681510039"><span class="hs-identifier hs-type">db</span></a></span><span>
</span><span id="line-232"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681510039"><span class="hs-identifier hs-type">db</span></a></span><span>
</span><span id="line-233"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Chainweb.TreeDB.html#DbKey"><span class="hs-identifier hs-type">DbKey</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681510039"><span class="hs-identifier hs-type">db</span></a></span><span>
</span><span id="line-234"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Handler</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.TreeDB.html#DbEntry"><span class="hs-identifier hs-type">DbEntry</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681510039"><span class="hs-identifier hs-type">db</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-235"></span><span id="headerHandler"><span class="annot"><span class="annottext">headerHandler :: db -&gt; DbKey db -&gt; Handler (DbEntry db)
</span><a href="Chainweb.BlockHeaderDB.RestAPI.Server.html#headerHandler"><span class="hs-identifier hs-var hs-var">headerHandler</span></a></span></span><span> </span><span id="local-6989586621681509816"><span class="annot"><span class="annottext">db :: db
</span><a href="#local-6989586621681509816"><span class="hs-identifier hs-var">db</span></a></span></span><span> </span><span id="local-6989586621681509815"><span class="annot"><span class="annottext">k :: DbKey db
</span><a href="#local-6989586621681509815"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO (Maybe (DbEntry db)) -&gt; Handler (Maybe (DbEntry db))
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">db -&gt; DbKey db -&gt; IO (Maybe (DbEntry db))
forall db. TreeDb db =&gt; db -&gt; DbKey db -&gt; IO (Maybe (DbEntry db))
</span><a href="Chainweb.TreeDB.html#lookup"><span class="hs-identifier hs-var">lookup</span></a></span><span> </span><span class="annot"><span class="annottext">db
</span><a href="#local-6989586621681509816"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="annot"><span class="annottext">DbKey db
</span><a href="#local-6989586621681509815"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Handler (Maybe (DbEntry db))
-&gt; (Maybe (DbEntry db) -&gt; Handler (DbEntry db))
-&gt; Handler (DbEntry db)
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-236"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ServerError -&gt; Handler (DbEntry db)
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(ServerError -&gt; Handler (DbEntry db))
-&gt; ServerError -&gt; Handler (DbEntry db)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Value -&gt; ServerError
forall msg. ToJSON msg =&gt; msg -&gt; ServerError
</span><a href="Chainweb.BlockHeaderDB.RestAPI.Server.html#err404Msg"><span class="hs-identifier hs-var">err404Msg</span></a></span><span> </span><span class="annot"><span class="annottext">(Value -&gt; ServerError) -&gt; Value -&gt; ServerError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Pair] -&gt; Value
</span><span class="hs-identifier hs-var">object</span></span><span>
</span><span id="line-237"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;reason&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; String -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Text -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;key not found&quot;</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">)</span><span>
</span><span id="line-238"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;key&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; DbKey db -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Text -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="annot"><span class="annottext">DbKey db
</span><a href="#local-6989586621681509815"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-239"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-240"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621681509814"><span class="annot"><span class="annottext">e :: DbEntry db
</span><a href="#local-6989586621681509814"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DbEntry db -&gt; Handler (DbEntry db)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">DbEntry db
</span><a href="#local-6989586621681509814"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-241"></span><span>
</span><span id="line-242"></span><span class="hs-comment">-- | Add a new 'BlockHeader' to the database</span><span>
</span><span id="line-243"></span><span class="hs-comment">--</span><span>
</span><span id="line-244"></span><span class="hs-comment">-- Cf. &quot;Chainweb.BlockHeaderDB.RestAPI&quot; for more details</span><span>
</span><span id="line-245"></span><span class="hs-comment">--</span><span>
</span><span id="line-246"></span><span class="annot"><a href="Chainweb.BlockHeaderDB.RestAPI.Server.html#headerPutHandler"><span class="hs-identifier hs-type">headerPutHandler</span></a></span><span>
</span><span id="line-247"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621681510038"><span class="annot"><a href="#local-6989586621681510038"><span class="hs-identifier hs-type">db</span></a></span></span><span>
</span><span id="line-248"></span><span>    </span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Chainweb.TreeDB.html#TreeDb"><span class="hs-identifier hs-type">TreeDb</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681510038"><span class="hs-identifier hs-type">db</span></a></span><span>
</span><span id="line-249"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681510038"><span class="hs-identifier hs-type">db</span></a></span><span>
</span><span id="line-250"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Chainweb.TreeDB.html#DbEntry"><span class="hs-identifier hs-type">DbEntry</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681510038"><span class="hs-identifier hs-type">db</span></a></span><span>
</span><span id="line-251"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Handler</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">NoContent</span></span><span>
</span><span id="line-252"></span><span id="headerPutHandler"><span class="annot"><span class="annottext">headerPutHandler :: db -&gt; DbEntry db -&gt; Handler NoContent
</span><a href="Chainweb.BlockHeaderDB.RestAPI.Server.html#headerPutHandler"><span class="hs-identifier hs-var hs-var">headerPutHandler</span></a></span></span><span> </span><span id="local-6989586621681509812"><span class="annot"><span class="annottext">db :: db
</span><a href="#local-6989586621681509812"><span class="hs-identifier hs-var">db</span></a></span></span><span> </span><span id="local-6989586621681509811"><span class="annot"><span class="annottext">e :: DbEntry db
</span><a href="#local-6989586621681509811"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NoContent
</span><span class="hs-identifier hs-var">NoContent</span></span><span> </span><span class="annot"><span class="annottext">NoContent -&gt; Handler () -&gt; Handler NoContent
forall (f :: * -&gt; *) a b. Functor f =&gt; a -&gt; f b -&gt; f a
</span><span class="hs-operator hs-var">&lt;$</span></span><span> </span><span class="annot"><span class="annottext">IO () -&gt; Handler ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">db -&gt; DbEntry db -&gt; IO ()
forall db. TreeDb db =&gt; db -&gt; DbEntry db -&gt; IO ()
</span><a href="Chainweb.TreeDB.html#insert"><span class="hs-identifier hs-var">insert</span></a></span><span> </span><span class="annot"><span class="annottext">db
</span><a href="#local-6989586621681509812"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="annot"><span class="annottext">DbEntry db
</span><a href="#local-6989586621681509811"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Handler NoContent
-&gt; [Handler Handler NoContent] -&gt; Handler NoContent
forall (f :: * -&gt; *) (m :: * -&gt; *) a.
(Foldable f, MonadCatch m) =&gt;
m a -&gt; f (Handler m a) -&gt; m a
</span><span class="hs-operator hs-var">`E.catches`</span></span><span>
</span><span id="line-253"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">(TreeDbException db -&gt; Handler NoContent)
-&gt; Handler Handler NoContent
forall (m :: * -&gt; *) a e. Exception e =&gt; (e -&gt; m a) -&gt; Handler m a
</span><span class="hs-identifier hs-var">E.Handler</span></span><span> </span><span class="annot"><span class="annottext">((TreeDbException db -&gt; Handler NoContent)
 -&gt; Handler Handler NoContent)
-&gt; (TreeDbException db -&gt; Handler NoContent)
-&gt; Handler Handler NoContent
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621681509807"><span class="annot"><span class="annottext">TreeDbException db
</span><a href="#local-6989586621681509807"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Chainweb.TreeDB.html#TreeDbException"><span class="hs-identifier hs-type">TreeDbException</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681510038"><span class="hs-identifier hs-type">db</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-254"></span><span>        </span><span class="annot"><span class="annottext">ServerError -&gt; Handler NoContent
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(ServerError -&gt; Handler NoContent)
-&gt; ServerError -&gt; Handler NoContent
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><span class="hs-identifier hs-var">err400</span></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">errBody :: ByteString
</span><span class="hs-identifier hs-var">errBody</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TreeDbException db -&gt; ByteString
forall a b. (Show a, IsString b) =&gt; a -&gt; b
</span><a href="Chainweb.Utils.html#sshow"><span class="hs-identifier hs-var">sshow</span></a></span><span> </span><span class="annot"><span class="annottext">TreeDbException db
</span><a href="#local-6989586621681509807"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-255"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(ValidationFailure -&gt; Handler NoContent)
-&gt; Handler Handler NoContent
forall (m :: * -&gt; *) a e. Exception e =&gt; (e -&gt; m a) -&gt; Handler m a
</span><span class="hs-identifier hs-var">E.Handler</span></span><span> </span><span class="annot"><span class="annottext">((ValidationFailure -&gt; Handler NoContent)
 -&gt; Handler Handler NoContent)
-&gt; (ValidationFailure -&gt; Handler NoContent)
-&gt; Handler Handler NoContent
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621681509804"><span class="annot"><span class="annottext">ValidationFailure
</span><a href="#local-6989586621681509804"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Chainweb.BlockHeader.Validation.html#ValidationFailure"><span class="hs-identifier hs-type">ValidationFailure</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-256"></span><span>        </span><span class="annot"><span class="annottext">ServerError -&gt; Handler NoContent
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(ServerError -&gt; Handler NoContent)
-&gt; ServerError -&gt; Handler NoContent
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><span class="hs-identifier hs-var">err400</span></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">errBody :: ByteString
</span><span class="hs-identifier hs-var">errBody</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ValidationFailure -&gt; ByteString
forall a b. (Show a, IsString b) =&gt; a -&gt; b
</span><a href="Chainweb.Utils.html#sshow"><span class="hs-identifier hs-var">sshow</span></a></span><span> </span><span class="annot"><span class="annottext">ValidationFailure
</span><a href="#local-6989586621681509804"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-257"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-258"></span><span>
</span><span id="line-259"></span><span class="hs-comment">-- -------------------------------------------------------------------------- --</span><span>
</span><span id="line-260"></span><span class="hs-comment">-- BlockHeaderDB API Server</span><span>
</span><span id="line-261"></span><span>
</span><span id="line-262"></span><span id="local-6989586621681510006"><span id="local-6989586621681510007"><span class="annot"><a href="Chainweb.BlockHeaderDB.RestAPI.Server.html#blockHeaderDbServer"><span class="hs-identifier hs-type">blockHeaderDbServer</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Chainweb.BlockHeaderDB.RestAPI.html#BlockHeaderDb_"><span class="hs-identifier hs-type">BlockHeaderDb_</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681510007"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681510006"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Server</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.BlockHeaderDB.RestAPI.html#BlockHeaderDbApi"><span class="hs-identifier hs-type">BlockHeaderDbApi</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681510007"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681510006"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-263"></span><span id="blockHeaderDbServer"><span class="annot"><span class="annottext">blockHeaderDbServer :: BlockHeaderDb_ v c -&gt; Server (BlockHeaderDbApi v c)
</span><a href="Chainweb.BlockHeaderDB.RestAPI.Server.html#blockHeaderDbServer"><span class="hs-identifier hs-var hs-var">blockHeaderDbServer</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.BlockHeaderDB.RestAPI.html#BlockHeaderDb_"><span class="hs-identifier hs-type">BlockHeaderDb_</span></a></span><span> </span><span id="local-6989586621681509801"><span class="annot"><span class="annottext">db :: BlockHeaderDb
</span><a href="#local-6989586621681509801"><span class="hs-identifier hs-var">db</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-264"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BlockHeaderDb
-&gt; Maybe Limit
-&gt; Maybe (NextItem (DbKey BlockHeaderDb))
-&gt; Maybe MinRank
-&gt; Maybe MaxRank
-&gt; Handler
     (Page (NextItem (DbKey BlockHeaderDb)) (DbKey BlockHeaderDb))
forall db.
(TreeDb db, ToJSON (DbKey db)) =&gt;
db
-&gt; Maybe Limit
-&gt; Maybe (NextItem (DbKey db))
-&gt; Maybe MinRank
-&gt; Maybe MaxRank
-&gt; Handler (Page (NextItem (DbKey db)) (DbKey db))
</span><a href="Chainweb.BlockHeaderDB.RestAPI.Server.html#hashesHandler"><span class="hs-identifier hs-var">hashesHandler</span></a></span><span> </span><span class="annot"><span class="annottext">BlockHeaderDb
</span><a href="#local-6989586621681509801"><span class="hs-identifier hs-var">db</span></a></span><span>
</span><span id="line-265"></span><span>    </span><span class="annot"><span class="annottext">(Maybe Limit
 -&gt; Maybe (NextItem BlockHash)
 -&gt; Maybe MinRank
 -&gt; Maybe MaxRank
 -&gt; Handler (Page (NextItem BlockHash) BlockHash))
-&gt; ((Maybe Limit
     -&gt; Maybe (NextItem BlockHash)
     -&gt; Maybe MinRank
     -&gt; Maybe MaxRank
     -&gt; Handler (Page (NextItem BlockHash) BlockHeader))
    :&lt;|&gt; ((BlockHash -&gt; Handler BlockHeader)
          :&lt;|&gt; ((BlockHeader -&gt; Handler NoContent)
                :&lt;|&gt; ((Maybe Limit
                       -&gt; Maybe (NextItem BlockHash)
                       -&gt; Maybe MinRank
                       -&gt; Maybe MaxRank
                       -&gt; BranchBounds BlockHeaderDb
                       -&gt; Handler (Page (NextItem BlockHash) BlockHash))
                      :&lt;|&gt; (Maybe Limit
                            -&gt; Maybe (NextItem BlockHash)
                            -&gt; Maybe MinRank
                            -&gt; Maybe MaxRank
                            -&gt; BranchBounds BlockHeaderDb
                            -&gt; Handler (Page (NextItem BlockHash) BlockHeader))))))
-&gt; (Maybe Limit
    -&gt; Maybe (NextItem BlockHash)
    -&gt; Maybe MinRank
    -&gt; Maybe MaxRank
    -&gt; Handler (Page (NextItem BlockHash) BlockHash))
   :&lt;|&gt; ((Maybe Limit
          -&gt; Maybe (NextItem BlockHash)
          -&gt; Maybe MinRank
          -&gt; Maybe MaxRank
          -&gt; Handler (Page (NextItem BlockHash) BlockHeader))
         :&lt;|&gt; ((BlockHash -&gt; Handler BlockHeader)
               :&lt;|&gt; ((BlockHeader -&gt; Handler NoContent)
                     :&lt;|&gt; ((Maybe Limit
                            -&gt; Maybe (NextItem BlockHash)
                            -&gt; Maybe MinRank
                            -&gt; Maybe MaxRank
                            -&gt; BranchBounds BlockHeaderDb
                            -&gt; Handler (Page (NextItem BlockHash) BlockHash))
                           :&lt;|&gt; (Maybe Limit
                                 -&gt; Maybe (NextItem BlockHash)
                                 -&gt; Maybe MinRank
                                 -&gt; Maybe MaxRank
                                 -&gt; BranchBounds BlockHeaderDb
                                 -&gt; Handler (Page (NextItem BlockHash) BlockHeader))))))
forall a b. a -&gt; b -&gt; a :&lt;|&gt; b
</span><span class="hs-operator hs-var">:&lt;|&gt;</span></span><span> </span><span class="annot"><span class="annottext">BlockHeaderDb
-&gt; Maybe Limit
-&gt; Maybe (NextItem (DbKey BlockHeaderDb))
-&gt; Maybe MinRank
-&gt; Maybe MaxRank
-&gt; Handler
     (Page (NextItem (DbKey BlockHeaderDb)) (DbEntry BlockHeaderDb))
forall db.
(TreeDb db, ToJSON (DbKey db)) =&gt;
db
-&gt; Maybe Limit
-&gt; Maybe (NextItem (DbKey db))
-&gt; Maybe MinRank
-&gt; Maybe MaxRank
-&gt; Handler (Page (NextItem (DbKey db)) (DbEntry db))
</span><a href="Chainweb.BlockHeaderDB.RestAPI.Server.html#headersHandler"><span class="hs-identifier hs-var">headersHandler</span></a></span><span> </span><span class="annot"><span class="annottext">BlockHeaderDb
</span><a href="#local-6989586621681509801"><span class="hs-identifier hs-var">db</span></a></span><span>
</span><span id="line-266"></span><span>    </span><span class="annot"><span class="annottext">(Maybe Limit
 -&gt; Maybe (NextItem BlockHash)
 -&gt; Maybe MinRank
 -&gt; Maybe MaxRank
 -&gt; Handler (Page (NextItem BlockHash) BlockHeader))
-&gt; ((BlockHash -&gt; Handler BlockHeader)
    :&lt;|&gt; ((BlockHeader -&gt; Handler NoContent)
          :&lt;|&gt; ((Maybe Limit
                 -&gt; Maybe (NextItem BlockHash)
                 -&gt; Maybe MinRank
                 -&gt; Maybe MaxRank
                 -&gt; BranchBounds BlockHeaderDb
                 -&gt; Handler (Page (NextItem BlockHash) BlockHash))
                :&lt;|&gt; (Maybe Limit
                      -&gt; Maybe (NextItem BlockHash)
                      -&gt; Maybe MinRank
                      -&gt; Maybe MaxRank
                      -&gt; BranchBounds BlockHeaderDb
                      -&gt; Handler (Page (NextItem BlockHash) BlockHeader)))))
-&gt; (Maybe Limit
    -&gt; Maybe (NextItem BlockHash)
    -&gt; Maybe MinRank
    -&gt; Maybe MaxRank
    -&gt; Handler (Page (NextItem BlockHash) BlockHeader))
   :&lt;|&gt; ((BlockHash -&gt; Handler BlockHeader)
         :&lt;|&gt; ((BlockHeader -&gt; Handler NoContent)
               :&lt;|&gt; ((Maybe Limit
                      -&gt; Maybe (NextItem BlockHash)
                      -&gt; Maybe MinRank
                      -&gt; Maybe MaxRank
                      -&gt; BranchBounds BlockHeaderDb
                      -&gt; Handler (Page (NextItem BlockHash) BlockHash))
                     :&lt;|&gt; (Maybe Limit
                           -&gt; Maybe (NextItem BlockHash)
                           -&gt; Maybe MinRank
                           -&gt; Maybe MaxRank
                           -&gt; BranchBounds BlockHeaderDb
                           -&gt; Handler (Page (NextItem BlockHash) BlockHeader)))))
forall a b. a -&gt; b -&gt; a :&lt;|&gt; b
</span><span class="hs-operator hs-var">:&lt;|&gt;</span></span><span> </span><span class="annot"><span class="annottext">BlockHeaderDb
-&gt; DbKey BlockHeaderDb -&gt; Handler (DbEntry BlockHeaderDb)
forall db.
(ToJSON (DbKey db), TreeDb db) =&gt;
db -&gt; DbKey db -&gt; Handler (DbEntry db)
</span><a href="Chainweb.BlockHeaderDB.RestAPI.Server.html#headerHandler"><span class="hs-identifier hs-var">headerHandler</span></a></span><span> </span><span class="annot"><span class="annottext">BlockHeaderDb
</span><a href="#local-6989586621681509801"><span class="hs-identifier hs-var">db</span></a></span><span>
</span><span id="line-267"></span><span>    </span><span class="annot"><span class="annottext">(BlockHash -&gt; Handler BlockHeader)
-&gt; ((BlockHeader -&gt; Handler NoContent)
    :&lt;|&gt; ((Maybe Limit
           -&gt; Maybe (NextItem BlockHash)
           -&gt; Maybe MinRank
           -&gt; Maybe MaxRank
           -&gt; BranchBounds BlockHeaderDb
           -&gt; Handler (Page (NextItem BlockHash) BlockHash))
          :&lt;|&gt; (Maybe Limit
                -&gt; Maybe (NextItem BlockHash)
                -&gt; Maybe MinRank
                -&gt; Maybe MaxRank
                -&gt; BranchBounds BlockHeaderDb
                -&gt; Handler (Page (NextItem BlockHash) BlockHeader))))
-&gt; (BlockHash -&gt; Handler BlockHeader)
   :&lt;|&gt; ((BlockHeader -&gt; Handler NoContent)
         :&lt;|&gt; ((Maybe Limit
                -&gt; Maybe (NextItem BlockHash)
                -&gt; Maybe MinRank
                -&gt; Maybe MaxRank
                -&gt; BranchBounds BlockHeaderDb
                -&gt; Handler (Page (NextItem BlockHash) BlockHash))
               :&lt;|&gt; (Maybe Limit
                     -&gt; Maybe (NextItem BlockHash)
                     -&gt; Maybe MinRank
                     -&gt; Maybe MaxRank
                     -&gt; BranchBounds BlockHeaderDb
                     -&gt; Handler (Page (NextItem BlockHash) BlockHeader))))
forall a b. a -&gt; b -&gt; a :&lt;|&gt; b
</span><span class="hs-operator hs-var">:&lt;|&gt;</span></span><span> </span><span class="annot"><span class="annottext">BlockHeaderDb -&gt; DbEntry BlockHeaderDb -&gt; Handler NoContent
forall db. TreeDb db =&gt; db -&gt; DbEntry db -&gt; Handler NoContent
</span><a href="Chainweb.BlockHeaderDB.RestAPI.Server.html#headerPutHandler"><span class="hs-identifier hs-var">headerPutHandler</span></a></span><span> </span><span class="annot"><span class="annottext">BlockHeaderDb
</span><a href="#local-6989586621681509801"><span class="hs-identifier hs-var">db</span></a></span><span>
</span><span id="line-268"></span><span>    </span><span class="annot"><span class="annottext">(BlockHeader -&gt; Handler NoContent)
-&gt; ((Maybe Limit
     -&gt; Maybe (NextItem BlockHash)
     -&gt; Maybe MinRank
     -&gt; Maybe MaxRank
     -&gt; BranchBounds BlockHeaderDb
     -&gt; Handler (Page (NextItem BlockHash) BlockHash))
    :&lt;|&gt; (Maybe Limit
          -&gt; Maybe (NextItem BlockHash)
          -&gt; Maybe MinRank
          -&gt; Maybe MaxRank
          -&gt; BranchBounds BlockHeaderDb
          -&gt; Handler (Page (NextItem BlockHash) BlockHeader)))
-&gt; (BlockHeader -&gt; Handler NoContent)
   :&lt;|&gt; ((Maybe Limit
          -&gt; Maybe (NextItem BlockHash)
          -&gt; Maybe MinRank
          -&gt; Maybe MaxRank
          -&gt; BranchBounds BlockHeaderDb
          -&gt; Handler (Page (NextItem BlockHash) BlockHash))
         :&lt;|&gt; (Maybe Limit
               -&gt; Maybe (NextItem BlockHash)
               -&gt; Maybe MinRank
               -&gt; Maybe MaxRank
               -&gt; BranchBounds BlockHeaderDb
               -&gt; Handler (Page (NextItem BlockHash) BlockHeader)))
forall a b. a -&gt; b -&gt; a :&lt;|&gt; b
</span><span class="hs-operator hs-var">:&lt;|&gt;</span></span><span> </span><span class="annot"><span class="annottext">BlockHeaderDb
-&gt; Maybe Limit
-&gt; Maybe (NextItem (DbKey BlockHeaderDb))
-&gt; Maybe MinRank
-&gt; Maybe MaxRank
-&gt; BranchBounds BlockHeaderDb
-&gt; Handler
     (Page (NextItem (DbKey BlockHeaderDb)) (DbKey BlockHeaderDb))
forall db.
(TreeDb db, ToJSON (DbKey db)) =&gt;
db
-&gt; Maybe Limit
-&gt; Maybe (NextItem (DbKey db))
-&gt; Maybe MinRank
-&gt; Maybe MaxRank
-&gt; BranchBounds db
-&gt; Handler (Page (NextItem (DbKey db)) (DbKey db))
</span><a href="Chainweb.BlockHeaderDB.RestAPI.Server.html#branchHashesHandler"><span class="hs-identifier hs-var">branchHashesHandler</span></a></span><span> </span><span class="annot"><span class="annottext">BlockHeaderDb
</span><a href="#local-6989586621681509801"><span class="hs-identifier hs-var">db</span></a></span><span>
</span><span id="line-269"></span><span>    </span><span class="annot"><span class="annottext">(Maybe Limit
 -&gt; Maybe (NextItem BlockHash)
 -&gt; Maybe MinRank
 -&gt; Maybe MaxRank
 -&gt; BranchBounds BlockHeaderDb
 -&gt; Handler (Page (NextItem BlockHash) BlockHash))
-&gt; (Maybe Limit
    -&gt; Maybe (NextItem BlockHash)
    -&gt; Maybe MinRank
    -&gt; Maybe MaxRank
    -&gt; BranchBounds BlockHeaderDb
    -&gt; Handler (Page (NextItem BlockHash) BlockHeader))
-&gt; (Maybe Limit
    -&gt; Maybe (NextItem BlockHash)
    -&gt; Maybe MinRank
    -&gt; Maybe MaxRank
    -&gt; BranchBounds BlockHeaderDb
    -&gt; Handler (Page (NextItem BlockHash) BlockHash))
   :&lt;|&gt; (Maybe Limit
         -&gt; Maybe (NextItem BlockHash)
         -&gt; Maybe MinRank
         -&gt; Maybe MaxRank
         -&gt; BranchBounds BlockHeaderDb
         -&gt; Handler (Page (NextItem BlockHash) BlockHeader))
forall a b. a -&gt; b -&gt; a :&lt;|&gt; b
</span><span class="hs-operator hs-var">:&lt;|&gt;</span></span><span> </span><span class="annot"><span class="annottext">BlockHeaderDb
-&gt; Maybe Limit
-&gt; Maybe (NextItem (DbKey BlockHeaderDb))
-&gt; Maybe MinRank
-&gt; Maybe MaxRank
-&gt; BranchBounds BlockHeaderDb
-&gt; Handler
     (Page (NextItem (DbKey BlockHeaderDb)) (DbEntry BlockHeaderDb))
forall db.
(TreeDb db, ToJSON (DbKey db)) =&gt;
db
-&gt; Maybe Limit
-&gt; Maybe (NextItem (DbKey db))
-&gt; Maybe MinRank
-&gt; Maybe MaxRank
-&gt; BranchBounds db
-&gt; Handler (Page (NextItem (DbKey db)) (DbEntry db))
</span><a href="Chainweb.BlockHeaderDB.RestAPI.Server.html#branchHeadersHandler"><span class="hs-identifier hs-var">branchHeadersHandler</span></a></span><span> </span><span class="annot"><span class="annottext">BlockHeaderDb
</span><a href="#local-6989586621681509801"><span class="hs-identifier hs-var">db</span></a></span><span>
</span><span id="line-270"></span><span>
</span><span id="line-271"></span><span class="hs-comment">-- -------------------------------------------------------------------------- --</span><span>
</span><span id="line-272"></span><span class="hs-comment">-- Application for a single BlockHeaderDB</span><span>
</span><span id="line-273"></span><span>
</span><span id="line-274"></span><span class="annot"><a href="Chainweb.BlockHeaderDB.RestAPI.Server.html#blockHeaderDbApp"><span class="hs-identifier hs-type">blockHeaderDbApp</span></a></span><span>
</span><span id="line-275"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621681509799"><span class="annot"><a href="#local-6989586621681509799"><span class="hs-identifier hs-type">v</span></a></span></span><span> </span><span id="local-6989586621681509798"><span class="annot"><a href="#local-6989586621681509798"><span class="hs-identifier hs-type">c</span></a></span></span><span>
</span><span id="line-276"></span><span>    </span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Chainweb.Version.html#KnownChainwebVersionSymbol"><span class="hs-identifier hs-type">KnownChainwebVersionSymbol</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681509799"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-277"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Chainweb.ChainId.html#KnownChainIdSymbol"><span class="hs-identifier hs-type">KnownChainIdSymbol</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681509798"><span class="hs-identifier hs-type">c</span></a></span><span>
</span><span id="line-278"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Chainweb.BlockHeaderDB.RestAPI.html#BlockHeaderDb_"><span class="hs-identifier hs-type">BlockHeaderDb_</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681509799"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681509798"><span class="hs-identifier hs-type">c</span></a></span><span>
</span><span id="line-279"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Application</span></span><span>
</span><span id="line-280"></span><span id="blockHeaderDbApp"><span class="annot"><span class="annottext">blockHeaderDbApp :: BlockHeaderDb_ v c -&gt; Application
</span><a href="Chainweb.BlockHeaderDB.RestAPI.Server.html#blockHeaderDbApp"><span class="hs-identifier hs-var hs-var">blockHeaderDbApp</span></a></span></span><span> </span><span id="local-6989586621681509795"><span class="annot"><span class="annottext">db :: BlockHeaderDb_ v c
</span><a href="#local-6989586621681509795"><span class="hs-identifier hs-var">db</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Proxy
  (('ChainwebEndpoint v
    :&gt; (ChainEndpoint c
        :&gt; (&quot;hash&quot;
            :&gt; (QueryParam' '[Optional, Strict] &quot;limit&quot; Limit
                :&gt; (QueryParam' '[Optional, Strict] &quot;next&quot; (NextItem BlockHash)
                    :&gt; (QueryParam' '[Optional, Strict] &quot;minheight&quot; MinRank
                        :&gt; (QueryParam' '[Optional, Strict] &quot;maxheight&quot; MaxRank
                            :&gt; Verb
                                 'GET 200 '[JSON] (Page (NextItem BlockHash) BlockHash))))))))
   :&lt;|&gt; (('ChainwebEndpoint v
          :&gt; (ChainEndpoint c
              :&gt; (&quot;header&quot;
                  :&gt; (QueryParam' '[Optional, Strict] &quot;limit&quot; Limit
                      :&gt; (QueryParam' '[Optional, Strict] &quot;next&quot; (NextItem BlockHash)
                          :&gt; (QueryParam' '[Optional, Strict] &quot;minheight&quot; MinRank
                              :&gt; (QueryParam' '[Optional, Strict] &quot;maxheight&quot; MaxRank
                                  :&gt; Verb
                                       'GET
                                       200
                                       '[JSON, JsonBlockHeaderObject]
                                       (Page (NextItem BlockHash) BlockHeader))))))))
         :&lt;|&gt; (HeaderApi v c
               :&lt;|&gt; (HeaderPutApi v c
                     :&lt;|&gt; (('ChainwebEndpoint v
                            :&gt; (ChainEndpoint c
                                :&gt; (&quot;hash&quot;
                                    :&gt; (&quot;branch&quot;
                                        :&gt; (QueryParam' '[Optional, Strict] &quot;limit&quot; Limit
                                            :&gt; (QueryParam'
                                                  '[Optional, Strict] &quot;next&quot; (NextItem BlockHash)
                                                :&gt; (QueryParam'
                                                      '[Optional, Strict] &quot;minheight&quot; MinRank
                                                    :&gt; (QueryParam'
                                                          '[Optional, Strict] &quot;maxheight&quot; MaxRank
                                                        :&gt; (ReqBody'
                                                              '[Required, Strict]
                                                              '[JSON]
                                                              (BranchBounds BlockHeaderDb)
                                                            :&gt; Verb
                                                                 'POST
                                                                 200
                                                                 '[JSON]
                                                                 (Page
                                                                    (NextItem BlockHash)
                                                                    BlockHash))))))))))
                           :&lt;|&gt; ('ChainwebEndpoint v
                                 :&gt; (ChainEndpoint c
                                     :&gt; (&quot;header&quot;
                                         :&gt; (&quot;branch&quot;
                                             :&gt; (QueryParam' '[Optional, Strict] &quot;limit&quot; Limit
                                                 :&gt; (QueryParam'
                                                       '[Optional, Strict]
                                                       &quot;next&quot;
                                                       (NextItem BlockHash)
                                                     :&gt; (QueryParam'
                                                           '[Optional, Strict] &quot;minheight&quot; MinRank
                                                         :&gt; (QueryParam'
                                                               '[Optional, Strict]
                                                               &quot;maxheight&quot;
                                                               MaxRank
                                                             :&gt; (ReqBody'
                                                                   '[Required, Strict]
                                                                   '[JSON]
                                                                   (BranchBounds BlockHeaderDb)
                                                                 :&gt; Verb
                                                                      'POST
                                                                      200
                                                                      '[JSON, JsonBlockHeaderObject]
                                                                      (Page
                                                                         (NextItem BlockHash)
                                                                         BlockHeader)))))))))))))))
-&gt; Server
     (('ChainwebEndpoint v
       :&gt; (ChainEndpoint c
           :&gt; (&quot;hash&quot;
               :&gt; (QueryParam' '[Optional, Strict] &quot;limit&quot; Limit
                   :&gt; (QueryParam' '[Optional, Strict] &quot;next&quot; (NextItem BlockHash)
                       :&gt; (QueryParam' '[Optional, Strict] &quot;minheight&quot; MinRank
                           :&gt; (QueryParam' '[Optional, Strict] &quot;maxheight&quot; MaxRank
                               :&gt; Verb
                                    'GET 200 '[JSON] (Page (NextItem BlockHash) BlockHash))))))))
      :&lt;|&gt; (('ChainwebEndpoint v
             :&gt; (ChainEndpoint c
                 :&gt; (&quot;header&quot;
                     :&gt; (QueryParam' '[Optional, Strict] &quot;limit&quot; Limit
                         :&gt; (QueryParam' '[Optional, Strict] &quot;next&quot; (NextItem BlockHash)
                             :&gt; (QueryParam' '[Optional, Strict] &quot;minheight&quot; MinRank
                                 :&gt; (QueryParam' '[Optional, Strict] &quot;maxheight&quot; MaxRank
                                     :&gt; Verb
                                          'GET
                                          200
                                          '[JSON, JsonBlockHeaderObject]
                                          (Page (NextItem BlockHash) BlockHeader))))))))
            :&lt;|&gt; (HeaderApi v c
                  :&lt;|&gt; (HeaderPutApi v c
                        :&lt;|&gt; (('ChainwebEndpoint v
                               :&gt; (ChainEndpoint c
                                   :&gt; (&quot;hash&quot;
                                       :&gt; (&quot;branch&quot;
                                           :&gt; (QueryParam' '[Optional, Strict] &quot;limit&quot; Limit
                                               :&gt; (QueryParam'
                                                     '[Optional, Strict] &quot;next&quot; (NextItem BlockHash)
                                                   :&gt; (QueryParam'
                                                         '[Optional, Strict] &quot;minheight&quot; MinRank
                                                       :&gt; (QueryParam'
                                                             '[Optional, Strict] &quot;maxheight&quot; MaxRank
                                                           :&gt; (ReqBody'
                                                                 '[Required, Strict]
                                                                 '[JSON]
                                                                 (BranchBounds BlockHeaderDb)
                                                               :&gt; Verb
                                                                    'POST
                                                                    200
                                                                    '[JSON]
                                                                    (Page
                                                                       (NextItem BlockHash)
                                                                       BlockHash))))))))))
                              :&lt;|&gt; ('ChainwebEndpoint v
                                    :&gt; (ChainEndpoint c
                                        :&gt; (&quot;header&quot;
                                            :&gt; (&quot;branch&quot;
                                                :&gt; (QueryParam' '[Optional, Strict] &quot;limit&quot; Limit
                                                    :&gt; (QueryParam'
                                                          '[Optional, Strict]
                                                          &quot;next&quot;
                                                          (NextItem BlockHash)
                                                        :&gt; (QueryParam'
                                                              '[Optional, Strict]
                                                              &quot;minheight&quot;
                                                              MinRank
                                                            :&gt; (QueryParam'
                                                                  '[Optional, Strict]
                                                                  &quot;maxheight&quot;
                                                                  MaxRank
                                                                :&gt; (ReqBody'
                                                                      '[Required, Strict]
                                                                      '[JSON]
                                                                      (BranchBounds BlockHeaderDb)
                                                                    :&gt; Verb
                                                                         'POST
                                                                         200
                                                                         '[JSON,
                                                                           JsonBlockHeaderObject]
                                                                         (Page
                                                                            (NextItem BlockHash)
                                                                            BlockHeader)))))))))))))))
-&gt; Application
forall api.
HasServer api '[] =&gt;
Proxy api -&gt; Server api -&gt; Application
</span><span class="hs-identifier hs-var">serve</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy (BlockHeaderDbApi v c)
forall k (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.BlockHeaderDB.RestAPI.html#BlockHeaderDbApi"><span class="hs-identifier hs-type">BlockHeaderDbApi</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681509799"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681509798"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BlockHeaderDb_ v c -&gt; Server (BlockHeaderDbApi v c)
forall (v :: ChainwebVersionT) (c :: ChainIdT).
BlockHeaderDb_ v c -&gt; Server (BlockHeaderDbApi v c)
</span><a href="Chainweb.BlockHeaderDB.RestAPI.Server.html#blockHeaderDbServer"><span class="hs-identifier hs-var">blockHeaderDbServer</span></a></span><span> </span><span class="annot"><span class="annottext">BlockHeaderDb_ v c
</span><a href="#local-6989586621681509795"><span class="hs-identifier hs-var">db</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-281"></span><span>
</span><span id="line-282"></span><span class="annot"><a href="Chainweb.BlockHeaderDB.RestAPI.Server.html#blockHeaderDbApiLayout"><span class="hs-identifier hs-type">blockHeaderDbApiLayout</span></a></span><span>
</span><span id="line-283"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621681509792"><span class="annot"><a href="#local-6989586621681509792"><span class="hs-identifier hs-type">v</span></a></span></span><span> </span><span id="local-6989586621681509791"><span class="annot"><a href="#local-6989586621681509791"><span class="hs-identifier hs-type">c</span></a></span></span><span>
</span><span id="line-284"></span><span>    </span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Chainweb.Version.html#KnownChainwebVersionSymbol"><span class="hs-identifier hs-type">KnownChainwebVersionSymbol</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681509792"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-285"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Chainweb.ChainId.html#KnownChainIdSymbol"><span class="hs-identifier hs-type">KnownChainIdSymbol</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681509791"><span class="hs-identifier hs-type">c</span></a></span><span>
</span><span id="line-286"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Chainweb.BlockHeaderDB.RestAPI.html#BlockHeaderDb_"><span class="hs-identifier hs-type">BlockHeaderDb_</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681509792"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681509791"><span class="hs-identifier hs-type">c</span></a></span><span>
</span><span id="line-287"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-288"></span><span id="blockHeaderDbApiLayout"><span class="annot"><span class="annottext">blockHeaderDbApiLayout :: BlockHeaderDb_ v c -&gt; IO ()
</span><a href="Chainweb.BlockHeaderDB.RestAPI.Server.html#blockHeaderDbApiLayout"><span class="hs-identifier hs-var hs-var">blockHeaderDbApiLayout</span></a></span></span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; IO ()
</span><span class="hs-identifier hs-var">T.putStrLn</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; IO ()) -&gt; Text -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Proxy
  (('ChainwebEndpoint v
    :&gt; (ChainEndpoint c
        :&gt; (&quot;hash&quot;
            :&gt; (QueryParam' '[Optional, Strict] &quot;limit&quot; Limit
                :&gt; (QueryParam' '[Optional, Strict] &quot;next&quot; (NextItem BlockHash)
                    :&gt; (QueryParam' '[Optional, Strict] &quot;minheight&quot; MinRank
                        :&gt; (QueryParam' '[Optional, Strict] &quot;maxheight&quot; MaxRank
                            :&gt; Verb
                                 'GET 200 '[JSON] (Page (NextItem BlockHash) BlockHash))))))))
   :&lt;|&gt; (('ChainwebEndpoint v
          :&gt; (ChainEndpoint c
              :&gt; (&quot;header&quot;
                  :&gt; (QueryParam' '[Optional, Strict] &quot;limit&quot; Limit
                      :&gt; (QueryParam' '[Optional, Strict] &quot;next&quot; (NextItem BlockHash)
                          :&gt; (QueryParam' '[Optional, Strict] &quot;minheight&quot; MinRank
                              :&gt; (QueryParam' '[Optional, Strict] &quot;maxheight&quot; MaxRank
                                  :&gt; Verb
                                       'GET
                                       200
                                       '[JSON, JsonBlockHeaderObject]
                                       (Page (NextItem BlockHash) BlockHeader))))))))
         :&lt;|&gt; (HeaderApi v c
               :&lt;|&gt; (HeaderPutApi v c
                     :&lt;|&gt; (('ChainwebEndpoint v
                            :&gt; (ChainEndpoint c
                                :&gt; (&quot;hash&quot;
                                    :&gt; (&quot;branch&quot;
                                        :&gt; (QueryParam' '[Optional, Strict] &quot;limit&quot; Limit
                                            :&gt; (QueryParam'
                                                  '[Optional, Strict] &quot;next&quot; (NextItem BlockHash)
                                                :&gt; (QueryParam'
                                                      '[Optional, Strict] &quot;minheight&quot; MinRank
                                                    :&gt; (QueryParam'
                                                          '[Optional, Strict] &quot;maxheight&quot; MaxRank
                                                        :&gt; (ReqBody'
                                                              '[Required, Strict]
                                                              '[JSON]
                                                              (BranchBounds BlockHeaderDb)
                                                            :&gt; Verb
                                                                 'POST
                                                                 200
                                                                 '[JSON]
                                                                 (Page
                                                                    (NextItem BlockHash)
                                                                    BlockHash))))))))))
                           :&lt;|&gt; ('ChainwebEndpoint v
                                 :&gt; (ChainEndpoint c
                                     :&gt; (&quot;header&quot;
                                         :&gt; (&quot;branch&quot;
                                             :&gt; (QueryParam' '[Optional, Strict] &quot;limit&quot; Limit
                                                 :&gt; (QueryParam'
                                                       '[Optional, Strict]
                                                       &quot;next&quot;
                                                       (NextItem BlockHash)
                                                     :&gt; (QueryParam'
                                                           '[Optional, Strict] &quot;minheight&quot; MinRank
                                                         :&gt; (QueryParam'
                                                               '[Optional, Strict]
                                                               &quot;maxheight&quot;
                                                               MaxRank
                                                             :&gt; (ReqBody'
                                                                   '[Required, Strict]
                                                                   '[JSON]
                                                                   (BranchBounds BlockHeaderDb)
                                                                 :&gt; Verb
                                                                      'POST
                                                                      200
                                                                      '[JSON, JsonBlockHeaderObject]
                                                                      (Page
                                                                         (NextItem BlockHash)
                                                                         BlockHeader)))))))))))))))
-&gt; Text
forall api. HasServer api '[] =&gt; Proxy api -&gt; Text
</span><span class="hs-identifier hs-var">layout</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy (BlockHeaderDbApi v c)
forall k (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.BlockHeaderDB.RestAPI.html#BlockHeaderDbApi"><span class="hs-identifier hs-type">BlockHeaderDbApi</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681509792"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681509791"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-289"></span><span>
</span><span id="line-290"></span><span class="hs-comment">-- -------------------------------------------------------------------------- --</span><span>
</span><span id="line-291"></span><span class="hs-comment">-- Multichain Server</span><span>
</span><span id="line-292"></span><span>
</span><span id="line-293"></span><span class="annot"><a href="Chainweb.BlockHeaderDB.RestAPI.Server.html#someBlockHeaderDbServer"><span class="hs-identifier hs-type">someBlockHeaderDbServer</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Chainweb.BlockHeaderDB.RestAPI.html#SomeBlockHeaderDb"><span class="hs-identifier hs-type">SomeBlockHeaderDb</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Chainweb.RestAPI.Utils.html#SomeServer"><span class="hs-identifier hs-type">SomeServer</span></a></span><span>
</span><span id="line-294"></span><span id="someBlockHeaderDbServer"><span class="annot"><span class="annottext">someBlockHeaderDbServer :: SomeBlockHeaderDb -&gt; SomeServer
</span><a href="Chainweb.BlockHeaderDB.RestAPI.Server.html#someBlockHeaderDbServer"><span class="hs-identifier hs-var hs-var">someBlockHeaderDbServer</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.BlockHeaderDB.RestAPI.html#SomeBlockHeaderDb"><span class="hs-identifier hs-type">SomeBlockHeaderDb</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681509786"><span id="local-6989586621681509787"><span id="local-6989586621681509785"><span class="annot"><span class="annottext">BlockHeaderDb_ v c
</span><a href="#local-6989586621681509785"><span class="hs-identifier hs-var">db</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Chainweb.BlockHeaderDB.RestAPI.html#BlockHeaderDb_"><span class="hs-identifier hs-type">BlockHeaderDb_</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681509787"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681509786"><span class="hs-identifier hs-type">c</span></a></span></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-295"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Proxy
  (('ChainwebEndpoint v
    :&gt; (ChainEndpoint c
        :&gt; (&quot;hash&quot;
            :&gt; (QueryParam' '[Optional, Strict] &quot;limit&quot; Limit
                :&gt; (QueryParam' '[Optional, Strict] &quot;next&quot; (NextItem BlockHash)
                    :&gt; (QueryParam' '[Optional, Strict] &quot;minheight&quot; MinRank
                        :&gt; (QueryParam' '[Optional, Strict] &quot;maxheight&quot; MaxRank
                            :&gt; Verb
                                 'GET 200 '[JSON] (Page (NextItem BlockHash) BlockHash))))))))
   :&lt;|&gt; (('ChainwebEndpoint v
          :&gt; (ChainEndpoint c
              :&gt; (&quot;header&quot;
                  :&gt; (QueryParam' '[Optional, Strict] &quot;limit&quot; Limit
                      :&gt; (QueryParam' '[Optional, Strict] &quot;next&quot; (NextItem BlockHash)
                          :&gt; (QueryParam' '[Optional, Strict] &quot;minheight&quot; MinRank
                              :&gt; (QueryParam' '[Optional, Strict] &quot;maxheight&quot; MaxRank
                                  :&gt; Verb
                                       'GET
                                       200
                                       '[JSON, JsonBlockHeaderObject]
                                       (Page (NextItem BlockHash) BlockHeader))))))))
         :&lt;|&gt; (HeaderApi v c
               :&lt;|&gt; (HeaderPutApi v c
                     :&lt;|&gt; (('ChainwebEndpoint v
                            :&gt; (ChainEndpoint c
                                :&gt; (&quot;hash&quot;
                                    :&gt; (&quot;branch&quot;
                                        :&gt; (QueryParam' '[Optional, Strict] &quot;limit&quot; Limit
                                            :&gt; (QueryParam'
                                                  '[Optional, Strict] &quot;next&quot; (NextItem BlockHash)
                                                :&gt; (QueryParam'
                                                      '[Optional, Strict] &quot;minheight&quot; MinRank
                                                    :&gt; (QueryParam'
                                                          '[Optional, Strict] &quot;maxheight&quot; MaxRank
                                                        :&gt; (ReqBody'
                                                              '[Required, Strict]
                                                              '[JSON]
                                                              (BranchBounds BlockHeaderDb)
                                                            :&gt; Verb
                                                                 'POST
                                                                 200
                                                                 '[JSON]
                                                                 (Page
                                                                    (NextItem BlockHash)
                                                                    BlockHash))))))))))
                           :&lt;|&gt; ('ChainwebEndpoint v
                                 :&gt; (ChainEndpoint c
                                     :&gt; (&quot;header&quot;
                                         :&gt; (&quot;branch&quot;
                                             :&gt; (QueryParam' '[Optional, Strict] &quot;limit&quot; Limit
                                                 :&gt; (QueryParam'
                                                       '[Optional, Strict]
                                                       &quot;next&quot;
                                                       (NextItem BlockHash)
                                                     :&gt; (QueryParam'
                                                           '[Optional, Strict] &quot;minheight&quot; MinRank
                                                         :&gt; (QueryParam'
                                                               '[Optional, Strict]
                                                               &quot;maxheight&quot;
                                                               MaxRank
                                                             :&gt; (ReqBody'
                                                                   '[Required, Strict]
                                                                   '[JSON]
                                                                   (BranchBounds BlockHeaderDb)
                                                                 :&gt; Verb
                                                                      'POST
                                                                      200
                                                                      '[JSON, JsonBlockHeaderObject]
                                                                      (Page
                                                                         (NextItem BlockHash)
                                                                         BlockHeader)))))))))))))))
-&gt; Server
     (('ChainwebEndpoint v
       :&gt; (ChainEndpoint c
           :&gt; (&quot;hash&quot;
               :&gt; (QueryParam' '[Optional, Strict] &quot;limit&quot; Limit
                   :&gt; (QueryParam' '[Optional, Strict] &quot;next&quot; (NextItem BlockHash)
                       :&gt; (QueryParam' '[Optional, Strict] &quot;minheight&quot; MinRank
                           :&gt; (QueryParam' '[Optional, Strict] &quot;maxheight&quot; MaxRank
                               :&gt; Verb
                                    'GET 200 '[JSON] (Page (NextItem BlockHash) BlockHash))))))))
      :&lt;|&gt; (('ChainwebEndpoint v
             :&gt; (ChainEndpoint c
                 :&gt; (&quot;header&quot;
                     :&gt; (QueryParam' '[Optional, Strict] &quot;limit&quot; Limit
                         :&gt; (QueryParam' '[Optional, Strict] &quot;next&quot; (NextItem BlockHash)
                             :&gt; (QueryParam' '[Optional, Strict] &quot;minheight&quot; MinRank
                                 :&gt; (QueryParam' '[Optional, Strict] &quot;maxheight&quot; MaxRank
                                     :&gt; Verb
                                          'GET
                                          200
                                          '[JSON, JsonBlockHeaderObject]
                                          (Page (NextItem BlockHash) BlockHeader))))))))
            :&lt;|&gt; (HeaderApi v c
                  :&lt;|&gt; (HeaderPutApi v c
                        :&lt;|&gt; (('ChainwebEndpoint v
                               :&gt; (ChainEndpoint c
                                   :&gt; (&quot;hash&quot;
                                       :&gt; (&quot;branch&quot;
                                           :&gt; (QueryParam' '[Optional, Strict] &quot;limit&quot; Limit
                                               :&gt; (QueryParam'
                                                     '[Optional, Strict] &quot;next&quot; (NextItem BlockHash)
                                                   :&gt; (QueryParam'
                                                         '[Optional, Strict] &quot;minheight&quot; MinRank
                                                       :&gt; (QueryParam'
                                                             '[Optional, Strict] &quot;maxheight&quot; MaxRank
                                                           :&gt; (ReqBody'
                                                                 '[Required, Strict]
                                                                 '[JSON]
                                                                 (BranchBounds BlockHeaderDb)
                                                               :&gt; Verb
                                                                    'POST
                                                                    200
                                                                    '[JSON]
                                                                    (Page
                                                                       (NextItem BlockHash)
                                                                       BlockHash))))))))))
                              :&lt;|&gt; ('ChainwebEndpoint v
                                    :&gt; (ChainEndpoint c
                                        :&gt; (&quot;header&quot;
                                            :&gt; (&quot;branch&quot;
                                                :&gt; (QueryParam' '[Optional, Strict] &quot;limit&quot; Limit
                                                    :&gt; (QueryParam'
                                                          '[Optional, Strict]
                                                          &quot;next&quot;
                                                          (NextItem BlockHash)
                                                        :&gt; (QueryParam'
                                                              '[Optional, Strict]
                                                              &quot;minheight&quot;
                                                              MinRank
                                                            :&gt; (QueryParam'
                                                                  '[Optional, Strict]
                                                                  &quot;maxheight&quot;
                                                                  MaxRank
                                                                :&gt; (ReqBody'
                                                                      '[Required, Strict]
                                                                      '[JSON]
                                                                      (BranchBounds BlockHeaderDb)
                                                                    :&gt; Verb
                                                                         'POST
                                                                         200
                                                                         '[JSON,
                                                                           JsonBlockHeaderObject]
                                                                         (Page
                                                                            (NextItem BlockHash)
                                                                            BlockHeader)))))))))))))))
-&gt; SomeServer
forall a. HasServer a '[] =&gt; Proxy a -&gt; Server a -&gt; SomeServer
</span><a href="Chainweb.RestAPI.Utils.html#SomeServer"><span class="hs-identifier hs-var">SomeServer</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy (BlockHeaderDbApi v c)
forall k (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.BlockHeaderDB.RestAPI.html#BlockHeaderDbApi"><span class="hs-identifier hs-type">BlockHeaderDbApi</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681509787"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681509786"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BlockHeaderDb_ v c -&gt; Server (BlockHeaderDbApi v c)
forall (v :: ChainwebVersionT) (c :: ChainIdT).
BlockHeaderDb_ v c -&gt; Server (BlockHeaderDbApi v c)
</span><a href="Chainweb.BlockHeaderDB.RestAPI.Server.html#blockHeaderDbServer"><span class="hs-identifier hs-var">blockHeaderDbServer</span></a></span><span> </span><span class="annot"><span class="annottext">BlockHeaderDb_ v c
</span><a href="#local-6989586621681509785"><span class="hs-identifier hs-var">db</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-296"></span><span>
</span><span id="line-297"></span><span class="annot"><a href="Chainweb.BlockHeaderDB.RestAPI.Server.html#someBlockHeaderDbServers"><span class="hs-identifier hs-type">someBlockHeaderDbServers</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Chainweb.Version.html#ChainwebVersion"><span class="hs-identifier hs-type">ChainwebVersion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.ChainId.html#ChainId"><span class="hs-identifier hs-type">ChainId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.BlockHeaderDB.Types.html#BlockHeaderDb"><span class="hs-identifier hs-type">BlockHeaderDb</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Chainweb.RestAPI.Utils.html#SomeServer"><span class="hs-identifier hs-type">SomeServer</span></a></span><span>
</span><span id="line-298"></span><span id="someBlockHeaderDbServers"><span class="annot"><span class="annottext">someBlockHeaderDbServers :: ChainwebVersion -&gt; [(ChainId, BlockHeaderDb)] -&gt; SomeServer
</span><a href="Chainweb.BlockHeaderDB.RestAPI.Server.html#someBlockHeaderDbServers"><span class="hs-identifier hs-var hs-var">someBlockHeaderDbServers</span></a></span></span><span> </span><span id="local-6989586621681509783"><span class="annot"><span class="annottext">v :: ChainwebVersion
</span><a href="#local-6989586621681509783"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SomeServer] -&gt; SomeServer
forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span>
</span><span id="line-299"></span><span>    </span><span class="annot"><span class="annottext">([SomeServer] -&gt; SomeServer)
-&gt; ([(ChainId, BlockHeaderDb)] -&gt; [SomeServer])
-&gt; [(ChainId, BlockHeaderDb)]
-&gt; SomeServer
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">((ChainId, BlockHeaderDb) -&gt; SomeServer)
-&gt; [(ChainId, BlockHeaderDb)] -&gt; [SomeServer]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SomeBlockHeaderDb -&gt; SomeServer
</span><a href="Chainweb.BlockHeaderDB.RestAPI.Server.html#someBlockHeaderDbServer"><span class="hs-identifier hs-var">someBlockHeaderDbServer</span></a></span><span> </span><span class="annot"><span class="annottext">(SomeBlockHeaderDb -&gt; SomeServer)
-&gt; ((ChainId, BlockHeaderDb) -&gt; SomeBlockHeaderDb)
-&gt; (ChainId, BlockHeaderDb)
-&gt; SomeServer
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(ChainId -&gt; BlockHeaderDb -&gt; SomeBlockHeaderDb)
-&gt; (ChainId, BlockHeaderDb) -&gt; SomeBlockHeaderDb
forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><span class="hs-identifier hs-var">uncurry</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ChainwebVersion -&gt; ChainId -&gt; BlockHeaderDb -&gt; SomeBlockHeaderDb
</span><a href="Chainweb.BlockHeaderDB.RestAPI.html#someBlockHeaderDbVal"><span class="hs-identifier hs-var">someBlockHeaderDbVal</span></a></span><span> </span><span class="annot"><span class="annottext">ChainwebVersion
</span><a href="#local-6989586621681509783"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-300"></span><span>
</span><span id="line-301"></span><span class="hs-comment">-- -------------------------------------------------------------------------- --</span><span>
</span><span id="line-302"></span><span class="hs-comment">-- BlockHeader Event Stream</span><span>
</span><span id="line-303"></span><span>
</span><span id="line-304"></span><span id="local-6989586621681509780"><span class="annot"><a href="Chainweb.BlockHeaderDB.RestAPI.Server.html#someHeaderStreamServer"><span class="hs-identifier hs-type">someHeaderStreamServer</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Chainweb.Payload.PayloadStore.Types.html#PayloadCas"><span class="hs-identifier hs-type">PayloadCas</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681509780"><span class="hs-identifier hs-type">cas</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Chainweb.Version.html#ChainwebVersion"><span class="hs-identifier hs-type">ChainwebVersion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Chainweb.CutDB.Types.html#CutDb"><span class="hs-identifier hs-type">CutDb</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681509780"><span class="hs-identifier hs-type">cas</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Chainweb.RestAPI.Utils.html#SomeServer"><span class="hs-identifier hs-type">SomeServer</span></a></span></span><span>
</span><span id="line-305"></span><span id="someHeaderStreamServer"><span class="annot"><span class="annottext">someHeaderStreamServer :: ChainwebVersion -&gt; CutDb cas -&gt; SomeServer
</span><a href="Chainweb.BlockHeaderDB.RestAPI.Server.html#someHeaderStreamServer"><span class="hs-identifier hs-var hs-var">someHeaderStreamServer</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Singletons.html#FromSing"><span class="hs-identifier hs-type">FromSing</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681509778"><span class="annot"><a href="Chainweb.Version.html#SChainwebVersion"><span class="hs-identifier hs-type">SChainwebVersion</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.Singletons.html#Sing"><span class="hs-identifier hs-type">Sing</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681509778"><span class="hs-identifier hs-type">v</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621681509775"><span class="annot"><span class="annottext">cdb :: CutDb cas
</span><a href="#local-6989586621681509775"><span class="hs-identifier hs-var">cdb</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-306"></span><span>    </span><span class="annot"><span class="annottext">Proxy (HeaderStreamApi a)
-&gt; Server (HeaderStreamApi a) -&gt; SomeServer
forall a. HasServer a '[] =&gt; Proxy a -&gt; Server a -&gt; SomeServer
</span><a href="Chainweb.RestAPI.Utils.html#SomeServer"><span class="hs-identifier hs-var">SomeServer</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy (HeaderStreamApi a)
forall k (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.BlockHeaderDB.RestAPI.html#HeaderStreamApi"><span class="hs-identifier hs-type">HeaderStreamApi</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681509778"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Server (HeaderStreamApi a) -&gt; SomeServer)
-&gt; Server (HeaderStreamApi a) -&gt; SomeServer
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CutDb cas -&gt; Server (HeaderStreamApi Any)
forall (cas :: * -&gt; *) (v :: ChainwebVersionT).
PayloadCas cas =&gt;
CutDb cas -&gt; Server (HeaderStreamApi v)
</span><a href="Chainweb.BlockHeaderDB.RestAPI.Server.html#headerStreamServer"><span class="hs-identifier hs-var">headerStreamServer</span></a></span><span> </span><span class="annot"><span class="annottext">CutDb cas
</span><a href="#local-6989586621681509775"><span class="hs-identifier hs-var">cdb</span></a></span><span>
</span><span id="line-307"></span><span>
</span><span id="line-308"></span><span class="annot"><a href="Chainweb.BlockHeaderDB.RestAPI.Server.html#headerStreamServer"><span class="hs-identifier hs-type">headerStreamServer</span></a></span><span>
</span><span id="line-309"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621681509985"><span class="annot"><a href="#local-6989586621681509985"><span class="hs-identifier hs-type">cas</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681509983"><span class="annot"><a href="#local-6989586621681509983"><span class="hs-identifier hs-type">v</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Chainweb.Version.html#ChainwebVersionT"><span class="hs-identifier hs-type">ChainwebVersionT</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-310"></span><span>    </span><span class="hs-operator">.</span><span>  </span><span class="annot"><a href="Chainweb.Payload.PayloadStore.Types.html#PayloadCas"><span class="hs-identifier hs-type">PayloadCas</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681509985"><span class="hs-identifier hs-type">cas</span></a></span><span>
</span><span id="line-311"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Chainweb.CutDB.Types.html#CutDb"><span class="hs-identifier hs-type">CutDb</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681509985"><span class="hs-identifier hs-type">cas</span></a></span><span>
</span><span id="line-312"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Server</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.BlockHeaderDB.RestAPI.html#HeaderStreamApi"><span class="hs-identifier hs-type">HeaderStreamApi</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681509983"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-313"></span><span id="headerStreamServer"><span class="annot"><span class="annottext">headerStreamServer :: CutDb cas -&gt; Server (HeaderStreamApi v)
</span><a href="Chainweb.BlockHeaderDB.RestAPI.Server.html#headerStreamServer"><span class="hs-identifier hs-var hs-var">headerStreamServer</span></a></span></span><span> </span><span id="local-6989586621681509773"><span class="annot"><span class="annottext">cdb :: CutDb cas
</span><a href="#local-6989586621681509773"><span class="hs-identifier hs-var">cdb</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CutDb cas -&gt; Tagged Handler Application
forall (cas :: * -&gt; *).
PayloadCas cas =&gt;
CutDb cas -&gt; Tagged Handler Application
</span><a href="Chainweb.BlockHeaderDB.RestAPI.Server.html#headerStreamHandler"><span class="hs-identifier hs-var">headerStreamHandler</span></a></span><span> </span><span class="annot"><span class="annottext">CutDb cas
</span><a href="#local-6989586621681509773"><span class="hs-identifier hs-var">cdb</span></a></span><span>
</span><span id="line-314"></span><span>
</span><span id="line-315"></span><span class="annot"><a href="Chainweb.BlockHeaderDB.RestAPI.Server.html#headerStreamHandler"><span class="hs-identifier hs-type">headerStreamHandler</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621681509979"><span class="annot"><a href="#local-6989586621681509979"><span class="hs-identifier hs-type">cas</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Chainweb.Payload.PayloadStore.Types.html#PayloadCas"><span class="hs-identifier hs-type">PayloadCas</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681509979"><span class="hs-identifier hs-type">cas</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Chainweb.CutDB.Types.html#CutDb"><span class="hs-identifier hs-type">CutDb</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681509979"><span class="hs-identifier hs-type">cas</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Tagged</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Handler</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Application</span></span><span>
</span><span id="line-316"></span><span id="headerStreamHandler"><span class="annot"><span class="annottext">headerStreamHandler :: CutDb cas -&gt; Tagged Handler Application
</span><a href="Chainweb.BlockHeaderDB.RestAPI.Server.html#headerStreamHandler"><span class="hs-identifier hs-var hs-var">headerStreamHandler</span></a></span></span><span> </span><span id="local-6989586621681509771"><span class="annot"><span class="annottext">db :: CutDb cas
</span><a href="#local-6989586621681509771"><span class="hs-identifier hs-var">db</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Application -&gt; Tagged Handler Application
forall k (s :: k) b. b -&gt; Tagged s b
</span><span class="hs-identifier hs-var">Tagged</span></span><span> </span><span class="annot"><span class="annottext">(Application -&gt; Tagged Handler Application)
-&gt; Application -&gt; Tagged Handler Application
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681509769"><span class="annot"><span class="annottext">req :: Request
</span><a href="#local-6989586621681509769"><span class="hs-identifier hs-var">req</span></a></span></span><span> </span><span id="local-6989586621681509768"><span class="annot"><span class="annottext">respond :: Response -&gt; IO ResponseReceived
</span><a href="#local-6989586621681509768"><span class="hs-identifier hs-var">respond</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-317"></span><span>    </span><span id="local-6989586621681509767"><span class="annot"><span class="annottext">IORef (Stream (Of ServerEvent) IO ())
</span><a href="#local-6989586621681509767"><span class="hs-identifier hs-var">streamRef</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Stream (Of ServerEvent) IO ()
-&gt; IO (IORef (Stream (Of ServerEvent) IO ()))
forall a. a -&gt; IO (IORef a)
</span><span class="hs-identifier hs-var">newIORef</span></span><span> </span><span class="annot"><span class="annottext">(Stream (Of ServerEvent) IO ()
 -&gt; IO (IORef (Stream (Of ServerEvent) IO ())))
-&gt; Stream (Of ServerEvent) IO ()
-&gt; IO (IORef (Stream (Of ServerEvent) IO ()))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(HeaderUpdate -&gt; ServerEvent)
-&gt; Stream (Of HeaderUpdate) IO () -&gt; Stream (Of ServerEvent) IO ()
forall (m :: * -&gt; *) a b r.
Monad m =&gt;
(a -&gt; b) -&gt; Stream (Of a) m r -&gt; Stream (Of b) m r
</span><span class="hs-identifier hs-var">SP.map</span></span><span> </span><span class="annot"><span class="annottext">HeaderUpdate -&gt; ServerEvent
</span><a href="#local-6989586621681509764"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">(Stream (Of HeaderUpdate) IO () -&gt; Stream (Of ServerEvent) IO ())
-&gt; Stream (Of HeaderUpdate) IO () -&gt; Stream (Of ServerEvent) IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(BlockHeader -&gt; IO HeaderUpdate)
-&gt; Stream (Of BlockHeader) IO () -&gt; Stream (Of HeaderUpdate) IO ()
forall (m :: * -&gt; *) a b r.
Monad m =&gt;
(a -&gt; m b) -&gt; Stream (Of a) m r -&gt; Stream (Of b) m r
</span><span class="hs-identifier hs-var">SP.mapM</span></span><span> </span><span class="annot"><span class="annottext">BlockHeader -&gt; IO HeaderUpdate
</span><a href="#local-6989586621681509762"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="annot"><span class="annottext">(Stream (Of BlockHeader) IO () -&gt; Stream (Of HeaderUpdate) IO ())
-&gt; Stream (Of BlockHeader) IO () -&gt; Stream (Of HeaderUpdate) IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Stream (Of (Either BlockHeader BlockHeader)) IO ()
-&gt; Stream (Of BlockHeader) IO ()
forall (m :: * -&gt; *) (f :: * -&gt; *) a r.
(Monad m, Foldable f) =&gt;
Stream (Of (f a)) m r -&gt; Stream (Of a) m r
</span><span class="hs-identifier hs-var">SP.concat</span></span><span> </span><span class="annot"><span class="annottext">(Stream (Of (Either BlockHeader BlockHeader)) IO ()
 -&gt; Stream (Of BlockHeader) IO ())
-&gt; Stream (Of (Either BlockHeader BlockHeader)) IO ()
-&gt; Stream (Of BlockHeader) IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CutDb cas -&gt; Stream (Of (Either BlockHeader BlockHeader)) IO ()
forall (m :: * -&gt; *) (cas :: * -&gt; *) r.
MonadIO m =&gt;
CutDb cas -&gt; Stream (Of (Either BlockHeader BlockHeader)) m r
</span><a href="Chainweb.CutDB.html#blockDiffStream"><span class="hs-identifier hs-var">blockDiffStream</span></a></span><span> </span><span class="annot"><span class="annottext">CutDb cas
</span><a href="#local-6989586621681509771"><span class="hs-identifier hs-var">db</span></a></span><span>
</span><span id="line-318"></span><span>    </span><span class="annot"><span class="annottext">IO ServerEvent -&gt; Application
</span><span class="hs-identifier hs-var">eventSourceAppIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IORef (Stream (Of ServerEvent) IO ()) -&gt; IO ServerEvent
</span><a href="#local-6989586621681509760"><span class="hs-identifier hs-var">run</span></a></span><span> </span><span class="annot"><span class="annottext">IORef (Stream (Of ServerEvent) IO ())
</span><a href="#local-6989586621681509767"><span class="hs-identifier hs-var">streamRef</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621681509769"><span class="hs-identifier hs-var">req</span></a></span><span> </span><span class="annot"><span class="annottext">Response -&gt; IO ResponseReceived
</span><a href="#local-6989586621681509768"><span class="hs-identifier hs-var">respond</span></a></span><span>
</span><span id="line-319"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-320"></span><span>    </span><span class="annot"><a href="#local-6989586621681509760"><span class="hs-identifier hs-type">run</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IORef</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">SP.Stream</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Of</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ServerEvent</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ServerEvent</span></span><span>
</span><span id="line-321"></span><span>    </span><span id="local-6989586621681509760"><span class="annot"><span class="annottext">run :: IORef (Stream (Of ServerEvent) IO ()) -&gt; IO ServerEvent
</span><a href="#local-6989586621681509760"><span class="hs-identifier hs-var hs-var">run</span></a></span></span><span> </span><span id="local-6989586621681509759"><span class="annot"><span class="annottext">var :: IORef (Stream (Of ServerEvent) IO ())
</span><a href="#local-6989586621681509759"><span class="hs-identifier hs-var">var</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef (Stream (Of ServerEvent) IO ())
-&gt; IO (Stream (Of ServerEvent) IO ())
forall a. IORef a -&gt; IO a
</span><span class="hs-identifier hs-var">readIORef</span></span><span> </span><span class="annot"><span class="annottext">IORef (Stream (Of ServerEvent) IO ())
</span><a href="#local-6989586621681509759"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">IO (Stream (Of ServerEvent) IO ())
-&gt; (Stream (Of ServerEvent) IO ()
    -&gt; IO (Maybe (ServerEvent, Stream (Of ServerEvent) IO ())))
-&gt; IO (Maybe (ServerEvent, Stream (Of ServerEvent) IO ()))
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Stream (Of ServerEvent) IO ()
-&gt; IO (Maybe (ServerEvent, Stream (Of ServerEvent) IO ()))
forall (m :: * -&gt; *) a r.
Monad m =&gt;
Stream (Of a) m r -&gt; m (Maybe (a, Stream (Of a) m r))
</span><span class="hs-identifier hs-var">SP.uncons</span></span><span> </span><span class="annot"><span class="annottext">IO (Maybe (ServerEvent, Stream (Of ServerEvent) IO ()))
-&gt; (Maybe (ServerEvent, Stream (Of ServerEvent) IO ())
    -&gt; IO ServerEvent)
-&gt; IO ServerEvent
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-322"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ServerEvent -&gt; IO ServerEvent
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">ServerEvent
</span><span class="hs-identifier hs-var">CloseEvent</span></span><span>
</span><span id="line-323"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681509755"><span class="annot"><span class="annottext">cur :: ServerEvent
</span><a href="#local-6989586621681509755"><span class="hs-identifier hs-var">cur</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621681509754"><span class="annot"><span class="annottext">Stream (Of ServerEvent) IO ()
</span><a href="#local-6989586621681509754"><span class="hs-identifier hs-var">s'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ServerEvent
</span><a href="#local-6989586621681509755"><span class="hs-identifier hs-var">cur</span></a></span><span> </span><span class="annot"><span class="annottext">ServerEvent -&gt; IO () -&gt; IO ServerEvent
forall (f :: * -&gt; *) a b. Functor f =&gt; a -&gt; f b -&gt; f a
</span><span class="hs-operator hs-var">&lt;$</span></span><span> </span><span class="annot"><span class="annottext">IORef (Stream (Of ServerEvent) IO ())
-&gt; Stream (Of ServerEvent) IO () -&gt; IO ()
forall a. IORef a -&gt; a -&gt; IO ()
</span><span class="hs-identifier hs-var">writeIORef</span></span><span> </span><span class="annot"><span class="annottext">IORef (Stream (Of ServerEvent) IO ())
</span><a href="#local-6989586621681509759"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">Stream (Of ServerEvent) IO ()
</span><a href="#local-6989586621681509754"><span class="hs-identifier hs-var">s'</span></a></span><span>
</span><span id="line-324"></span><span>
</span><span id="line-325"></span><span>    </span><span class="annot"><a href="#local-6989586621681509752"><span class="hs-identifier hs-type">cas</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Chainweb.Payload.PayloadStore.Types.html#PayloadDb"><span class="hs-identifier hs-type">PayloadDb</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681509979"><span class="hs-identifier hs-type">cas</span></a></span><span>
</span><span id="line-326"></span><span>    </span><span id="local-6989586621681509752"><span class="annot"><span class="annottext">cas :: PayloadDb cas
</span><a href="#local-6989586621681509752"><span class="hs-identifier hs-var hs-var">cas</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WebBlockPayloadStore cas -&gt; PayloadDb cas
forall (cas :: * -&gt; *). WebBlockPayloadStore cas -&gt; PayloadDb cas
</span><a href="Chainweb.Sync.WebBlockHeaderStore.Types.html#_webBlockPayloadStoreCas"><span class="hs-identifier hs-var hs-var">_webBlockPayloadStoreCas</span></a></span><span> </span><span class="annot"><span class="annottext">(WebBlockPayloadStore cas -&gt; PayloadDb cas)
-&gt; WebBlockPayloadStore cas -&gt; PayloadDb cas
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Getting
  (WebBlockPayloadStore cas) (CutDb cas) (WebBlockPayloadStore cas)
-&gt; CutDb cas -&gt; WebBlockPayloadStore cas
forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">view</span></span><span> </span><span class="annot"><span class="annottext">Getting
  (WebBlockPayloadStore cas) (CutDb cas) (WebBlockPayloadStore cas)
forall (cas :: * -&gt; *).
Getter (CutDb cas) (WebBlockPayloadStore cas)
</span><a href="Chainweb.CutDB.html#cutDbPayloadStore"><span class="hs-identifier hs-var">cutDbPayloadStore</span></a></span><span> </span><span class="annot"><span class="annottext">CutDb cas
</span><a href="#local-6989586621681509771"><span class="hs-identifier hs-var">db</span></a></span><span>
</span><span id="line-327"></span><span>
</span><span id="line-328"></span><span>    </span><span class="annot"><a href="#local-6989586621681509762"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Chainweb.BlockHeader.html#BlockHeader"><span class="hs-identifier hs-type">BlockHeader</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="Chainweb.BlockHeaderDB.RestAPI.html#HeaderUpdate"><span class="hs-identifier hs-type">HeaderUpdate</span></a></span><span>
</span><span id="line-329"></span><span>    </span><span id="local-6989586621681509762"><span class="annot"><span class="annottext">g :: BlockHeader -&gt; IO HeaderUpdate
</span><a href="#local-6989586621681509762"><span class="hs-identifier hs-var hs-var">g</span></a></span></span><span> </span><span id="local-6989586621681509750"><span class="annot"><span class="annottext">bh :: BlockHeader
</span><a href="#local-6989586621681509750"><span class="hs-identifier hs-var">bh</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-330"></span><span>        </span><span id="local-6989586621681509749"><span class="annot"><span class="annottext">PayloadWithOutputs
</span><a href="#local-6989586621681509749"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PayloadDb cas
-&gt; CasKeyType (CasValueType (PayloadDb cas))
-&gt; IO (CasValueType (PayloadDb cas))
forall a.
IsCas a =&gt;
a -&gt; CasKeyType (CasValueType a) -&gt; IO (CasValueType a)
</span><span class="hs-identifier hs-var">casLookupM</span></span><span> </span><span class="annot"><span class="annottext">PayloadDb cas
</span><a href="#local-6989586621681509752"><span class="hs-identifier hs-var">cas</span></a></span><span> </span><span class="annot"><span class="annottext">(CasKeyType (CasValueType (PayloadDb cas))
 -&gt; IO PayloadWithOutputs)
-&gt; CasKeyType (CasValueType (PayloadDb cas))
-&gt; IO PayloadWithOutputs
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BlockHeader -&gt; BlockPayloadHash
</span><a href="Chainweb.BlockHeader.html#_blockPayloadHash"><span class="hs-identifier hs-var hs-var">_blockPayloadHash</span></a></span><span> </span><span class="annot"><span class="annottext">BlockHeader
</span><a href="#local-6989586621681509750"><span class="hs-identifier hs-var">bh</span></a></span><span>
</span><span id="line-331"></span><span>        </span><span class="annot"><span class="annottext">HeaderUpdate -&gt; IO HeaderUpdate
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(HeaderUpdate -&gt; IO HeaderUpdate)
-&gt; HeaderUpdate -&gt; IO HeaderUpdate
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">$WHeaderUpdate :: ObjectEncoded BlockHeader -&gt; Int -&gt; Text -&gt; Text -&gt; HeaderUpdate
</span><a href="Chainweb.BlockHeaderDB.RestAPI.html#%24WHeaderUpdate"><span class="hs-identifier hs-type hs-type">HeaderUpdate</span></a></span><span>
</span><span id="line-332"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">_huHeader :: ObjectEncoded BlockHeader
</span><a href="Chainweb.BlockHeaderDB.RestAPI.html#_huHeader"><span class="hs-identifier hs-var">_huHeader</span></a></span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">BlockHeader -&gt; ObjectEncoded BlockHeader
forall a. a -&gt; ObjectEncoded a
</span><a href="Chainweb.BlockHeader.html#ObjectEncoded"><span class="hs-identifier hs-var">ObjectEncoded</span></a></span><span> </span><span class="annot"><span class="annottext">BlockHeader
</span><a href="#local-6989586621681509750"><span class="hs-identifier hs-var">bh</span></a></span><span>
</span><span id="line-333"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_huTxCount :: Int
</span><a href="Chainweb.BlockHeaderDB.RestAPI.html#_huTxCount"><span class="hs-identifier hs-var">_huTxCount</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector (Transaction, TransactionOutput) -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">(Vector (Transaction, TransactionOutput) -&gt; Int)
-&gt; Vector (Transaction, TransactionOutput) -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PayloadWithOutputs -&gt; Vector (Transaction, TransactionOutput)
</span><a href="Chainweb.Payload.html#_payloadWithOutputsTransactions"><span class="hs-identifier hs-var hs-var">_payloadWithOutputsTransactions</span></a></span><span> </span><span class="annot"><span class="annottext">PayloadWithOutputs
</span><a href="#local-6989586621681509749"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-334"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_huPowHash :: Text
</span><a href="Chainweb.BlockHeaderDB.RestAPI.html#_huPowHash"><span class="hs-identifier hs-var">_huPowHash</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Text
</span><span class="hs-identifier hs-var">decodeUtf8</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; Text) -&gt; (PowHash -&gt; ByteString) -&gt; PowHash -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString
</span><span class="hs-identifier hs-var">B16.encode</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; ByteString)
-&gt; (PowHash -&gt; ByteString) -&gt; PowHash -&gt; ByteString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString
</span><span class="hs-identifier hs-var">BS.reverse</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; ByteString)
-&gt; (PowHash -&gt; ByteString) -&gt; PowHash -&gt; ByteString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ShortByteString -&gt; ByteString
</span><span class="hs-identifier hs-var">fromShort</span></span><span> </span><span class="annot"><span class="annottext">(ShortByteString -&gt; ByteString)
-&gt; (PowHash -&gt; ShortByteString) -&gt; PowHash -&gt; ByteString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">PowHash -&gt; ShortByteString
</span><a href="Chainweb.PowHash.html#powHashBytes"><span class="hs-identifier hs-var">powHashBytes</span></a></span><span> </span><span class="annot"><span class="annottext">(PowHash -&gt; Text) -&gt; PowHash -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BlockHeader -&gt; PowHash
</span><a href="Chainweb.BlockHeader.html#_blockPow"><span class="hs-identifier hs-var">_blockPow</span></a></span><span> </span><span class="annot"><span class="annottext">BlockHeader
</span><a href="#local-6989586621681509750"><span class="hs-identifier hs-var">bh</span></a></span><span>
</span><span id="line-335"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_huTarget :: Text
</span><a href="Chainweb.BlockHeaderDB.RestAPI.html#_huTarget"><span class="hs-identifier hs-var">_huTarget</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashTarget -&gt; Text
</span><a href="Chainweb.Difficulty.html#showTargetHex"><span class="hs-identifier hs-var">showTargetHex</span></a></span><span> </span><span class="annot"><span class="annottext">(HashTarget -&gt; Text) -&gt; HashTarget -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BlockHeader -&gt; HashTarget
</span><a href="Chainweb.BlockHeader.html#_blockTarget"><span class="hs-identifier hs-var hs-var">_blockTarget</span></a></span><span> </span><span class="annot"><span class="annottext">BlockHeader
</span><a href="#local-6989586621681509750"><span class="hs-identifier hs-var">bh</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-336"></span><span>
</span><span id="line-337"></span><span>    </span><span class="annot"><a href="#local-6989586621681509764"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Chainweb.BlockHeaderDB.RestAPI.html#HeaderUpdate"><span class="hs-identifier hs-type">HeaderUpdate</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ServerEvent</span></span><span>
</span><span id="line-338"></span><span>    </span><span id="local-6989586621681509764"><span class="annot"><span class="annottext">f :: HeaderUpdate -&gt; ServerEvent
</span><a href="#local-6989586621681509764"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span id="local-6989586621681509735"><span class="annot"><span class="annottext">hu :: HeaderUpdate
</span><a href="#local-6989586621681509735"><span class="hs-identifier hs-var">hu</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Builder -&gt; Maybe Builder -&gt; [Builder] -&gt; ServerEvent
</span><span class="hs-identifier hs-var">ServerEvent</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Builder -&gt; Maybe Builder
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Builder -&gt; Maybe Builder) -&gt; Builder -&gt; Maybe Builder
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Builder
</span><span class="hs-identifier hs-var">fromByteString</span></span><span> </span><span class="annot"><span class="hs-string">&quot;BlockHeader&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Builder
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-339"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Builder
</span><span class="hs-identifier hs-var">fromLazyByteString</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; Builder)
-&gt; (Value -&gt; ByteString) -&gt; Value -&gt; Builder
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Value -&gt; ByteString
forall a. ToJSON a =&gt; a -&gt; ByteString
</span><span class="hs-identifier hs-var">encode</span></span><span> </span><span class="annot"><span class="annottext">(Value -&gt; Builder) -&gt; Value -&gt; Builder
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HeaderUpdate -&gt; Value
forall a. ToJSON a =&gt; a -&gt; Value
</span><span class="hs-identifier hs-var">toJSON</span></span><span> </span><span class="annot"><span class="annottext">HeaderUpdate
</span><a href="#local-6989586621681509735"><span class="hs-identifier hs-var">hu</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-340"></span></pre></body></html>