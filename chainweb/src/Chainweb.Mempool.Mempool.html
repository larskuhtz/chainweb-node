<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE BangPatterns #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE DeriveAnyClass #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE DeriveGeneric #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE DerivingStrategies #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE RankNTypes #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE TypeApplications #-}</span><span>
</span><span id="line-10"></span><span>
</span><span id="line-11"></span><span class="hs-pragma">{-# OPTIONS_GHC -fno-warn-orphans #-}</span><span>
</span><span id="line-12"></span><span>
</span><span id="line-13"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-14"></span><span class="hs-comment">-- | Mempool</span><span>
</span><span id="line-15"></span><span class="hs-comment">--</span><span>
</span><span id="line-16"></span><span class="hs-comment">-- The mempool contains an in-memory store of all of the pending transactions</span><span>
</span><span id="line-17"></span><span class="hs-comment">-- that have been submitted by users for inclusion into blocks, and is</span><span>
</span><span id="line-18"></span><span class="hs-comment">-- responsible for collecting the candidate transaction set when we prepare a</span><span>
</span><span id="line-19"></span><span class="hs-comment">-- new block for mining.</span><span>
</span><span id="line-20"></span><span class="hs-comment">--</span><span>
</span><span id="line-21"></span><span class="hs-comment">-- The in-memory mempool implementation (see @InMem.hs@ and @InMemTypes.hs@)</span><span>
</span><span id="line-22"></span><span class="hs-comment">-- contains three datasets:</span><span>
</span><span id="line-23"></span><span class="hs-comment">--</span><span>
</span><span id="line-24"></span><span class="hs-comment">-- 1. a priority search queue of pending transactions, keyed by pact</span><span>
</span><span id="line-25"></span><span class="hs-comment">-- transaction hash, and (currently) ordered by gas price (descending) with</span><span>
</span><span id="line-26"></span><span class="hs-comment">-- ties broken by gas limit (ascending). Basically -- we prefer highest bidder</span><span>
</span><span id="line-27"></span><span class="hs-comment">-- first, and all else being equal, smaller transactions.</span><span>
</span><span id="line-28"></span><span class="hs-comment">--</span><span>
</span><span id="line-29"></span><span class="hs-comment">-- 2. a recent-modifications log, storing the last @k@ updates to the mempool.</span><span>
</span><span id="line-30"></span><span class="hs-comment">-- This is in here so peers can sync with us by fetching starting with a</span><span>
</span><span id="line-31"></span><span class="hs-comment">-- high-water mark, rather than having to go through a complete re-sync of all</span><span>
</span><span id="line-32"></span><span class="hs-comment">-- transaction hashes.</span><span>
</span><span id="line-33"></span><span class="hs-comment">--</span><span>
</span><span id="line-34"></span><span class="hs-comment">-- Transaction lifecycle:</span><span>
</span><span id="line-35"></span><span class="hs-comment">--</span><span>
</span><span id="line-36"></span><span class="hs-comment">--   - a transaction is created and signed by a user, and sent (via the pact</span><span>
</span><span id="line-37"></span><span class="hs-comment">--     @/send@ endpoint) to the mempool, using 'mempoolInsert'</span><span>
</span><span id="line-38"></span><span class="hs-comment">--</span><span>
</span><span id="line-39"></span><span class="hs-comment">--   - miner calls 'mempoolGetBlock', at which point the top transactions (up</span><span>
</span><span id="line-40"></span><span class="hs-comment">--     to the gas limit) are run through the MempoolPreBlockCheck and discarded</span><span>
</span><span id="line-41"></span><span class="hs-comment">--     if they fail</span><span>
</span><span id="line-42"></span><span class="hs-comment">--</span><span>
</span><span id="line-43"></span><span class="hs-comment">--   - the transaction makes it into a mined block</span><span>
</span><span id="line-44"></span><span class="hs-comment">--</span><span>
</span><span id="line-45"></span><span class="hs-comment">--   - consensus calls pact's @newBlock@ to create the next block; at this</span><span>
</span><span id="line-46"></span><span class="hs-comment">--     point, the Consensus module processes the fork and: a) removes any</span><span>
</span><span id="line-47"></span><span class="hs-comment">--     transactions that made it onto the winning fork so that they are no</span><span>
</span><span id="line-48"></span><span class="hs-comment">--     longer considered for inclusion in blocks or gossiped, b) reintroduces</span><span>
</span><span id="line-49"></span><span class="hs-comment">--     any transactions into the mempool that were on the losing fork but</span><span>
</span><span id="line-50"></span><span class="hs-comment">--     didn't make it onto the winning one.</span><span>
</span><span id="line-51"></span><span class="hs-comment">--</span><span>
</span><span id="line-52"></span><span class="hs-comment">-- The mempool API is defined as a record-of-functions in 'MempoolBackend'.</span><span>
</span><span id="line-53"></span><span>
</span><span id="line-54"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Chainweb.Mempool.Mempool</span><span>
</span><span id="line-55"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#MempoolBackend"><span class="hs-identifier">MempoolBackend</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-56"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#MempoolPreBlockCheck"><span class="hs-identifier">MempoolPreBlockCheck</span></a></span><span>
</span><span id="line-57"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#TransactionConfig"><span class="hs-identifier">TransactionConfig</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-58"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#TransactionHash"><span class="hs-identifier">TransactionHash</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#TransactionMetadata"><span class="hs-identifier">TransactionMetadata</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-60"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#MempoolTxId"><span class="hs-identifier">MempoolTxId</span></a></span><span>
</span><span id="line-61"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#HashMeta"><span class="hs-identifier">HashMeta</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#ValidatedTransaction"><span class="hs-identifier">ValidatedTransaction</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-63"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#LookupResult"><span class="hs-identifier">LookupResult</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-64"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#MockTx"><span class="hs-identifier">MockTx</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-65"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#ServerNonce"><span class="hs-identifier">ServerNonce</span></a></span><span>
</span><span id="line-66"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#HighwaterMark"><span class="hs-identifier">HighwaterMark</span></a></span><span>
</span><span id="line-67"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#InsertType"><span class="hs-identifier">InsertType</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-68"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#InsertError"><span class="hs-identifier">InsertError</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-69"></span><span>
</span><span id="line-70"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#chainwebTransactionConfig"><span class="hs-identifier">chainwebTransactionConfig</span></a></span><span>
</span><span id="line-71"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#mockCodec"><span class="hs-identifier">mockCodec</span></a></span><span>
</span><span id="line-72"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#mockEncode"><span class="hs-identifier">mockEncode</span></a></span><span>
</span><span id="line-73"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#mockBlockGasLimit"><span class="hs-identifier">mockBlockGasLimit</span></a></span><span>
</span><span id="line-74"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#chainwebTestHasher"><span class="hs-identifier">chainwebTestHasher</span></a></span><span>
</span><span id="line-75"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#chainwebTestHashMeta"><span class="hs-identifier">chainwebTestHashMeta</span></a></span><span>
</span><span id="line-76"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#noopMempool"><span class="hs-identifier">noopMempool</span></a></span><span>
</span><span id="line-77"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#noopMempoolPreBlockCheck"><span class="hs-identifier">noopMempoolPreBlockCheck</span></a></span><span>
</span><span id="line-78"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#syncMempools"><span class="hs-identifier">syncMempools</span></a></span><span>
</span><span id="line-79"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#syncMempools%27"><span class="hs-identifier">syncMempools'</span></a></span><span>
</span><span id="line-80"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">GasLimit</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-81"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-82"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-83"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.DeepSeq</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">NFData</span></span><span class="hs-special">)</span><span>
</span><span id="line-84"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Exception</span></span><span>
</span><span id="line-85"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Lens</span></span><span>
</span><span id="line-86"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">replicateM</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">when</span></span><span class="hs-special">)</span><span>
</span><span id="line-87"></span><span>
</span><span id="line-88"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Crypto.Hash</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">hash</span></span><span class="hs-special">)</span><span>
</span><span id="line-89"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Crypto.Hash.Algorithms</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">SHA512t_256</span></span><span class="hs-special">)</span><span>
</span><span id="line-90"></span><span>
</span><span id="line-91"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Aeson</span></span><span>
</span><span id="line-92"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Bits</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">bit</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">shiftL</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">shiftR</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(.&amp;.)</span></span><span class="hs-special">)</span><span>
</span><span id="line-93"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteArray</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">convert</span></span><span class="hs-special">)</span><span>
</span><span id="line-94"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Bytes.Get</span></span><span>
</span><span id="line-95"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Bytes.Put</span></span><span>
</span><span id="line-96"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Base64.URL</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">B64</span></span><span>
</span><span id="line-97"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Char8</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ByteString</span></span><span class="hs-special">)</span><span>
</span><span id="line-98"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Char8</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">B</span></span><span>
</span><span id="line-99"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Short</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">SB</span></span><span>
</span><span id="line-100"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Decimal</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Decimal</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">DecimalRaw</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-101"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Foldable</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">traverse_</span></span><span class="hs-special">)</span><span>
</span><span id="line-102"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Hashable</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Hashable</span></span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">hashWithSalt</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-103"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.HashSet</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">HashSet</span></span><span class="hs-special">)</span><span>
</span><span id="line-104"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.HashSet</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HashSet</span></span><span>
</span><span id="line-105"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Int</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Int64</span></span><span class="hs-special">)</span><span>
</span><span id="line-106"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.IORef</span></span><span>
</span><span id="line-107"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">unfoldr</span></span><span class="hs-special">)</span><span>
</span><span id="line-108"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Text</span></span><span class="hs-special">)</span><span>
</span><span id="line-109"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-110"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Tuple.Strict</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">T2</span></span><span class="hs-special">)</span><span>
</span><span id="line-111"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Vector</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Vector</span></span><span class="hs-special">)</span><span>
</span><span id="line-112"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Vector</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">V</span></span><span>
</span><span id="line-113"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Word</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Word64</span></span><span class="hs-special">)</span><span>
</span><span id="line-114"></span><span>
</span><span id="line-115"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Generics</span></span><span>
</span><span id="line-116"></span><span>
</span><span id="line-117"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Prelude</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">log</span></span><span class="hs-special">)</span><span>
</span><span id="line-118"></span><span>
</span><span id="line-119"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.LogLevel</span></span><span>
</span><span id="line-120"></span><span>
</span><span id="line-121"></span><span class="hs-comment">-- internal modules</span><span>
</span><span id="line-122"></span><span>
</span><span id="line-123"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Pact.Parse</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ParsedDecimal</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">ParsedInteger</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-124"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Pact.Types.ChainMeta</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">TTLSeconds</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">TxCreationTime</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-125"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Pact.Types.Command</span></span><span>
</span><span id="line-126"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Pact.Types.Gas</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">GasLimit</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">GasPrice</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-127"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Pact.Types.Hash</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">H</span></span><span>
</span><span id="line-128"></span><span>
</span><span id="line-129"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Chainweb.BlockHash.html"><span class="hs-identifier">Chainweb.BlockHash</span></a></span><span>
</span><span id="line-130"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Chainweb.BlockHeader.html"><span class="hs-identifier">Chainweb.BlockHeader</span></a></span><span>
</span><span id="line-131"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Chainweb.Time.html"><span class="hs-identifier">Chainweb.Time</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.Time.html#Micros"><span class="hs-identifier">Micros</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.Time.html#Time"><span class="hs-identifier">Time</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.Time.html#TimeSpan"><span class="hs-identifier">TimeSpan</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-132"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Chainweb.Time.html"><span class="hs-identifier">Chainweb.Time</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Time</span></span><span>
</span><span id="line-133"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Chainweb.Transaction.html"><span class="hs-identifier">Chainweb.Transaction</span></a></span><span>
</span><span id="line-134"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Chainweb.Utils.html"><span class="hs-identifier">Chainweb.Utils</span></a></span><span>
</span><span id="line-135"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Data.LogMessage.html"><span class="hs-identifier">Data.LogMessage</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.LogMessage.html#LogFunctionText"><span class="hs-identifier">LogFunctionText</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-136"></span><span>
</span><span id="line-137"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-138"></span><span id="local-6989586621681483558"><span id="local-6989586621681483559"></span></span><span class="hs-keyword">data</span><span> </span><span id="LookupResult"><span class="annot"><a href="Chainweb.Mempool.Mempool.html#LookupResult"><span class="hs-identifier hs-var">LookupResult</span></a></span></span><span> </span><span id="local-6989586621681483887"><span class="annot"><a href="#local-6989586621681483887"><span class="hs-identifier hs-type">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Missing"><span class="annot"><a href="Chainweb.Mempool.Mempool.html#Missing"><span class="hs-identifier hs-var">Missing</span></a></span></span><span>
</span><span id="line-139"></span><span>                    </span><span class="hs-glyph">|</span><span> </span><span id="Pending"><span class="annot"><a href="Chainweb.Mempool.Mempool.html#Pending"><span class="hs-identifier hs-var">Pending</span></a></span></span><span> </span><span class="annot"><a href="#local-6989586621681483887"><span class="hs-identifier hs-type">t</span></a></span><span>
</span><span id="line-140"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681483550"><span id="local-6989586621681483552"><span id="local-6989586621681483554"><span class="annot"><span class="annottext">Int -&gt; LookupResult t -&gt; ShowS
[LookupResult t] -&gt; ShowS
LookupResult t -&gt; String
(Int -&gt; LookupResult t -&gt; ShowS)
-&gt; (LookupResult t -&gt; String)
-&gt; ([LookupResult t] -&gt; ShowS)
-&gt; Show (LookupResult t)
forall t. Show t =&gt; Int -&gt; LookupResult t -&gt; ShowS
forall t. Show t =&gt; [LookupResult t] -&gt; ShowS
forall t. Show t =&gt; LookupResult t -&gt; String
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [LookupResult t] -&gt; ShowS
$cshowList :: forall t. Show t =&gt; [LookupResult t] -&gt; ShowS
show :: LookupResult t -&gt; String
$cshow :: forall t. Show t =&gt; LookupResult t -&gt; String
showsPrec :: Int -&gt; LookupResult t -&gt; ShowS
$cshowsPrec :: forall t. Show t =&gt; Int -&gt; LookupResult t -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(forall x. LookupResult t -&gt; Rep (LookupResult t) x)
-&gt; (forall x. Rep (LookupResult t) x -&gt; LookupResult t)
-&gt; Generic (LookupResult t)
forall x. Rep (LookupResult t) x -&gt; LookupResult t
forall x. LookupResult t -&gt; Rep (LookupResult t) x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
forall t x. Rep (LookupResult t) x -&gt; LookupResult t
forall t x. LookupResult t -&gt; Rep (LookupResult t) x
$cto :: forall t x. Rep (LookupResult t) x -&gt; LookupResult t
$cfrom :: forall t x. LookupResult t -&gt; Rep (LookupResult t) x
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></span><span class="hs-special">)</span><span>
</span><span id="line-141"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">anyclass</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681483538"><span id="local-6989586621681483540"><span id="local-6989586621681483542"><span id="local-6989586621681483544"><span class="annot"><span class="annottext">[LookupResult t] -&gt; Encoding
[LookupResult t] -&gt; Value
LookupResult t -&gt; Encoding
LookupResult t -&gt; Value
(LookupResult t -&gt; Value)
-&gt; (LookupResult t -&gt; Encoding)
-&gt; ([LookupResult t] -&gt; Value)
-&gt; ([LookupResult t] -&gt; Encoding)
-&gt; ToJSON (LookupResult t)
forall t. ToJSON t =&gt; [LookupResult t] -&gt; Encoding
forall t. ToJSON t =&gt; [LookupResult t] -&gt; Value
forall t. ToJSON t =&gt; LookupResult t -&gt; Encoding
forall t. ToJSON t =&gt; LookupResult t -&gt; Value
forall a.
(a -&gt; Value)
-&gt; (a -&gt; Encoding)
-&gt; ([a] -&gt; Value)
-&gt; ([a] -&gt; Encoding)
-&gt; ToJSON a
toEncodingList :: [LookupResult t] -&gt; Encoding
$ctoEncodingList :: forall t. ToJSON t =&gt; [LookupResult t] -&gt; Encoding
toJSONList :: [LookupResult t] -&gt; Value
$ctoJSONList :: forall t. ToJSON t =&gt; [LookupResult t] -&gt; Value
toEncoding :: LookupResult t -&gt; Encoding
$ctoEncoding :: forall t. ToJSON t =&gt; LookupResult t -&gt; Encoding
toJSON :: LookupResult t -&gt; Value
$ctoJSON :: forall t. ToJSON t =&gt; LookupResult t -&gt; Value
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">ToJSON</span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681483533"><span id="local-6989586621681483535"><span class="annot"><span class="annottext">Value -&gt; Parser [LookupResult t]
Value -&gt; Parser (LookupResult t)
(Value -&gt; Parser (LookupResult t))
-&gt; (Value -&gt; Parser [LookupResult t]) -&gt; FromJSON (LookupResult t)
forall t. FromJSON t =&gt; Value -&gt; Parser [LookupResult t]
forall t. FromJSON t =&gt; Value -&gt; Parser (LookupResult t)
forall a.
(Value -&gt; Parser a) -&gt; (Value -&gt; Parser [a]) -&gt; FromJSON a
parseJSONList :: Value -&gt; Parser [LookupResult t]
$cparseJSONList :: forall t. FromJSON t =&gt; Value -&gt; Parser [LookupResult t]
parseJSON :: Value -&gt; Parser (LookupResult t)
$cparseJSON :: forall t. FromJSON t =&gt; Value -&gt; Parser (LookupResult t)
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">FromJSON</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681483530"><span class="annot"><span class="annottext">LookupResult t -&gt; ()
(LookupResult t -&gt; ()) -&gt; NFData (LookupResult t)
forall t. NFData t =&gt; LookupResult t -&gt; ()
forall a. (a -&gt; ()) -&gt; NFData a
rnf :: LookupResult t -&gt; ()
$crnf :: forall t. NFData t =&gt; LookupResult t -&gt; ()
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">NFData</span></span></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- TODO: a handwritten instance</span><span>
</span><span id="line-142"></span><span>
</span><span id="line-143"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681483526"><span class="annot"><span class="hs-identifier hs-type">Functor</span></span><span> </span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#LookupResult"><span class="hs-identifier hs-type">LookupResult</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-144"></span><span>    </span><span id="local-6989586621681483524"><span class="annot"><span class="annottext">fmap :: (a -&gt; b) -&gt; LookupResult a -&gt; LookupResult b
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">fmap</span></span></span><span> </span><span class="hs-identifier">_</span><span> </span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#Missing"><span class="hs-identifier hs-type">Missing</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LookupResult b
forall t. LookupResult t
</span><a href="Chainweb.Mempool.Mempool.html#Missing"><span class="hs-identifier hs-var">Missing</span></a></span><span>
</span><span id="line-145"></span><span>    </span><span class="annot"><span class="hs-identifier hs-var">fmap</span></span><span> </span><span id="local-6989586621681483523"><span class="annot"><span class="annottext">f :: a -&gt; b
</span><a href="#local-6989586621681483523"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#Pending"><span class="hs-identifier hs-type">Pending</span></a></span><span> </span><span id="local-6989586621681483522"><span class="annot"><span class="annottext">x :: a
</span><a href="#local-6989586621681483522"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">b -&gt; LookupResult b
forall t. t -&gt; LookupResult t
</span><a href="Chainweb.Mempool.Mempool.html#Pending"><span class="hs-identifier hs-var">Pending</span></a></span><span> </span><span class="annot"><span class="annottext">(b -&gt; LookupResult b) -&gt; b -&gt; LookupResult b
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621681483523"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681483522"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-146"></span><span>
</span><span id="line-147"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681483488"><span id="local-6989586621681483490"><span id="local-6989586621681483492"><span id="local-6989586621681483494"><span id="local-6989586621681483496"><span id="local-6989586621681483498"><span id="local-6989586621681483500"><span id="local-6989586621681483502"><span id="local-6989586621681483504"><span id="local-6989586621681483506"><span id="local-6989586621681483508"><span id="local-6989586621681483510"><span id="local-6989586621681483512"><span id="local-6989586621681483515"><span id="local-6989586621681483517"><span id="local-6989586621681483519"><span class="annot"><span class="hs-identifier hs-type">Foldable</span></span><span> </span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#LookupResult"><span class="hs-identifier hs-type">LookupResult</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-148"></span><span>    </span><span id="local-6989586621681483486"><span class="annot"><span class="annottext">foldr :: (a -&gt; b -&gt; b) -&gt; b -&gt; LookupResult a -&gt; b
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">foldr</span></span></span><span> </span><span id="local-6989586621681483484"><span class="annot"><span class="annottext">f :: a -&gt; b -&gt; b
</span><a href="#local-6989586621681483484"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621681483483"><span class="annot"><span class="annottext">seed :: b
</span><a href="#local-6989586621681483483"><span class="hs-identifier hs-var">seed</span></a></span></span><span> </span><span id="local-6989586621681483482"><span class="annot"><span class="annottext">t :: LookupResult a
</span><a href="#local-6989586621681483482"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">LookupResult a
</span><a href="#local-6989586621681483482"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-149"></span><span>                       </span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#Missing"><span class="hs-identifier hs-type">Missing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621681483483"><span class="hs-identifier hs-var">seed</span></a></span><span>
</span><span id="line-150"></span><span>                       </span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#Pending"><span class="hs-identifier hs-type">Pending</span></a></span><span> </span><span id="local-6989586621681483481"><span class="annot"><span class="annottext">x :: a
</span><a href="#local-6989586621681483481"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">a -&gt; b -&gt; b
</span><a href="#local-6989586621681483484"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681483481"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621681483483"><span class="hs-identifier hs-var">seed</span></a></span><span>
</span><span id="line-151"></span><span>
</span><span id="line-152"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681483472"><span id="local-6989586621681483474"><span id="local-6989586621681483476"><span class="annot"><span class="hs-identifier hs-type">Traversable</span></span><span> </span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#LookupResult"><span class="hs-identifier hs-type">LookupResult</span></a></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-153"></span><span>    </span><span id="local-6989586621681483470"><span class="annot"><span class="annottext">traverse :: (a -&gt; f b) -&gt; LookupResult a -&gt; f (LookupResult b)
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">traverse</span></span></span><span> </span><span id="local-6989586621681483468"><span class="annot"><span class="annottext">f :: a -&gt; f b
</span><a href="#local-6989586621681483468"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621681483467"><span class="annot"><span class="annottext">t :: LookupResult a
</span><a href="#local-6989586621681483467"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">LookupResult a
</span><a href="#local-6989586621681483467"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-154"></span><span>                     </span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#Missing"><span class="hs-identifier hs-type">Missing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LookupResult b -&gt; f (LookupResult b)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">LookupResult b
forall t. LookupResult t
</span><a href="Chainweb.Mempool.Mempool.html#Missing"><span class="hs-identifier hs-var">Missing</span></a></span><span>
</span><span id="line-155"></span><span>                     </span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#Pending"><span class="hs-identifier hs-type">Pending</span></a></span><span> </span><span id="local-6989586621681483466"><span class="annot"><span class="annottext">x :: a
</span><a href="#local-6989586621681483466"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">b -&gt; LookupResult b
forall t. t -&gt; LookupResult t
</span><a href="Chainweb.Mempool.Mempool.html#Pending"><span class="hs-identifier hs-var">Pending</span></a></span><span> </span><span class="annot"><span class="annottext">(b -&gt; LookupResult b) -&gt; f b -&gt; f (LookupResult b)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; f b
</span><a href="#local-6989586621681483468"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681483466"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-156"></span><span>
</span><span id="line-157"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-158"></span><span class="hs-keyword">type</span><span> </span><span id="MempoolPreBlockCheck"><span class="annot"><a href="Chainweb.Mempool.Mempool.html#MempoolPreBlockCheck"><span class="hs-identifier hs-var">MempoolPreBlockCheck</span></a></span></span><span> </span><span id="local-6989586621681483464"><span class="annot"><a href="#local-6989586621681483464"><span class="hs-identifier hs-type">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Chainweb.BlockHeader.html#BlockHeight"><span class="hs-identifier hs-type">BlockHeight</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Chainweb.BlockHash.html#BlockHash"><span class="hs-identifier hs-type">BlockHash</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="annot"><a href="#local-6989586621681483464"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span>
</span><span id="line-159"></span><span>
</span><span id="line-160"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-161"></span><span class="hs-comment">-- | Mempool operates over a transaction type @t@. Mempool needs several</span><span>
</span><span id="line-162"></span><span class="hs-comment">-- functions on @t@, e.g. \&quot;how do you encode and decode @t@ over the wire?\&quot;</span><span>
</span><span id="line-163"></span><span class="hs-comment">-- and \&quot;how is @t@ hashed?\&quot;. This information is passed to mempool in a</span><span>
</span><span id="line-164"></span><span class="hs-comment">-- 'TransactionConfig'.</span><span>
</span><span id="line-165"></span><span class="hs-keyword">data</span><span> </span><span id="TransactionConfig"><span class="annot"><a href="Chainweb.Mempool.Mempool.html#TransactionConfig"><span class="hs-identifier hs-var">TransactionConfig</span></a></span></span><span> </span><span id="local-6989586621681483738"><span class="annot"><a href="#local-6989586621681483738"><span class="hs-identifier hs-type">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="TransactionConfig"><span class="annot"><a href="Chainweb.Mempool.Mempool.html#TransactionConfig"><span class="hs-identifier hs-var">TransactionConfig</span></a></span></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-166"></span><span>    </span><span class="hs-comment">-- | converting transactions to/from bytestring. Note: the generated</span><span>
</span><span id="line-167"></span><span>    </span><span class="hs-comment">-- bytestring is currently expected to be valid utf8 so that it can be</span><span>
</span><span id="line-168"></span><span>    </span><span class="hs-comment">-- safely JSON-encoded by servant (we should revisit this)</span><span>
</span><span id="line-169"></span><span>    </span><span id="txCodec"><span class="annot"><span class="annottext">TransactionConfig t -&gt; Codec t
</span><a href="Chainweb.Mempool.Mempool.html#txCodec"><span class="hs-identifier hs-var hs-var">txCodec</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.Utils.html#Codec"><span class="hs-identifier hs-type">Codec</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681483738"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-170"></span><span>
</span><span id="line-171"></span><span>    </span><span class="hs-comment">-- | hash function to use when making transaction hashes.</span><span>
</span><span id="line-172"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="txHasher"><span class="annot"><span class="annottext">TransactionConfig t -&gt; t -&gt; TransactionHash
</span><a href="Chainweb.Mempool.Mempool.html#txHasher"><span class="hs-identifier hs-var hs-var">txHasher</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621681483738"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#TransactionHash"><span class="hs-identifier hs-type">TransactionHash</span></a></span><span>
</span><span id="line-173"></span><span>
</span><span id="line-174"></span><span>    </span><span class="hs-comment">-- | hash function metadata. Currently informational only -- for future use.</span><span>
</span><span id="line-175"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="txHashMeta"><span class="annot"><span class="annottext">TransactionConfig t -&gt; HashMeta
</span><a href="Chainweb.Mempool.Mempool.html#txHashMeta"><span class="hs-identifier hs-var hs-var">txHashMeta</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#HashMeta"><span class="hs-identifier hs-type">HashMeta</span></a></span><span>
</span><span id="line-176"></span><span>
</span><span id="line-177"></span><span>    </span><span class="hs-comment">-- | getter for the transaction gas price.</span><span>
</span><span id="line-178"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="txGasPrice"><span class="annot"><span class="annottext">TransactionConfig t -&gt; t -&gt; GasPrice
</span><a href="Chainweb.Mempool.Mempool.html#txGasPrice"><span class="hs-identifier hs-var hs-var">txGasPrice</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621681483738"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">GasPrice</span></span><span>
</span><span id="line-179"></span><span>
</span><span id="line-180"></span><span>    </span><span class="hs-comment">-- | getter for transaction gas limit.</span><span>
</span><span id="line-181"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="txGasLimit"><span class="annot"><span class="annottext">TransactionConfig t -&gt; t -&gt; GasLimit
</span><a href="Chainweb.Mempool.Mempool.html#txGasLimit"><span class="hs-identifier hs-var hs-var">txGasLimit</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621681483738"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">GasLimit</span></span><span>
</span><span id="line-182"></span><span>
</span><span id="line-183"></span><span>    </span><span class="hs-comment">-- | getter for transaction metadata (creation and expiry timestamps)</span><span>
</span><span id="line-184"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="txMetadata"><span class="annot"><span class="annottext">TransactionConfig t -&gt; t -&gt; TransactionMetadata
</span><a href="Chainweb.Mempool.Mempool.html#txMetadata"><span class="hs-identifier hs-var hs-var">txMetadata</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621681483738"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#TransactionMetadata"><span class="hs-identifier hs-type">TransactionMetadata</span></a></span><span>
</span><span id="line-185"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-186"></span><span>
</span><span id="line-187"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-188"></span><span class="hs-keyword">type</span><span> </span><span id="MempoolTxId"><span class="annot"><a href="Chainweb.Mempool.Mempool.html#MempoolTxId"><span class="hs-identifier hs-var">MempoolTxId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int64</span></span><span>
</span><span id="line-189"></span><span class="hs-keyword">type</span><span> </span><span id="ServerNonce"><span class="annot"><a href="Chainweb.Mempool.Mempool.html#ServerNonce"><span class="hs-identifier hs-var">ServerNonce</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-190"></span><span class="hs-keyword">type</span><span> </span><span id="HighwaterMark"><span class="annot"><a href="Chainweb.Mempool.Mempool.html#HighwaterMark"><span class="hs-identifier hs-var">HighwaterMark</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#ServerNonce"><span class="hs-identifier hs-type">ServerNonce</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#MempoolTxId"><span class="hs-identifier hs-type">MempoolTxId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-191"></span><span class="hs-keyword">data</span><span> </span><span id="InsertType"><span class="annot"><a href="Chainweb.Mempool.Mempool.html#InsertType"><span class="hs-identifier hs-var">InsertType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="CheckedInsert"><span class="annot"><a href="Chainweb.Mempool.Mempool.html#CheckedInsert"><span class="hs-identifier hs-var">CheckedInsert</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="UncheckedInsert"><span class="annot"><a href="Chainweb.Mempool.Mempool.html#UncheckedInsert"><span class="hs-identifier hs-var">UncheckedInsert</span></a></span></span><span>
</span><span id="line-192"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681483449"><span id="local-6989586621681483451"><span id="local-6989586621681483453"><span class="annot"><span class="annottext">Int -&gt; InsertType -&gt; ShowS
[InsertType] -&gt; ShowS
InsertType -&gt; String
(Int -&gt; InsertType -&gt; ShowS)
-&gt; (InsertType -&gt; String)
-&gt; ([InsertType] -&gt; ShowS)
-&gt; Show InsertType
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [InsertType] -&gt; ShowS
$cshowList :: [InsertType] -&gt; ShowS
show :: InsertType -&gt; String
$cshow :: InsertType -&gt; String
showsPrec :: Int -&gt; InsertType -&gt; ShowS
$cshowsPrec :: Int -&gt; InsertType -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681483445"><span id="local-6989586621681483447"><span class="annot"><span class="annottext">InsertType -&gt; InsertType -&gt; Bool
(InsertType -&gt; InsertType -&gt; Bool)
-&gt; (InsertType -&gt; InsertType -&gt; Bool) -&gt; Eq InsertType
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: InsertType -&gt; InsertType -&gt; Bool
$c/= :: InsertType -&gt; InsertType -&gt; Bool
== :: InsertType -&gt; InsertType -&gt; Bool
$c== :: InsertType -&gt; InsertType -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-193"></span><span>
</span><span id="line-194"></span><span id="local-6989586621681483442"><span id="local-6989586621681483443"></span></span><span class="hs-keyword">data</span><span> </span><span id="InsertError"><span class="annot"><a href="Chainweb.Mempool.Mempool.html#InsertError"><span class="hs-identifier hs-var">InsertError</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="InsertErrorDuplicate"><span class="annot"><a href="Chainweb.Mempool.Mempool.html#InsertErrorDuplicate"><span class="hs-identifier hs-var">InsertErrorDuplicate</span></a></span></span><span>
</span><span id="line-195"></span><span>                 </span><span class="hs-glyph">|</span><span> </span><span id="InsertErrorInvalidTime"><span class="annot"><a href="Chainweb.Mempool.Mempool.html#InsertErrorInvalidTime"><span class="hs-identifier hs-var">InsertErrorInvalidTime</span></a></span></span><span>
</span><span id="line-196"></span><span>                 </span><span class="hs-glyph">|</span><span> </span><span id="InsertErrorOversized"><span class="annot"><a href="Chainweb.Mempool.Mempool.html#InsertErrorOversized"><span class="hs-identifier hs-var">InsertErrorOversized</span></a></span></span><span>
</span><span id="line-197"></span><span>                 </span><span class="hs-glyph">|</span><span> </span><span id="InsertErrorBadlisted"><span class="annot"><a href="Chainweb.Mempool.Mempool.html#InsertErrorBadlisted"><span class="hs-identifier hs-var">InsertErrorBadlisted</span></a></span></span><span>
</span><span id="line-198"></span><span>                 </span><span class="hs-glyph">|</span><span> </span><span id="InsertErrorMetadataMismatch"><span class="annot"><a href="Chainweb.Mempool.Mempool.html#InsertErrorMetadataMismatch"><span class="hs-identifier hs-var">InsertErrorMetadataMismatch</span></a></span></span><span>
</span><span id="line-199"></span><span>                 </span><span class="hs-glyph">|</span><span> </span><span id="InsertErrorTransactionsDisabled"><span class="annot"><a href="Chainweb.Mempool.Mempool.html#InsertErrorTransactionsDisabled"><span class="hs-identifier hs-var">InsertErrorTransactionsDisabled</span></a></span></span><span>
</span><span id="line-200"></span><span>                 </span><span class="hs-glyph">|</span><span> </span><span id="InsertErrorOther"><span class="annot"><a href="Chainweb.Mempool.Mempool.html#InsertErrorOther"><span class="hs-identifier hs-var">InsertErrorOther</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-201"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(forall x. InsertError -&gt; Rep InsertError x)
-&gt; (forall x. Rep InsertError x -&gt; InsertError)
-&gt; Generic InsertError
forall x. Rep InsertError x -&gt; InsertError
forall x. InsertError -&gt; Rep InsertError x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep InsertError x -&gt; InsertError
$cfrom :: forall x. InsertError -&gt; Rep InsertError x
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681483429"><span id="local-6989586621681483431"><span class="annot"><span class="annottext">InsertError -&gt; InsertError -&gt; Bool
(InsertError -&gt; InsertError -&gt; Bool)
-&gt; (InsertError -&gt; InsertError -&gt; Bool) -&gt; Eq InsertError
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: InsertError -&gt; InsertError -&gt; Bool
$c/= :: InsertError -&gt; InsertError -&gt; Bool
== :: InsertError -&gt; InsertError -&gt; Bool
$c== :: InsertError -&gt; InsertError -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-202"></span><span>
</span><span id="line-203"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681483424"><span id="local-6989586621681483427"><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#InsertError"><span class="hs-identifier hs-type">InsertError</span></a></span></span></span><span>
</span><span id="line-204"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-205"></span><span>    </span><span id="local-6989586621681483423"><span class="annot"><span class="annottext">show :: InsertError -&gt; String
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">show</span></span></span><span> </span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#InsertErrorDuplicate"><span class="hs-identifier hs-type">InsertErrorDuplicate</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-string">&quot;Transaction already exists on chain&quot;</span></span><span>
</span><span id="line-206"></span><span>    </span><span class="annot"><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#InsertErrorInvalidTime"><span class="hs-identifier hs-type">InsertErrorInvalidTime</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-string">&quot;Transaction time is invalid or TTL is expired&quot;</span></span><span>
</span><span id="line-207"></span><span>    </span><span class="annot"><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#InsertErrorOversized"><span class="hs-identifier hs-type">InsertErrorOversized</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-string">&quot;Transaction gas limit exceeds block gas limit&quot;</span></span><span>
</span><span id="line-208"></span><span>    </span><span class="annot"><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#InsertErrorBadlisted"><span class="hs-identifier hs-type">InsertErrorBadlisted</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-209"></span><span>        </span><span class="annot"><span class="hs-string">&quot;Transaction is badlisted because it previously failed to validate \
        \(e.g. insufficient gas)&quot;</span></span><span>
</span><span id="line-211"></span><span>    </span><span class="annot"><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#InsertErrorMetadataMismatch"><span class="hs-identifier hs-type">InsertErrorMetadataMismatch</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-212"></span><span>        </span><span class="annot"><span class="hs-string">&quot;Transaction metadata (chain id, chainweb version) conflicts with this \
        \endpoint&quot;</span></span><span>
</span><span id="line-214"></span><span>    </span><span class="annot"><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#InsertErrorTransactionsDisabled"><span class="hs-identifier hs-type">InsertErrorTransactionsDisabled</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-string">&quot;Transactions are disabled until December 5&quot;</span></span><span>
</span><span id="line-215"></span><span>    </span><span class="annot"><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#InsertErrorOther"><span class="hs-identifier hs-type">InsertErrorOther</span></a></span><span> </span><span id="local-6989586621681483421"><span class="annot"><span class="annottext">m :: Text
</span><a href="#local-6989586621681483421"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-string">&quot;insert error: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">T.unpack</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621681483421"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-216"></span><span>
</span><span id="line-217"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681483412"><span id="local-6989586621681483414"><span id="local-6989586621681483416"><span class="annot"><span class="hs-identifier hs-type">Exception</span></span><span> </span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#InsertError"><span class="hs-identifier hs-type">InsertError</span></a></span></span></span></span><span>
</span><span id="line-218"></span><span>
</span><span id="line-219"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-220"></span><span class="hs-comment">-- | Mempool backend API. Here @t@ is the transaction payload type.</span><span>
</span><span id="line-221"></span><span class="hs-keyword">data</span><span> </span><span id="MempoolBackend"><span class="annot"><a href="Chainweb.Mempool.Mempool.html#MempoolBackend"><span class="hs-identifier hs-var">MempoolBackend</span></a></span></span><span> </span><span id="local-6989586621681483773"><span class="annot"><a href="#local-6989586621681483773"><span class="hs-identifier hs-type">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="MempoolBackend"><span class="annot"><a href="Chainweb.Mempool.Mempool.html#MempoolBackend"><span class="hs-identifier hs-var">MempoolBackend</span></a></span></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-222"></span><span>    </span><span id="mempoolTxConfig"><span class="annot"><span class="annottext">MempoolBackend t -&gt; TransactionConfig t
</span><a href="Chainweb.Mempool.Mempool.html#mempoolTxConfig"><span class="hs-identifier hs-var hs-var">mempoolTxConfig</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#TransactionConfig"><span class="hs-identifier hs-type">TransactionConfig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681483773"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-223"></span><span>
</span><span id="line-224"></span><span>    </span><span class="hs-comment">-- TODO: move this inside TransactionConfig or new MempoolConfig ?</span><span>
</span><span id="line-225"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="mempoolBlockGasLimit"><span class="annot"><span class="annottext">MempoolBackend t -&gt; GasLimit
</span><a href="Chainweb.Mempool.Mempool.html#mempoolBlockGasLimit"><span class="hs-identifier hs-var hs-var">mempoolBlockGasLimit</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">GasLimit</span></span><span>
</span><span id="line-226"></span><span>
</span><span id="line-227"></span><span>    </span><span class="hs-comment">-- | Returns true if the given transaction hash is known to this mempool.</span><span>
</span><span id="line-228"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="mempoolMember"><span class="annot"><span class="annottext">MempoolBackend t -&gt; Vector TransactionHash -&gt; IO (Vector Bool)
</span><a href="Chainweb.Mempool.Mempool.html#mempoolMember"><span class="hs-identifier hs-var hs-var">mempoolMember</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#TransactionHash"><span class="hs-identifier hs-type">TransactionHash</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span>
</span><span id="line-229"></span><span>
</span><span id="line-230"></span><span>    </span><span class="hs-comment">-- | Lookup transactions in the pending queue by hash.</span><span>
</span><span id="line-231"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="mempoolLookup"><span class="annot"><span class="annottext">MempoolBackend t
-&gt; Vector TransactionHash -&gt; IO (Vector (LookupResult t))
</span><a href="Chainweb.Mempool.Mempool.html#mempoolLookup"><span class="hs-identifier hs-var hs-var">mempoolLookup</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#TransactionHash"><span class="hs-identifier hs-type">TransactionHash</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#LookupResult"><span class="hs-identifier hs-type">LookupResult</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681483773"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-232"></span><span>
</span><span id="line-233"></span><span>    </span><span class="hs-comment">-- | Insert the given transactions into the mempool.</span><span>
</span><span id="line-234"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="mempoolInsert"><span class="annot"><span class="annottext">MempoolBackend t -&gt; InsertType -&gt; Vector t -&gt; IO ()
</span><a href="Chainweb.Mempool.Mempool.html#mempoolInsert"><span class="hs-identifier hs-var hs-var">mempoolInsert</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#InsertType"><span class="hs-identifier hs-type">InsertType</span></a></span><span>      </span><span class="hs-comment">-- run pre-gossip check? Ignored at remote pools.</span><span>
</span><span id="line-235"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="annot"><a href="#local-6989586621681483773"><span class="hs-identifier hs-type">t</span></a></span><span>
</span><span id="line-236"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-237"></span><span>
</span><span id="line-238"></span><span>    </span><span class="hs-comment">-- | Perform the pre-insert check for the given transactions. Short-circuits</span><span>
</span><span id="line-239"></span><span>    </span><span class="hs-comment">-- on the first Transaction that fails.</span><span>
</span><span id="line-240"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="mempoolInsertCheck"><span class="annot"><span class="annottext">MempoolBackend t
-&gt; Vector t -&gt; IO (Either (T2 TransactionHash InsertError) ())
</span><a href="Chainweb.Mempool.Mempool.html#mempoolInsertCheck"><span class="hs-identifier hs-var hs-var">mempoolInsertCheck</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="annot"><a href="#local-6989586621681483773"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">T2</span></span><span> </span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#TransactionHash"><span class="hs-identifier hs-type">TransactionHash</span></a></span><span> </span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#InsertError"><span class="hs-identifier hs-type">InsertError</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-241"></span><span>
</span><span id="line-242"></span><span>    </span><span class="hs-comment">-- | Remove the given hashes from the pending set.</span><span>
</span><span id="line-243"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="mempoolMarkValidated"><span class="annot"><span class="annottext">MempoolBackend t -&gt; Vector TransactionHash -&gt; IO ()
</span><a href="Chainweb.Mempool.Mempool.html#mempoolMarkValidated"><span class="hs-identifier hs-var hs-var">mempoolMarkValidated</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#TransactionHash"><span class="hs-identifier hs-type">TransactionHash</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-244"></span><span>
</span><span id="line-245"></span><span>    </span><span class="hs-comment">-- | given maximum block size, produce a candidate block of transactions</span><span>
</span><span id="line-246"></span><span>    </span><span class="hs-comment">-- for mining.</span><span>
</span><span id="line-247"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-248"></span><span>    </span><span class="hs-comment">-- TODO remove gas limit argument here</span><span>
</span><span id="line-249"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="mempoolGetBlock"><span class="annot"><span class="annottext">MempoolBackend t
-&gt; MempoolPreBlockCheck t
-&gt; BlockHeight
-&gt; BlockHash
-&gt; GasLimit
-&gt; IO (Vector t)
</span><a href="Chainweb.Mempool.Mempool.html#mempoolGetBlock"><span class="hs-identifier hs-var hs-var">mempoolGetBlock</span></a></span></span><span>
</span><span id="line-250"></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#MempoolPreBlockCheck"><span class="hs-identifier hs-type">MempoolPreBlockCheck</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681483773"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Chainweb.BlockHeader.html#BlockHeight"><span class="hs-identifier hs-type">BlockHeight</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Chainweb.BlockHash.html#BlockHash"><span class="hs-identifier hs-type">BlockHash</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">GasLimit</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="annot"><a href="#local-6989586621681483773"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-251"></span><span>
</span><span id="line-252"></span><span>    </span><span class="hs-comment">-- | given a previous high-water mark and a chunk callback function, loops</span><span>
</span><span id="line-253"></span><span>    </span><span class="hs-comment">-- through the pending candidate transactions and supplies the hashes to</span><span>
</span><span id="line-254"></span><span>    </span><span class="hs-comment">-- the callback in chunks. No ordering of hashes is presupposed. Returns</span><span>
</span><span id="line-255"></span><span>    </span><span class="hs-comment">-- the remote high-water mark.</span><span>
</span><span id="line-256"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="mempoolGetPendingTransactions"><span class="annot"><span class="annottext">MempoolBackend t
-&gt; Maybe HighwaterMark
-&gt; (Vector TransactionHash -&gt; IO ())
-&gt; IO HighwaterMark
</span><a href="Chainweb.Mempool.Mempool.html#mempoolGetPendingTransactions"><span class="hs-identifier hs-var hs-var">mempoolGetPendingTransactions</span></a></span></span><span>
</span><span id="line-257"></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#HighwaterMark"><span class="hs-identifier hs-type">HighwaterMark</span></a></span><span>                </span><span class="hs-comment">-- previous high-water mark, if any</span><span>
</span><span id="line-258"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#TransactionHash"><span class="hs-identifier hs-type">TransactionHash</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- chunk callback</span><span>
</span><span id="line-259"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#HighwaterMark"><span class="hs-identifier hs-type">HighwaterMark</span></a></span><span>                   </span><span class="hs-comment">-- returns remote high water mark</span><span>
</span><span id="line-260"></span><span>
</span><span id="line-261"></span><span>  </span><span class="hs-comment">-- | A hook to clear the mempool. Intended only for the in-mem backend and</span><span>
</span><span id="line-262"></span><span>  </span><span class="hs-comment">-- only for testing.</span><span>
</span><span id="line-263"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="mempoolClear"><span class="annot"><span class="annottext">MempoolBackend t -&gt; IO ()
</span><a href="Chainweb.Mempool.Mempool.html#mempoolClear"><span class="hs-identifier hs-var hs-var">mempoolClear</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-264"></span><span class="hs-special">}</span><span>
</span><span id="line-265"></span><span>
</span><span id="line-266"></span><span id="local-6989586621681483399"><span class="annot"><a href="Chainweb.Mempool.Mempool.html#noopMempoolPreBlockCheck"><span class="hs-identifier hs-type">noopMempoolPreBlockCheck</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#MempoolPreBlockCheck"><span class="hs-identifier hs-type">MempoolPreBlockCheck</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681483399"><span class="hs-identifier hs-type">t</span></a></span></span><span>
</span><span id="line-267"></span><span id="noopMempoolPreBlockCheck"><span class="annot"><span class="annottext">noopMempoolPreBlockCheck :: MempoolPreBlockCheck t
</span><a href="Chainweb.Mempool.Mempool.html#noopMempoolPreBlockCheck"><span class="hs-identifier hs-var hs-var">noopMempoolPreBlockCheck</span></a></span></span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span id="local-6989586621681483398"><span class="annot"><span class="annottext">v :: Vector t
</span><a href="#local-6989586621681483398"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector Bool -&gt; IO (Vector Bool)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Vector Bool -&gt; IO (Vector Bool))
-&gt; Vector Bool -&gt; IO (Vector Bool)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Bool -&gt; Vector Bool
forall a. Int -&gt; a -&gt; Vector a
</span><span class="hs-identifier hs-var">V.replicate</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Vector t -&gt; Int
forall a. Vector a -&gt; Int
</span><span class="hs-identifier hs-var">V.length</span></span><span> </span><span class="annot"><span class="annottext">Vector t
</span><a href="#local-6989586621681483398"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-268"></span><span>
</span><span id="line-269"></span><span id="local-6989586621681483395"><span class="annot"><a href="Chainweb.Mempool.Mempool.html#noopMempool"><span class="hs-identifier hs-type">noopMempool</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#MempoolBackend"><span class="hs-identifier hs-type">MempoolBackend</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681483395"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-270"></span><span id="noopMempool"><span class="annot"><span class="annottext">noopMempool :: IO (MempoolBackend t)
</span><a href="Chainweb.Mempool.Mempool.html#noopMempool"><span class="hs-identifier hs-var hs-var">noopMempool</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-271"></span><span>  </span><span class="annot"><span class="annottext">MempoolBackend t -&gt; IO (MempoolBackend t)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(MempoolBackend t -&gt; IO (MempoolBackend t))
-&gt; MempoolBackend t -&gt; IO (MempoolBackend t)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">$WMempoolBackend :: forall t.
TransactionConfig t
-&gt; GasLimit
-&gt; (Vector TransactionHash -&gt; IO (Vector Bool))
-&gt; (Vector TransactionHash -&gt; IO (Vector (LookupResult t)))
-&gt; (InsertType -&gt; Vector t -&gt; IO ())
-&gt; (Vector t -&gt; IO (Either (T2 TransactionHash InsertError) ()))
-&gt; (Vector TransactionHash -&gt; IO ())
-&gt; (MempoolPreBlockCheck t
    -&gt; BlockHeight -&gt; BlockHash -&gt; GasLimit -&gt; IO (Vector t))
-&gt; (Maybe HighwaterMark
    -&gt; (Vector TransactionHash -&gt; IO ()) -&gt; IO HighwaterMark)
-&gt; IO ()
-&gt; MempoolBackend t
</span><a href="Chainweb.Mempool.Mempool.html#%24WMempoolBackend"><span class="hs-identifier hs-type hs-type">MempoolBackend</span></a></span><span>
</span><span id="line-272"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">mempoolTxConfig :: TransactionConfig t
</span><a href="Chainweb.Mempool.Mempool.html#mempoolTxConfig"><span class="hs-identifier hs-var">mempoolTxConfig</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TransactionConfig t
forall b. TransactionConfig b
</span><a href="#local-6989586621681483393"><span class="hs-identifier hs-var">txcfg</span></a></span><span>
</span><span id="line-273"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">mempoolBlockGasLimit :: GasLimit
</span><a href="Chainweb.Mempool.Mempool.html#mempoolBlockGasLimit"><span class="hs-identifier hs-var">mempoolBlockGasLimit</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-number">1000</span></span><span>
</span><span id="line-274"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">mempoolMember :: Vector TransactionHash -&gt; IO (Vector Bool)
</span><a href="Chainweb.Mempool.Mempool.html#mempoolMember"><span class="hs-identifier hs-var">mempoolMember</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector TransactionHash -&gt; IO (Vector Bool)
forall (m :: * -&gt; *) a. Monad m =&gt; Vector a -&gt; m (Vector Bool)
</span><a href="#local-6989586621681483392"><span class="hs-identifier hs-var">noopMember</span></a></span><span>
</span><span id="line-275"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">mempoolLookup :: Vector TransactionHash -&gt; IO (Vector (LookupResult t))
</span><a href="Chainweb.Mempool.Mempool.html#mempoolLookup"><span class="hs-identifier hs-var">mempoolLookup</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector TransactionHash -&gt; IO (Vector (LookupResult t))
forall (m :: * -&gt; *) a t.
Monad m =&gt;
Vector a -&gt; m (Vector (LookupResult t))
</span><a href="#local-6989586621681483391"><span class="hs-identifier hs-var">noopLookup</span></a></span><span>
</span><span id="line-276"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">mempoolInsert :: InsertType -&gt; Vector t -&gt; IO ()
</span><a href="Chainweb.Mempool.Mempool.html#mempoolInsert"><span class="hs-identifier hs-var">mempoolInsert</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InsertType -&gt; Vector t -&gt; IO ()
forall b b. b -&gt; b -&gt; IO ()
</span><a href="#local-6989586621681483390"><span class="hs-identifier hs-var">noopInsert</span></a></span><span>
</span><span id="line-277"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">mempoolInsertCheck :: Vector t -&gt; IO (Either (T2 TransactionHash InsertError) ())
</span><a href="Chainweb.Mempool.Mempool.html#mempoolInsertCheck"><span class="hs-identifier hs-var">mempoolInsertCheck</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector t -&gt; IO (Either (T2 TransactionHash InsertError) ())
forall (m :: * -&gt; *) p a. MonadFail m =&gt; p -&gt; m a
</span><a href="#local-6989586621681483389"><span class="hs-identifier hs-var">noopInsertCheck</span></a></span><span>
</span><span id="line-278"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">mempoolMarkValidated :: Vector TransactionHash -&gt; IO ()
</span><a href="Chainweb.Mempool.Mempool.html#mempoolMarkValidated"><span class="hs-identifier hs-var">mempoolMarkValidated</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector TransactionHash -&gt; IO ()
forall b. b -&gt; IO ()
</span><a href="#local-6989586621681483388"><span class="hs-identifier hs-var">noopMV</span></a></span><span>
</span><span id="line-279"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">mempoolGetBlock :: MempoolPreBlockCheck t
-&gt; BlockHeight -&gt; BlockHash -&gt; GasLimit -&gt; IO (Vector t)
</span><a href="Chainweb.Mempool.Mempool.html#mempoolGetBlock"><span class="hs-identifier hs-var">mempoolGetBlock</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MempoolPreBlockCheck t
-&gt; BlockHeight -&gt; BlockHash -&gt; GasLimit -&gt; IO (Vector t)
forall (m :: * -&gt; *) p p p p a.
Monad m =&gt;
p -&gt; p -&gt; p -&gt; p -&gt; m (Vector a)
</span><a href="#local-6989586621681483387"><span class="hs-identifier hs-var">noopGetBlock</span></a></span><span>
</span><span id="line-280"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">mempoolGetPendingTransactions :: Maybe HighwaterMark
-&gt; (Vector TransactionHash -&gt; IO ()) -&gt; IO HighwaterMark
</span><a href="Chainweb.Mempool.Mempool.html#mempoolGetPendingTransactions"><span class="hs-identifier hs-var">mempoolGetPendingTransactions</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe HighwaterMark
-&gt; (Vector TransactionHash -&gt; IO ()) -&gt; IO HighwaterMark
forall b b. b -&gt; b -&gt; IO HighwaterMark
</span><a href="#local-6989586621681483386"><span class="hs-identifier hs-var">noopGetPending</span></a></span><span>
</span><span id="line-281"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">mempoolClear :: IO ()
</span><a href="Chainweb.Mempool.Mempool.html#mempoolClear"><span class="hs-identifier hs-var">mempoolClear</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621681483385"><span class="hs-identifier hs-var">noopClear</span></a></span><span>
</span><span id="line-282"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-283"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-284"></span><span>    </span><span id="local-6989586621681483384"><span class="annot"><span class="annottext">noopCodec :: Codec b
</span><a href="#local-6989586621681483384"><span class="hs-identifier hs-var hs-var">noopCodec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(b -&gt; ByteString) -&gt; (ByteString -&gt; Either String b) -&gt; Codec b
forall t.
(t -&gt; ByteString) -&gt; (ByteString -&gt; Either String t) -&gt; Codec t
</span><a href="Chainweb.Utils.html#Codec"><span class="hs-identifier hs-var">Codec</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; b -&gt; ByteString
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Either String b -&gt; ByteString -&gt; Either String b
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">(Either String b -&gt; ByteString -&gt; Either String b)
-&gt; Either String b -&gt; ByteString -&gt; Either String b
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Either String b
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="hs-string">&quot;unimplemented&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-285"></span><span>    </span><span id="local-6989586621681483381"><span class="annot"><span class="annottext">noopHasher :: b -&gt; TransactionHash
</span><a href="#local-6989586621681483381"><span class="hs-identifier hs-var hs-var">noopHasher</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TransactionHash -&gt; b -&gt; TransactionHash
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">(TransactionHash -&gt; b -&gt; TransactionHash)
-&gt; TransactionHash -&gt; b -&gt; TransactionHash
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; TransactionHash
</span><a href="Chainweb.Mempool.Mempool.html#chainwebTestHasher"><span class="hs-identifier hs-var">chainwebTestHasher</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;noopMempool&quot;</span></span><span>
</span><span id="line-286"></span><span>    </span><span id="local-6989586621681483380"><span class="annot"><span class="annottext">noopHashMeta :: HashMeta
</span><a href="#local-6989586621681483380"><span class="hs-identifier hs-var hs-var">noopHashMeta</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashMeta
</span><a href="Chainweb.Mempool.Mempool.html#chainwebTestHashMeta"><span class="hs-identifier hs-var">chainwebTestHashMeta</span></a></span><span>
</span><span id="line-287"></span><span>    </span><span id="local-6989586621681483379"><span class="annot"><span class="annottext">noopGasPrice :: b -&gt; GasPrice
</span><a href="#local-6989586621681483379"><span class="hs-identifier hs-var hs-var">noopGasPrice</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GasPrice -&gt; b -&gt; GasPrice
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span>
</span><span id="line-288"></span><span>    </span><span id="local-6989586621681483378"><span class="annot"><span class="annottext">noopSize :: b -&gt; GasLimit
</span><a href="#local-6989586621681483378"><span class="hs-identifier hs-var hs-var">noopSize</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GasLimit -&gt; b -&gt; GasLimit
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span>
</span><span id="line-289"></span><span>    </span><span id="local-6989586621681483377"><span class="annot"><span class="annottext">noopMeta :: b -&gt; TransactionMetadata
</span><a href="#local-6989586621681483377"><span class="hs-identifier hs-var hs-var">noopMeta</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TransactionMetadata -&gt; b -&gt; TransactionMetadata
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">(TransactionMetadata -&gt; b -&gt; TransactionMetadata)
-&gt; TransactionMetadata -&gt; b -&gt; TransactionMetadata
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Time Micros -&gt; Time Micros -&gt; TransactionMetadata
</span><a href="Chainweb.Mempool.Mempool.html#TransactionMetadata"><span class="hs-identifier hs-var">TransactionMetadata</span></a></span><span> </span><span class="annot"><span class="annottext">Time Micros
forall a. Bounded a =&gt; Time a
</span><a href="Chainweb.Time.html#minTime"><span class="hs-identifier hs-var">Time.minTime</span></a></span><span> </span><span class="annot"><span class="annottext">Time Micros
forall a. Bounded a =&gt; Time a
</span><a href="Chainweb.Time.html#maxTime"><span class="hs-identifier hs-var">Time.maxTime</span></a></span><span>
</span><span id="line-290"></span><span>    </span><span id="local-6989586621681483393"><span class="annot"><span class="annottext">txcfg :: TransactionConfig b
</span><a href="#local-6989586621681483393"><span class="hs-identifier hs-var hs-var">txcfg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Codec b
-&gt; (b -&gt; TransactionHash)
-&gt; HashMeta
-&gt; (b -&gt; GasPrice)
-&gt; (b -&gt; GasLimit)
-&gt; (b -&gt; TransactionMetadata)
-&gt; TransactionConfig b
forall t.
Codec t
-&gt; (t -&gt; TransactionHash)
-&gt; HashMeta
-&gt; (t -&gt; GasPrice)
-&gt; (t -&gt; GasLimit)
-&gt; (t -&gt; TransactionMetadata)
-&gt; TransactionConfig t
</span><a href="Chainweb.Mempool.Mempool.html#TransactionConfig"><span class="hs-identifier hs-var">TransactionConfig</span></a></span><span> </span><span class="annot"><span class="annottext">Codec b
forall b. Codec b
</span><a href="#local-6989586621681483384"><span class="hs-identifier hs-var">noopCodec</span></a></span><span> </span><span class="annot"><span class="annottext">b -&gt; TransactionHash
forall b. b -&gt; TransactionHash
</span><a href="#local-6989586621681483381"><span class="hs-identifier hs-var">noopHasher</span></a></span><span> </span><span class="annot"><span class="annottext">HashMeta
</span><a href="#local-6989586621681483380"><span class="hs-identifier hs-var">noopHashMeta</span></a></span><span> </span><span class="annot"><span class="annottext">b -&gt; GasPrice
forall b. b -&gt; GasPrice
</span><a href="#local-6989586621681483379"><span class="hs-identifier hs-var">noopGasPrice</span></a></span><span> </span><span class="annot"><span class="annottext">b -&gt; GasLimit
forall b. b -&gt; GasLimit
</span><a href="#local-6989586621681483378"><span class="hs-identifier hs-var">noopSize</span></a></span><span>
</span><span id="line-291"></span><span>                              </span><span class="annot"><span class="annottext">b -&gt; TransactionMetadata
forall b. b -&gt; TransactionMetadata
</span><a href="#local-6989586621681483377"><span class="hs-identifier hs-var">noopMeta</span></a></span><span>
</span><span id="line-292"></span><span>    </span><span id="local-6989586621681483392"><span class="annot"><span class="annottext">noopMember :: Vector a -&gt; m (Vector Bool)
</span><a href="#local-6989586621681483392"><span class="hs-identifier hs-var hs-var">noopMember</span></a></span></span><span> </span><span id="local-6989586621681483373"><span class="annot"><span class="annottext">v :: Vector a
</span><a href="#local-6989586621681483373"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector Bool -&gt; m (Vector Bool)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Vector Bool -&gt; m (Vector Bool)) -&gt; Vector Bool -&gt; m (Vector Bool)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Bool -&gt; Vector Bool
forall a. Int -&gt; a -&gt; Vector a
</span><span class="hs-identifier hs-var">V.replicate</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Vector a -&gt; Int
forall a. Vector a -&gt; Int
</span><span class="hs-identifier hs-var">V.length</span></span><span> </span><span class="annot"><span class="annottext">Vector a
</span><a href="#local-6989586621681483373"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-293"></span><span>    </span><span id="local-6989586621681483391"><span class="annot"><span class="annottext">noopLookup :: Vector a -&gt; m (Vector (LookupResult t))
</span><a href="#local-6989586621681483391"><span class="hs-identifier hs-var hs-var">noopLookup</span></a></span></span><span> </span><span id="local-6989586621681483372"><span class="annot"><span class="annottext">v :: Vector a
</span><a href="#local-6989586621681483372"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector (LookupResult t) -&gt; m (Vector (LookupResult t))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Vector (LookupResult t) -&gt; m (Vector (LookupResult t)))
-&gt; Vector (LookupResult t) -&gt; m (Vector (LookupResult t))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; LookupResult t -&gt; Vector (LookupResult t)
forall a. Int -&gt; a -&gt; Vector a
</span><span class="hs-identifier hs-var">V.replicate</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Vector a -&gt; Int
forall a. Vector a -&gt; Int
</span><span class="hs-identifier hs-var">V.length</span></span><span> </span><span class="annot"><span class="annottext">Vector a
</span><a href="#local-6989586621681483372"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LookupResult t
forall t. LookupResult t
</span><a href="Chainweb.Mempool.Mempool.html#Missing"><span class="hs-identifier hs-var">Missing</span></a></span><span>
</span><span id="line-294"></span><span>    </span><span id="local-6989586621681483390"><span class="annot"><span class="annottext">noopInsert :: b -&gt; b -&gt; IO ()
</span><a href="#local-6989586621681483390"><span class="hs-identifier hs-var hs-var">noopInsert</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(b -&gt; IO ()) -&gt; b -&gt; b -&gt; IO ()
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">((b -&gt; IO ()) -&gt; b -&gt; b -&gt; IO ())
-&gt; (b -&gt; IO ()) -&gt; b -&gt; b -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IO () -&gt; b -&gt; IO ()
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; b -&gt; IO ()) -&gt; IO () -&gt; b -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-295"></span><span>    </span><span id="local-6989586621681483389"><span class="annot"><span class="annottext">noopInsertCheck :: p -&gt; m a
</span><a href="#local-6989586621681483389"><span class="hs-identifier hs-var hs-var">noopInsertCheck</span></a></span></span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; m a
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><span class="hs-identifier hs-var">fail</span></span><span> </span><span class="annot"><span class="hs-string">&quot;unsupported&quot;</span></span><span>
</span><span id="line-296"></span><span>    </span><span id="local-6989586621681483388"><span class="annot"><span class="annottext">noopMV :: b -&gt; IO ()
</span><a href="#local-6989586621681483388"><span class="hs-identifier hs-var hs-var">noopMV</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; b -&gt; IO ()
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; b -&gt; IO ()) -&gt; IO () -&gt; b -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-297"></span><span>    </span><span id="local-6989586621681483387"><span class="annot"><span class="annottext">noopGetBlock :: p -&gt; p -&gt; p -&gt; p -&gt; m (Vector a)
</span><a href="#local-6989586621681483387"><span class="hs-identifier hs-var hs-var">noopGetBlock</span></a></span></span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector a -&gt; m (Vector a)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Vector a
forall a. Vector a
</span><span class="hs-identifier hs-var">V.empty</span></span><span>
</span><span id="line-298"></span><span>    </span><span id="local-6989586621681483386"><span class="annot"><span class="annottext">noopGetPending :: b -&gt; b -&gt; IO HighwaterMark
</span><a href="#local-6989586621681483386"><span class="hs-identifier hs-var hs-var">noopGetPending</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(b -&gt; IO HighwaterMark) -&gt; b -&gt; b -&gt; IO HighwaterMark
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">((b -&gt; IO HighwaterMark) -&gt; b -&gt; b -&gt; IO HighwaterMark)
-&gt; (b -&gt; IO HighwaterMark) -&gt; b -&gt; b -&gt; IO HighwaterMark
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IO HighwaterMark -&gt; b -&gt; IO HighwaterMark
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">(IO HighwaterMark -&gt; b -&gt; IO HighwaterMark)
-&gt; IO HighwaterMark -&gt; b -&gt; IO HighwaterMark
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HighwaterMark -&gt; IO HighwaterMark
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-299"></span><span>    </span><span id="local-6989586621681483385"><span class="annot"><span class="annottext">noopClear :: IO ()
</span><a href="#local-6989586621681483385"><span class="hs-identifier hs-var hs-var">noopClear</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-300"></span><span>
</span><span id="line-301"></span><span>
</span><span id="line-302"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-303"></span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#chainwebTransactionConfig"><span class="hs-identifier hs-type">chainwebTransactionConfig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#TransactionConfig"><span class="hs-identifier hs-type">TransactionConfig</span></a></span><span> </span><span class="annot"><a href="Chainweb.Transaction.html#ChainwebTransaction"><span class="hs-identifier hs-type">ChainwebTransaction</span></a></span><span>
</span><span id="line-304"></span><span id="chainwebTransactionConfig"><span class="annot"><span class="annottext">chainwebTransactionConfig :: TransactionConfig ChainwebTransaction
</span><a href="Chainweb.Mempool.Mempool.html#chainwebTransactionConfig"><span class="hs-identifier hs-var hs-var">chainwebTransactionConfig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Codec ChainwebTransaction
-&gt; (ChainwebTransaction -&gt; TransactionHash)
-&gt; HashMeta
-&gt; (ChainwebTransaction -&gt; GasPrice)
-&gt; (ChainwebTransaction -&gt; GasLimit)
-&gt; (ChainwebTransaction -&gt; TransactionMetadata)
-&gt; TransactionConfig ChainwebTransaction
forall t.
Codec t
-&gt; (t -&gt; TransactionHash)
-&gt; HashMeta
-&gt; (t -&gt; GasPrice)
-&gt; (t -&gt; GasLimit)
-&gt; (t -&gt; TransactionMetadata)
-&gt; TransactionConfig t
</span><a href="Chainweb.Mempool.Mempool.html#TransactionConfig"><span class="hs-identifier hs-var">TransactionConfig</span></a></span><span> </span><span class="annot"><span class="annottext">Codec ChainwebTransaction
</span><a href="Chainweb.Transaction.html#chainwebPayloadCodec"><span class="hs-identifier hs-var">chainwebPayloadCodec</span></a></span><span>
</span><span id="line-305"></span><span>    </span><span class="annot"><span class="annottext">ChainwebTransaction -&gt; TransactionHash
forall a. Command a -&gt; TransactionHash
</span><a href="#local-6989586621681483369"><span class="hs-identifier hs-var">commandHash</span></a></span><span>
</span><span id="line-306"></span><span>    </span><span class="annot"><span class="annottext">HashMeta
</span><a href="Chainweb.Mempool.Mempool.html#chainwebTestHashMeta"><span class="hs-identifier hs-var">chainwebTestHashMeta</span></a></span><span>
</span><span id="line-307"></span><span>    </span><span class="annot"><span class="annottext">ChainwebTransaction -&gt; GasPrice
</span><a href="#local-6989586621681483368"><span class="hs-identifier hs-var">getGasPrice</span></a></span><span>
</span><span id="line-308"></span><span>    </span><span class="annot"><span class="annottext">ChainwebTransaction -&gt; GasLimit
</span><a href="#local-6989586621681483367"><span class="hs-identifier hs-var">getGasLimit</span></a></span><span>
</span><span id="line-309"></span><span>    </span><span class="annot"><span class="annottext">ChainwebTransaction -&gt; TransactionMetadata
</span><a href="#local-6989586621681483366"><span class="hs-identifier hs-var">txmeta</span></a></span><span>
</span><span id="line-310"></span><span>
</span><span id="line-311"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-312"></span><span>    </span><span id="local-6989586621681483368"><span class="annot"><span class="annottext">getGasPrice :: ChainwebTransaction -&gt; GasPrice
</span><a href="#local-6989586621681483368"><span class="hs-identifier hs-var hs-var">getGasPrice</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Command (Payload PublicMeta ParsedCode) -&gt; GasPrice
forall c. Command (Payload PublicMeta c) -&gt; GasPrice
</span><a href="Chainweb.Transaction.html#gasPriceOf"><span class="hs-identifier hs-var">gasPriceOf</span></a></span><span> </span><span class="annot"><span class="annottext">(Command (Payload PublicMeta ParsedCode) -&gt; GasPrice)
-&gt; (ChainwebTransaction -&gt; Command (Payload PublicMeta ParsedCode))
-&gt; ChainwebTransaction
-&gt; GasPrice
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(PayloadWithText -&gt; Payload PublicMeta ParsedCode)
-&gt; ChainwebTransaction -&gt; Command (Payload PublicMeta ParsedCode)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">PayloadWithText -&gt; Payload PublicMeta ParsedCode
</span><a href="Chainweb.Transaction.html#payloadObj"><span class="hs-identifier hs-var">payloadObj</span></a></span><span>
</span><span id="line-313"></span><span>    </span><span id="local-6989586621681483367"><span class="annot"><span class="annottext">getGasLimit :: ChainwebTransaction -&gt; GasLimit
</span><a href="#local-6989586621681483367"><span class="hs-identifier hs-var hs-var">getGasLimit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Command (Payload PublicMeta ParsedCode) -&gt; GasLimit
forall c. Command (Payload PublicMeta c) -&gt; GasLimit
</span><a href="Chainweb.Transaction.html#gasLimitOf"><span class="hs-identifier hs-var">gasLimitOf</span></a></span><span> </span><span class="annot"><span class="annottext">(Command (Payload PublicMeta ParsedCode) -&gt; GasLimit)
-&gt; (ChainwebTransaction -&gt; Command (Payload PublicMeta ParsedCode))
-&gt; ChainwebTransaction
-&gt; GasLimit
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(PayloadWithText -&gt; Payload PublicMeta ParsedCode)
-&gt; ChainwebTransaction -&gt; Command (Payload PublicMeta ParsedCode)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">PayloadWithText -&gt; Payload PublicMeta ParsedCode
</span><a href="Chainweb.Transaction.html#payloadObj"><span class="hs-identifier hs-var">payloadObj</span></a></span><span>
</span><span id="line-314"></span><span>    </span><span id="local-6989586621681483361"><span class="annot"><span class="annottext">getTimeToLive :: ChainwebTransaction -&gt; TTLSeconds
</span><a href="#local-6989586621681483361"><span class="hs-identifier hs-var hs-var">getTimeToLive</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Command (Payload PublicMeta ParsedCode) -&gt; TTLSeconds
forall c. Command (Payload PublicMeta c) -&gt; TTLSeconds
</span><a href="Chainweb.Transaction.html#timeToLiveOf"><span class="hs-identifier hs-var">timeToLiveOf</span></a></span><span> </span><span class="annot"><span class="annottext">(Command (Payload PublicMeta ParsedCode) -&gt; TTLSeconds)
-&gt; (ChainwebTransaction -&gt; Command (Payload PublicMeta ParsedCode))
-&gt; ChainwebTransaction
-&gt; TTLSeconds
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(PayloadWithText -&gt; Payload PublicMeta ParsedCode)
-&gt; ChainwebTransaction -&gt; Command (Payload PublicMeta ParsedCode)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">PayloadWithText -&gt; Payload PublicMeta ParsedCode
</span><a href="Chainweb.Transaction.html#payloadObj"><span class="hs-identifier hs-var">payloadObj</span></a></span><span>
</span><span id="line-315"></span><span>    </span><span id="local-6989586621681483359"><span class="annot"><span class="annottext">getCreationTime :: ChainwebTransaction -&gt; TxCreationTime
</span><a href="#local-6989586621681483359"><span class="hs-identifier hs-var hs-var">getCreationTime</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Command (Payload PublicMeta ParsedCode) -&gt; TxCreationTime
forall c. Command (Payload PublicMeta c) -&gt; TxCreationTime
</span><a href="Chainweb.Transaction.html#creationTimeOf"><span class="hs-identifier hs-var">creationTimeOf</span></a></span><span> </span><span class="annot"><span class="annottext">(Command (Payload PublicMeta ParsedCode) -&gt; TxCreationTime)
-&gt; (ChainwebTransaction -&gt; Command (Payload PublicMeta ParsedCode))
-&gt; ChainwebTransaction
-&gt; TxCreationTime
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(PayloadWithText -&gt; Payload PublicMeta ParsedCode)
-&gt; ChainwebTransaction -&gt; Command (Payload PublicMeta ParsedCode)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">PayloadWithText -&gt; Payload PublicMeta ParsedCode
</span><a href="Chainweb.Transaction.html#payloadObj"><span class="hs-identifier hs-var">payloadObj</span></a></span><span>
</span><span id="line-316"></span><span>    </span><span id="local-6989586621681483369"><span class="annot"><span class="annottext">commandHash :: Command a -&gt; TransactionHash
</span><a href="#local-6989586621681483369"><span class="hs-identifier hs-var hs-var">commandHash</span></a></span></span><span> </span><span id="local-6989586621681483357"><span class="annot"><span class="annottext">c :: Command a
</span><a href="#local-6989586621681483357"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">H.Hash</span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621681483355"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621681483355"><span class="hs-identifier hs-var">h</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypedHash 'Blake2b_256 -&gt; Hash
forall (h :: HashAlgo). TypedHash h -&gt; Hash
</span><span class="hs-identifier hs-var">H.toUntypedHash</span></span><span> </span><span class="annot"><span class="annottext">(TypedHash 'Blake2b_256 -&gt; Hash) -&gt; TypedHash 'Blake2b_256 -&gt; Hash
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Command a -&gt; TypedHash 'Blake2b_256
forall a. Command a -&gt; TypedHash 'Blake2b_256
</span><span class="hs-identifier hs-var hs-var">_cmdHash</span></span><span> </span><span class="annot"><span class="annottext">Command a
</span><a href="#local-6989586621681483357"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-317"></span><span>                    </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">ShortByteString -&gt; TransactionHash
</span><a href="Chainweb.Mempool.Mempool.html#TransactionHash"><span class="hs-identifier hs-var">TransactionHash</span></a></span><span> </span><span class="annot"><span class="annottext">(ShortByteString -&gt; TransactionHash)
-&gt; ShortByteString -&gt; TransactionHash
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ShortByteString
</span><span class="hs-identifier hs-var">SB.toShort</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; ShortByteString) -&gt; ByteString -&gt; ShortByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621681483355"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-318"></span><span>    </span><span id="local-6989586621681483366"><span class="annot"><span class="annottext">txmeta :: ChainwebTransaction -&gt; TransactionMetadata
</span><a href="#local-6989586621681483366"><span class="hs-identifier hs-var hs-var">txmeta</span></a></span></span><span> </span><span id="local-6989586621681483350"><span class="annot"><span class="annottext">t :: ChainwebTransaction
</span><a href="#local-6989586621681483350"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-319"></span><span>        </span><span class="annot"><span class="annottext">Time Micros -&gt; Time Micros -&gt; TransactionMetadata
</span><a href="Chainweb.Mempool.Mempool.html#TransactionMetadata"><span class="hs-identifier hs-var">TransactionMetadata</span></a></span><span>
</span><span id="line-320"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ParsedInteger -&gt; Time Micros
</span><a href="#local-6989586621681483349"><span class="hs-identifier hs-var">toMicros</span></a></span><span> </span><span class="annot"><span class="annottext">ParsedInteger
</span><a href="#local-6989586621681483348"><span class="hs-identifier hs-var">ct</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-321"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ParsedInteger -&gt; Time Micros
</span><a href="#local-6989586621681483349"><span class="hs-identifier hs-var">toMicros</span></a></span><span> </span><span class="annot"><span class="annottext">(ParsedInteger -&gt; Time Micros) -&gt; ParsedInteger -&gt; Time Micros
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ParsedInteger
</span><a href="#local-6989586621681483348"><span class="hs-identifier hs-var">ct</span></a></span><span> </span><span class="annot"><span class="annottext">ParsedInteger -&gt; ParsedInteger -&gt; ParsedInteger
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">ParsedInteger -&gt; ParsedInteger -&gt; ParsedInteger
forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">min</span></span><span> </span><span class="annot"><span class="annottext">ParsedInteger
</span><a href="#local-6989586621681483345"><span class="hs-identifier hs-var">maxDuration</span></a></span><span> </span><span class="annot"><span class="annottext">ParsedInteger
</span><a href="#local-6989586621681483344"><span class="hs-identifier hs-var">ttl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-322"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-323"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TxCreationTime</span></span><span> </span><span id="local-6989586621681483348"><span class="annot"><span class="annottext">ct :: ParsedInteger
</span><a href="#local-6989586621681483348"><span class="hs-identifier hs-var">ct</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ChainwebTransaction -&gt; TxCreationTime
</span><a href="#local-6989586621681483359"><span class="hs-identifier hs-var">getCreationTime</span></a></span><span> </span><span class="annot"><span class="annottext">ChainwebTransaction
</span><a href="#local-6989586621681483350"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-324"></span><span>        </span><span id="local-6989586621681483349"><span class="annot"><span class="annottext">toMicros :: ParsedInteger -&gt; Time Micros
</span><a href="#local-6989586621681483349"><span class="hs-identifier hs-var hs-var">toMicros</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TimeSpan Micros -&gt; Time Micros
forall a. TimeSpan a -&gt; Time a
</span><a href="Chainweb.Time.html#Time"><span class="hs-identifier hs-var">Time</span></a></span><span> </span><span class="annot"><span class="annottext">(TimeSpan Micros -&gt; Time Micros)
-&gt; (ParsedInteger -&gt; TimeSpan Micros)
-&gt; ParsedInteger
-&gt; Time Micros
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Micros -&gt; TimeSpan Micros
forall a. a -&gt; TimeSpan a
</span><a href="Chainweb.Time.html#TimeSpan"><span class="hs-identifier hs-var">TimeSpan</span></a></span><span> </span><span class="annot"><span class="annottext">(Micros -&gt; TimeSpan Micros)
-&gt; (ParsedInteger -&gt; Micros) -&gt; ParsedInteger -&gt; TimeSpan Micros
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Int64 -&gt; Micros
</span><a href="Chainweb.Time.html#Micros"><span class="hs-identifier hs-var">Micros</span></a></span><span> </span><span class="annot"><span class="annottext">(Int64 -&gt; Micros)
-&gt; (ParsedInteger -&gt; Int64) -&gt; ParsedInteger -&gt; Micros
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ParsedInteger -&gt; Int64
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">(ParsedInteger -&gt; Int64)
-&gt; (ParsedInteger -&gt; ParsedInteger) -&gt; ParsedInteger -&gt; Int64
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-number">1000000</span></span><span> </span><span class="annot"><span class="annottext">ParsedInteger -&gt; ParsedInteger -&gt; ParsedInteger
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span class="hs-special">)</span><span>
</span><span id="line-325"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TTLSeconds</span></span><span> </span><span id="local-6989586621681483344"><span class="annot"><span class="annottext">ttl :: ParsedInteger
</span><a href="#local-6989586621681483344"><span class="hs-identifier hs-var">ttl</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ChainwebTransaction -&gt; TTLSeconds
</span><a href="#local-6989586621681483361"><span class="hs-identifier hs-var">getTimeToLive</span></a></span><span> </span><span class="annot"><span class="annottext">ChainwebTransaction
</span><a href="#local-6989586621681483350"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-326"></span><span>        </span><span id="local-6989586621681483345"><span class="annot"><span class="annottext">maxDuration :: ParsedInteger
</span><a href="#local-6989586621681483345"><span class="hs-identifier hs-var hs-var">maxDuration</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">ParsedInteger -&gt; ParsedInteger -&gt; ParsedInteger
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="hs-number">24</span></span><span> </span><span class="annot"><span class="annottext">ParsedInteger -&gt; ParsedInteger -&gt; ParsedInteger
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="hs-number">60</span></span><span> </span><span class="annot"><span class="annottext">ParsedInteger -&gt; ParsedInteger -&gt; ParsedInteger
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="hs-number">60</span></span><span> </span><span class="annot"><span class="annottext">ParsedInteger -&gt; ParsedInteger -&gt; ParsedInteger
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span>
</span><span id="line-327"></span><span>
</span><span id="line-328"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-329"></span><span class="hs-keyword">data</span><span> </span><span id="SyncState"><span class="annot"><a href="Chainweb.Mempool.Mempool.html#SyncState"><span class="hs-identifier hs-var">SyncState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="SyncState"><span class="annot"><a href="Chainweb.Mempool.Mempool.html#SyncState"><span class="hs-identifier hs-var">SyncState</span></a></span></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-330"></span><span>    </span><span id="_syncCount"><span class="annot"><span class="annottext">SyncState -&gt; Int64
</span><a href="Chainweb.Mempool.Mempool.html#_syncCount"><span class="hs-identifier hs-var hs-var">_syncCount</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Int64</span></span><span>
</span><span id="line-331"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="_syncMissing"><span class="annot"><span class="annottext">SyncState -&gt; [Vector TransactionHash]
</span><a href="Chainweb.Mempool.Mempool.html#_syncMissing"><span class="hs-identifier hs-var hs-var">_syncMissing</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#TransactionHash"><span class="hs-identifier hs-type">TransactionHash</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-332"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="_syncPresent"><span class="annot"><span class="annottext">SyncState -&gt; HashSet TransactionHash
</span><a href="Chainweb.Mempool.Mempool.html#_syncPresent"><span class="hs-identifier hs-var hs-var">_syncPresent</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HashSet</span></span><span> </span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#TransactionHash"><span class="hs-identifier hs-type">TransactionHash</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-333"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="_syncTooMany"><span class="annot"><span class="annottext">SyncState -&gt; Bool
</span><a href="Chainweb.Mempool.Mempool.html#_syncTooMany"><span class="hs-identifier hs-var hs-var">_syncTooMany</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-334"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-335"></span><span>
</span><span id="line-336"></span><span class="hs-comment">-- | Pulls any missing pending transactions from a remote mempool.</span><span>
</span><span id="line-337"></span><span class="hs-comment">--</span><span>
</span><span id="line-338"></span><span class="hs-comment">-- The initial sync procedure:</span><span>
</span><span id="line-339"></span><span class="hs-comment">--</span><span>
</span><span id="line-340"></span><span class="hs-comment">--    1. get the list of pending transaction hashes from remote,</span><span>
</span><span id="line-341"></span><span class="hs-comment">--    2. lookup any hashes that are missing, and insert them into local,</span><span>
</span><span id="line-342"></span><span class="hs-comment">--    3. push any hashes remote is missing</span><span>
</span><span id="line-343"></span><span class="hs-comment">--</span><span>
</span><span id="line-344"></span><span class="hs-comment">-- After initial sync, will loop subscribing to updates from remote.</span><span>
</span><span id="line-345"></span><span class="hs-comment">--</span><span>
</span><span id="line-346"></span><span class="hs-comment">-- Loops until killed, or until the underlying mempool connection throws an</span><span>
</span><span id="line-347"></span><span class="hs-comment">-- exception.</span><span>
</span><span id="line-348"></span><span class="hs-comment">--</span><span>
</span><span id="line-349"></span><span id="local-6989586621681483653"><span class="annot"><a href="Chainweb.Mempool.Mempool.html#syncMempools%27"><span class="hs-identifier hs-type">syncMempools'</span></a></span><span>
</span><span id="line-350"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621681483653"><span class="hs-identifier hs-type">t</span></a></span><span>
</span><span id="line-351"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.LogMessage.html#LogFunctionText"><span class="hs-identifier hs-type">LogFunctionText</span></a></span><span>
</span><span id="line-352"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-353"></span><span>        </span><span class="hs-comment">-- ^ polling interval in microseconds</span><span>
</span><span id="line-354"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#MempoolBackend"><span class="hs-identifier hs-type">MempoolBackend</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681483653"><span class="hs-identifier hs-type">t</span></a></span><span>
</span><span id="line-355"></span><span>        </span><span class="hs-comment">-- ^ local mempool</span><span>
</span><span id="line-356"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#MempoolBackend"><span class="hs-identifier hs-type">MempoolBackend</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681483653"><span class="hs-identifier hs-type">t</span></a></span><span>
</span><span id="line-357"></span><span>        </span><span class="hs-comment">-- ^ remote mempool</span><span>
</span><span id="line-358"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-359"></span><span id="syncMempools%27"><span class="annot"><span class="annottext">syncMempools' :: LogFunctionText
-&gt; Int -&gt; MempoolBackend t -&gt; MempoolBackend t -&gt; IO ()
</span><a href="Chainweb.Mempool.Mempool.html#syncMempools%27"><span class="hs-identifier hs-var hs-var">syncMempools'</span></a></span></span><span> </span><span id="local-6989586621681483332"><span class="annot"><span class="annottext">log0 :: LogFunctionText
</span><a href="#local-6989586621681483332"><span class="hs-identifier hs-var">log0</span></a></span></span><span> </span><span id="local-6989586621681483331"><span class="annot"><span class="annottext">us :: Int
</span><a href="#local-6989586621681483331"><span class="hs-identifier hs-var">us</span></a></span></span><span> </span><span id="local-6989586621681483330"><span class="annot"><span class="annottext">localMempool :: MempoolBackend t
</span><a href="#local-6989586621681483330"><span class="hs-identifier hs-var">localMempool</span></a></span></span><span> </span><span id="local-6989586621681483329"><span class="annot"><span class="annottext">remoteMempool :: MempoolBackend t
</span><a href="#local-6989586621681483329"><span class="hs-identifier hs-var">remoteMempool</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO ()
forall a. IO a
</span><a href="#local-6989586621681483328"><span class="hs-identifier hs-var">sync</span></a></span><span>
</span><span id="line-360"></span><span>
</span><span id="line-361"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-362"></span><span>    </span><span id="local-6989586621681483327"><span class="annot"><span class="annottext">maxCnt :: Int64
</span><a href="#local-6989586621681483327"><span class="hs-identifier hs-var hs-var">maxCnt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-number">5000</span></span><span>
</span><span id="line-363"></span><span>        </span><span class="hs-comment">-- don't pull more than this many new transactions from a single peer in</span><span>
</span><span id="line-364"></span><span>        </span><span class="hs-comment">-- a session.</span><span>
</span><span id="line-365"></span><span>
</span><span id="line-366"></span><span>    </span><span class="hs-comment">-- This function is called for each chunk of pending hashes in the the remote mempool.</span><span>
</span><span id="line-367"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-368"></span><span>    </span><span class="hs-comment">-- The 'SyncState' collects</span><span>
</span><span id="line-369"></span><span>    </span><span class="hs-comment">-- * the total count of hashes that are missing from the local pool,</span><span>
</span><span id="line-370"></span><span>    </span><span class="hs-comment">-- * chunks of hashes that are missing from the local pool,</span><span>
</span><span id="line-371"></span><span>    </span><span class="hs-comment">-- * the set of hashes that is available locally but missing from the remote pool, and</span><span>
</span><span id="line-372"></span><span>    </span><span class="hs-comment">-- * whether there are @tooMany@ missing hashes.</span><span>
</span><span id="line-373"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-374"></span><span>    </span><span class="hs-comment">-- When we already collected @tooMany@ missing hashes we stop updating the sync state</span><span>
</span><span id="line-375"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-376"></span><span>    </span><span class="hs-comment">-- TODO: would it help if 'mempoolGetPendingTransactions' would provide an option for early</span><span>
</span><span id="line-377"></span><span>    </span><span class="hs-comment">-- termination in case we got @tooMany@ missing hashes?</span><span>
</span><span id="line-378"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-379"></span><span>    </span><span id="local-6989586621681483326"><span class="annot"><span class="annottext">syncChunk :: IORef SyncState -&gt; Vector TransactionHash -&gt; IO ()
</span><a href="#local-6989586621681483326"><span class="hs-identifier hs-var hs-var">syncChunk</span></a></span></span><span> </span><span id="local-6989586621681483325"><span class="annot"><span class="annottext">syncState :: IORef SyncState
</span><a href="#local-6989586621681483325"><span class="hs-identifier hs-var">syncState</span></a></span></span><span> </span><span id="local-6989586621681483324"><span class="annot"><span class="annottext">hashes :: Vector TransactionHash
</span><a href="#local-6989586621681483324"><span class="hs-identifier hs-var">hashes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-380"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#SyncState"><span class="hs-identifier hs-type">SyncState</span></a></span><span> </span><span id="local-6989586621681483323"><span class="annot"><span class="annottext">cnt :: Int64
</span><a href="#local-6989586621681483323"><span class="hs-identifier hs-var">cnt</span></a></span></span><span> </span><span id="local-6989586621681483322"><span class="annot"><span class="annottext">chunks :: [Vector TransactionHash]
</span><a href="#local-6989586621681483322"><span class="hs-identifier hs-var">chunks</span></a></span></span><span> </span><span id="local-6989586621681483321"><span class="annot"><span class="annottext">remoteHashes :: HashSet TransactionHash
</span><a href="#local-6989586621681483321"><span class="hs-identifier hs-var">remoteHashes</span></a></span></span><span> </span><span id="local-6989586621681483320"><span class="annot"><span class="annottext">tooMany :: Bool
</span><a href="#local-6989586621681483320"><span class="hs-identifier hs-var">tooMany</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IORef SyncState -&gt; IO SyncState
forall a. IORef a -&gt; IO a
</span><span class="hs-identifier hs-var">readIORef</span></span><span> </span><span class="annot"><span class="annottext">IORef SyncState
</span><a href="#local-6989586621681483325"><span class="hs-identifier hs-var">syncState</span></a></span><span>
</span><span id="line-381"></span><span>
</span><span id="line-382"></span><span>        </span><span class="hs-comment">-- If there are too many missing hashes we stop collecting</span><span>
</span><span id="line-383"></span><span>        </span><span class="hs-comment">--</span><span>
</span><span id="line-384"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; IO () -&gt; IO ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681483320"><span class="hs-identifier hs-var">tooMany</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-385"></span><span>
</span><span id="line-386"></span><span>            </span><span class="hs-comment">-- Collect remote hashes that are missing from the local pool</span><span>
</span><span id="line-387"></span><span>            </span><span id="local-6989586621681483317"><span class="annot"><span class="annottext">Vector (Bool, TransactionHash)
</span><a href="#local-6989586621681483317"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Vector Bool
-&gt; Vector TransactionHash -&gt; Vector (Bool, TransactionHash)
forall a b. Vector a -&gt; Vector b -&gt; Vector (a, b)
</span><span class="hs-operator hs-var">`V.zip`</span></span><span> </span><span class="annot"><span class="annottext">Vector TransactionHash
</span><a href="#local-6989586621681483324"><span class="hs-identifier hs-var">hashes</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Vector Bool -&gt; Vector (Bool, TransactionHash))
-&gt; IO (Vector Bool) -&gt; IO (Vector (Bool, TransactionHash))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">MempoolBackend t -&gt; Vector TransactionHash -&gt; IO (Vector Bool)
forall t.
MempoolBackend t -&gt; Vector TransactionHash -&gt; IO (Vector Bool)
</span><a href="Chainweb.Mempool.Mempool.html#mempoolMember"><span class="hs-identifier hs-var hs-var">mempoolMember</span></a></span><span> </span><span class="annot"><span class="annottext">MempoolBackend t
</span><a href="#local-6989586621681483330"><span class="hs-identifier hs-var">localMempool</span></a></span><span> </span><span class="annot"><span class="annottext">Vector TransactionHash
</span><a href="#local-6989586621681483324"><span class="hs-identifier hs-var">hashes</span></a></span><span>
</span><span id="line-388"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621681483315"><span class="annot"><span class="annottext">newMissing :: Vector TransactionHash
</span><a href="#local-6989586621681483315"><span class="hs-identifier hs-var hs-var">newMissing</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Bool, TransactionHash) -&gt; TransactionHash)
-&gt; Vector (Bool, TransactionHash) -&gt; Vector TransactionHash
forall a b. (a -&gt; b) -&gt; Vector a -&gt; Vector b
</span><span class="hs-identifier hs-var">V.map</span></span><span> </span><span class="annot"><span class="annottext">(Bool, TransactionHash) -&gt; TransactionHash
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">(Vector (Bool, TransactionHash) -&gt; Vector TransactionHash)
-&gt; Vector (Bool, TransactionHash) -&gt; Vector TransactionHash
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((Bool, TransactionHash) -&gt; Bool)
-&gt; Vector (Bool, TransactionHash) -&gt; Vector (Bool, TransactionHash)
forall a. (a -&gt; Bool) -&gt; Vector a -&gt; Vector a
</span><span class="hs-identifier hs-var">V.filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool)
-&gt; ((Bool, TransactionHash) -&gt; Bool)
-&gt; (Bool, TransactionHash)
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Bool, TransactionHash) -&gt; Bool
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Vector (Bool, TransactionHash)
</span><a href="#local-6989586621681483317"><span class="hs-identifier hs-var">res</span></a></span><span>
</span><span id="line-389"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621681483312"><span class="annot"><span class="annottext">newMissingCnt :: Int
</span><a href="#local-6989586621681483312"><span class="hs-identifier hs-var hs-var">newMissingCnt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector TransactionHash -&gt; Int
forall a. Vector a -&gt; Int
</span><span class="hs-identifier hs-var">V.length</span></span><span> </span><span class="annot"><span class="annottext">Vector TransactionHash
</span><a href="#local-6989586621681483315"><span class="hs-identifier hs-var">newMissing</span></a></span><span>
</span><span id="line-390"></span><span>
</span><span id="line-391"></span><span>            </span><span class="hs-comment">-- Collect set of all remote hashes</span><span>
</span><span id="line-392"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621681483311"><span class="annot"><span class="annottext">remoteHashes' :: HashSet TransactionHash
</span><a href="#local-6989586621681483311"><span class="hs-identifier hs-var hs-var">remoteHashes'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(HashSet TransactionHash
 -&gt; TransactionHash -&gt; HashSet TransactionHash)
-&gt; HashSet TransactionHash
-&gt; Vector TransactionHash
-&gt; HashSet TransactionHash
forall a b. (a -&gt; b -&gt; a) -&gt; a -&gt; Vector b -&gt; a
</span><span class="hs-identifier hs-var">V.foldl'</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TransactionHash
 -&gt; HashSet TransactionHash -&gt; HashSet TransactionHash)
-&gt; HashSet TransactionHash
-&gt; TransactionHash
-&gt; HashSet TransactionHash
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">TransactionHash
-&gt; HashSet TransactionHash -&gt; HashSet TransactionHash
forall a. (Eq a, Hashable a) =&gt; a -&gt; HashSet a -&gt; HashSet a
</span><span class="hs-identifier hs-var">HashSet.insert</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HashSet TransactionHash
</span><a href="#local-6989586621681483321"><span class="hs-identifier hs-var">remoteHashes</span></a></span><span> </span><span class="annot"><span class="annottext">Vector TransactionHash
</span><a href="#local-6989586621681483324"><span class="hs-identifier hs-var">hashes</span></a></span><span>
</span><span id="line-393"></span><span>
</span><span id="line-394"></span><span>            </span><span class="hs-comment">-- Count number of missing hashes and decide if there @tooMany@</span><span>
</span><span id="line-395"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621681483307"><span class="annot"><span class="annottext">newCnt :: Int64
</span><a href="#local-6989586621681483307"><span class="hs-identifier hs-var hs-var">newCnt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621681483323"><span class="hs-identifier hs-var">cnt</span></a></span><span> </span><span class="annot"><span class="annottext">Int64 -&gt; Int64 -&gt; Int64
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int64
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681483312"><span class="hs-identifier hs-var">newMissingCnt</span></a></span><span>
</span><span id="line-396"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621681483306"><span class="annot"><span class="annottext">tooMany' :: Bool
</span><a href="#local-6989586621681483306"><span class="hs-identifier hs-var hs-var">tooMany'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621681483307"><span class="hs-identifier hs-var">newCnt</span></a></span><span> </span><span class="annot"><span class="annottext">Int64 -&gt; Int64 -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621681483327"><span class="hs-identifier hs-var">maxCnt</span></a></span><span>
</span><span id="line-397"></span><span>
</span><span id="line-398"></span><span>            </span><span class="hs-comment">-- Update the SyncState</span><span>
</span><span id="line-399"></span><span>            </span><span class="annot"><span class="annottext">IORef SyncState -&gt; SyncState -&gt; IO ()
forall a. IORef a -&gt; a -&gt; IO ()
</span><span class="hs-identifier hs-var">writeIORef</span></span><span> </span><span class="annot"><span class="annottext">IORef SyncState
</span><a href="#local-6989586621681483325"><span class="hs-identifier hs-var">syncState</span></a></span><span> </span><span class="annot"><span class="annottext">(SyncState -&gt; IO ()) -&gt; SyncState -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span>
</span><span id="line-400"></span><span>                </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681483306"><span class="hs-identifier hs-var">tooMany'</span></a></span><span>
</span><span id="line-401"></span><span>                    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Int64
-&gt; [Vector TransactionHash]
-&gt; HashSet TransactionHash
-&gt; Bool
-&gt; SyncState
</span><a href="Chainweb.Mempool.Mempool.html#SyncState"><span class="hs-identifier hs-var">SyncState</span></a></span><span> </span><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621681483323"><span class="hs-identifier hs-var">cnt</span></a></span><span> </span><span class="annot"><span class="annottext">[Vector TransactionHash]
</span><a href="#local-6989586621681483322"><span class="hs-identifier hs-var">chunks</span></a></span><span> </span><span class="annot"><span class="annottext">HashSet TransactionHash
</span><a href="#local-6989586621681483321"><span class="hs-identifier hs-var">remoteHashes</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-402"></span><span>                    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Int64
-&gt; [Vector TransactionHash]
-&gt; HashSet TransactionHash
-&gt; Bool
-&gt; SyncState
</span><a href="Chainweb.Mempool.Mempool.html#SyncState"><span class="hs-identifier hs-var">SyncState</span></a></span><span> </span><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621681483307"><span class="hs-identifier hs-var">newCnt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Vector TransactionHash
</span><a href="#local-6989586621681483315"><span class="hs-identifier hs-var">newMissing</span></a></span><span> </span><span class="annot"><span class="annottext">Vector TransactionHash
-&gt; [Vector TransactionHash] -&gt; [Vector TransactionHash]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Vector TransactionHash]
</span><a href="#local-6989586621681483322"><span class="hs-identifier hs-var">chunks</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HashSet TransactionHash
</span><a href="#local-6989586621681483311"><span class="hs-identifier hs-var">remoteHashes'</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-403"></span><span>
</span><span id="line-404"></span><span>    </span><span id="local-6989586621681483304"><span class="annot"><span class="annottext">fromPending :: LookupResult p -&gt; p
</span><a href="#local-6989586621681483304"><span class="hs-identifier hs-var hs-var">fromPending</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#Pending"><span class="hs-identifier hs-type">Pending</span></a></span><span> </span><span id="local-6989586621681483303"><span class="annot"><span class="annottext">t :: p
</span><a href="#local-6989586621681483303"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">p
</span><a href="#local-6989586621681483303"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-405"></span><span>    </span><span class="annot"><a href="#local-6989586621681483304"><span class="hs-identifier hs-var">fromPending</span></a></span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; p
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="hs-string">&quot;impossible&quot;</span></span><span>
</span><span id="line-406"></span><span>
</span><span id="line-407"></span><span>    </span><span id="local-6989586621681483301"><span class="annot"><span class="annottext">isPending :: LookupResult t -&gt; Bool
</span><a href="#local-6989586621681483301"><span class="hs-identifier hs-var hs-var">isPending</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#Pending"><span class="hs-identifier hs-type">Pending</span></a></span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-408"></span><span>    </span><span class="annot"><a href="#local-6989586621681483301"><span class="hs-identifier hs-var">isPending</span></a></span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-409"></span><span>
</span><span id="line-410"></span><span>    </span><span id="local-6989586621681483300"><span class="annot"><span class="annottext">fetchMissing :: Vector TransactionHash -&gt; IO ()
</span><a href="#local-6989586621681483300"><span class="hs-identifier hs-var hs-var">fetchMissing</span></a></span></span><span> </span><span id="local-6989586621681483299"><span class="annot"><span class="annottext">chunk :: Vector TransactionHash
</span><a href="#local-6989586621681483299"><span class="hs-identifier hs-var">chunk</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-411"></span><span>        </span><span id="local-6989586621681483298"><span class="annot"><span class="annottext">Vector (LookupResult t)
</span><a href="#local-6989586621681483298"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MempoolBackend t
-&gt; Vector TransactionHash -&gt; IO (Vector (LookupResult t))
forall t.
MempoolBackend t
-&gt; Vector TransactionHash -&gt; IO (Vector (LookupResult t))
</span><a href="Chainweb.Mempool.Mempool.html#mempoolLookup"><span class="hs-identifier hs-var hs-var">mempoolLookup</span></a></span><span> </span><span class="annot"><span class="annottext">MempoolBackend t
</span><a href="#local-6989586621681483329"><span class="hs-identifier hs-var">remoteMempool</span></a></span><span> </span><span class="annot"><span class="annottext">Vector TransactionHash
</span><a href="#local-6989586621681483299"><span class="hs-identifier hs-var">chunk</span></a></span><span>
</span><span id="line-412"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621681483297"><span class="annot"><span class="annottext">newTxs :: Vector t
</span><a href="#local-6989586621681483297"><span class="hs-identifier hs-var hs-var">newTxs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(LookupResult t -&gt; t) -&gt; Vector (LookupResult t) -&gt; Vector t
forall a b. (a -&gt; b) -&gt; Vector a -&gt; Vector b
</span><span class="hs-identifier hs-var">V.map</span></span><span> </span><span class="annot"><span class="annottext">LookupResult t -&gt; t
forall p. LookupResult p -&gt; p
</span><a href="#local-6989586621681483304"><span class="hs-identifier hs-var">fromPending</span></a></span><span> </span><span class="annot"><span class="annottext">(Vector (LookupResult t) -&gt; Vector t)
-&gt; Vector (LookupResult t) -&gt; Vector t
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(LookupResult t -&gt; Bool)
-&gt; Vector (LookupResult t) -&gt; Vector (LookupResult t)
forall a. (a -&gt; Bool) -&gt; Vector a -&gt; Vector a
</span><span class="hs-identifier hs-var">V.filter</span></span><span> </span><span class="annot"><span class="annottext">LookupResult t -&gt; Bool
forall a. LookupResult a -&gt; Bool
</span><a href="#local-6989586621681483301"><span class="hs-identifier hs-var">isPending</span></a></span><span> </span><span class="annot"><span class="annottext">Vector (LookupResult t)
</span><a href="#local-6989586621681483298"><span class="hs-identifier hs-var">res</span></a></span><span>
</span><span id="line-413"></span><span>        </span><span class="annot"><span class="annottext">MempoolBackend t -&gt; InsertType -&gt; Vector t -&gt; IO ()
forall t. MempoolBackend t -&gt; InsertType -&gt; Vector t -&gt; IO ()
</span><a href="Chainweb.Mempool.Mempool.html#mempoolInsert"><span class="hs-identifier hs-var hs-var">mempoolInsert</span></a></span><span> </span><span class="annot"><span class="annottext">MempoolBackend t
</span><a href="#local-6989586621681483330"><span class="hs-identifier hs-var">localMempool</span></a></span><span> </span><span class="annot"><span class="annottext">InsertType
</span><a href="Chainweb.Mempool.Mempool.html#CheckedInsert"><span class="hs-identifier hs-var">CheckedInsert</span></a></span><span> </span><span class="annot"><span class="annottext">Vector t
</span><a href="#local-6989586621681483297"><span class="hs-identifier hs-var">newTxs</span></a></span><span>
</span><span id="line-414"></span><span>
</span><span id="line-415"></span><span>    </span><span class="annot"><a href="#local-6989586621681483296"><span class="hs-identifier hs-type">deb</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-416"></span><span>    </span><span id="local-6989586621681483296"><span class="annot"><span class="annottext">deb :: Text -&gt; IO ()
</span><a href="#local-6989586621681483296"><span class="hs-identifier hs-var hs-var">deb</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LogFunctionText
</span><a href="#local-6989586621681483332"><span class="hs-identifier hs-var">log0</span></a></span><span> </span><span class="annot"><span class="annottext">LogLevel
</span><span class="hs-identifier hs-var">Debug</span></span><span>
</span><span id="line-417"></span><span>
</span><span id="line-418"></span><span>    </span><span id="local-6989586621681483328"><span class="annot"><span class="annottext">sync :: IO a
</span><a href="#local-6989586621681483328"><span class="hs-identifier hs-var hs-var">sync</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO a -&gt; IO () -&gt; IO a
forall a b. IO a -&gt; IO b -&gt; IO a
</span><span class="hs-identifier hs-var">finally</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO HighwaterMark
</span><a href="#local-6989586621681483293"><span class="hs-identifier hs-var">initialSync</span></a></span><span> </span><span class="annot"><span class="annottext">IO HighwaterMark -&gt; (HighwaterMark -&gt; IO a) -&gt; IO a
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">HighwaterMark -&gt; IO a
forall b. HighwaterMark -&gt; IO b
</span><a href="#local-6989586621681483292"><span class="hs-identifier hs-var">subsequentSync</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; IO ()
</span><a href="#local-6989586621681483296"><span class="hs-identifier hs-var">deb</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;sync exiting&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-419"></span><span>
</span><span id="line-420"></span><span>    </span><span id="local-6989586621681483293"><span class="annot"><span class="annottext">initialSync :: IO HighwaterMark
</span><a href="#local-6989586621681483293"><span class="hs-identifier hs-var hs-var">initialSync</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-421"></span><span>        </span><span class="annot"><span class="annottext">Text -&gt; IO ()
</span><a href="#local-6989586621681483296"><span class="hs-identifier hs-var">deb</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Get full list of pending hashes from remote&quot;</span></span><span>
</span><span id="line-422"></span><span>
</span><span id="line-423"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621681483291"><span class="annot"><span class="annottext">numMissingFromLocal :: Int64
</span><a href="#local-6989586621681483291"><span class="hs-identifier hs-var">numMissingFromLocal</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681483290"><span class="annot"><span class="annottext">missingChunks :: [Vector TransactionHash]
</span><a href="#local-6989586621681483290"><span class="hs-identifier hs-var">missingChunks</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681483289"><span class="annot"><span class="annottext">remoteHashes :: HashSet TransactionHash
</span><a href="#local-6989586621681483289"><span class="hs-identifier hs-var">remoteHashes</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681483288"><span class="annot"><span class="annottext">remoteHw :: HighwaterMark
</span><a href="#local-6989586621681483288"><span class="hs-identifier hs-var">remoteHw</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-424"></span><span>            </span><span class="annot"><span class="annottext">Maybe HighwaterMark
-&gt; IO
     (Int64, [Vector TransactionHash], HashSet TransactionHash,
      HighwaterMark)
</span><a href="#local-6989586621681483287"><span class="hs-identifier hs-var">fetchSince</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe HighwaterMark
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-425"></span><span>
</span><span id="line-426"></span><span>        </span><span class="annot"><span class="annottext">Text -&gt; IO ()
</span><a href="#local-6989586621681483296"><span class="hs-identifier hs-var">deb</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; IO ()) -&gt; Text -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
</span><span class="hs-identifier hs-var">T.concat</span></span><span>
</span><span id="line-427"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Text
forall a b. (Show a, IsString b) =&gt; a -&gt; b
</span><a href="Chainweb.Utils.html#sshow"><span class="hs-identifier hs-var">sshow</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashSet TransactionHash -&gt; Int
forall a. HashSet a -&gt; Int
</span><span class="hs-identifier hs-var">HashSet.size</span></span><span> </span><span class="annot"><span class="annottext">HashSet TransactionHash
</span><a href="#local-6989586621681483289"><span class="hs-identifier hs-var">remoteHashes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-428"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot; hashes at remote (&quot;</span></span><span>
</span><span id="line-429"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int64 -&gt; Text
forall a b. (Show a, IsString b) =&gt; a -&gt; b
</span><a href="Chainweb.Utils.html#sshow"><span class="hs-identifier hs-var">sshow</span></a></span><span> </span><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621681483291"><span class="hs-identifier hs-var">numMissingFromLocal</span></a></span><span>
</span><span id="line-430"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot; need to be fetched)&quot;</span></span><span>
</span><span id="line-431"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-432"></span><span>
</span><span id="line-433"></span><span>        </span><span class="hs-comment">-- todo: should we do subsequent sync of pushed txs also?</span><span>
</span><span id="line-434"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621681483283"><span class="annot"><span class="annottext">numPushed :: Int
</span><a href="#local-6989586621681483283"><span class="hs-identifier hs-var">numPushed</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-435"></span><span>            </span><span class="hs-comment">-- Go fetch missing transactions from remote</span><span>
</span><span id="line-436"></span><span>            </span><span class="annot"><span class="annottext">(Vector TransactionHash -&gt; IO ())
-&gt; [Vector TransactionHash] -&gt; IO ()
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f ()
</span><span class="hs-identifier hs-var">traverse_</span></span><span> </span><span class="annot"><span class="annottext">Vector TransactionHash -&gt; IO ()
</span><a href="#local-6989586621681483300"><span class="hs-identifier hs-var">fetchMissing</span></a></span><span> </span><span class="annot"><span class="annottext">[Vector TransactionHash]
</span><a href="#local-6989586621681483290"><span class="hs-identifier hs-var">missingChunks</span></a></span><span>
</span><span id="line-437"></span><span>
</span><span id="line-438"></span><span>            </span><span class="hs-comment">-- Push our missing txs to remote.</span><span>
</span><span id="line-439"></span><span>            </span><span class="annot"><span class="annottext">HashSet TransactionHash -&gt; IO (Int, HighwaterMark)
</span><a href="#local-6989586621681483282"><span class="hs-identifier hs-var">push</span></a></span><span> </span><span class="annot"><span class="annottext">HashSet TransactionHash
</span><a href="#local-6989586621681483289"><span class="hs-identifier hs-var">remoteHashes</span></a></span><span>
</span><span id="line-440"></span><span>
</span><span id="line-441"></span><span>        </span><span class="annot"><span class="annottext">Text -&gt; IO ()
</span><a href="#local-6989586621681483296"><span class="hs-identifier hs-var">deb</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; IO ()) -&gt; Text -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;pushed &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Text
forall a b. (Show a, IsString b) =&gt; a -&gt; b
</span><a href="Chainweb.Utils.html#sshow"><span class="hs-identifier hs-var">sshow</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681483283"><span class="hs-identifier hs-var">numPushed</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="hs-string">&quot; new transactions to remote.&quot;</span></span><span>
</span><span id="line-442"></span><span>        </span><span class="annot"><span class="annottext">HighwaterMark -&gt; IO HighwaterMark
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">HighwaterMark
</span><a href="#local-6989586621681483288"><span class="hs-identifier hs-var">remoteHw</span></a></span><span>
</span><span id="line-443"></span><span>
</span><span id="line-444"></span><span>    </span><span id="local-6989586621681483292"><span class="annot"><span class="annottext">subsequentSync :: HighwaterMark -&gt; IO b
</span><a href="#local-6989586621681483292"><span class="hs-identifier hs-var hs-var">subsequentSync</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621681483281"><span class="annot"><span class="annottext">HighwaterMark
</span><a href="#local-6989586621681483281"><span class="hs-identifier hs-var">remoteHw</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-445"></span><span>        </span><span class="annot"><span class="annottext">Text -&gt; IO ()
</span><a href="#local-6989586621681483296"><span class="hs-identifier hs-var">deb</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Get new pending hashes from remote&quot;</span></span><span>
</span><span id="line-446"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621681483280"><span class="annot"><span class="annottext">numMissingFromLocal :: Int64
</span><a href="#local-6989586621681483280"><span class="hs-identifier hs-var">numMissingFromLocal</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681483279"><span class="annot"><span class="annottext">missingChunks :: [Vector TransactionHash]
</span><a href="#local-6989586621681483279"><span class="hs-identifier hs-var">missingChunks</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span id="local-6989586621681483278"><span class="annot"><span class="annottext">remoteHw' :: HighwaterMark
</span><a href="#local-6989586621681483278"><span class="hs-identifier hs-var">remoteHw'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-447"></span><span>            </span><span class="annot"><span class="annottext">Maybe HighwaterMark
-&gt; IO
     (Int64, [Vector TransactionHash], HashSet TransactionHash,
      HighwaterMark)
</span><a href="#local-6989586621681483287"><span class="hs-identifier hs-var">fetchSince</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe HighwaterMark
 -&gt; IO
      (Int64, [Vector TransactionHash], HashSet TransactionHash,
       HighwaterMark))
-&gt; Maybe HighwaterMark
-&gt; IO
     (Int64, [Vector TransactionHash], HashSet TransactionHash,
      HighwaterMark)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">HighwaterMark -&gt; Maybe HighwaterMark
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">HighwaterMark
</span><a href="#local-6989586621681483281"><span class="hs-identifier hs-var">remoteHw</span></a></span><span>
</span><span id="line-448"></span><span>        </span><span class="annot"><span class="annottext">Text -&gt; IO ()
</span><a href="#local-6989586621681483296"><span class="hs-identifier hs-var">deb</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; IO ()) -&gt; Text -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
</span><span class="hs-identifier hs-var">T.concat</span></span><span>
</span><span id="line-449"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;sync: &quot;</span></span><span>
</span><span id="line-450"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int64 -&gt; Text
forall a b. (Show a, IsString b) =&gt; a -&gt; b
</span><a href="Chainweb.Utils.html#sshow"><span class="hs-identifier hs-var">sshow</span></a></span><span> </span><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621681483280"><span class="hs-identifier hs-var">numMissingFromLocal</span></a></span><span>
</span><span id="line-451"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot; new remote hashes need to be fetched&quot;</span></span><span>
</span><span id="line-452"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-453"></span><span>        </span><span class="annot"><span class="annottext">(Vector TransactionHash -&gt; IO ())
-&gt; [Vector TransactionHash] -&gt; IO ()
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f ()
</span><span class="hs-identifier hs-var">traverse_</span></span><span> </span><span class="annot"><span class="annottext">Vector TransactionHash -&gt; IO ()
</span><a href="#local-6989586621681483300"><span class="hs-identifier hs-var">fetchMissing</span></a></span><span> </span><span class="annot"><span class="annottext">[Vector TransactionHash]
</span><a href="#local-6989586621681483279"><span class="hs-identifier hs-var">missingChunks</span></a></span><span>
</span><span id="line-454"></span><span>        </span><span class="annot"><span class="annottext">Int -&gt; IO ()
</span><a href="Chainweb.Utils.html#approximateThreadDelay"><span class="hs-identifier hs-var">approximateThreadDelay</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681483331"><span class="hs-identifier hs-var">us</span></a></span><span>
</span><span id="line-455"></span><span>        </span><span class="annot"><span class="annottext">HighwaterMark -&gt; IO b
</span><a href="#local-6989586621681483292"><span class="hs-identifier hs-var">subsequentSync</span></a></span><span> </span><span class="annot"><span class="annottext">HighwaterMark
</span><a href="#local-6989586621681483278"><span class="hs-identifier hs-var">remoteHw'</span></a></span><span>
</span><span id="line-456"></span><span>
</span><span id="line-457"></span><span>    </span><span class="hs-comment">-- get pending hashes from remote since the given (optional) high water mark</span><span>
</span><span id="line-458"></span><span>    </span><span id="local-6989586621681483287"><span class="annot"><span class="annottext">fetchSince :: Maybe HighwaterMark
-&gt; IO
     (Int64, [Vector TransactionHash], HashSet TransactionHash,
      HighwaterMark)
</span><a href="#local-6989586621681483287"><span class="hs-identifier hs-var hs-var">fetchSince</span></a></span></span><span> </span><span id="local-6989586621681483276"><span class="annot"><span class="annottext">oldRemoteHw :: Maybe HighwaterMark
</span><a href="#local-6989586621681483276"><span class="hs-identifier hs-var">oldRemoteHw</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-459"></span><span>        </span><span class="hs-comment">-- Intialize and collect SyncState</span><span>
</span><span id="line-460"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681483275"><span class="annot"><span class="annottext">emptySyncState :: SyncState
</span><a href="#local-6989586621681483275"><span class="hs-identifier hs-var hs-var">emptySyncState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int64
-&gt; [Vector TransactionHash]
-&gt; HashSet TransactionHash
-&gt; Bool
-&gt; SyncState
</span><a href="Chainweb.Mempool.Mempool.html#SyncState"><span class="hs-identifier hs-var">SyncState</span></a></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">HashSet TransactionHash
forall a. HashSet a
</span><span class="hs-identifier hs-var">HashSet.empty</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-461"></span><span>        </span><span id="local-6989586621681483273"><span class="annot"><span class="annottext">IORef SyncState
</span><a href="#local-6989586621681483273"><span class="hs-identifier hs-var">syncState</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SyncState -&gt; IO (IORef SyncState)
forall a. a -&gt; IO (IORef a)
</span><span class="hs-identifier hs-var">newIORef</span></span><span> </span><span class="annot"><span class="annottext">SyncState
</span><a href="#local-6989586621681483275"><span class="hs-identifier hs-var">emptySyncState</span></a></span><span>
</span><span id="line-462"></span><span>        </span><span id="local-6989586621681483271"><span class="annot"><span class="annottext">HighwaterMark
</span><a href="#local-6989586621681483271"><span class="hs-identifier hs-var">remoteHw</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MempoolBackend t
-&gt; Maybe HighwaterMark
-&gt; (Vector TransactionHash -&gt; IO ())
-&gt; IO HighwaterMark
forall t.
MempoolBackend t
-&gt; Maybe HighwaterMark
-&gt; (Vector TransactionHash -&gt; IO ())
-&gt; IO HighwaterMark
</span><a href="Chainweb.Mempool.Mempool.html#mempoolGetPendingTransactions"><span class="hs-identifier hs-var hs-var">mempoolGetPendingTransactions</span></a></span><span> </span><span class="annot"><span class="annottext">MempoolBackend t
</span><a href="#local-6989586621681483329"><span class="hs-identifier hs-var">remoteMempool</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe HighwaterMark
</span><a href="#local-6989586621681483276"><span class="hs-identifier hs-var">oldRemoteHw</span></a></span><span> </span><span class="annot"><span class="annottext">((Vector TransactionHash -&gt; IO ()) -&gt; IO HighwaterMark)
-&gt; (Vector TransactionHash -&gt; IO ()) -&gt; IO HighwaterMark
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IORef SyncState -&gt; Vector TransactionHash -&gt; IO ()
</span><a href="#local-6989586621681483326"><span class="hs-identifier hs-var">syncChunk</span></a></span><span> </span><span class="annot"><span class="annottext">IORef SyncState
</span><a href="#local-6989586621681483273"><span class="hs-identifier hs-var">syncState</span></a></span><span>
</span><span id="line-463"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#SyncState"><span class="hs-identifier hs-type">SyncState</span></a></span><span> </span><span id="local-6989586621681483270"><span class="annot"><span class="annottext">numMissingFromLocal :: Int64
</span><a href="#local-6989586621681483270"><span class="hs-identifier hs-var">numMissingFromLocal</span></a></span></span><span> </span><span id="local-6989586621681483269"><span class="annot"><span class="annottext">missingChunks :: [Vector TransactionHash]
</span><a href="#local-6989586621681483269"><span class="hs-identifier hs-var">missingChunks</span></a></span></span><span> </span><span id="local-6989586621681483268"><span class="annot"><span class="annottext">remoteHashes :: HashSet TransactionHash
</span><a href="#local-6989586621681483268"><span class="hs-identifier hs-var">remoteHashes</span></a></span></span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IORef SyncState -&gt; IO SyncState
forall a. IORef a -&gt; IO a
</span><span class="hs-identifier hs-var">readIORef</span></span><span> </span><span class="annot"><span class="annottext">IORef SyncState
</span><a href="#local-6989586621681483273"><span class="hs-identifier hs-var">syncState</span></a></span><span>
</span><span id="line-464"></span><span>        </span><span class="hs-comment">-- immediately destroy ioref contents to assist GC</span><span>
</span><span id="line-465"></span><span>        </span><span class="annot"><span class="annottext">IORef SyncState -&gt; SyncState -&gt; IO ()
forall a. IORef a -&gt; a -&gt; IO ()
</span><span class="hs-identifier hs-var">writeIORef</span></span><span> </span><span class="annot"><span class="annottext">IORef SyncState
</span><a href="#local-6989586621681483273"><span class="hs-identifier hs-var">syncState</span></a></span><span> </span><span class="annot"><span class="annottext">SyncState
</span><a href="#local-6989586621681483275"><span class="hs-identifier hs-var">emptySyncState</span></a></span><span>
</span><span id="line-466"></span><span>        </span><span class="annot"><span class="annottext">(Int64, [Vector TransactionHash], HashSet TransactionHash,
 HighwaterMark)
-&gt; IO
     (Int64, [Vector TransactionHash], HashSet TransactionHash,
      HighwaterMark)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621681483270"><span class="hs-identifier hs-var">numMissingFromLocal</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Vector TransactionHash]
</span><a href="#local-6989586621681483269"><span class="hs-identifier hs-var">missingChunks</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HashSet TransactionHash
</span><a href="#local-6989586621681483268"><span class="hs-identifier hs-var">remoteHashes</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HighwaterMark
</span><a href="#local-6989586621681483271"><span class="hs-identifier hs-var">remoteHw</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-467"></span><span>
</span><span id="line-468"></span><span>    </span><span class="hs-comment">-- Push transactions that are available locally but are missing from the</span><span>
</span><span id="line-469"></span><span>    </span><span class="hs-comment">-- remote pool to the remote pool.</span><span>
</span><span id="line-470"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-471"></span><span>    </span><span id="local-6989586621681483282"><span class="annot"><span class="annottext">push :: HashSet TransactionHash -&gt; IO (Int, HighwaterMark)
</span><a href="#local-6989586621681483282"><span class="hs-identifier hs-var hs-var">push</span></a></span></span><span> </span><span id="local-6989586621681483267"><span class="annot"><span class="annottext">remoteHashes :: HashSet TransactionHash
</span><a href="#local-6989586621681483267"><span class="hs-identifier hs-var">remoteHashes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-472"></span><span>        </span><span id="local-6989586621681483266"><span class="annot"><span class="annottext">IORef Int
</span><a href="#local-6989586621681483266"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; IO (IORef Int)
forall a. a -&gt; IO (IORef a)
</span><span class="hs-identifier hs-var">newIORef</span></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span>
</span><span id="line-473"></span><span>        </span><span id="local-6989586621681483265"><span class="annot"><span class="annottext">HighwaterMark
</span><a href="#local-6989586621681483265"><span class="hs-identifier hs-var">ourHw</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MempoolBackend t
-&gt; Maybe HighwaterMark
-&gt; (Vector TransactionHash -&gt; IO ())
-&gt; IO HighwaterMark
forall t.
MempoolBackend t
-&gt; Maybe HighwaterMark
-&gt; (Vector TransactionHash -&gt; IO ())
-&gt; IO HighwaterMark
</span><a href="Chainweb.Mempool.Mempool.html#mempoolGetPendingTransactions"><span class="hs-identifier hs-var hs-var">mempoolGetPendingTransactions</span></a></span><span> </span><span class="annot"><span class="annottext">MempoolBackend t
</span><a href="#local-6989586621681483330"><span class="hs-identifier hs-var">localMempool</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe HighwaterMark
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">((Vector TransactionHash -&gt; IO ()) -&gt; IO HighwaterMark)
-&gt; (Vector TransactionHash -&gt; IO ()) -&gt; IO HighwaterMark
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681483264"><span class="annot"><span class="annottext">chunk :: Vector TransactionHash
</span><a href="#local-6989586621681483264"><span class="hs-identifier hs-var">chunk</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-474"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681483263"><span class="annot"><span class="annottext">chunk' :: Vector TransactionHash
</span><a href="#local-6989586621681483263"><span class="hs-identifier hs-var hs-var">chunk'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TransactionHash -&gt; Bool)
-&gt; Vector TransactionHash -&gt; Vector TransactionHash
forall a. (a -&gt; Bool) -&gt; Vector a -&gt; Vector a
</span><span class="hs-identifier hs-var">V.filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool)
-&gt; (TransactionHash -&gt; Bool) -&gt; TransactionHash -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(TransactionHash -&gt; HashSet TransactionHash -&gt; Bool)
-&gt; HashSet TransactionHash -&gt; TransactionHash -&gt; Bool
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">TransactionHash -&gt; HashSet TransactionHash -&gt; Bool
forall a. (Eq a, Hashable a) =&gt; a -&gt; HashSet a -&gt; Bool
</span><span class="hs-identifier hs-var">HashSet.member</span></span><span> </span><span class="annot"><span class="annottext">HashSet TransactionHash
</span><a href="#local-6989586621681483267"><span class="hs-identifier hs-var">remoteHashes</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Vector TransactionHash
</span><a href="#local-6989586621681483264"><span class="hs-identifier hs-var">chunk</span></a></span><span>
</span><span id="line-475"></span><span>            </span><span class="annot"><span class="annottext">Bool -&gt; IO () -&gt; IO ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Vector TransactionHash -&gt; Bool
forall a. Vector a -&gt; Bool
</span><span class="hs-identifier hs-var">V.null</span></span><span> </span><span class="annot"><span class="annottext">Vector TransactionHash
</span><a href="#local-6989586621681483263"><span class="hs-identifier hs-var">chunk'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-476"></span><span>                </span><span class="annot"><span class="annottext">Vector TransactionHash -&gt; IO ()
</span><a href="#local-6989586621681483260"><span class="hs-identifier hs-var">sendChunk</span></a></span><span> </span><span class="annot"><span class="annottext">Vector TransactionHash
</span><a href="#local-6989586621681483263"><span class="hs-identifier hs-var">chunk'</span></a></span><span>
</span><span id="line-477"></span><span>                </span><span class="annot"><span class="annottext">IORef Int -&gt; (Int -&gt; Int) -&gt; IO ()
forall a. IORef a -&gt; (a -&gt; a) -&gt; IO ()
</span><span class="hs-identifier hs-var">modifyIORef'</span></span><span> </span><span class="annot"><span class="annottext">IORef Int
</span><a href="#local-6989586621681483266"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Vector TransactionHash -&gt; Int
forall a. Vector a -&gt; Int
</span><span class="hs-identifier hs-var">V.length</span></span><span> </span><span class="annot"><span class="annottext">Vector TransactionHash
</span><a href="#local-6989586621681483263"><span class="hs-identifier hs-var">chunk'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-478"></span><span>        </span><span id="local-6989586621681483258"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681483258"><span class="hs-identifier hs-var">numPushed</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IORef Int -&gt; IO Int
forall a. IORef a -&gt; IO a
</span><span class="hs-identifier hs-var">readIORef</span></span><span> </span><span class="annot"><span class="annottext">IORef Int
</span><a href="#local-6989586621681483266"><span class="hs-identifier hs-var">ref</span></a></span><span>
</span><span id="line-479"></span><span>        </span><span class="annot"><span class="annottext">(Int, HighwaterMark) -&gt; IO (Int, HighwaterMark)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681483258"><span class="hs-identifier hs-var">numPushed</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HighwaterMark
</span><a href="#local-6989586621681483265"><span class="hs-identifier hs-var">ourHw</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-480"></span><span>
</span><span id="line-481"></span><span>    </span><span class="hs-comment">-- Send a chunk of tranactions to the remote pool.</span><span>
</span><span id="line-482"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-483"></span><span>    </span><span id="local-6989586621681483260"><span class="annot"><span class="annottext">sendChunk :: Vector TransactionHash -&gt; IO ()
</span><a href="#local-6989586621681483260"><span class="hs-identifier hs-var hs-var">sendChunk</span></a></span></span><span> </span><span id="local-6989586621681483257"><span class="annot"><span class="annottext">chunk :: Vector TransactionHash
</span><a href="#local-6989586621681483257"><span class="hs-identifier hs-var">chunk</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-484"></span><span>        </span><span id="local-6989586621681483256"><span class="annot"><span class="annottext">Vector t
</span><a href="#local-6989586621681483256"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(LookupResult t -&gt; t) -&gt; Vector (LookupResult t) -&gt; Vector t
forall a b. (a -&gt; b) -&gt; Vector a -&gt; Vector b
</span><span class="hs-identifier hs-var">V.map</span></span><span> </span><span class="annot"><span class="annottext">LookupResult t -&gt; t
forall p. LookupResult p -&gt; p
</span><a href="#local-6989586621681483304"><span class="hs-identifier hs-var">fromPending</span></a></span><span> </span><span class="annot"><span class="annottext">(Vector (LookupResult t) -&gt; Vector t)
-&gt; (Vector (LookupResult t) -&gt; Vector (LookupResult t))
-&gt; Vector (LookupResult t)
-&gt; Vector t
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(LookupResult t -&gt; Bool)
-&gt; Vector (LookupResult t) -&gt; Vector (LookupResult t)
forall a. (a -&gt; Bool) -&gt; Vector a -&gt; Vector a
</span><span class="hs-identifier hs-var">V.filter</span></span><span> </span><span class="annot"><span class="annottext">LookupResult t -&gt; Bool
forall a. LookupResult a -&gt; Bool
</span><a href="#local-6989586621681483301"><span class="hs-identifier hs-var">isPending</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Vector (LookupResult t) -&gt; Vector t)
-&gt; IO (Vector (LookupResult t)) -&gt; IO (Vector t)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">MempoolBackend t
-&gt; Vector TransactionHash -&gt; IO (Vector (LookupResult t))
forall t.
MempoolBackend t
-&gt; Vector TransactionHash -&gt; IO (Vector (LookupResult t))
</span><a href="Chainweb.Mempool.Mempool.html#mempoolLookup"><span class="hs-identifier hs-var hs-var">mempoolLookup</span></a></span><span> </span><span class="annot"><span class="annottext">MempoolBackend t
</span><a href="#local-6989586621681483330"><span class="hs-identifier hs-var">localMempool</span></a></span><span> </span><span class="annot"><span class="annottext">Vector TransactionHash
</span><a href="#local-6989586621681483257"><span class="hs-identifier hs-var">chunk</span></a></span><span>
</span><span id="line-485"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; IO () -&gt; IO ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Vector t -&gt; Bool
forall a. Vector a -&gt; Bool
</span><span class="hs-identifier hs-var">V.null</span></span><span> </span><span class="annot"><span class="annottext">Vector t
</span><a href="#local-6989586621681483256"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">MempoolBackend t -&gt; InsertType -&gt; Vector t -&gt; IO ()
forall t. MempoolBackend t -&gt; InsertType -&gt; Vector t -&gt; IO ()
</span><a href="Chainweb.Mempool.Mempool.html#mempoolInsert"><span class="hs-identifier hs-var hs-var">mempoolInsert</span></a></span><span> </span><span class="annot"><span class="annottext">MempoolBackend t
</span><a href="#local-6989586621681483329"><span class="hs-identifier hs-var">remoteMempool</span></a></span><span> </span><span class="annot"><span class="annottext">InsertType
</span><a href="Chainweb.Mempool.Mempool.html#CheckedInsert"><span class="hs-identifier hs-var">CheckedInsert</span></a></span><span> </span><span class="annot"><span class="annottext">Vector t
</span><a href="#local-6989586621681483256"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-486"></span><span>
</span><span id="line-487"></span><span>
</span><span id="line-488"></span><span id="local-6989586621681483255"><span class="annot"><a href="Chainweb.Mempool.Mempool.html#syncMempools"><span class="hs-identifier hs-type">syncMempools</span></a></span><span>
</span><span id="line-489"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621681483255"><span class="hs-identifier hs-type">t</span></a></span><span>
</span><span id="line-490"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.LogMessage.html#LogFunctionText"><span class="hs-identifier hs-type">LogFunctionText</span></a></span><span>
</span><span id="line-491"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>                  </span><span class="hs-comment">-- ^ polling interval in microseconds</span><span>
</span><span id="line-492"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#MempoolBackend"><span class="hs-identifier hs-type">MempoolBackend</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681483255"><span class="hs-identifier hs-type">t</span></a></span><span>     </span><span class="hs-comment">-- ^ local mempool</span><span>
</span><span id="line-493"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#MempoolBackend"><span class="hs-identifier hs-type">MempoolBackend</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681483255"><span class="hs-identifier hs-type">t</span></a></span><span>     </span><span class="hs-comment">-- ^ remote mempool</span><span>
</span><span id="line-494"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-495"></span><span id="syncMempools"><span class="annot"><span class="annottext">syncMempools :: LogFunctionText
-&gt; Int -&gt; MempoolBackend t -&gt; MempoolBackend t -&gt; IO ()
</span><a href="Chainweb.Mempool.Mempool.html#syncMempools"><span class="hs-identifier hs-var hs-var">syncMempools</span></a></span></span><span> </span><span id="local-6989586621681483254"><span class="annot"><span class="annottext">log :: LogFunctionText
</span><a href="#local-6989586621681483254"><span class="hs-identifier hs-var">log</span></a></span></span><span> </span><span id="local-6989586621681483253"><span class="annot"><span class="annottext">us :: Int
</span><a href="#local-6989586621681483253"><span class="hs-identifier hs-var">us</span></a></span></span><span> </span><span id="local-6989586621681483252"><span class="annot"><span class="annottext">localMempool :: MempoolBackend t
</span><a href="#local-6989586621681483252"><span class="hs-identifier hs-var">localMempool</span></a></span></span><span> </span><span id="local-6989586621681483251"><span class="annot"><span class="annottext">remoteMempool :: MempoolBackend t
</span><a href="#local-6989586621681483251"><span class="hs-identifier hs-var">remoteMempool</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-496"></span><span>    </span><span class="annot"><span class="annottext">LogFunctionText
-&gt; Int -&gt; MempoolBackend t -&gt; MempoolBackend t -&gt; IO ()
forall t.
Show t =&gt;
LogFunctionText
-&gt; Int -&gt; MempoolBackend t -&gt; MempoolBackend t -&gt; IO ()
</span><a href="Chainweb.Mempool.Mempool.html#syncMempools%27"><span class="hs-identifier hs-var">syncMempools'</span></a></span><span> </span><span class="annot"><span class="annottext">LogFunctionText
</span><a href="#local-6989586621681483254"><span class="hs-identifier hs-var">log</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681483253"><span class="hs-identifier hs-var">us</span></a></span><span> </span><span class="annot"><span class="annottext">MempoolBackend t
</span><a href="#local-6989586621681483252"><span class="hs-identifier hs-var">localMempool</span></a></span><span> </span><span class="annot"><span class="annottext">MempoolBackend t
</span><a href="#local-6989586621681483251"><span class="hs-identifier hs-var">remoteMempool</span></a></span><span>
</span><span id="line-497"></span><span>
</span><span id="line-498"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-499"></span><span class="hs-comment">-- | Raw/unencoded transaction hashes.</span><span>
</span><span id="line-500"></span><span class="hs-comment">--</span><span>
</span><span id="line-501"></span><span class="hs-comment">-- TODO: production versions of this kind of DB should salt with a</span><span>
</span><span id="line-502"></span><span class="hs-comment">-- runtime-generated constant to avoid collision attacks; see the \&quot;hashing and</span><span>
</span><span id="line-503"></span><span class="hs-comment">-- security\&quot; section of the hashable docs.</span><span>
</span><span id="line-504"></span><span id="local-6989586621681483249"><span id="local-6989586621681483250"></span></span><span class="hs-keyword">newtype</span><span> </span><span id="TransactionHash"><span class="annot"><a href="Chainweb.Mempool.Mempool.html#TransactionHash"><span class="hs-identifier hs-var">TransactionHash</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="TransactionHash"><span class="annot"><a href="Chainweb.Mempool.Mempool.html#TransactionHash"><span class="hs-identifier hs-var">TransactionHash</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SB.ShortByteString</span></span><span>
</span><span id="line-505"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681483241"><span id="local-6989586621681483243"><span id="local-6989586621681483245"><span id="local-6989586621681483247"><span class="annot"><span class="annottext">ReadPrec [TransactionHash]
ReadPrec TransactionHash
Int -&gt; ReadS TransactionHash
ReadS [TransactionHash]
(Int -&gt; ReadS TransactionHash)
-&gt; ReadS [TransactionHash]
-&gt; ReadPrec TransactionHash
-&gt; ReadPrec [TransactionHash]
-&gt; Read TransactionHash
forall a.
(Int -&gt; ReadS a)
-&gt; ReadS [a] -&gt; ReadPrec a -&gt; ReadPrec [a] -&gt; Read a
readListPrec :: ReadPrec [TransactionHash]
$creadListPrec :: ReadPrec [TransactionHash]
readPrec :: ReadPrec TransactionHash
$creadPrec :: ReadPrec TransactionHash
readList :: ReadS [TransactionHash]
$creadList :: ReadS [TransactionHash]
readsPrec :: Int -&gt; ReadS TransactionHash
$creadsPrec :: Int -&gt; ReadS TransactionHash
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Read</span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681483236"><span id="local-6989586621681483238"><span class="annot"><span class="annottext">TransactionHash -&gt; TransactionHash -&gt; Bool
(TransactionHash -&gt; TransactionHash -&gt; Bool)
-&gt; (TransactionHash -&gt; TransactionHash -&gt; Bool)
-&gt; Eq TransactionHash
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: TransactionHash -&gt; TransactionHash -&gt; Bool
$c/= :: TransactionHash -&gt; TransactionHash -&gt; Bool
== :: TransactionHash -&gt; TransactionHash -&gt; Bool
$c== :: TransactionHash -&gt; TransactionHash -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681483221"><span id="local-6989586621681483223"><span id="local-6989586621681483225"><span id="local-6989586621681483227"><span id="local-6989586621681483229"><span id="local-6989586621681483231"><span id="local-6989586621681483233"><span class="annot"><span class="annottext">Eq TransactionHash
Eq TransactionHash =&gt;
(TransactionHash -&gt; TransactionHash -&gt; Ordering)
-&gt; (TransactionHash -&gt; TransactionHash -&gt; Bool)
-&gt; (TransactionHash -&gt; TransactionHash -&gt; Bool)
-&gt; (TransactionHash -&gt; TransactionHash -&gt; Bool)
-&gt; (TransactionHash -&gt; TransactionHash -&gt; Bool)
-&gt; (TransactionHash -&gt; TransactionHash -&gt; TransactionHash)
-&gt; (TransactionHash -&gt; TransactionHash -&gt; TransactionHash)
-&gt; Ord TransactionHash
TransactionHash -&gt; TransactionHash -&gt; Bool
TransactionHash -&gt; TransactionHash -&gt; Ordering
TransactionHash -&gt; TransactionHash -&gt; TransactionHash
forall a.
Eq a =&gt;
(a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
min :: TransactionHash -&gt; TransactionHash -&gt; TransactionHash
$cmin :: TransactionHash -&gt; TransactionHash -&gt; TransactionHash
max :: TransactionHash -&gt; TransactionHash -&gt; TransactionHash
$cmax :: TransactionHash -&gt; TransactionHash -&gt; TransactionHash
&gt;= :: TransactionHash -&gt; TransactionHash -&gt; Bool
$c&gt;= :: TransactionHash -&gt; TransactionHash -&gt; Bool
&gt; :: TransactionHash -&gt; TransactionHash -&gt; Bool
$c&gt; :: TransactionHash -&gt; TransactionHash -&gt; Bool
&lt;= :: TransactionHash -&gt; TransactionHash -&gt; Bool
$c&lt;= :: TransactionHash -&gt; TransactionHash -&gt; Bool
&lt; :: TransactionHash -&gt; TransactionHash -&gt; Bool
$c&lt; :: TransactionHash -&gt; TransactionHash -&gt; Bool
compare :: TransactionHash -&gt; TransactionHash -&gt; Ordering
$ccompare :: TransactionHash -&gt; TransactionHash -&gt; Ordering
$cp1Ord :: Eq TransactionHash
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(forall x. TransactionHash -&gt; Rep TransactionHash x)
-&gt; (forall x. Rep TransactionHash x -&gt; TransactionHash)
-&gt; Generic TransactionHash
forall x. Rep TransactionHash x -&gt; TransactionHash
forall x. TransactionHash -&gt; Rep TransactionHash x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep TransactionHash x -&gt; TransactionHash
$cfrom :: forall x. TransactionHash -&gt; Rep TransactionHash x
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></span><span class="hs-special">)</span><span>
</span><span id="line-506"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">anyclass</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681483216"><span class="annot"><span class="annottext">TransactionHash -&gt; ()
(TransactionHash -&gt; ()) -&gt; NFData TransactionHash
forall a. (a -&gt; ()) -&gt; NFData a
rnf :: TransactionHash -&gt; ()
$crnf :: TransactionHash -&gt; ()
</span><a href="#local-6989586621681483216"><span class="hs-identifier hs-var hs-var hs-var hs-var">NFData</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-507"></span><span>
</span><span id="line-508"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681483211"><span id="local-6989586621681483214"><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#TransactionHash"><span class="hs-identifier hs-type">TransactionHash</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-509"></span><span>    </span><span id="local-6989586621681483210"><span class="annot"><span class="annottext">show :: TransactionHash -&gt; String
</span><a href="#local-6989586621681483210"><span class="hs-identifier hs-var hs-var hs-var hs-var">show</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">T.unpack</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; String)
-&gt; (TransactionHash -&gt; Text) -&gt; TransactionHash -&gt; String
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TransactionHash -&gt; Text
forall a. ToJSON a =&gt; a -&gt; Text
</span><a href="Chainweb.Utils.html#encodeToText"><span class="hs-identifier hs-var">encodeToText</span></a></span><span>
</span><span id="line-510"></span><span>
</span><span id="line-511"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681483206"><span class="annot"><span class="hs-identifier hs-type">Hashable</span></span><span> </span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#TransactionHash"><span class="hs-identifier hs-type">TransactionHash</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-512"></span><span>  </span><span id="local-6989586621681483204"><span class="annot"><span class="annottext">hashWithSalt :: Int -&gt; TransactionHash -&gt; Int
</span><a href="#local-6989586621681483204"><span class="hs-identifier hs-var hs-var hs-var hs-var">hashWithSalt</span></a></span></span><span> </span><span id="local-6989586621681483203"><span class="annot"><span class="annottext">s :: Int
</span><a href="#local-6989586621681483203"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#TransactionHash"><span class="hs-identifier hs-type">TransactionHash</span></a></span><span> </span><span id="local-6989586621681483202"><span class="annot"><span class="annottext">h :: ShortByteString
</span><a href="#local-6989586621681483202"><span class="hs-identifier hs-var">h</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Hashable a =&gt; Int -&gt; a -&gt; Int
</span><span class="hs-identifier hs-var">hashWithSalt</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681483203"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681483201"><span class="hs-identifier hs-var">hashCode</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span>
</span><span id="line-513"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-514"></span><span>      </span><span id="local-6989586621681483201"><span class="annot"><span class="annottext">hashCode :: Int
</span><a href="#local-6989586621681483201"><span class="hs-identifier hs-var hs-var">hashCode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(String -&gt; Int) -&gt; (Int -&gt; Int) -&gt; Either String Int -&gt; Int
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><span class="hs-identifier hs-var">either</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Int
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="annot"><span class="annottext">(Either String Int -&gt; Int) -&gt; Either String Int -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Get Int -&gt; ByteString -&gt; Either String Int
forall a. Get a -&gt; ByteString -&gt; Either String a
</span><span class="hs-identifier hs-var">runGetS</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word64 -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">(Word64 -&gt; Int) -&gt; Get Word64 -&gt; Get Int
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Get Word64
forall (m :: * -&gt; *). MonadGet m =&gt; m Word64
</span><span class="hs-identifier hs-var">getWord64host</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; ByteString -&gt; ByteString
</span><span class="hs-identifier hs-var">B.take</span></span><span> </span><span class="annot"><span class="hs-number">8</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; ByteString) -&gt; ByteString -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ShortByteString -&gt; ByteString
</span><span class="hs-identifier hs-var">SB.fromShort</span></span><span> </span><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621681483202"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-515"></span><span>  </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><span class="hs-pragma hs-type">hashWithSalt</span></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-516"></span><span>
</span><span id="line-517"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681483188"><span id="local-6989586621681483190"><span id="local-6989586621681483192"><span class="annot"><span class="hs-identifier hs-type">ToJSON</span></span><span> </span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#TransactionHash"><span class="hs-identifier hs-type">TransactionHash</span></a></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-518"></span><span>  </span><span id="local-6989586621681483187"><span class="annot"><span class="annottext">toJSON :: TransactionHash -&gt; Value
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">toJSON</span></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#TransactionHash"><span class="hs-identifier hs-type">TransactionHash</span></a></span><span> </span><span id="local-6989586621681483185"><span class="annot"><span class="annottext">x :: ShortByteString
</span><a href="#local-6989586621681483185"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Value
forall a. ToJSON a =&gt; a -&gt; Value
</span><span class="hs-identifier hs-var">toJSON</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Value) -&gt; Text -&gt; Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Text
</span><a href="Chainweb.Utils.html#encodeB64UrlNoPaddingText"><span class="hs-identifier hs-var">encodeB64UrlNoPaddingText</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; Text) -&gt; ByteString -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ShortByteString -&gt; ByteString
</span><span class="hs-identifier hs-var">SB.fromShort</span></span><span> </span><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621681483185"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-519"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681483181"><span class="annot"><span class="hs-identifier hs-type">FromJSON</span></span><span> </span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#TransactionHash"><span class="hs-identifier hs-type">TransactionHash</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-520"></span><span>  </span><span id="local-6989586621681483180"><span class="annot"><span class="annottext">parseJSON :: Value -&gt; Parser TransactionHash
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">parseJSON</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
-&gt; (Text -&gt; Parser TransactionHash)
-&gt; Value
-&gt; Parser TransactionHash
forall a. String -&gt; (Text -&gt; Parser a) -&gt; Value -&gt; Parser a
</span><span class="hs-identifier hs-var">withText</span></span><span> </span><span class="annot"><span class="hs-string">&quot;TransactionHash&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(SomeException -&gt; Parser TransactionHash)
-&gt; (TransactionHash -&gt; Parser TransactionHash)
-&gt; Either SomeException TransactionHash
-&gt; Parser TransactionHash
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><span class="hs-identifier hs-var">either</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Parser TransactionHash
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><span class="hs-identifier hs-var">fail</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Parser TransactionHash)
-&gt; (SomeException -&gt; String)
-&gt; SomeException
-&gt; Parser TransactionHash
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SomeException -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TransactionHash -&gt; Parser TransactionHash
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Either SomeException TransactionHash -&gt; Parser TransactionHash)
-&gt; (Text -&gt; Either SomeException TransactionHash)
-&gt; Text
-&gt; Parser TransactionHash
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Either SomeException TransactionHash
</span><a href="#local-6989586621681483177"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-521"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-522"></span><span>      </span><span class="annot"><a href="#local-6989586621681483177"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SomeException</span></span><span> </span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#TransactionHash"><span class="hs-identifier hs-type">TransactionHash</span></a></span><span>
</span><span id="line-523"></span><span>      </span><span class="hs-glyph">!</span><span id="local-6989586621681483177"><span class="annot"><span class="annottext">p :: Text -&gt; Either SomeException TransactionHash
</span><a href="#local-6989586621681483177"><span class="hs-identifier hs-var hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShortByteString -&gt; TransactionHash
</span><a href="Chainweb.Mempool.Mempool.html#TransactionHash"><span class="hs-identifier hs-var">TransactionHash</span></a></span><span> </span><span class="annot"><span class="annottext">(ShortByteString -&gt; TransactionHash)
-&gt; (ByteString -&gt; ShortByteString) -&gt; ByteString -&gt; TransactionHash
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ShortByteString
</span><span class="hs-identifier hs-var">SB.toShort</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; TransactionHash)
-&gt; Either SomeException ByteString
-&gt; Either SomeException TransactionHash
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Either SomeException ByteString
 -&gt; Either SomeException TransactionHash)
-&gt; (Text -&gt; Either SomeException ByteString)
-&gt; Text
-&gt; Either SomeException TransactionHash
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Either SomeException ByteString
forall (m :: * -&gt; *). MonadThrow m =&gt; Text -&gt; m ByteString
</span><a href="Chainweb.Utils.html#decodeB64UrlNoPaddingText"><span class="hs-identifier hs-var">decodeB64UrlNoPaddingText</span></a></span><span>
</span><span id="line-524"></span><span>
</span><span id="line-525"></span><span>
</span><span id="line-526"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-527"></span><span id="local-6989586621681483174"><span id="local-6989586621681483175"></span></span><span class="hs-keyword">data</span><span> </span><span id="TransactionMetadata"><span class="annot"><a href="Chainweb.Mempool.Mempool.html#TransactionMetadata"><span class="hs-identifier hs-var">TransactionMetadata</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="TransactionMetadata"><span class="annot"><a href="Chainweb.Mempool.Mempool.html#TransactionMetadata"><span class="hs-identifier hs-var">TransactionMetadata</span></a></span></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-528"></span><span>    </span><span id="txMetaCreationTime"><span class="annot"><span class="annottext">TransactionMetadata -&gt; Time Micros
</span><a href="Chainweb.Mempool.Mempool.html#txMetaCreationTime"><span class="hs-identifier hs-var hs-var">txMetaCreationTime</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.Time.html#Time"><span class="hs-identifier hs-type">Time</span></a></span><span> </span><span class="annot"><a href="Chainweb.Time.html#Micros"><span class="hs-identifier hs-type">Micros</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-529"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="txMetaExpiryTime"><span class="annot"><span class="annottext">TransactionMetadata -&gt; Time Micros
</span><a href="Chainweb.Mempool.Mempool.html#txMetaExpiryTime"><span class="hs-identifier hs-var hs-var">txMetaExpiryTime</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.Time.html#Time"><span class="hs-identifier hs-type">Time</span></a></span><span> </span><span class="annot"><a href="Chainweb.Time.html#Micros"><span class="hs-identifier hs-type">Micros</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-530"></span><span>  </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681483168"><span id="local-6989586621681483170"><span class="annot"><span class="annottext">TransactionMetadata -&gt; TransactionMetadata -&gt; Bool
(TransactionMetadata -&gt; TransactionMetadata -&gt; Bool)
-&gt; (TransactionMetadata -&gt; TransactionMetadata -&gt; Bool)
-&gt; Eq TransactionMetadata
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: TransactionMetadata -&gt; TransactionMetadata -&gt; Bool
$c/= :: TransactionMetadata -&gt; TransactionMetadata -&gt; Bool
== :: TransactionMetadata -&gt; TransactionMetadata -&gt; Bool
$c== :: TransactionMetadata -&gt; TransactionMetadata -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681483153"><span id="local-6989586621681483155"><span id="local-6989586621681483157"><span id="local-6989586621681483159"><span id="local-6989586621681483161"><span id="local-6989586621681483163"><span id="local-6989586621681483165"><span class="annot"><span class="annottext">Eq TransactionMetadata
Eq TransactionMetadata =&gt;
(TransactionMetadata -&gt; TransactionMetadata -&gt; Ordering)
-&gt; (TransactionMetadata -&gt; TransactionMetadata -&gt; Bool)
-&gt; (TransactionMetadata -&gt; TransactionMetadata -&gt; Bool)
-&gt; (TransactionMetadata -&gt; TransactionMetadata -&gt; Bool)
-&gt; (TransactionMetadata -&gt; TransactionMetadata -&gt; Bool)
-&gt; (TransactionMetadata
    -&gt; TransactionMetadata -&gt; TransactionMetadata)
-&gt; (TransactionMetadata
    -&gt; TransactionMetadata -&gt; TransactionMetadata)
-&gt; Ord TransactionMetadata
TransactionMetadata -&gt; TransactionMetadata -&gt; Bool
TransactionMetadata -&gt; TransactionMetadata -&gt; Ordering
TransactionMetadata -&gt; TransactionMetadata -&gt; TransactionMetadata
forall a.
Eq a =&gt;
(a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
min :: TransactionMetadata -&gt; TransactionMetadata -&gt; TransactionMetadata
$cmin :: TransactionMetadata -&gt; TransactionMetadata -&gt; TransactionMetadata
max :: TransactionMetadata -&gt; TransactionMetadata -&gt; TransactionMetadata
$cmax :: TransactionMetadata -&gt; TransactionMetadata -&gt; TransactionMetadata
&gt;= :: TransactionMetadata -&gt; TransactionMetadata -&gt; Bool
$c&gt;= :: TransactionMetadata -&gt; TransactionMetadata -&gt; Bool
&gt; :: TransactionMetadata -&gt; TransactionMetadata -&gt; Bool
$c&gt; :: TransactionMetadata -&gt; TransactionMetadata -&gt; Bool
&lt;= :: TransactionMetadata -&gt; TransactionMetadata -&gt; Bool
$c&lt;= :: TransactionMetadata -&gt; TransactionMetadata -&gt; Bool
&lt; :: TransactionMetadata -&gt; TransactionMetadata -&gt; Bool
$c&lt; :: TransactionMetadata -&gt; TransactionMetadata -&gt; Bool
compare :: TransactionMetadata -&gt; TransactionMetadata -&gt; Ordering
$ccompare :: TransactionMetadata -&gt; TransactionMetadata -&gt; Ordering
$cp1Ord :: Eq TransactionMetadata
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681483147"><span id="local-6989586621681483149"><span id="local-6989586621681483151"><span class="annot"><span class="annottext">Int -&gt; TransactionMetadata -&gt; ShowS
[TransactionMetadata] -&gt; ShowS
TransactionMetadata -&gt; String
(Int -&gt; TransactionMetadata -&gt; ShowS)
-&gt; (TransactionMetadata -&gt; String)
-&gt; ([TransactionMetadata] -&gt; ShowS)
-&gt; Show TransactionMetadata
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [TransactionMetadata] -&gt; ShowS
$cshowList :: [TransactionMetadata] -&gt; ShowS
show :: TransactionMetadata -&gt; String
$cshow :: TransactionMetadata -&gt; String
showsPrec :: Int -&gt; TransactionMetadata -&gt; ShowS
$cshowsPrec :: Int -&gt; TransactionMetadata -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(forall x. TransactionMetadata -&gt; Rep TransactionMetadata x)
-&gt; (forall x. Rep TransactionMetadata x -&gt; TransactionMetadata)
-&gt; Generic TransactionMetadata
forall x. Rep TransactionMetadata x -&gt; TransactionMetadata
forall x. TransactionMetadata -&gt; Rep TransactionMetadata x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep TransactionMetadata x -&gt; TransactionMetadata
$cfrom :: forall x. TransactionMetadata -&gt; Rep TransactionMetadata x
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></span><span class="hs-special">)</span><span>
</span><span id="line-531"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">anyclass</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681483141"><span id="local-6989586621681483143"><span class="annot"><span class="annottext">Value -&gt; Parser [TransactionMetadata]
Value -&gt; Parser TransactionMetadata
(Value -&gt; Parser TransactionMetadata)
-&gt; (Value -&gt; Parser [TransactionMetadata])
-&gt; FromJSON TransactionMetadata
forall a.
(Value -&gt; Parser a) -&gt; (Value -&gt; Parser [a]) -&gt; FromJSON a
parseJSONList :: Value -&gt; Parser [TransactionMetadata]
$cparseJSONList :: Value -&gt; Parser [TransactionMetadata]
parseJSON :: Value -&gt; Parser TransactionMetadata
$cparseJSON :: Value -&gt; Parser TransactionMetadata
</span><a href="#local-6989586621681483141"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">FromJSON</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681483133"><span id="local-6989586621681483135"><span id="local-6989586621681483137"><span id="local-6989586621681483139"><span class="annot"><span class="annottext">[TransactionMetadata] -&gt; Encoding
[TransactionMetadata] -&gt; Value
TransactionMetadata -&gt; Encoding
TransactionMetadata -&gt; Value
(TransactionMetadata -&gt; Value)
-&gt; (TransactionMetadata -&gt; Encoding)
-&gt; ([TransactionMetadata] -&gt; Value)
-&gt; ([TransactionMetadata] -&gt; Encoding)
-&gt; ToJSON TransactionMetadata
forall a.
(a -&gt; Value)
-&gt; (a -&gt; Encoding)
-&gt; ([a] -&gt; Value)
-&gt; ([a] -&gt; Encoding)
-&gt; ToJSON a
toEncodingList :: [TransactionMetadata] -&gt; Encoding
$ctoEncodingList :: [TransactionMetadata] -&gt; Encoding
toJSONList :: [TransactionMetadata] -&gt; Value
$ctoJSONList :: [TransactionMetadata] -&gt; Value
toEncoding :: TransactionMetadata -&gt; Encoding
$ctoEncoding :: TransactionMetadata -&gt; Encoding
toJSON :: TransactionMetadata -&gt; Value
$ctoJSON :: TransactionMetadata -&gt; Value
</span><a href="#local-6989586621681483133"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">ToJSON</span></a></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681483131"><span class="annot"><span class="annottext">TransactionMetadata -&gt; ()
(TransactionMetadata -&gt; ()) -&gt; NFData TransactionMetadata
forall a. (a -&gt; ()) -&gt; NFData a
rnf :: TransactionMetadata -&gt; ()
$crnf :: TransactionMetadata -&gt; ()
</span><a href="#local-6989586621681483131"><span class="hs-identifier hs-var hs-var hs-var hs-var">NFData</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-532"></span><span>
</span><span id="line-533"></span><span>
</span><span id="line-534"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-535"></span><span class="hs-comment">-- | Mempools will check these values match in APIs</span><span>
</span><span id="line-536"></span><span class="hs-keyword">data</span><span> </span><span id="HashMeta"><span class="annot"><a href="Chainweb.Mempool.Mempool.html#HashMeta"><span class="hs-identifier hs-var">HashMeta</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="HashMeta"><span class="annot"><a href="Chainweb.Mempool.Mempool.html#HashMeta"><span class="hs-identifier hs-var">HashMeta</span></a></span></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-537"></span><span>    </span><span id="hashmetaName"><span class="annot"><span class="annottext">HashMeta -&gt; Text
</span><a href="Chainweb.Mempool.Mempool.html#hashmetaName"><span class="hs-identifier hs-var hs-var">hashmetaName</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-538"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="hashmetaLenBytes"><span class="annot"><span class="annottext">HashMeta -&gt; Int
</span><a href="Chainweb.Mempool.Mempool.html#hashmetaLenBytes"><span class="hs-identifier hs-var hs-var">hashmetaLenBytes</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-539"></span><span class="hs-special">}</span><span>
</span><span id="line-540"></span><span>
</span><span id="line-541"></span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#chainwebTestHasher"><span class="hs-identifier hs-type">chainwebTestHasher</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#TransactionHash"><span class="hs-identifier hs-type">TransactionHash</span></a></span><span>
</span><span id="line-542"></span><span id="chainwebTestHasher"><span class="annot"><span class="annottext">chainwebTestHasher :: ByteString -&gt; TransactionHash
</span><a href="Chainweb.Mempool.Mempool.html#chainwebTestHasher"><span class="hs-identifier hs-var hs-var">chainwebTestHasher</span></a></span></span><span> </span><span id="local-6989586621681483127"><span class="annot"><span class="annottext">s :: ByteString
</span><a href="#local-6989586621681483127"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621681483126"><span class="annot"><span class="annottext">b :: ShortByteString
</span><a href="#local-6989586621681483126"><span class="hs-identifier hs-var hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ShortByteString
</span><span class="hs-identifier hs-var">SB.toShort</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; ShortByteString) -&gt; ByteString -&gt; ShortByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Digest SHA512t_256 -&gt; ByteString
forall bin bout.
(ByteArrayAccess bin, ByteArray bout) =&gt;
bin -&gt; bout
</span><span class="hs-identifier hs-var">convert</span></span><span> </span><span class="annot"><span class="annottext">(Digest SHA512t_256 -&gt; ByteString)
-&gt; Digest SHA512t_256 -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(ByteArrayAccess ByteString, HashAlgorithm SHA512t_256) =&gt;
ByteString -&gt; Digest SHA512t_256
forall ba a.
(ByteArrayAccess ba, HashAlgorithm a) =&gt;
ba -&gt; Digest a
</span><span class="hs-identifier hs-var">hash</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">SHA512t_256</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; Digest SHA512t_256)
-&gt; ByteString -&gt; Digest SHA512t_256
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;TEST&quot;</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString -&gt; ByteString
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621681483127"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-543"></span><span>                       </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">ShortByteString -&gt; TransactionHash
</span><a href="Chainweb.Mempool.Mempool.html#TransactionHash"><span class="hs-identifier hs-var">TransactionHash</span></a></span><span> </span><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621681483126"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-544"></span><span>
</span><span id="line-545"></span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#chainwebTestHashMeta"><span class="hs-identifier hs-type">chainwebTestHashMeta</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#HashMeta"><span class="hs-identifier hs-type">HashMeta</span></a></span><span>
</span><span id="line-546"></span><span id="chainwebTestHashMeta"><span class="annot"><span class="annottext">chainwebTestHashMeta :: HashMeta
</span><a href="Chainweb.Mempool.Mempool.html#chainwebTestHashMeta"><span class="hs-identifier hs-var hs-var">chainwebTestHashMeta</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Int -&gt; HashMeta
</span><a href="Chainweb.Mempool.Mempool.html#HashMeta"><span class="hs-identifier hs-var">HashMeta</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;chainweb-sha512-256&quot;</span></span><span> </span><span class="annot"><span class="hs-number">32</span></span><span>
</span><span id="line-547"></span><span>
</span><span id="line-548"></span><span id="local-6989586621681483124"><span id="local-6989586621681483125"></span></span><span class="hs-keyword">data</span><span> </span><span id="ValidatedTransaction"><span class="annot"><a href="Chainweb.Mempool.Mempool.html#ValidatedTransaction"><span class="hs-identifier hs-var">ValidatedTransaction</span></a></span></span><span> </span><span id="local-6989586621681483123"><span class="annot"><a href="#local-6989586621681483123"><span class="hs-identifier hs-type">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ValidatedTransaction"><span class="annot"><a href="Chainweb.Mempool.Mempool.html#ValidatedTransaction"><span class="hs-identifier hs-var">ValidatedTransaction</span></a></span></span><span>
</span><span id="line-549"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="validatedHeight"><span class="annot"><span class="annottext">ValidatedTransaction t -&gt; BlockHeight
</span><a href="Chainweb.Mempool.Mempool.html#validatedHeight"><span class="hs-identifier hs-var hs-var">validatedHeight</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Chainweb.BlockHeader.html#BlockHeight"><span class="hs-identifier hs-type">BlockHeight</span></a></span><span>
</span><span id="line-550"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="validatedHash"><span class="annot"><span class="annottext">ValidatedTransaction t -&gt; BlockHash
</span><a href="Chainweb.Mempool.Mempool.html#validatedHash"><span class="hs-identifier hs-var hs-var">validatedHash</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Chainweb.BlockHash.html#BlockHash"><span class="hs-identifier hs-type">BlockHash</span></a></span><span>
</span><span id="line-551"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="validatedTransaction"><span class="annot"><span class="annottext">ValidatedTransaction t -&gt; t
</span><a href="Chainweb.Mempool.Mempool.html#validatedTransaction"><span class="hs-identifier hs-var hs-var">validatedTransaction</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="#local-6989586621681483123"><span class="hs-identifier hs-type">t</span></a></span><span>
</span><span id="line-552"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-553"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681483113"><span id="local-6989586621681483115"><span id="local-6989586621681483117"><span class="annot"><span class="annottext">Int -&gt; ValidatedTransaction t -&gt; ShowS
[ValidatedTransaction t] -&gt; ShowS
ValidatedTransaction t -&gt; String
(Int -&gt; ValidatedTransaction t -&gt; ShowS)
-&gt; (ValidatedTransaction t -&gt; String)
-&gt; ([ValidatedTransaction t] -&gt; ShowS)
-&gt; Show (ValidatedTransaction t)
forall t. Show t =&gt; Int -&gt; ValidatedTransaction t -&gt; ShowS
forall t. Show t =&gt; [ValidatedTransaction t] -&gt; ShowS
forall t. Show t =&gt; ValidatedTransaction t -&gt; String
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [ValidatedTransaction t] -&gt; ShowS
$cshowList :: forall t. Show t =&gt; [ValidatedTransaction t] -&gt; ShowS
show :: ValidatedTransaction t -&gt; String
$cshow :: forall t. Show t =&gt; ValidatedTransaction t -&gt; String
showsPrec :: Int -&gt; ValidatedTransaction t -&gt; ShowS
$cshowsPrec :: forall t. Show t =&gt; Int -&gt; ValidatedTransaction t -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(forall x.
 ValidatedTransaction t -&gt; Rep (ValidatedTransaction t) x)
-&gt; (forall x.
    Rep (ValidatedTransaction t) x -&gt; ValidatedTransaction t)
-&gt; Generic (ValidatedTransaction t)
forall x. Rep (ValidatedTransaction t) x -&gt; ValidatedTransaction t
forall x. ValidatedTransaction t -&gt; Rep (ValidatedTransaction t) x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
forall t x.
Rep (ValidatedTransaction t) x -&gt; ValidatedTransaction t
forall t x.
ValidatedTransaction t -&gt; Rep (ValidatedTransaction t) x
$cto :: forall t x.
Rep (ValidatedTransaction t) x -&gt; ValidatedTransaction t
$cfrom :: forall t x.
ValidatedTransaction t -&gt; Rep (ValidatedTransaction t) x
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></span><span class="hs-special">)</span><span>
</span><span id="line-554"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">anyclass</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681483103"><span id="local-6989586621681483105"><span id="local-6989586621681483107"><span id="local-6989586621681483109"><span class="annot"><span class="annottext">[ValidatedTransaction t] -&gt; Encoding
[ValidatedTransaction t] -&gt; Value
ValidatedTransaction t -&gt; Encoding
ValidatedTransaction t -&gt; Value
(ValidatedTransaction t -&gt; Value)
-&gt; (ValidatedTransaction t -&gt; Encoding)
-&gt; ([ValidatedTransaction t] -&gt; Value)
-&gt; ([ValidatedTransaction t] -&gt; Encoding)
-&gt; ToJSON (ValidatedTransaction t)
forall t. ToJSON t =&gt; [ValidatedTransaction t] -&gt; Encoding
forall t. ToJSON t =&gt; [ValidatedTransaction t] -&gt; Value
forall t. ToJSON t =&gt; ValidatedTransaction t -&gt; Encoding
forall t. ToJSON t =&gt; ValidatedTransaction t -&gt; Value
forall a.
(a -&gt; Value)
-&gt; (a -&gt; Encoding)
-&gt; ([a] -&gt; Value)
-&gt; ([a] -&gt; Encoding)
-&gt; ToJSON a
toEncodingList :: [ValidatedTransaction t] -&gt; Encoding
$ctoEncodingList :: forall t. ToJSON t =&gt; [ValidatedTransaction t] -&gt; Encoding
toJSONList :: [ValidatedTransaction t] -&gt; Value
$ctoJSONList :: forall t. ToJSON t =&gt; [ValidatedTransaction t] -&gt; Value
toEncoding :: ValidatedTransaction t -&gt; Encoding
$ctoEncoding :: forall t. ToJSON t =&gt; ValidatedTransaction t -&gt; Encoding
toJSON :: ValidatedTransaction t -&gt; Value
$ctoJSON :: forall t. ToJSON t =&gt; ValidatedTransaction t -&gt; Value
</span><a href="#local-6989586621681483103"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">ToJSON</span></a></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681483099"><span id="local-6989586621681483101"><span class="annot"><span class="annottext">Value -&gt; Parser [ValidatedTransaction t]
Value -&gt; Parser (ValidatedTransaction t)
(Value -&gt; Parser (ValidatedTransaction t))
-&gt; (Value -&gt; Parser [ValidatedTransaction t])
-&gt; FromJSON (ValidatedTransaction t)
forall t. FromJSON t =&gt; Value -&gt; Parser [ValidatedTransaction t]
forall t. FromJSON t =&gt; Value -&gt; Parser (ValidatedTransaction t)
forall a.
(Value -&gt; Parser a) -&gt; (Value -&gt; Parser [a]) -&gt; FromJSON a
parseJSONList :: Value -&gt; Parser [ValidatedTransaction t]
$cparseJSONList :: forall t. FromJSON t =&gt; Value -&gt; Parser [ValidatedTransaction t]
parseJSON :: Value -&gt; Parser (ValidatedTransaction t)
$cparseJSON :: forall t. FromJSON t =&gt; Value -&gt; Parser (ValidatedTransaction t)
</span><a href="#local-6989586621681483099"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">FromJSON</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681483097"><span class="annot"><span class="annottext">ValidatedTransaction t -&gt; ()
(ValidatedTransaction t -&gt; ()) -&gt; NFData (ValidatedTransaction t)
forall t. NFData t =&gt; ValidatedTransaction t -&gt; ()
forall a. (a -&gt; ()) -&gt; NFData a
rnf :: ValidatedTransaction t -&gt; ()
$crnf :: forall t. NFData t =&gt; ValidatedTransaction t -&gt; ()
</span><a href="#local-6989586621681483097"><span class="hs-identifier hs-var hs-var hs-var hs-var">NFData</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- TODO: a handwritten instance</span><span>
</span><span id="line-555"></span><span>
</span><span id="line-556"></span><span>
</span><span id="line-557"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-558"></span><span class="hs-comment">-- | Mempool only cares about a few projected values from the transaction type</span><span>
</span><span id="line-559"></span><span class="hs-comment">-- (gas price, gas limit, hash, metadata), so our mock transaction type will only</span><span>
</span><span id="line-560"></span><span class="hs-comment">-- contain these (plus a nonce)</span><span>
</span><span id="line-561"></span><span id="local-6989586621681483095"><span id="local-6989586621681483096"></span></span><span class="hs-keyword">data</span><span> </span><span id="MockTx"><span class="annot"><a href="Chainweb.Mempool.Mempool.html#MockTx"><span class="hs-identifier hs-var">MockTx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="MockTx"><span class="annot"><a href="Chainweb.Mempool.Mempool.html#MockTx"><span class="hs-identifier hs-var">MockTx</span></a></span></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-562"></span><span>    </span><span id="mockNonce"><span class="annot"><span class="annottext">MockTx -&gt; Int64
</span><a href="Chainweb.Mempool.Mempool.html#mockNonce"><span class="hs-identifier hs-var hs-var">mockNonce</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Int64</span></span><span>
</span><span id="line-563"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="mockGasPrice"><span class="annot"><span class="annottext">MockTx -&gt; GasPrice
</span><a href="Chainweb.Mempool.Mempool.html#mockGasPrice"><span class="hs-identifier hs-var hs-var">mockGasPrice</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">GasPrice</span></span><span>
</span><span id="line-564"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="mockGasLimit"><span class="annot"><span class="annottext">MockTx -&gt; GasLimit
</span><a href="Chainweb.Mempool.Mempool.html#mockGasLimit"><span class="hs-identifier hs-var hs-var">mockGasLimit</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">GasLimit</span></span><span>
</span><span id="line-565"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="mockMeta"><span class="annot"><span class="annottext">MockTx -&gt; TransactionMetadata
</span><a href="Chainweb.Mempool.Mempool.html#mockMeta"><span class="hs-identifier hs-var hs-var">mockMeta</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#TransactionMetadata"><span class="hs-identifier hs-type">TransactionMetadata</span></a></span><span>
</span><span id="line-566"></span><span>  </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681483086"><span id="local-6989586621681483088"><span class="annot"><span class="annottext">MockTx -&gt; MockTx -&gt; Bool
(MockTx -&gt; MockTx -&gt; Bool)
-&gt; (MockTx -&gt; MockTx -&gt; Bool) -&gt; Eq MockTx
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: MockTx -&gt; MockTx -&gt; Bool
$c/= :: MockTx -&gt; MockTx -&gt; Bool
== :: MockTx -&gt; MockTx -&gt; Bool
$c== :: MockTx -&gt; MockTx -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681483071"><span id="local-6989586621681483073"><span id="local-6989586621681483075"><span id="local-6989586621681483077"><span id="local-6989586621681483079"><span id="local-6989586621681483081"><span id="local-6989586621681483083"><span class="annot"><span class="annottext">Eq MockTx
Eq MockTx =&gt;
(MockTx -&gt; MockTx -&gt; Ordering)
-&gt; (MockTx -&gt; MockTx -&gt; Bool)
-&gt; (MockTx -&gt; MockTx -&gt; Bool)
-&gt; (MockTx -&gt; MockTx -&gt; Bool)
-&gt; (MockTx -&gt; MockTx -&gt; Bool)
-&gt; (MockTx -&gt; MockTx -&gt; MockTx)
-&gt; (MockTx -&gt; MockTx -&gt; MockTx)
-&gt; Ord MockTx
MockTx -&gt; MockTx -&gt; Bool
MockTx -&gt; MockTx -&gt; Ordering
MockTx -&gt; MockTx -&gt; MockTx
forall a.
Eq a =&gt;
(a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
min :: MockTx -&gt; MockTx -&gt; MockTx
$cmin :: MockTx -&gt; MockTx -&gt; MockTx
max :: MockTx -&gt; MockTx -&gt; MockTx
$cmax :: MockTx -&gt; MockTx -&gt; MockTx
&gt;= :: MockTx -&gt; MockTx -&gt; Bool
$c&gt;= :: MockTx -&gt; MockTx -&gt; Bool
&gt; :: MockTx -&gt; MockTx -&gt; Bool
$c&gt; :: MockTx -&gt; MockTx -&gt; Bool
&lt;= :: MockTx -&gt; MockTx -&gt; Bool
$c&lt;= :: MockTx -&gt; MockTx -&gt; Bool
&lt; :: MockTx -&gt; MockTx -&gt; Bool
$c&lt; :: MockTx -&gt; MockTx -&gt; Bool
compare :: MockTx -&gt; MockTx -&gt; Ordering
$ccompare :: MockTx -&gt; MockTx -&gt; Ordering
$cp1Ord :: Eq MockTx
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681483065"><span id="local-6989586621681483067"><span id="local-6989586621681483069"><span class="annot"><span class="annottext">Int -&gt; MockTx -&gt; ShowS
[MockTx] -&gt; ShowS
MockTx -&gt; String
(Int -&gt; MockTx -&gt; ShowS)
-&gt; (MockTx -&gt; String) -&gt; ([MockTx] -&gt; ShowS) -&gt; Show MockTx
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [MockTx] -&gt; ShowS
$cshowList :: [MockTx] -&gt; ShowS
show :: MockTx -&gt; String
$cshow :: MockTx -&gt; String
showsPrec :: Int -&gt; MockTx -&gt; ShowS
$cshowsPrec :: Int -&gt; MockTx -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(forall x. MockTx -&gt; Rep MockTx x)
-&gt; (forall x. Rep MockTx x -&gt; MockTx) -&gt; Generic MockTx
forall x. Rep MockTx x -&gt; MockTx
forall x. MockTx -&gt; Rep MockTx x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep MockTx x -&gt; MockTx
$cfrom :: forall x. MockTx -&gt; Rep MockTx x
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></span><span class="hs-special">)</span><span>
</span><span id="line-567"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">anyclass</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681483059"><span id="local-6989586621681483061"><span class="annot"><span class="annottext">Value -&gt; Parser [MockTx]
Value -&gt; Parser MockTx
(Value -&gt; Parser MockTx)
-&gt; (Value -&gt; Parser [MockTx]) -&gt; FromJSON MockTx
forall a.
(Value -&gt; Parser a) -&gt; (Value -&gt; Parser [a]) -&gt; FromJSON a
parseJSONList :: Value -&gt; Parser [MockTx]
$cparseJSONList :: Value -&gt; Parser [MockTx]
parseJSON :: Value -&gt; Parser MockTx
$cparseJSON :: Value -&gt; Parser MockTx
</span><a href="#local-6989586621681483059"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">FromJSON</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681483051"><span id="local-6989586621681483053"><span id="local-6989586621681483055"><span id="local-6989586621681483057"><span class="annot"><span class="annottext">[MockTx] -&gt; Encoding
[MockTx] -&gt; Value
MockTx -&gt; Encoding
MockTx -&gt; Value
(MockTx -&gt; Value)
-&gt; (MockTx -&gt; Encoding)
-&gt; ([MockTx] -&gt; Value)
-&gt; ([MockTx] -&gt; Encoding)
-&gt; ToJSON MockTx
forall a.
(a -&gt; Value)
-&gt; (a -&gt; Encoding)
-&gt; ([a] -&gt; Value)
-&gt; ([a] -&gt; Encoding)
-&gt; ToJSON a
toEncodingList :: [MockTx] -&gt; Encoding
$ctoEncodingList :: [MockTx] -&gt; Encoding
toJSONList :: [MockTx] -&gt; Value
$ctoJSONList :: [MockTx] -&gt; Value
toEncoding :: MockTx -&gt; Encoding
$ctoEncoding :: MockTx -&gt; Encoding
toJSON :: MockTx -&gt; Value
$ctoJSON :: MockTx -&gt; Value
</span><a href="#local-6989586621681483051"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">ToJSON</span></a></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681483049"><span class="annot"><span class="annottext">MockTx -&gt; ()
(MockTx -&gt; ()) -&gt; NFData MockTx
forall a. (a -&gt; ()) -&gt; NFData a
rnf :: MockTx -&gt; ()
$crnf :: MockTx -&gt; ()
</span><a href="#local-6989586621681483049"><span class="hs-identifier hs-var hs-var hs-var hs-var">NFData</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-568"></span><span>
</span><span id="line-569"></span><span>
</span><span id="line-570"></span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#mockBlockGasLimit"><span class="hs-identifier hs-type">mockBlockGasLimit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">GasLimit</span></span><span>
</span><span id="line-571"></span><span id="mockBlockGasLimit"><span class="annot"><span class="annottext">mockBlockGasLimit :: GasLimit
</span><a href="Chainweb.Mempool.Mempool.html#mockBlockGasLimit"><span class="hs-identifier hs-var hs-var">mockBlockGasLimit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-number">65535</span></span><span>
</span><span id="line-572"></span><span>
</span><span id="line-573"></span><span>
</span><span id="line-574"></span><span class="hs-comment">-- | A codec for transactions when sending them over the wire.</span><span>
</span><span id="line-575"></span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#mockCodec"><span class="hs-identifier hs-type">mockCodec</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Chainweb.Utils.html#Codec"><span class="hs-identifier hs-type">Codec</span></a></span><span> </span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#MockTx"><span class="hs-identifier hs-type">MockTx</span></a></span><span>
</span><span id="line-576"></span><span id="mockCodec"><span class="annot"><span class="annottext">mockCodec :: Codec MockTx
</span><a href="Chainweb.Mempool.Mempool.html#mockCodec"><span class="hs-identifier hs-var hs-var">mockCodec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(MockTx -&gt; ByteString)
-&gt; (ByteString -&gt; Either String MockTx) -&gt; Codec MockTx
forall t.
(t -&gt; ByteString) -&gt; (ByteString -&gt; Either String t) -&gt; Codec t
</span><a href="Chainweb.Utils.html#Codec"><span class="hs-identifier hs-var">Codec</span></a></span><span> </span><span class="annot"><span class="annottext">MockTx -&gt; ByteString
</span><a href="Chainweb.Mempool.Mempool.html#mockEncode"><span class="hs-identifier hs-var">mockEncode</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Either String MockTx
</span><a href="Chainweb.Mempool.Mempool.html#mockDecode"><span class="hs-identifier hs-var">mockDecode</span></a></span><span>
</span><span id="line-577"></span><span>
</span><span id="line-578"></span><span>
</span><span id="line-579"></span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#mockEncode"><span class="hs-identifier hs-type">mockEncode</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#MockTx"><span class="hs-identifier hs-type">MockTx</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span>
</span><span id="line-580"></span><span id="mockEncode"><span class="annot"><span class="annottext">mockEncode :: MockTx -&gt; ByteString
</span><a href="Chainweb.Mempool.Mempool.html#mockEncode"><span class="hs-identifier hs-var hs-var">mockEncode</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#MockTx"><span class="hs-identifier hs-type">MockTx</span></a></span><span> </span><span id="local-6989586621681483047"><span class="annot"><span class="annottext">nonce :: Int64
</span><a href="#local-6989586621681483047"><span class="hs-identifier hs-var">nonce</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">GasPrice</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ParsedDecimal</span></span><span> </span><span id="local-6989586621681483044"><span class="annot"><span class="annottext">price :: Decimal
</span><a href="#local-6989586621681483044"><span class="hs-identifier hs-var">price</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621681483043"><span class="annot"><span class="annottext">limit :: GasLimit
</span><a href="#local-6989586621681483043"><span class="hs-identifier hs-var">limit</span></a></span></span><span> </span><span id="local-6989586621681483042"><span class="annot"><span class="annottext">meta :: TransactionMetadata
</span><a href="#local-6989586621681483042"><span class="hs-identifier hs-var">meta</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-581"></span><span>  </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString
</span><span class="hs-identifier hs-var">B64.encode</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; ByteString) -&gt; ByteString -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-582"></span><span>  </span><span class="annot"><span class="annottext">Put -&gt; ByteString
</span><span class="hs-identifier hs-var">runPutS</span></span><span> </span><span class="annot"><span class="annottext">(Put -&gt; ByteString) -&gt; Put -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-583"></span><span>    </span><span class="annot"><span class="annottext">Word64 -&gt; Put
forall (m :: * -&gt; *). MonadPut m =&gt; Word64 -&gt; m ()
</span><span class="hs-identifier hs-var">putWord64le</span></span><span> </span><span class="annot"><span class="annottext">(Word64 -&gt; Put) -&gt; Word64 -&gt; Put
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int64 -&gt; Word64
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621681483047"><span class="hs-identifier hs-var">nonce</span></a></span><span>
</span><span id="line-584"></span><span>    </span><span class="annot"><span class="annottext">Decimal -&gt; Put
forall (m :: * -&gt; *). MonadPut m =&gt; Decimal -&gt; m ()
</span><a href="Chainweb.Mempool.Mempool.html#putDecimal"><span class="hs-identifier hs-var">putDecimal</span></a></span><span> </span><span class="annot"><span class="annottext">Decimal
</span><a href="#local-6989586621681483044"><span class="hs-identifier hs-var">price</span></a></span><span>
</span><span id="line-585"></span><span>    </span><span class="annot"><span class="annottext">Word64 -&gt; Put
forall (m :: * -&gt; *). MonadPut m =&gt; Word64 -&gt; m ()
</span><span class="hs-identifier hs-var">putWord64le</span></span><span> </span><span class="annot"><span class="annottext">(Word64 -&gt; Put) -&gt; Word64 -&gt; Put
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">GasLimit -&gt; Word64
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">GasLimit
</span><a href="#local-6989586621681483043"><span class="hs-identifier hs-var">limit</span></a></span><span>
</span><span id="line-586"></span><span>    </span><span class="annot"><span class="annottext">Time Micros -&gt; Put
forall (m :: * -&gt; *). MonadPut m =&gt; Time Micros -&gt; m ()
</span><a href="Chainweb.Time.html#encodeTime"><span class="hs-identifier hs-var">Time.encodeTime</span></a></span><span> </span><span class="annot"><span class="annottext">(Time Micros -&gt; Put) -&gt; Time Micros -&gt; Put
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TransactionMetadata -&gt; Time Micros
</span><a href="Chainweb.Mempool.Mempool.html#txMetaCreationTime"><span class="hs-identifier hs-var hs-var">txMetaCreationTime</span></a></span><span> </span><span class="annot"><span class="annottext">TransactionMetadata
</span><a href="#local-6989586621681483042"><span class="hs-identifier hs-var">meta</span></a></span><span>
</span><span id="line-587"></span><span>    </span><span class="annot"><span class="annottext">Time Micros -&gt; Put
forall (m :: * -&gt; *). MonadPut m =&gt; Time Micros -&gt; m ()
</span><a href="Chainweb.Time.html#encodeTime"><span class="hs-identifier hs-var">Time.encodeTime</span></a></span><span> </span><span class="annot"><span class="annottext">(Time Micros -&gt; Put) -&gt; Time Micros -&gt; Put
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TransactionMetadata -&gt; Time Micros
</span><a href="Chainweb.Mempool.Mempool.html#txMetaExpiryTime"><span class="hs-identifier hs-var hs-var">txMetaExpiryTime</span></a></span><span> </span><span class="annot"><span class="annottext">TransactionMetadata
</span><a href="#local-6989586621681483042"><span class="hs-identifier hs-var">meta</span></a></span><span>
</span><span id="line-588"></span><span>
</span><span id="line-589"></span><span>
</span><span id="line-590"></span><span id="local-6989586621681483604"><span class="annot"><a href="Chainweb.Mempool.Mempool.html#putDecimal"><span class="hs-identifier hs-type">putDecimal</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadPut</span></span><span> </span><span class="annot"><a href="#local-6989586621681483604"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Decimal</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681483604"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-591"></span><span id="putDecimal"><span class="annot"><span class="annottext">putDecimal :: Decimal -&gt; m ()
</span><a href="Chainweb.Mempool.Mempool.html#putDecimal"><span class="hs-identifier hs-var hs-var">putDecimal</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Decimal</span></span><span> </span><span id="local-6989586621681483035"><span class="annot"><span class="annottext">places :: Word8
</span><a href="#local-6989586621681483035"><span class="hs-identifier hs-var">places</span></a></span></span><span> </span><span id="local-6989586621681483034"><span class="annot"><span class="annottext">mantissa :: Integer
</span><a href="#local-6989586621681483034"><span class="hs-identifier hs-var">mantissa</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-592"></span><span>    </span><span class="annot"><span class="annottext">Word8 -&gt; m ()
forall (m :: * -&gt; *). MonadPut m =&gt; Word8 -&gt; m ()
</span><span class="hs-identifier hs-var">putWord8</span></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621681483035"><span class="hs-identifier hs-var">places</span></a></span><span>
</span><span id="line-593"></span><span>    </span><span class="annot"><span class="annottext">Word8 -&gt; m ()
forall (m :: * -&gt; *). MonadPut m =&gt; Word8 -&gt; m ()
</span><span class="hs-identifier hs-var">putWord8</span></span><span> </span><span class="annot"><span class="annottext">(Word8 -&gt; m ()) -&gt; Word8 -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621681483034"><span class="hs-identifier hs-var">mantissa</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="hs-number">1</span></span><span>
</span><span id="line-594"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681483032"><span class="annot"><span class="annottext">ws :: [Word64]
</span><a href="#local-6989586621681483032"><span class="hs-identifier hs-var hs-var">ws</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; [Word64]
</span><a href="#local-6989586621681483031"><span class="hs-identifier hs-var">toWordList</span></a></span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; [Word64]) -&gt; Integer -&gt; [Word64]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621681483034"><span class="hs-identifier hs-var">mantissa</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621681483034"><span class="hs-identifier hs-var">mantissa</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621681483034"><span class="hs-identifier hs-var">mantissa</span></a></span><span>
</span><span id="line-595"></span><span>    </span><span class="annot"><span class="annottext">Word16 -&gt; m ()
forall (m :: * -&gt; *). MonadPut m =&gt; Word16 -&gt; m ()
</span><span class="hs-identifier hs-var">putWord16le</span></span><span> </span><span class="annot"><span class="annottext">(Word16 -&gt; m ()) -&gt; Word16 -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Word16
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Word16) -&gt; Int -&gt; Word16
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Word64] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[Word64]
</span><a href="#local-6989586621681483032"><span class="hs-identifier hs-var">ws</span></a></span><span>
</span><span id="line-596"></span><span>    </span><span class="annot"><span class="annottext">(Word64 -&gt; m ()) -&gt; [Word64] -&gt; m ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; m ()
forall (m :: * -&gt; *). MonadPut m =&gt; Word64 -&gt; m ()
</span><span class="hs-identifier hs-var">putWord64le</span></span><span> </span><span class="annot"><span class="annottext">[Word64]
</span><a href="#local-6989586621681483032"><span class="hs-identifier hs-var">ws</span></a></span><span>
</span><span id="line-597"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-598"></span><span>    </span><span id="local-6989586621681483031"><span class="annot"><span class="annottext">toWordList :: Integer -&gt; [Word64]
</span><a href="#local-6989586621681483031"><span class="hs-identifier hs-var hs-var">toWordList</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; Maybe (Word64, Integer)) -&gt; Integer -&gt; [Word64]
forall b a. (b -&gt; Maybe (a, b)) -&gt; b -&gt; [a]
</span><span class="hs-identifier hs-var">unfoldr</span></span><span> </span><span class="annot"><span class="annottext">((Integer -&gt; Maybe (Word64, Integer)) -&gt; Integer -&gt; [Word64])
-&gt; (Integer -&gt; Maybe (Word64, Integer)) -&gt; Integer -&gt; [Word64]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-599"></span><span>                 </span><span class="hs-glyph">\</span><span id="local-6989586621681483027"><span class="annot"><span class="annottext">d :: Integer
</span><a href="#local-6989586621681483027"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621681483027"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span>
</span><span id="line-600"></span><span>                         </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Maybe (Word64, Integer)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-601"></span><span>                         </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621681483026"><span class="annot"><span class="annottext">a :: Word64
</span><a href="#local-6989586621681483026"><span class="hs-identifier hs-var hs-var">a</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Word64
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621681483027"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.&amp;.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Integer
forall a. Bits a =&gt; Int -&gt; a
</span><span class="hs-identifier hs-var">bit</span></span><span> </span><span class="annot"><span class="hs-number">64</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-602"></span><span>                                  </span><span class="hs-glyph">!</span><span id="local-6989586621681483025"><span class="annot"><span class="annottext">d' :: Integer
</span><a href="#local-6989586621681483025"><span class="hs-identifier hs-var hs-var">d'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621681483027"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Int -&gt; Integer
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">`shiftR`</span></span><span> </span><span class="annot"><span class="hs-number">64</span></span><span>
</span><span id="line-603"></span><span>                              </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(Word64, Integer) -&gt; Maybe (Word64, Integer)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621681483026"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621681483025"><span class="hs-identifier hs-var">d'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-604"></span><span>
</span><span id="line-605"></span><span>
</span><span id="line-606"></span><span id="local-6989586621681483585"><span class="annot"><a href="Chainweb.Mempool.Mempool.html#getDecimal"><span class="hs-identifier hs-type">getDecimal</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadGet</span></span><span> </span><span class="annot"><a href="#local-6989586621681483585"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681483585"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Decimal</span></span></span><span>
</span><span id="line-607"></span><span id="getDecimal"><span class="annot"><span class="annottext">getDecimal :: m Decimal
</span><a href="Chainweb.Mempool.Mempool.html#getDecimal"><span class="hs-identifier hs-var hs-var">getDecimal</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-608"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621681483023"><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621681483023"><span class="hs-identifier hs-var">places</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m Word8
forall (m :: * -&gt; *). MonadGet m =&gt; m Word8
</span><span class="hs-identifier hs-var">getWord8</span></span><span>
</span><span id="line-609"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621681483021"><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621681483021"><span class="hs-identifier hs-var">negative</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m Word8
forall (m :: * -&gt; *). MonadGet m =&gt; m Word8
</span><span class="hs-identifier hs-var">getWord8</span></span><span>
</span><span id="line-610"></span><span>    </span><span id="local-6989586621681483020"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681483020"><span class="hs-identifier hs-var">numWords</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Word16 -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">(Word16 -&gt; Int) -&gt; m Word16 -&gt; m Int
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">m Word16
forall (m :: * -&gt; *). MonadGet m =&gt; m Word16
</span><span class="hs-identifier hs-var">getWord16le</span></span><span>
</span><span id="line-611"></span><span>    </span><span id="local-6989586621681483018"><span class="annot"><span class="annottext">[Word64]
</span><a href="#local-6989586621681483018"><span class="hs-identifier hs-var">mantissaWords</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; m Word64 -&gt; m [Word64]
forall (m :: * -&gt; *) a. Applicative m =&gt; Int -&gt; m a -&gt; m [a]
</span><span class="hs-identifier hs-var">replicateM</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681483020"><span class="hs-identifier hs-var">numWords</span></a></span><span> </span><span class="annot"><span class="annottext">m Word64
forall (m :: * -&gt; *). MonadGet m =&gt; m Word64
</span><span class="hs-identifier hs-var">getWord64le</span></span><span>
</span><span id="line-612"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">!</span><span id="local-6989586621681483016"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621681483016"><span class="hs-identifier hs-var">mantissa</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Integer, Int) -&gt; Word64 -&gt; (Integer, Int))
-&gt; (Integer, Int) -&gt; [Word64] -&gt; (Integer, Int)
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl</span></span><span> </span><span class="annot"><span class="annottext">(Integer, Int) -&gt; Word64 -&gt; (Integer, Int)
</span><a href="#local-6989586621681483014"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Word64]
</span><a href="#local-6989586621681483018"><span class="hs-identifier hs-var">mantissaWords</span></a></span><span>
</span><span id="line-613"></span><span>    </span><span class="annot"><span class="annottext">Decimal -&gt; m Decimal
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Decimal -&gt; m Decimal) -&gt; Decimal -&gt; m Decimal
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Integer -&gt; Decimal
forall i. Word8 -&gt; i -&gt; DecimalRaw i
</span><span class="hs-identifier hs-var">Decimal</span></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621681483023"><span class="hs-identifier hs-var">places</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621681483021"><span class="hs-identifier hs-var">negative</span></a></span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Word8 -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621681483016"><span class="hs-identifier hs-var">mantissa</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621681483016"><span class="hs-identifier hs-var">mantissa</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-614"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-615"></span><span>    </span><span class="annot"><a href="#local-6989586621681483014"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word64</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span>
</span><span id="line-616"></span><span>    </span><span id="local-6989586621681483014"><span class="annot"><span class="annottext">go :: (Integer, Int) -&gt; Word64 -&gt; (Integer, Int)
</span><a href="#local-6989586621681483014"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">!</span><span id="local-6989586621681483013"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621681483013"><span class="hs-identifier hs-var">soFar</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621681483012"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681483012"><span class="hs-identifier hs-var">shiftVal</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621681483011"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621681483011"><span class="hs-identifier hs-var">next</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-617"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621681483010"><span class="annot"><span class="annottext">i :: Integer
</span><a href="#local-6989586621681483010"><span class="hs-identifier hs-var hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Integer
forall a. Integral a =&gt; a -&gt; Integer
</span><span class="hs-identifier hs-var">toInteger</span></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621681483011"><span class="hs-identifier hs-var">next</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621681483013"><span class="hs-identifier hs-var">soFar</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Int -&gt; Integer
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">`shiftL`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681483012"><span class="hs-identifier hs-var">shiftVal</span></a></span><span>
</span><span id="line-618"></span><span>            </span><span class="hs-glyph">!</span><span id="local-6989586621681483009"><span class="annot"><span class="annottext">s :: Int
</span><a href="#local-6989586621681483009"><span class="hs-identifier hs-var hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681483012"><span class="hs-identifier hs-var">shiftVal</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="hs-number">64</span></span><span>
</span><span id="line-619"></span><span>        </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621681483010"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681483009"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-620"></span><span>
</span><span id="line-621"></span><span>
</span><span id="line-622"></span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#mockDecode"><span class="hs-identifier hs-type">mockDecode</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="annot"><a href="Chainweb.Mempool.Mempool.html#MockTx"><span class="hs-identifier hs-type">MockTx</span></a></span><span>
</span><span id="line-623"></span><span id="mockDecode"><span class="annot"><span class="annottext">mockDecode :: ByteString -&gt; Either String MockTx
</span><a href="Chainweb.Mempool.Mempool.html#mockDecode"><span class="hs-identifier hs-var hs-var">mockDecode</span></a></span></span><span> </span><span id="local-6989586621681483008"><span class="annot"><span class="annottext">s :: ByteString
</span><a href="#local-6989586621681483008"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-624"></span><span>    </span><span id="local-6989586621681483007"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621681483007"><span class="hs-identifier hs-var">s'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Either String ByteString
</span><span class="hs-identifier hs-var">B64.decode</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621681483008"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-625"></span><span>    </span><span class="annot"><span class="annottext">Get MockTx -&gt; ByteString -&gt; Either String MockTx
forall a. Get a -&gt; ByteString -&gt; Either String a
</span><span class="hs-identifier hs-var">runGetS</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int64 -&gt; GasPrice -&gt; GasLimit -&gt; TransactionMetadata -&gt; MockTx
</span><a href="Chainweb.Mempool.Mempool.html#MockTx"><span class="hs-identifier hs-var">MockTx</span></a></span><span> </span><span class="annot"><span class="annottext">(Int64 -&gt; GasPrice -&gt; GasLimit -&gt; TransactionMetadata -&gt; MockTx)
-&gt; Get Int64
-&gt; Get (GasPrice -&gt; GasLimit -&gt; TransactionMetadata -&gt; MockTx)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Get Int64
</span><a href="#local-6989586621681483005"><span class="hs-identifier hs-var">getI64</span></a></span><span> </span><span class="annot"><span class="annottext">Get (GasPrice -&gt; GasLimit -&gt; TransactionMetadata -&gt; MockTx)
-&gt; Get GasPrice -&gt; Get (GasLimit -&gt; TransactionMetadata -&gt; MockTx)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Get GasPrice
</span><a href="#local-6989586621681483004"><span class="hs-identifier hs-var">getPrice</span></a></span><span> </span><span class="annot"><span class="annottext">Get (GasLimit -&gt; TransactionMetadata -&gt; MockTx)
-&gt; Get GasLimit -&gt; Get (TransactionMetadata -&gt; MockTx)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Get GasLimit
</span><a href="#local-6989586621681483003"><span class="hs-identifier hs-var">getGL</span></a></span><span> </span><span class="annot"><span class="annottext">Get (TransactionMetadata -&gt; MockTx)
-&gt; Get TransactionMetadata -&gt; Get MockTx
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Get TransactionMetadata
</span><a href="#local-6989586621681483002"><span class="hs-identifier hs-var">getMeta</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621681483007"><span class="hs-identifier hs-var">s'</span></a></span><span>
</span><span id="line-626"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-627"></span><span>    </span><span id="local-6989586621681483004"><span class="annot"><span class="annottext">getPrice :: Get GasPrice
</span><a href="#local-6989586621681483004"><span class="hs-identifier hs-var hs-var">getPrice</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ParsedDecimal -&gt; GasPrice
</span><span class="hs-identifier hs-var">GasPrice</span></span><span> </span><span class="annot"><span class="annottext">(ParsedDecimal -&gt; GasPrice)
-&gt; (Decimal -&gt; ParsedDecimal) -&gt; Decimal -&gt; GasPrice
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Decimal -&gt; ParsedDecimal
</span><span class="hs-identifier hs-var">ParsedDecimal</span></span><span> </span><span class="annot"><span class="annottext">(Decimal -&gt; GasPrice) -&gt; Get Decimal -&gt; Get GasPrice
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Get Decimal
forall (m :: * -&gt; *). MonadGet m =&gt; m Decimal
</span><a href="Chainweb.Mempool.Mempool.html#getDecimal"><span class="hs-identifier hs-var">getDecimal</span></a></span><span>
</span><span id="line-628"></span><span>    </span><span id="local-6989586621681483003"><span class="annot"><span class="annottext">getGL :: Get GasLimit
</span><a href="#local-6989586621681483003"><span class="hs-identifier hs-var hs-var">getGL</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ParsedInteger -&gt; GasLimit
</span><span class="hs-identifier hs-var">GasLimit</span></span><span> </span><span class="annot"><span class="annottext">(ParsedInteger -&gt; GasLimit)
-&gt; (Word64 -&gt; ParsedInteger) -&gt; Word64 -&gt; GasLimit
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; ParsedInteger
</span><span class="hs-identifier hs-var">ParsedInteger</span></span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; ParsedInteger)
-&gt; (Word64 -&gt; Integer) -&gt; Word64 -&gt; ParsedInteger
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Integer
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">(Word64 -&gt; GasLimit) -&gt; Get Word64 -&gt; Get GasLimit
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Get Word64
forall (m :: * -&gt; *). MonadGet m =&gt; m Word64
</span><span class="hs-identifier hs-var">getWord64le</span></span><span>
</span><span id="line-629"></span><span>    </span><span id="local-6989586621681483005"><span class="annot"><span class="annottext">getI64 :: Get Int64
</span><a href="#local-6989586621681483005"><span class="hs-identifier hs-var hs-var">getI64</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Int64
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">(Word64 -&gt; Int64) -&gt; Get Word64 -&gt; Get Int64
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Get Word64
forall (m :: * -&gt; *). MonadGet m =&gt; m Word64
</span><span class="hs-identifier hs-var">getWord64le</span></span><span>
</span><span id="line-630"></span><span>    </span><span id="local-6989586621681483002"><span class="annot"><span class="annottext">getMeta :: Get TransactionMetadata
</span><a href="#local-6989586621681483002"><span class="hs-identifier hs-var hs-var">getMeta</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Time Micros -&gt; Time Micros -&gt; TransactionMetadata
</span><a href="Chainweb.Mempool.Mempool.html#TransactionMetadata"><span class="hs-identifier hs-var">TransactionMetadata</span></a></span><span> </span><span class="annot"><span class="annottext">(Time Micros -&gt; Time Micros -&gt; TransactionMetadata)
-&gt; Get (Time Micros) -&gt; Get (Time Micros -&gt; TransactionMetadata)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Get (Time Micros)
forall (m :: * -&gt; *). MonadGet m =&gt; m (Time Micros)
</span><a href="Chainweb.Time.html#decodeTime"><span class="hs-identifier hs-var">Time.decodeTime</span></a></span><span> </span><span class="annot"><span class="annottext">Get (Time Micros -&gt; TransactionMetadata)
-&gt; Get (Time Micros) -&gt; Get TransactionMetadata
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Get (Time Micros)
forall (m :: * -&gt; *). MonadGet m =&gt; m (Time Micros)
</span><a href="Chainweb.Time.html#decodeTime"><span class="hs-identifier hs-var">Time.decodeTime</span></a></span><span>
</span><span id="line-631"></span></pre></body></html>