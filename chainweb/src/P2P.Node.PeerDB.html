<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE DataKinds #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE DeriveAnyClass #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE DeriveGeneric #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE DerivingStrategies #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE ExistentialQuantification #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE FlexibleInstances #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE GeneralizedNewtypeDeriving #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE MultiParamTypeClasses #-}</span><span>
</span><span id="line-10"></span><span class="hs-pragma">{-# LANGUAGE MultiWayIf #-}</span><span>
</span><span id="line-11"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-12"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-13"></span><span class="hs-pragma">{-# LANGUAGE TemplateHaskell #-}</span><span>
</span><span id="line-14"></span><span class="hs-pragma">{-# LANGUAGE TypeApplications #-}</span><span>
</span><span id="line-15"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies #-}</span><span>
</span><span id="line-16"></span><span>
</span><span id="line-17"></span><span class="hs-comment">-- |</span><span>
</span><span id="line-18"></span><span class="hs-comment">-- Module: P2P.Node.PeerDB</span><span>
</span><span id="line-19"></span><span class="hs-comment">-- Copyright: Copyright &#169; 2018 Kadena LLC.</span><span>
</span><span id="line-20"></span><span class="hs-comment">-- License: MIT</span><span>
</span><span id="line-21"></span><span class="hs-comment">-- Maintainer: Lars Kuhtz &lt;lars@kadena.io&gt;</span><span>
</span><span id="line-22"></span><span class="hs-comment">-- Stability: experimental</span><span>
</span><span id="line-23"></span><span class="hs-comment">--</span><span>
</span><span id="line-24"></span><span class="hs-comment">-- TODO</span><span>
</span><span id="line-25"></span><span class="hs-comment">--</span><span>
</span><span id="line-26"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">P2P.Node.PeerDB</span><span>
</span><span id="line-27"></span><span class="hs-special">(</span><span>
</span><span id="line-28"></span><span class="annot"><span class="hs-comment">-- * Index Values</span></span><span>
</span><span id="line-29"></span><span>  </span><span class="annot"><a href="P2P.Node.PeerDB.html#LastSuccess"><span class="hs-identifier">LastSuccess</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-30"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="P2P.Node.PeerDB.html#SuccessiveFailures"><span class="hs-identifier">SuccessiveFailures</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="P2P.Node.PeerDB.html#AddedTime"><span class="hs-identifier">AddedTime</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="P2P.Node.PeerDB.html#ActiveSessionCount"><span class="hs-identifier">ActiveSessionCount</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-33"></span><span>
</span><span id="line-34"></span><span class="annot"><span class="hs-comment">-- * Peer Entry</span></span><span>
</span><span id="line-35"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="P2P.Node.PeerDB.html#PeerEntry"><span class="hs-identifier">PeerEntry</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-36"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="P2P.Node.PeerDB.html#peerEntryInfo"><span class="hs-identifier">peerEntryInfo</span></a></span><span>
</span><span id="line-37"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="P2P.Node.PeerDB.html#peerEntrySuccessiveFailures"><span class="hs-identifier">peerEntrySuccessiveFailures</span></a></span><span>
</span><span id="line-38"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="P2P.Node.PeerDB.html#peerEntryLastSuccess"><span class="hs-identifier">peerEntryLastSuccess</span></a></span><span>
</span><span id="line-39"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="P2P.Node.PeerDB.html#peerEntryNetworkIds"><span class="hs-identifier">peerEntryNetworkIds</span></a></span><span>
</span><span id="line-40"></span><span>
</span><span id="line-41"></span><span class="annot"><span class="hs-comment">-- * Peer Database</span></span><span>
</span><span id="line-42"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="P2P.Node.PeerDB.html#PeerDb"><span class="hs-identifier">PeerDb</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-43"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="P2P.Node.PeerDB.html#peerDbSnapshot"><span class="hs-identifier">peerDbSnapshot</span></a></span><span>
</span><span id="line-44"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="P2P.Node.PeerDB.html#peerDbSnapshotSTM"><span class="hs-identifier">peerDbSnapshotSTM</span></a></span><span>
</span><span id="line-45"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="P2P.Node.PeerDB.html#peerDbSize"><span class="hs-identifier">peerDbSize</span></a></span><span>
</span><span id="line-46"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="P2P.Node.PeerDB.html#peerDbSizeSTM"><span class="hs-identifier">peerDbSizeSTM</span></a></span><span>
</span><span id="line-47"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="P2P.Node.PeerDB.html#peerDbInsert"><span class="hs-identifier">peerDbInsert</span></a></span><span>
</span><span id="line-48"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="P2P.Node.PeerDB.html#peerDbInsertList"><span class="hs-identifier">peerDbInsertList</span></a></span><span>
</span><span id="line-49"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="P2P.Node.PeerDB.html#peerDbInsertPeerInfoList"><span class="hs-identifier">peerDbInsertPeerInfoList</span></a></span><span>
</span><span id="line-50"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="P2P.Node.PeerDB.html#peerDbInsertSet"><span class="hs-identifier">peerDbInsertSet</span></a></span><span>
</span><span id="line-51"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="P2P.Node.PeerDB.html#peerDbDelete"><span class="hs-identifier">peerDbDelete</span></a></span><span>
</span><span id="line-52"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="P2P.Node.PeerDB.html#newEmptyPeerDb"><span class="hs-identifier">newEmptyPeerDb</span></a></span><span>
</span><span id="line-53"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="P2P.Node.PeerDB.html#fromPeerEntryList"><span class="hs-identifier">fromPeerEntryList</span></a></span><span>
</span><span id="line-54"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="P2P.Node.PeerDB.html#fromPeerInfoList"><span class="hs-identifier">fromPeerInfoList</span></a></span><span>
</span><span id="line-55"></span><span>
</span><span id="line-56"></span><span class="annot"><span class="hs-comment">-- * Update PeerDb Entries</span></span><span>
</span><span id="line-57"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="P2P.Node.PeerDB.html#updateLastSuccess"><span class="hs-identifier">updateLastSuccess</span></a></span><span>
</span><span id="line-58"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="P2P.Node.PeerDB.html#resetSuccessiveFailures"><span class="hs-identifier">resetSuccessiveFailures</span></a></span><span>
</span><span id="line-59"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="P2P.Node.PeerDB.html#incrementSuccessiveFailures"><span class="hs-identifier">incrementSuccessiveFailures</span></a></span><span>
</span><span id="line-60"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="P2P.Node.PeerDB.html#incrementActiveSessionCount"><span class="hs-identifier">incrementActiveSessionCount</span></a></span><span>
</span><span id="line-61"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="P2P.Node.PeerDB.html#decrementActiveSessionCount"><span class="hs-identifier">decrementActiveSessionCount</span></a></span><span>
</span><span id="line-62"></span><span>
</span><span id="line-63"></span><span class="annot"><span class="hs-comment">-- * Persistence</span></span><span>
</span><span id="line-64"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="P2P.Node.PeerDB.html#storePeerDb"><span class="hs-identifier">storePeerDb</span></a></span><span>
</span><span id="line-65"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="P2P.Node.PeerDB.html#loadPeerDb"><span class="hs-identifier">loadPeerDb</span></a></span><span>
</span><span id="line-66"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="P2P.Node.PeerDB.html#loadIntoPeerDb"><span class="hs-identifier">loadIntoPeerDb</span></a></span><span>
</span><span id="line-67"></span><span>
</span><span id="line-68"></span><span class="annot"><span class="hs-comment">-- * Some PeerDb</span></span><span>
</span><span id="line-69"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="P2P.Node.PeerDB.html#PeerDbT"><span class="hs-identifier">PeerDbT</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-70"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="P2P.Node.PeerDB.html#SomePeerDb"><span class="hs-identifier">SomePeerDb</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-71"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="P2P.Node.PeerDB.html#somePeerDbVal"><span class="hs-identifier">somePeerDbVal</span></a></span><span>
</span><span id="line-72"></span><span>
</span><span id="line-73"></span><span class="annot"><span class="hs-comment">-- * properties</span></span><span>
</span><span id="line-74"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="P2P.Node.PeerDB.html#properties"><span class="hs-identifier">properties</span></a></span><span>
</span><span id="line-75"></span><span>
</span><span id="line-76"></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-77"></span><span>
</span><span id="line-78"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Concurrent.MVar</span></span><span>
</span><span id="line-79"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Concurrent.STM.TVar</span></span><span>
</span><span id="line-80"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.DeepSeq</span></span><span>
</span><span id="line-81"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Lens</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Indexable</span></span><span class="hs-special">)</span><span>
</span><span id="line-82"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">(&lt;$!&gt;)</span></span><span class="hs-special">)</span><span>
</span><span id="line-83"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.STM</span></span><span>
</span><span id="line-84"></span><span>
</span><span id="line-85"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Aeson</span></span><span>
</span><span id="line-86"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Lazy</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BL</span></span><span>
</span><span id="line-87"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Foldable</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">foldl'</span></span><span class="hs-special">)</span><span>
</span><span id="line-88"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Foldable</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">F</span></span><span>
</span><span id="line-89"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.IxSet.Typed</span></span><span>
</span><span id="line-90"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">S</span></span><span>
</span><span id="line-91"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Time.Clock</span></span><span>
</span><span id="line-92"></span><span>
</span><span id="line-93"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Generics</span></span><span>
</span><span id="line-94"></span><span>
</span><span id="line-95"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Numeric.Natural</span></span><span>
</span><span id="line-96"></span><span>
</span><span id="line-97"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Prelude</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">null</span></span><span class="hs-special">)</span><span>
</span><span id="line-98"></span><span>
</span><span id="line-99"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.IO.SafeWrite</span></span><span>
</span><span id="line-100"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.IO.Temp</span></span><span>
</span><span id="line-101"></span><span>
</span><span id="line-102"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Test.QuickCheck</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Arbitrary</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Property</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">ioProperty</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">property</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(===)</span></span><span class="hs-special">)</span><span>
</span><span id="line-103"></span><span>
</span><span id="line-104"></span><span class="hs-comment">-- internal modules</span><span>
</span><span id="line-105"></span><span>
</span><span id="line-106"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Chainweb.ChainId.html"><span class="hs-identifier">Chainweb.ChainId</span></a></span><span>
</span><span id="line-107"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Chainweb.HostAddress.html"><span class="hs-identifier">Chainweb.HostAddress</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.HostAddress.html#properties"><span class="hs-identifier">properties</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-108"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Chainweb.RestAPI.NetworkID.html"><span class="hs-identifier">Chainweb.RestAPI.NetworkID</span></a></span><span>
</span><span id="line-109"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Chainweb.Utils.html"><span class="hs-identifier">Chainweb.Utils</span></a></span><span>
</span><span id="line-110"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Chainweb.Version.html"><span class="hs-identifier">Chainweb.Version</span></a></span><span>
</span><span id="line-111"></span><span>
</span><span id="line-112"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Data.Singletons.html"><span class="hs-identifier">Data.Singletons</span></a></span><span>
</span><span id="line-113"></span><span>
</span><span id="line-114"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="P2P.Peer.html"><span class="hs-identifier">P2P.Peer</span></a></span><span>
</span><span id="line-115"></span><span>
</span><span id="line-116"></span><span class="hs-comment">-- -------------------------------------------------------------------------- --</span><span>
</span><span id="line-117"></span><span class="hs-comment">-- Peer Database Entry</span><span>
</span><span id="line-118"></span><span>
</span><span id="line-119"></span><span id="local-6989586621681493954"><span id="local-6989586621681493955"></span></span><span class="hs-keyword">newtype</span><span> </span><span id="LastSuccess"><span class="annot"><a href="P2P.Node.PeerDB.html#LastSuccess"><span class="hs-identifier hs-var">LastSuccess</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="LastSuccess"><span class="annot"><a href="P2P.Node.PeerDB.html#LastSuccess"><span class="hs-identifier hs-var">LastSuccess</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="_getLastSuccess"><span class="annot"><span class="annottext">LastSuccess -&gt; Maybe UTCTime
</span><a href="P2P.Node.PeerDB.html#_getLastSuccess"><span class="hs-identifier hs-var hs-var">_getLastSuccess</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">UTCTime</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-120"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681493946"><span id="local-6989586621681493948"><span id="local-6989586621681493950"><span class="annot"><span class="annottext">Int -&gt; LastSuccess -&gt; ShowS
[LastSuccess] -&gt; ShowS
LastSuccess -&gt; String
(Int -&gt; LastSuccess -&gt; ShowS)
-&gt; (LastSuccess -&gt; String)
-&gt; ([LastSuccess] -&gt; ShowS)
-&gt; Show LastSuccess
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [LastSuccess] -&gt; ShowS
$cshowList :: [LastSuccess] -&gt; ShowS
show :: LastSuccess -&gt; String
$cshow :: LastSuccess -&gt; String
showsPrec :: Int -&gt; LastSuccess -&gt; ShowS
$cshowsPrec :: Int -&gt; LastSuccess -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681493941"><span id="local-6989586621681493943"><span class="annot"><span class="annottext">LastSuccess -&gt; LastSuccess -&gt; Bool
(LastSuccess -&gt; LastSuccess -&gt; Bool)
-&gt; (LastSuccess -&gt; LastSuccess -&gt; Bool) -&gt; Eq LastSuccess
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: LastSuccess -&gt; LastSuccess -&gt; Bool
$c/= :: LastSuccess -&gt; LastSuccess -&gt; Bool
== :: LastSuccess -&gt; LastSuccess -&gt; Bool
$c== :: LastSuccess -&gt; LastSuccess -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681493925"><span id="local-6989586621681493927"><span id="local-6989586621681493929"><span id="local-6989586621681493931"><span id="local-6989586621681493933"><span id="local-6989586621681493935"><span id="local-6989586621681493937"><span class="annot"><span class="annottext">Eq LastSuccess
Eq LastSuccess =&gt;
(LastSuccess -&gt; LastSuccess -&gt; Ordering)
-&gt; (LastSuccess -&gt; LastSuccess -&gt; Bool)
-&gt; (LastSuccess -&gt; LastSuccess -&gt; Bool)
-&gt; (LastSuccess -&gt; LastSuccess -&gt; Bool)
-&gt; (LastSuccess -&gt; LastSuccess -&gt; Bool)
-&gt; (LastSuccess -&gt; LastSuccess -&gt; LastSuccess)
-&gt; (LastSuccess -&gt; LastSuccess -&gt; LastSuccess)
-&gt; Ord LastSuccess
LastSuccess -&gt; LastSuccess -&gt; Bool
LastSuccess -&gt; LastSuccess -&gt; Ordering
LastSuccess -&gt; LastSuccess -&gt; LastSuccess
forall a.
Eq a =&gt;
(a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
min :: LastSuccess -&gt; LastSuccess -&gt; LastSuccess
$cmin :: LastSuccess -&gt; LastSuccess -&gt; LastSuccess
max :: LastSuccess -&gt; LastSuccess -&gt; LastSuccess
$cmax :: LastSuccess -&gt; LastSuccess -&gt; LastSuccess
&gt;= :: LastSuccess -&gt; LastSuccess -&gt; Bool
$c&gt;= :: LastSuccess -&gt; LastSuccess -&gt; Bool
&gt; :: LastSuccess -&gt; LastSuccess -&gt; Bool
$c&gt; :: LastSuccess -&gt; LastSuccess -&gt; Bool
&lt;= :: LastSuccess -&gt; LastSuccess -&gt; Bool
$c&lt;= :: LastSuccess -&gt; LastSuccess -&gt; Bool
&lt; :: LastSuccess -&gt; LastSuccess -&gt; Bool
$c&lt; :: LastSuccess -&gt; LastSuccess -&gt; Bool
compare :: LastSuccess -&gt; LastSuccess -&gt; Ordering
$ccompare :: LastSuccess -&gt; LastSuccess -&gt; Ordering
$cp1Ord :: Eq LastSuccess
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(forall x. LastSuccess -&gt; Rep LastSuccess x)
-&gt; (forall x. Rep LastSuccess x -&gt; LastSuccess)
-&gt; Generic LastSuccess
forall x. Rep LastSuccess x -&gt; LastSuccess
forall x. LastSuccess -&gt; Rep LastSuccess x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep LastSuccess x -&gt; LastSuccess
$cfrom :: forall x. LastSuccess -&gt; Rep LastSuccess x
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></span><span class="hs-special">)</span><span>
</span><span id="line-121"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">newtype</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681493913"><span id="local-6989586621681493915"><span id="local-6989586621681493917"><span id="local-6989586621681493919"><span class="annot"><span class="annottext">[LastSuccess] -&gt; Encoding
[LastSuccess] -&gt; Value
LastSuccess -&gt; Encoding
LastSuccess -&gt; Value
(LastSuccess -&gt; Value)
-&gt; (LastSuccess -&gt; Encoding)
-&gt; ([LastSuccess] -&gt; Value)
-&gt; ([LastSuccess] -&gt; Encoding)
-&gt; ToJSON LastSuccess
forall a.
(a -&gt; Value)
-&gt; (a -&gt; Encoding)
-&gt; ([a] -&gt; Value)
-&gt; ([a] -&gt; Encoding)
-&gt; ToJSON a
toEncodingList :: [LastSuccess] -&gt; Encoding
$ctoEncodingList :: [LastSuccess] -&gt; Encoding
toJSONList :: [LastSuccess] -&gt; Value
$ctoJSONList :: [LastSuccess] -&gt; Value
toEncoding :: LastSuccess -&gt; Encoding
$ctoEncoding :: LastSuccess -&gt; Encoding
toJSON :: LastSuccess -&gt; Value
$ctoJSON :: LastSuccess -&gt; Value
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">ToJSON</span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681493908"><span id="local-6989586621681493910"><span class="annot"><span class="annottext">Value -&gt; Parser [LastSuccess]
Value -&gt; Parser LastSuccess
(Value -&gt; Parser LastSuccess)
-&gt; (Value -&gt; Parser [LastSuccess]) -&gt; FromJSON LastSuccess
forall a.
(Value -&gt; Parser a) -&gt; (Value -&gt; Parser [a]) -&gt; FromJSON a
parseJSONList :: Value -&gt; Parser [LastSuccess]
$cparseJSONList :: Value -&gt; Parser [LastSuccess]
parseJSON :: Value -&gt; Parser LastSuccess
$cparseJSON :: Value -&gt; Parser LastSuccess
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">FromJSON</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681493903"><span id="local-6989586621681493905"><span class="annot"><span class="annottext">Gen LastSuccess
Gen LastSuccess
-&gt; (LastSuccess -&gt; [LastSuccess]) -&gt; Arbitrary LastSuccess
LastSuccess -&gt; [LastSuccess]
forall a. Gen a -&gt; (a -&gt; [a]) -&gt; Arbitrary a
shrink :: LastSuccess -&gt; [LastSuccess]
$cshrink :: LastSuccess -&gt; [LastSuccess]
arbitrary :: Gen LastSuccess
$carbitrary :: Gen LastSuccess
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Arbitrary</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681493900"><span class="annot"><span class="annottext">LastSuccess -&gt; ()
(LastSuccess -&gt; ()) -&gt; NFData LastSuccess
forall a. (a -&gt; ()) -&gt; NFData a
rnf :: LastSuccess -&gt; ()
$crnf :: LastSuccess -&gt; ()
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">NFData</span></span></span><span class="hs-special">)</span><span>
</span><span id="line-122"></span><span>
</span><span id="line-123"></span><span id="local-6989586621681493897"><span id="local-6989586621681493898"></span></span><span class="hs-keyword">newtype</span><span> </span><span id="SuccessiveFailures"><span class="annot"><a href="P2P.Node.PeerDB.html#SuccessiveFailures"><span class="hs-identifier hs-var">SuccessiveFailures</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="SuccessiveFailures"><span class="annot"><a href="P2P.Node.PeerDB.html#SuccessiveFailures"><span class="hs-identifier hs-var">SuccessiveFailures</span></a></span></span><span class="hs-special">{</span><span> </span><span id="_getSuccessiveFailures"><span class="annot"><span class="annottext">SuccessiveFailures -&gt; Natural
</span><a href="P2P.Node.PeerDB.html#_getSuccessiveFailures"><span class="hs-identifier hs-var hs-var">_getSuccessiveFailures</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Natural</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-124"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681493889"><span id="local-6989586621681493891"><span id="local-6989586621681493893"><span class="annot"><span class="annottext">Int -&gt; SuccessiveFailures -&gt; ShowS
[SuccessiveFailures] -&gt; ShowS
SuccessiveFailures -&gt; String
(Int -&gt; SuccessiveFailures -&gt; ShowS)
-&gt; (SuccessiveFailures -&gt; String)
-&gt; ([SuccessiveFailures] -&gt; ShowS)
-&gt; Show SuccessiveFailures
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [SuccessiveFailures] -&gt; ShowS
$cshowList :: [SuccessiveFailures] -&gt; ShowS
show :: SuccessiveFailures -&gt; String
$cshow :: SuccessiveFailures -&gt; String
showsPrec :: Int -&gt; SuccessiveFailures -&gt; ShowS
$cshowsPrec :: Int -&gt; SuccessiveFailures -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681493885"><span id="local-6989586621681493887"><span class="annot"><span class="annottext">SuccessiveFailures -&gt; SuccessiveFailures -&gt; Bool
(SuccessiveFailures -&gt; SuccessiveFailures -&gt; Bool)
-&gt; (SuccessiveFailures -&gt; SuccessiveFailures -&gt; Bool)
-&gt; Eq SuccessiveFailures
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: SuccessiveFailures -&gt; SuccessiveFailures -&gt; Bool
$c/= :: SuccessiveFailures -&gt; SuccessiveFailures -&gt; Bool
== :: SuccessiveFailures -&gt; SuccessiveFailures -&gt; Bool
$c== :: SuccessiveFailures -&gt; SuccessiveFailures -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681493870"><span id="local-6989586621681493872"><span id="local-6989586621681493874"><span id="local-6989586621681493876"><span id="local-6989586621681493878"><span id="local-6989586621681493880"><span id="local-6989586621681493882"><span class="annot"><span class="annottext">Eq SuccessiveFailures
Eq SuccessiveFailures =&gt;
(SuccessiveFailures -&gt; SuccessiveFailures -&gt; Ordering)
-&gt; (SuccessiveFailures -&gt; SuccessiveFailures -&gt; Bool)
-&gt; (SuccessiveFailures -&gt; SuccessiveFailures -&gt; Bool)
-&gt; (SuccessiveFailures -&gt; SuccessiveFailures -&gt; Bool)
-&gt; (SuccessiveFailures -&gt; SuccessiveFailures -&gt; Bool)
-&gt; (SuccessiveFailures -&gt; SuccessiveFailures -&gt; SuccessiveFailures)
-&gt; (SuccessiveFailures -&gt; SuccessiveFailures -&gt; SuccessiveFailures)
-&gt; Ord SuccessiveFailures
SuccessiveFailures -&gt; SuccessiveFailures -&gt; Bool
SuccessiveFailures -&gt; SuccessiveFailures -&gt; Ordering
SuccessiveFailures -&gt; SuccessiveFailures -&gt; SuccessiveFailures
forall a.
Eq a =&gt;
(a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
min :: SuccessiveFailures -&gt; SuccessiveFailures -&gt; SuccessiveFailures
$cmin :: SuccessiveFailures -&gt; SuccessiveFailures -&gt; SuccessiveFailures
max :: SuccessiveFailures -&gt; SuccessiveFailures -&gt; SuccessiveFailures
$cmax :: SuccessiveFailures -&gt; SuccessiveFailures -&gt; SuccessiveFailures
&gt;= :: SuccessiveFailures -&gt; SuccessiveFailures -&gt; Bool
$c&gt;= :: SuccessiveFailures -&gt; SuccessiveFailures -&gt; Bool
&gt; :: SuccessiveFailures -&gt; SuccessiveFailures -&gt; Bool
$c&gt; :: SuccessiveFailures -&gt; SuccessiveFailures -&gt; Bool
&lt;= :: SuccessiveFailures -&gt; SuccessiveFailures -&gt; Bool
$c&lt;= :: SuccessiveFailures -&gt; SuccessiveFailures -&gt; Bool
&lt; :: SuccessiveFailures -&gt; SuccessiveFailures -&gt; Bool
$c&lt; :: SuccessiveFailures -&gt; SuccessiveFailures -&gt; Bool
compare :: SuccessiveFailures -&gt; SuccessiveFailures -&gt; Ordering
$ccompare :: SuccessiveFailures -&gt; SuccessiveFailures -&gt; Ordering
$cp1Ord :: Eq SuccessiveFailures
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(forall x. SuccessiveFailures -&gt; Rep SuccessiveFailures x)
-&gt; (forall x. Rep SuccessiveFailures x -&gt; SuccessiveFailures)
-&gt; Generic SuccessiveFailures
forall x. Rep SuccessiveFailures x -&gt; SuccessiveFailures
forall x. SuccessiveFailures -&gt; Rep SuccessiveFailures x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep SuccessiveFailures x -&gt; SuccessiveFailures
$cfrom :: forall x. SuccessiveFailures -&gt; Rep SuccessiveFailures x
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></span><span class="hs-special">)</span><span>
</span><span id="line-125"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">newtype</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681493860"><span id="local-6989586621681493862"><span id="local-6989586621681493864"><span id="local-6989586621681493866"><span class="annot"><span class="annottext">[SuccessiveFailures] -&gt; Encoding
[SuccessiveFailures] -&gt; Value
SuccessiveFailures -&gt; Encoding
SuccessiveFailures -&gt; Value
(SuccessiveFailures -&gt; Value)
-&gt; (SuccessiveFailures -&gt; Encoding)
-&gt; ([SuccessiveFailures] -&gt; Value)
-&gt; ([SuccessiveFailures] -&gt; Encoding)
-&gt; ToJSON SuccessiveFailures
forall a.
(a -&gt; Value)
-&gt; (a -&gt; Encoding)
-&gt; ([a] -&gt; Value)
-&gt; ([a] -&gt; Encoding)
-&gt; ToJSON a
toEncodingList :: [SuccessiveFailures] -&gt; Encoding
$ctoEncodingList :: [SuccessiveFailures] -&gt; Encoding
toJSONList :: [SuccessiveFailures] -&gt; Value
$ctoJSONList :: [SuccessiveFailures] -&gt; Value
toEncoding :: SuccessiveFailures -&gt; Encoding
$ctoEncoding :: SuccessiveFailures -&gt; Encoding
toJSON :: SuccessiveFailures -&gt; Value
$ctoJSON :: SuccessiveFailures -&gt; Value
</span><a href="#local-6989586621681493860"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">ToJSON</span></a></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681493856"><span id="local-6989586621681493858"><span class="annot"><span class="annottext">Value -&gt; Parser [SuccessiveFailures]
Value -&gt; Parser SuccessiveFailures
(Value -&gt; Parser SuccessiveFailures)
-&gt; (Value -&gt; Parser [SuccessiveFailures])
-&gt; FromJSON SuccessiveFailures
forall a.
(Value -&gt; Parser a) -&gt; (Value -&gt; Parser [a]) -&gt; FromJSON a
parseJSONList :: Value -&gt; Parser [SuccessiveFailures]
$cparseJSONList :: Value -&gt; Parser [SuccessiveFailures]
parseJSON :: Value -&gt; Parser SuccessiveFailures
$cparseJSON :: Value -&gt; Parser SuccessiveFailures
</span><a href="#local-6989586621681493856"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">FromJSON</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681493842"><span id="local-6989586621681493844"><span id="local-6989586621681493846"><span id="local-6989586621681493848"><span id="local-6989586621681493850"><span id="local-6989586621681493852"><span id="local-6989586621681493854"><span class="annot"><span class="annottext">Integer -&gt; SuccessiveFailures
SuccessiveFailures -&gt; SuccessiveFailures
SuccessiveFailures -&gt; SuccessiveFailures -&gt; SuccessiveFailures
(SuccessiveFailures -&gt; SuccessiveFailures -&gt; SuccessiveFailures)
-&gt; (SuccessiveFailures -&gt; SuccessiveFailures -&gt; SuccessiveFailures)
-&gt; (SuccessiveFailures -&gt; SuccessiveFailures -&gt; SuccessiveFailures)
-&gt; (SuccessiveFailures -&gt; SuccessiveFailures)
-&gt; (SuccessiveFailures -&gt; SuccessiveFailures)
-&gt; (SuccessiveFailures -&gt; SuccessiveFailures)
-&gt; (Integer -&gt; SuccessiveFailures)
-&gt; Num SuccessiveFailures
forall a.
(a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a)
-&gt; (a -&gt; a)
-&gt; (a -&gt; a)
-&gt; (Integer -&gt; a)
-&gt; Num a
fromInteger :: Integer -&gt; SuccessiveFailures
$cfromInteger :: Integer -&gt; SuccessiveFailures
signum :: SuccessiveFailures -&gt; SuccessiveFailures
$csignum :: SuccessiveFailures -&gt; SuccessiveFailures
abs :: SuccessiveFailures -&gt; SuccessiveFailures
$cabs :: SuccessiveFailures -&gt; SuccessiveFailures
negate :: SuccessiveFailures -&gt; SuccessiveFailures
$cnegate :: SuccessiveFailures -&gt; SuccessiveFailures
* :: SuccessiveFailures -&gt; SuccessiveFailures -&gt; SuccessiveFailures
$c* :: SuccessiveFailures -&gt; SuccessiveFailures -&gt; SuccessiveFailures
- :: SuccessiveFailures -&gt; SuccessiveFailures -&gt; SuccessiveFailures
$c- :: SuccessiveFailures -&gt; SuccessiveFailures -&gt; SuccessiveFailures
+ :: SuccessiveFailures -&gt; SuccessiveFailures -&gt; SuccessiveFailures
$c+ :: SuccessiveFailures -&gt; SuccessiveFailures -&gt; SuccessiveFailures
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Num</span></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681493825"><span id="local-6989586621681493827"><span id="local-6989586621681493829"><span id="local-6989586621681493831"><span id="local-6989586621681493833"><span id="local-6989586621681493835"><span id="local-6989586621681493837"><span id="local-6989586621681493839"><span class="annot"><span class="annottext">Int -&gt; SuccessiveFailures
SuccessiveFailures -&gt; Int
SuccessiveFailures -&gt; [SuccessiveFailures]
SuccessiveFailures -&gt; SuccessiveFailures
SuccessiveFailures -&gt; SuccessiveFailures -&gt; [SuccessiveFailures]
SuccessiveFailures
-&gt; SuccessiveFailures -&gt; SuccessiveFailures -&gt; [SuccessiveFailures]
(SuccessiveFailures -&gt; SuccessiveFailures)
-&gt; (SuccessiveFailures -&gt; SuccessiveFailures)
-&gt; (Int -&gt; SuccessiveFailures)
-&gt; (SuccessiveFailures -&gt; Int)
-&gt; (SuccessiveFailures -&gt; [SuccessiveFailures])
-&gt; (SuccessiveFailures
    -&gt; SuccessiveFailures -&gt; [SuccessiveFailures])
-&gt; (SuccessiveFailures
    -&gt; SuccessiveFailures -&gt; [SuccessiveFailures])
-&gt; (SuccessiveFailures
    -&gt; SuccessiveFailures
    -&gt; SuccessiveFailures
    -&gt; [SuccessiveFailures])
-&gt; Enum SuccessiveFailures
forall a.
(a -&gt; a)
-&gt; (a -&gt; a)
-&gt; (Int -&gt; a)
-&gt; (a -&gt; Int)
-&gt; (a -&gt; [a])
-&gt; (a -&gt; a -&gt; [a])
-&gt; (a -&gt; a -&gt; [a])
-&gt; (a -&gt; a -&gt; a -&gt; [a])
-&gt; Enum a
enumFromThenTo :: SuccessiveFailures
-&gt; SuccessiveFailures -&gt; SuccessiveFailures -&gt; [SuccessiveFailures]
$cenumFromThenTo :: SuccessiveFailures
-&gt; SuccessiveFailures -&gt; SuccessiveFailures -&gt; [SuccessiveFailures]
enumFromTo :: SuccessiveFailures -&gt; SuccessiveFailures -&gt; [SuccessiveFailures]
$cenumFromTo :: SuccessiveFailures -&gt; SuccessiveFailures -&gt; [SuccessiveFailures]
enumFromThen :: SuccessiveFailures -&gt; SuccessiveFailures -&gt; [SuccessiveFailures]
$cenumFromThen :: SuccessiveFailures -&gt; SuccessiveFailures -&gt; [SuccessiveFailures]
enumFrom :: SuccessiveFailures -&gt; [SuccessiveFailures]
$cenumFrom :: SuccessiveFailures -&gt; [SuccessiveFailures]
fromEnum :: SuccessiveFailures -&gt; Int
$cfromEnum :: SuccessiveFailures -&gt; Int
toEnum :: Int -&gt; SuccessiveFailures
$ctoEnum :: Int -&gt; SuccessiveFailures
pred :: SuccessiveFailures -&gt; SuccessiveFailures
$cpred :: SuccessiveFailures -&gt; SuccessiveFailures
succ :: SuccessiveFailures -&gt; SuccessiveFailures
$csucc :: SuccessiveFailures -&gt; SuccessiveFailures
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Enum</span></span></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681493820"><span id="local-6989586621681493822"><span class="annot"><span class="annottext">Gen SuccessiveFailures
Gen SuccessiveFailures
-&gt; (SuccessiveFailures -&gt; [SuccessiveFailures])
-&gt; Arbitrary SuccessiveFailures
SuccessiveFailures -&gt; [SuccessiveFailures]
forall a. Gen a -&gt; (a -&gt; [a]) -&gt; Arbitrary a
shrink :: SuccessiveFailures -&gt; [SuccessiveFailures]
$cshrink :: SuccessiveFailures -&gt; [SuccessiveFailures]
arbitrary :: Gen SuccessiveFailures
$carbitrary :: Gen SuccessiveFailures
</span><a href="#local-6989586621681493820"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Arbitrary</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681493818"><span class="annot"><span class="annottext">SuccessiveFailures -&gt; ()
(SuccessiveFailures -&gt; ()) -&gt; NFData SuccessiveFailures
forall a. (a -&gt; ()) -&gt; NFData a
rnf :: SuccessiveFailures -&gt; ()
$crnf :: SuccessiveFailures -&gt; ()
</span><a href="#local-6989586621681493818"><span class="hs-identifier hs-var hs-var hs-var hs-var">NFData</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-126"></span><span>
</span><span id="line-127"></span><span id="local-6989586621681493816"><span id="local-6989586621681493817"></span></span><span class="hs-keyword">newtype</span><span> </span><span id="AddedTime"><span class="annot"><a href="P2P.Node.PeerDB.html#AddedTime"><span class="hs-identifier hs-var">AddedTime</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="AddedTime"><span class="annot"><a href="P2P.Node.PeerDB.html#AddedTime"><span class="hs-identifier hs-var">AddedTime</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="_getAddedTime"><span class="annot"><span class="annottext">AddedTime -&gt; UTCTime
</span><a href="P2P.Node.PeerDB.html#_getAddedTime"><span class="hs-identifier hs-var hs-var">_getAddedTime</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">UTCTime</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-128"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681493808"><span id="local-6989586621681493810"><span id="local-6989586621681493812"><span class="annot"><span class="annottext">Int -&gt; AddedTime -&gt; ShowS
[AddedTime] -&gt; ShowS
AddedTime -&gt; String
(Int -&gt; AddedTime -&gt; ShowS)
-&gt; (AddedTime -&gt; String)
-&gt; ([AddedTime] -&gt; ShowS)
-&gt; Show AddedTime
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [AddedTime] -&gt; ShowS
$cshowList :: [AddedTime] -&gt; ShowS
show :: AddedTime -&gt; String
$cshow :: AddedTime -&gt; String
showsPrec :: Int -&gt; AddedTime -&gt; ShowS
$cshowsPrec :: Int -&gt; AddedTime -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681493804"><span id="local-6989586621681493806"><span class="annot"><span class="annottext">AddedTime -&gt; AddedTime -&gt; Bool
(AddedTime -&gt; AddedTime -&gt; Bool)
-&gt; (AddedTime -&gt; AddedTime -&gt; Bool) -&gt; Eq AddedTime
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: AddedTime -&gt; AddedTime -&gt; Bool
$c/= :: AddedTime -&gt; AddedTime -&gt; Bool
== :: AddedTime -&gt; AddedTime -&gt; Bool
$c== :: AddedTime -&gt; AddedTime -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681493789"><span id="local-6989586621681493791"><span id="local-6989586621681493793"><span id="local-6989586621681493795"><span id="local-6989586621681493797"><span id="local-6989586621681493799"><span id="local-6989586621681493801"><span class="annot"><span class="annottext">Eq AddedTime
Eq AddedTime =&gt;
(AddedTime -&gt; AddedTime -&gt; Ordering)
-&gt; (AddedTime -&gt; AddedTime -&gt; Bool)
-&gt; (AddedTime -&gt; AddedTime -&gt; Bool)
-&gt; (AddedTime -&gt; AddedTime -&gt; Bool)
-&gt; (AddedTime -&gt; AddedTime -&gt; Bool)
-&gt; (AddedTime -&gt; AddedTime -&gt; AddedTime)
-&gt; (AddedTime -&gt; AddedTime -&gt; AddedTime)
-&gt; Ord AddedTime
AddedTime -&gt; AddedTime -&gt; Bool
AddedTime -&gt; AddedTime -&gt; Ordering
AddedTime -&gt; AddedTime -&gt; AddedTime
forall a.
Eq a =&gt;
(a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
min :: AddedTime -&gt; AddedTime -&gt; AddedTime
$cmin :: AddedTime -&gt; AddedTime -&gt; AddedTime
max :: AddedTime -&gt; AddedTime -&gt; AddedTime
$cmax :: AddedTime -&gt; AddedTime -&gt; AddedTime
&gt;= :: AddedTime -&gt; AddedTime -&gt; Bool
$c&gt;= :: AddedTime -&gt; AddedTime -&gt; Bool
&gt; :: AddedTime -&gt; AddedTime -&gt; Bool
$c&gt; :: AddedTime -&gt; AddedTime -&gt; Bool
&lt;= :: AddedTime -&gt; AddedTime -&gt; Bool
$c&lt;= :: AddedTime -&gt; AddedTime -&gt; Bool
&lt; :: AddedTime -&gt; AddedTime -&gt; Bool
$c&lt; :: AddedTime -&gt; AddedTime -&gt; Bool
compare :: AddedTime -&gt; AddedTime -&gt; Ordering
$ccompare :: AddedTime -&gt; AddedTime -&gt; Ordering
$cp1Ord :: Eq AddedTime
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(forall x. AddedTime -&gt; Rep AddedTime x)
-&gt; (forall x. Rep AddedTime x -&gt; AddedTime) -&gt; Generic AddedTime
forall x. Rep AddedTime x -&gt; AddedTime
forall x. AddedTime -&gt; Rep AddedTime x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep AddedTime x -&gt; AddedTime
$cfrom :: forall x. AddedTime -&gt; Rep AddedTime x
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></span><span class="hs-special">)</span><span>
</span><span id="line-129"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">newtype</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681493779"><span id="local-6989586621681493781"><span id="local-6989586621681493783"><span id="local-6989586621681493785"><span class="annot"><span class="annottext">[AddedTime] -&gt; Encoding
[AddedTime] -&gt; Value
AddedTime -&gt; Encoding
AddedTime -&gt; Value
(AddedTime -&gt; Value)
-&gt; (AddedTime -&gt; Encoding)
-&gt; ([AddedTime] -&gt; Value)
-&gt; ([AddedTime] -&gt; Encoding)
-&gt; ToJSON AddedTime
forall a.
(a -&gt; Value)
-&gt; (a -&gt; Encoding)
-&gt; ([a] -&gt; Value)
-&gt; ([a] -&gt; Encoding)
-&gt; ToJSON a
toEncodingList :: [AddedTime] -&gt; Encoding
$ctoEncodingList :: [AddedTime] -&gt; Encoding
toJSONList :: [AddedTime] -&gt; Value
$ctoJSONList :: [AddedTime] -&gt; Value
toEncoding :: AddedTime -&gt; Encoding
$ctoEncoding :: AddedTime -&gt; Encoding
toJSON :: AddedTime -&gt; Value
$ctoJSON :: AddedTime -&gt; Value
</span><a href="#local-6989586621681493779"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">ToJSON</span></a></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681493775"><span id="local-6989586621681493777"><span class="annot"><span class="annottext">Value -&gt; Parser [AddedTime]
Value -&gt; Parser AddedTime
(Value -&gt; Parser AddedTime)
-&gt; (Value -&gt; Parser [AddedTime]) -&gt; FromJSON AddedTime
forall a.
(Value -&gt; Parser a) -&gt; (Value -&gt; Parser [a]) -&gt; FromJSON a
parseJSONList :: Value -&gt; Parser [AddedTime]
$cparseJSONList :: Value -&gt; Parser [AddedTime]
parseJSON :: Value -&gt; Parser AddedTime
$cparseJSON :: Value -&gt; Parser AddedTime
</span><a href="#local-6989586621681493775"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">FromJSON</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681493771"><span id="local-6989586621681493773"><span class="annot"><span class="annottext">Gen AddedTime
Gen AddedTime -&gt; (AddedTime -&gt; [AddedTime]) -&gt; Arbitrary AddedTime
AddedTime -&gt; [AddedTime]
forall a. Gen a -&gt; (a -&gt; [a]) -&gt; Arbitrary a
shrink :: AddedTime -&gt; [AddedTime]
$cshrink :: AddedTime -&gt; [AddedTime]
arbitrary :: Gen AddedTime
$carbitrary :: Gen AddedTime
</span><a href="#local-6989586621681493771"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Arbitrary</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681493769"><span class="annot"><span class="annottext">AddedTime -&gt; ()
(AddedTime -&gt; ()) -&gt; NFData AddedTime
forall a. (a -&gt; ()) -&gt; NFData a
rnf :: AddedTime -&gt; ()
$crnf :: AddedTime -&gt; ()
</span><a href="#local-6989586621681493769"><span class="hs-identifier hs-var hs-var hs-var hs-var">NFData</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-130"></span><span>
</span><span id="line-131"></span><span id="local-6989586621681493767"><span id="local-6989586621681493768"></span></span><span class="hs-keyword">newtype</span><span> </span><span id="ActiveSessionCount"><span class="annot"><a href="P2P.Node.PeerDB.html#ActiveSessionCount"><span class="hs-identifier hs-var">ActiveSessionCount</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ActiveSessionCount"><span class="annot"><a href="P2P.Node.PeerDB.html#ActiveSessionCount"><span class="hs-identifier hs-var">ActiveSessionCount</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="_getActiveSessionCount"><span class="annot"><span class="annottext">ActiveSessionCount -&gt; Natural
</span><a href="P2P.Node.PeerDB.html#_getActiveSessionCount"><span class="hs-identifier hs-var hs-var">_getActiveSessionCount</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Natural</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-132"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681493759"><span id="local-6989586621681493761"><span id="local-6989586621681493763"><span class="annot"><span class="annottext">Int -&gt; ActiveSessionCount -&gt; ShowS
[ActiveSessionCount] -&gt; ShowS
ActiveSessionCount -&gt; String
(Int -&gt; ActiveSessionCount -&gt; ShowS)
-&gt; (ActiveSessionCount -&gt; String)
-&gt; ([ActiveSessionCount] -&gt; ShowS)
-&gt; Show ActiveSessionCount
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [ActiveSessionCount] -&gt; ShowS
$cshowList :: [ActiveSessionCount] -&gt; ShowS
show :: ActiveSessionCount -&gt; String
$cshow :: ActiveSessionCount -&gt; String
showsPrec :: Int -&gt; ActiveSessionCount -&gt; ShowS
$cshowsPrec :: Int -&gt; ActiveSessionCount -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681493755"><span id="local-6989586621681493757"><span class="annot"><span class="annottext">ActiveSessionCount -&gt; ActiveSessionCount -&gt; Bool
(ActiveSessionCount -&gt; ActiveSessionCount -&gt; Bool)
-&gt; (ActiveSessionCount -&gt; ActiveSessionCount -&gt; Bool)
-&gt; Eq ActiveSessionCount
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: ActiveSessionCount -&gt; ActiveSessionCount -&gt; Bool
$c/= :: ActiveSessionCount -&gt; ActiveSessionCount -&gt; Bool
== :: ActiveSessionCount -&gt; ActiveSessionCount -&gt; Bool
$c== :: ActiveSessionCount -&gt; ActiveSessionCount -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681493740"><span id="local-6989586621681493742"><span id="local-6989586621681493744"><span id="local-6989586621681493746"><span id="local-6989586621681493748"><span id="local-6989586621681493750"><span id="local-6989586621681493752"><span class="annot"><span class="annottext">Eq ActiveSessionCount
Eq ActiveSessionCount =&gt;
(ActiveSessionCount -&gt; ActiveSessionCount -&gt; Ordering)
-&gt; (ActiveSessionCount -&gt; ActiveSessionCount -&gt; Bool)
-&gt; (ActiveSessionCount -&gt; ActiveSessionCount -&gt; Bool)
-&gt; (ActiveSessionCount -&gt; ActiveSessionCount -&gt; Bool)
-&gt; (ActiveSessionCount -&gt; ActiveSessionCount -&gt; Bool)
-&gt; (ActiveSessionCount -&gt; ActiveSessionCount -&gt; ActiveSessionCount)
-&gt; (ActiveSessionCount -&gt; ActiveSessionCount -&gt; ActiveSessionCount)
-&gt; Ord ActiveSessionCount
ActiveSessionCount -&gt; ActiveSessionCount -&gt; Bool
ActiveSessionCount -&gt; ActiveSessionCount -&gt; Ordering
ActiveSessionCount -&gt; ActiveSessionCount -&gt; ActiveSessionCount
forall a.
Eq a =&gt;
(a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
min :: ActiveSessionCount -&gt; ActiveSessionCount -&gt; ActiveSessionCount
$cmin :: ActiveSessionCount -&gt; ActiveSessionCount -&gt; ActiveSessionCount
max :: ActiveSessionCount -&gt; ActiveSessionCount -&gt; ActiveSessionCount
$cmax :: ActiveSessionCount -&gt; ActiveSessionCount -&gt; ActiveSessionCount
&gt;= :: ActiveSessionCount -&gt; ActiveSessionCount -&gt; Bool
$c&gt;= :: ActiveSessionCount -&gt; ActiveSessionCount -&gt; Bool
&gt; :: ActiveSessionCount -&gt; ActiveSessionCount -&gt; Bool
$c&gt; :: ActiveSessionCount -&gt; ActiveSessionCount -&gt; Bool
&lt;= :: ActiveSessionCount -&gt; ActiveSessionCount -&gt; Bool
$c&lt;= :: ActiveSessionCount -&gt; ActiveSessionCount -&gt; Bool
&lt; :: ActiveSessionCount -&gt; ActiveSessionCount -&gt; Bool
$c&lt; :: ActiveSessionCount -&gt; ActiveSessionCount -&gt; Bool
compare :: ActiveSessionCount -&gt; ActiveSessionCount -&gt; Ordering
$ccompare :: ActiveSessionCount -&gt; ActiveSessionCount -&gt; Ordering
$cp1Ord :: Eq ActiveSessionCount
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(forall x. ActiveSessionCount -&gt; Rep ActiveSessionCount x)
-&gt; (forall x. Rep ActiveSessionCount x -&gt; ActiveSessionCount)
-&gt; Generic ActiveSessionCount
forall x. Rep ActiveSessionCount x -&gt; ActiveSessionCount
forall x. ActiveSessionCount -&gt; Rep ActiveSessionCount x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep ActiveSessionCount x -&gt; ActiveSessionCount
$cfrom :: forall x. ActiveSessionCount -&gt; Rep ActiveSessionCount x
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></span><span class="hs-special">)</span><span>
</span><span id="line-133"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">newtype</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681493730"><span id="local-6989586621681493732"><span id="local-6989586621681493734"><span id="local-6989586621681493736"><span class="annot"><span class="annottext">[ActiveSessionCount] -&gt; Encoding
[ActiveSessionCount] -&gt; Value
ActiveSessionCount -&gt; Encoding
ActiveSessionCount -&gt; Value
(ActiveSessionCount -&gt; Value)
-&gt; (ActiveSessionCount -&gt; Encoding)
-&gt; ([ActiveSessionCount] -&gt; Value)
-&gt; ([ActiveSessionCount] -&gt; Encoding)
-&gt; ToJSON ActiveSessionCount
forall a.
(a -&gt; Value)
-&gt; (a -&gt; Encoding)
-&gt; ([a] -&gt; Value)
-&gt; ([a] -&gt; Encoding)
-&gt; ToJSON a
toEncodingList :: [ActiveSessionCount] -&gt; Encoding
$ctoEncodingList :: [ActiveSessionCount] -&gt; Encoding
toJSONList :: [ActiveSessionCount] -&gt; Value
$ctoJSONList :: [ActiveSessionCount] -&gt; Value
toEncoding :: ActiveSessionCount -&gt; Encoding
$ctoEncoding :: ActiveSessionCount -&gt; Encoding
toJSON :: ActiveSessionCount -&gt; Value
$ctoJSON :: ActiveSessionCount -&gt; Value
</span><a href="#local-6989586621681493730"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">ToJSON</span></a></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681493726"><span id="local-6989586621681493728"><span class="annot"><span class="annottext">Value -&gt; Parser [ActiveSessionCount]
Value -&gt; Parser ActiveSessionCount
(Value -&gt; Parser ActiveSessionCount)
-&gt; (Value -&gt; Parser [ActiveSessionCount])
-&gt; FromJSON ActiveSessionCount
forall a.
(Value -&gt; Parser a) -&gt; (Value -&gt; Parser [a]) -&gt; FromJSON a
parseJSONList :: Value -&gt; Parser [ActiveSessionCount]
$cparseJSONList :: Value -&gt; Parser [ActiveSessionCount]
parseJSON :: Value -&gt; Parser ActiveSessionCount
$cparseJSON :: Value -&gt; Parser ActiveSessionCount
</span><a href="#local-6989586621681493726"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">FromJSON</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681493712"><span id="local-6989586621681493714"><span id="local-6989586621681493716"><span id="local-6989586621681493718"><span id="local-6989586621681493720"><span id="local-6989586621681493722"><span id="local-6989586621681493724"><span class="annot"><span class="annottext">Integer -&gt; ActiveSessionCount
ActiveSessionCount -&gt; ActiveSessionCount
ActiveSessionCount -&gt; ActiveSessionCount -&gt; ActiveSessionCount
(ActiveSessionCount -&gt; ActiveSessionCount -&gt; ActiveSessionCount)
-&gt; (ActiveSessionCount -&gt; ActiveSessionCount -&gt; ActiveSessionCount)
-&gt; (ActiveSessionCount -&gt; ActiveSessionCount -&gt; ActiveSessionCount)
-&gt; (ActiveSessionCount -&gt; ActiveSessionCount)
-&gt; (ActiveSessionCount -&gt; ActiveSessionCount)
-&gt; (ActiveSessionCount -&gt; ActiveSessionCount)
-&gt; (Integer -&gt; ActiveSessionCount)
-&gt; Num ActiveSessionCount
forall a.
(a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a)
-&gt; (a -&gt; a)
-&gt; (a -&gt; a)
-&gt; (Integer -&gt; a)
-&gt; Num a
fromInteger :: Integer -&gt; ActiveSessionCount
$cfromInteger :: Integer -&gt; ActiveSessionCount
signum :: ActiveSessionCount -&gt; ActiveSessionCount
$csignum :: ActiveSessionCount -&gt; ActiveSessionCount
abs :: ActiveSessionCount -&gt; ActiveSessionCount
$cabs :: ActiveSessionCount -&gt; ActiveSessionCount
negate :: ActiveSessionCount -&gt; ActiveSessionCount
$cnegate :: ActiveSessionCount -&gt; ActiveSessionCount
* :: ActiveSessionCount -&gt; ActiveSessionCount -&gt; ActiveSessionCount
$c* :: ActiveSessionCount -&gt; ActiveSessionCount -&gt; ActiveSessionCount
- :: ActiveSessionCount -&gt; ActiveSessionCount -&gt; ActiveSessionCount
$c- :: ActiveSessionCount -&gt; ActiveSessionCount -&gt; ActiveSessionCount
+ :: ActiveSessionCount -&gt; ActiveSessionCount -&gt; ActiveSessionCount
$c+ :: ActiveSessionCount -&gt; ActiveSessionCount -&gt; ActiveSessionCount
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Num</span></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681493696"><span id="local-6989586621681493698"><span id="local-6989586621681493700"><span id="local-6989586621681493702"><span id="local-6989586621681493704"><span id="local-6989586621681493706"><span id="local-6989586621681493708"><span id="local-6989586621681493710"><span class="annot"><span class="annottext">Int -&gt; ActiveSessionCount
ActiveSessionCount -&gt; Int
ActiveSessionCount -&gt; [ActiveSessionCount]
ActiveSessionCount -&gt; ActiveSessionCount
ActiveSessionCount -&gt; ActiveSessionCount -&gt; [ActiveSessionCount]
ActiveSessionCount
-&gt; ActiveSessionCount -&gt; ActiveSessionCount -&gt; [ActiveSessionCount]
(ActiveSessionCount -&gt; ActiveSessionCount)
-&gt; (ActiveSessionCount -&gt; ActiveSessionCount)
-&gt; (Int -&gt; ActiveSessionCount)
-&gt; (ActiveSessionCount -&gt; Int)
-&gt; (ActiveSessionCount -&gt; [ActiveSessionCount])
-&gt; (ActiveSessionCount
    -&gt; ActiveSessionCount -&gt; [ActiveSessionCount])
-&gt; (ActiveSessionCount
    -&gt; ActiveSessionCount -&gt; [ActiveSessionCount])
-&gt; (ActiveSessionCount
    -&gt; ActiveSessionCount
    -&gt; ActiveSessionCount
    -&gt; [ActiveSessionCount])
-&gt; Enum ActiveSessionCount
forall a.
(a -&gt; a)
-&gt; (a -&gt; a)
-&gt; (Int -&gt; a)
-&gt; (a -&gt; Int)
-&gt; (a -&gt; [a])
-&gt; (a -&gt; a -&gt; [a])
-&gt; (a -&gt; a -&gt; [a])
-&gt; (a -&gt; a -&gt; a -&gt; [a])
-&gt; Enum a
enumFromThenTo :: ActiveSessionCount
-&gt; ActiveSessionCount -&gt; ActiveSessionCount -&gt; [ActiveSessionCount]
$cenumFromThenTo :: ActiveSessionCount
-&gt; ActiveSessionCount -&gt; ActiveSessionCount -&gt; [ActiveSessionCount]
enumFromTo :: ActiveSessionCount -&gt; ActiveSessionCount -&gt; [ActiveSessionCount]
$cenumFromTo :: ActiveSessionCount -&gt; ActiveSessionCount -&gt; [ActiveSessionCount]
enumFromThen :: ActiveSessionCount -&gt; ActiveSessionCount -&gt; [ActiveSessionCount]
$cenumFromThen :: ActiveSessionCount -&gt; ActiveSessionCount -&gt; [ActiveSessionCount]
enumFrom :: ActiveSessionCount -&gt; [ActiveSessionCount]
$cenumFrom :: ActiveSessionCount -&gt; [ActiveSessionCount]
fromEnum :: ActiveSessionCount -&gt; Int
$cfromEnum :: ActiveSessionCount -&gt; Int
toEnum :: Int -&gt; ActiveSessionCount
$ctoEnum :: Int -&gt; ActiveSessionCount
pred :: ActiveSessionCount -&gt; ActiveSessionCount
$cpred :: ActiveSessionCount -&gt; ActiveSessionCount
succ :: ActiveSessionCount -&gt; ActiveSessionCount
$csucc :: ActiveSessionCount -&gt; ActiveSessionCount
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Enum</span></span></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681493692"><span id="local-6989586621681493694"><span class="annot"><span class="annottext">Gen ActiveSessionCount
Gen ActiveSessionCount
-&gt; (ActiveSessionCount -&gt; [ActiveSessionCount])
-&gt; Arbitrary ActiveSessionCount
ActiveSessionCount -&gt; [ActiveSessionCount]
forall a. Gen a -&gt; (a -&gt; [a]) -&gt; Arbitrary a
shrink :: ActiveSessionCount -&gt; [ActiveSessionCount]
$cshrink :: ActiveSessionCount -&gt; [ActiveSessionCount]
arbitrary :: Gen ActiveSessionCount
$carbitrary :: Gen ActiveSessionCount
</span><a href="#local-6989586621681493692"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Arbitrary</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681493690"><span class="annot"><span class="annottext">ActiveSessionCount -&gt; ()
(ActiveSessionCount -&gt; ()) -&gt; NFData ActiveSessionCount
forall a. (a -&gt; ()) -&gt; NFData a
rnf :: ActiveSessionCount -&gt; ()
$crnf :: ActiveSessionCount -&gt; ()
</span><a href="#local-6989586621681493690"><span class="hs-identifier hs-var hs-var hs-var hs-var">NFData</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-134"></span><span>
</span><span id="line-135"></span><span id="local-6989586621681493688"><span id="local-6989586621681493689"></span></span><span class="hs-keyword">data</span><span> </span><span id="PeerEntry"><span class="annot"><a href="P2P.Node.PeerDB.html#PeerEntry"><span class="hs-identifier hs-var">PeerEntry</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="PeerEntry"><span class="annot"><a href="P2P.Node.PeerDB.html#PeerEntry"><span class="hs-identifier hs-var">PeerEntry</span></a></span></span><span>
</span><span id="line-136"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="_peerEntryInfo"><span class="annot"><span class="annottext">PeerEntry -&gt; PeerInfo
</span><a href="P2P.Node.PeerDB.html#_peerEntryInfo"><span class="hs-identifier hs-var hs-var">_peerEntryInfo</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="P2P.Peer.html#PeerInfo"><span class="hs-identifier hs-type">PeerInfo</span></a></span><span>
</span><span id="line-137"></span><span>        </span><span class="hs-comment">-- ^ There must be only one peer per peer address. A peer id</span><span>
</span><span id="line-138"></span><span>        </span><span class="hs-comment">-- can be updated from 'Nothing' to 'Just' some value. If a</span><span>
</span><span id="line-139"></span><span>        </span><span class="hs-comment">-- peer id of 'Just' some value changes, it is considered a</span><span>
</span><span id="line-140"></span><span>        </span><span class="hs-comment">-- new peer and the existing value is replaced.</span><span>
</span><span id="line-141"></span><span>
</span><span id="line-142"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="_peerEntrySuccessiveFailures"><span class="annot"><span class="annottext">PeerEntry -&gt; SuccessiveFailures
</span><a href="P2P.Node.PeerDB.html#_peerEntrySuccessiveFailures"><span class="hs-identifier hs-var hs-var">_peerEntrySuccessiveFailures</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="P2P.Node.PeerDB.html#SuccessiveFailures"><span class="hs-identifier hs-type">SuccessiveFailures</span></a></span><span>
</span><span id="line-143"></span><span>        </span><span class="hs-comment">-- ^ The number of successive failure for this peer. If this number</span><span>
</span><span id="line-144"></span><span>        </span><span class="hs-comment">-- execeeds a certain threshold we drop the peer from the database.</span><span>
</span><span id="line-145"></span><span>
</span><span id="line-146"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="_peerEntryLastSuccess"><span class="annot"><span class="annottext">PeerEntry -&gt; LastSuccess
</span><a href="P2P.Node.PeerDB.html#_peerEntryLastSuccess"><span class="hs-identifier hs-var hs-var">_peerEntryLastSuccess</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="P2P.Node.PeerDB.html#LastSuccess"><span class="hs-identifier hs-type">LastSuccess</span></a></span><span>
</span><span id="line-147"></span><span>        </span><span class="hs-comment">-- ^ The time of the last successful interaction with this peer.</span><span>
</span><span id="line-148"></span><span>
</span><span id="line-149"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="_peerEntryNetworkIds"><span class="annot"><span class="annottext">PeerEntry -&gt; Set NetworkId
</span><a href="P2P.Node.PeerDB.html#_peerEntryNetworkIds"><span class="hs-identifier hs-var hs-var">_peerEntryNetworkIds</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">S.Set</span></span><span> </span><span class="annot"><a href="Chainweb.RestAPI.NetworkID.html#NetworkId"><span class="hs-identifier hs-type">NetworkId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-150"></span><span>        </span><span class="hs-comment">-- ^ The set of networks that this peer supports.</span><span>
</span><span id="line-151"></span><span>
</span><span id="line-152"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="_peerEntryActiveSessionCount"><span class="annot"><span class="annottext">PeerEntry -&gt; ActiveSessionCount
</span><a href="P2P.Node.PeerDB.html#_peerEntryActiveSessionCount"><span class="hs-identifier hs-var hs-var">_peerEntryActiveSessionCount</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="P2P.Node.PeerDB.html#ActiveSessionCount"><span class="hs-identifier hs-type">ActiveSessionCount</span></a></span><span>
</span><span id="line-153"></span><span>        </span><span class="hs-comment">-- ^ number of currently active sessions with this peer. By trying to</span><span>
</span><span id="line-154"></span><span>        </span><span class="hs-comment">-- maximize this number, the sharing of peers between different network</span><span>
</span><span id="line-155"></span><span>        </span><span class="hs-comment">-- ids is increased. There should be only one active session per network</span><span>
</span><span id="line-156"></span><span>        </span><span class="hs-comment">-- id.</span><span>
</span><span id="line-157"></span><span>
</span><span id="line-158"></span><span class="hs-comment">--     , _peerEntrySessionCount :: !Natural</span><span>
</span><span id="line-159"></span><span class="hs-comment">--         -- ^ Count the number of sessions. When this number becomes to high</span><span>
</span><span id="line-160"></span><span class="hs-comment">--         -- we should</span><span>
</span><span id="line-161"></span><span>
</span><span id="line-162"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-163"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681493676"><span id="local-6989586621681493678"><span id="local-6989586621681493680"><span class="annot"><span class="annottext">Int -&gt; PeerEntry -&gt; ShowS
[PeerEntry] -&gt; ShowS
PeerEntry -&gt; String
(Int -&gt; PeerEntry -&gt; ShowS)
-&gt; (PeerEntry -&gt; String)
-&gt; ([PeerEntry] -&gt; ShowS)
-&gt; Show PeerEntry
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [PeerEntry] -&gt; ShowS
$cshowList :: [PeerEntry] -&gt; ShowS
show :: PeerEntry -&gt; String
$cshow :: PeerEntry -&gt; String
showsPrec :: Int -&gt; PeerEntry -&gt; ShowS
$cshowsPrec :: Int -&gt; PeerEntry -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681493672"><span id="local-6989586621681493674"><span class="annot"><span class="annottext">PeerEntry -&gt; PeerEntry -&gt; Bool
(PeerEntry -&gt; PeerEntry -&gt; Bool)
-&gt; (PeerEntry -&gt; PeerEntry -&gt; Bool) -&gt; Eq PeerEntry
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: PeerEntry -&gt; PeerEntry -&gt; Bool
$c/= :: PeerEntry -&gt; PeerEntry -&gt; Bool
== :: PeerEntry -&gt; PeerEntry -&gt; Bool
$c== :: PeerEntry -&gt; PeerEntry -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681493657"><span id="local-6989586621681493659"><span id="local-6989586621681493661"><span id="local-6989586621681493663"><span id="local-6989586621681493665"><span id="local-6989586621681493667"><span id="local-6989586621681493669"><span class="annot"><span class="annottext">Eq PeerEntry
Eq PeerEntry =&gt;
(PeerEntry -&gt; PeerEntry -&gt; Ordering)
-&gt; (PeerEntry -&gt; PeerEntry -&gt; Bool)
-&gt; (PeerEntry -&gt; PeerEntry -&gt; Bool)
-&gt; (PeerEntry -&gt; PeerEntry -&gt; Bool)
-&gt; (PeerEntry -&gt; PeerEntry -&gt; Bool)
-&gt; (PeerEntry -&gt; PeerEntry -&gt; PeerEntry)
-&gt; (PeerEntry -&gt; PeerEntry -&gt; PeerEntry)
-&gt; Ord PeerEntry
PeerEntry -&gt; PeerEntry -&gt; Bool
PeerEntry -&gt; PeerEntry -&gt; Ordering
PeerEntry -&gt; PeerEntry -&gt; PeerEntry
forall a.
Eq a =&gt;
(a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
min :: PeerEntry -&gt; PeerEntry -&gt; PeerEntry
$cmin :: PeerEntry -&gt; PeerEntry -&gt; PeerEntry
max :: PeerEntry -&gt; PeerEntry -&gt; PeerEntry
$cmax :: PeerEntry -&gt; PeerEntry -&gt; PeerEntry
&gt;= :: PeerEntry -&gt; PeerEntry -&gt; Bool
$c&gt;= :: PeerEntry -&gt; PeerEntry -&gt; Bool
&gt; :: PeerEntry -&gt; PeerEntry -&gt; Bool
$c&gt; :: PeerEntry -&gt; PeerEntry -&gt; Bool
&lt;= :: PeerEntry -&gt; PeerEntry -&gt; Bool
$c&lt;= :: PeerEntry -&gt; PeerEntry -&gt; Bool
&lt; :: PeerEntry -&gt; PeerEntry -&gt; Bool
$c&lt; :: PeerEntry -&gt; PeerEntry -&gt; Bool
compare :: PeerEntry -&gt; PeerEntry -&gt; Ordering
$ccompare :: PeerEntry -&gt; PeerEntry -&gt; Ordering
$cp1Ord :: Eq PeerEntry
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(forall x. PeerEntry -&gt; Rep PeerEntry x)
-&gt; (forall x. Rep PeerEntry x -&gt; PeerEntry) -&gt; Generic PeerEntry
forall x. Rep PeerEntry x -&gt; PeerEntry
forall x. PeerEntry -&gt; Rep PeerEntry x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep PeerEntry x -&gt; PeerEntry
$cfrom :: forall x. PeerEntry -&gt; Rep PeerEntry x
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></span><span class="hs-special">)</span><span>
</span><span id="line-164"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">anyclass</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681493647"><span id="local-6989586621681493649"><span id="local-6989586621681493651"><span id="local-6989586621681493653"><span class="annot"><span class="annottext">[PeerEntry] -&gt; Encoding
[PeerEntry] -&gt; Value
PeerEntry -&gt; Encoding
PeerEntry -&gt; Value
(PeerEntry -&gt; Value)
-&gt; (PeerEntry -&gt; Encoding)
-&gt; ([PeerEntry] -&gt; Value)
-&gt; ([PeerEntry] -&gt; Encoding)
-&gt; ToJSON PeerEntry
forall a.
(a -&gt; Value)
-&gt; (a -&gt; Encoding)
-&gt; ([a] -&gt; Value)
-&gt; ([a] -&gt; Encoding)
-&gt; ToJSON a
toEncodingList :: [PeerEntry] -&gt; Encoding
$ctoEncodingList :: [PeerEntry] -&gt; Encoding
toJSONList :: [PeerEntry] -&gt; Value
$ctoJSONList :: [PeerEntry] -&gt; Value
toEncoding :: PeerEntry -&gt; Encoding
$ctoEncoding :: PeerEntry -&gt; Encoding
toJSON :: PeerEntry -&gt; Value
$ctoJSON :: PeerEntry -&gt; Value
</span><a href="#local-6989586621681493647"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">ToJSON</span></a></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681493643"><span id="local-6989586621681493645"><span class="annot"><span class="annottext">Value -&gt; Parser [PeerEntry]
Value -&gt; Parser PeerEntry
(Value -&gt; Parser PeerEntry)
-&gt; (Value -&gt; Parser [PeerEntry]) -&gt; FromJSON PeerEntry
forall a.
(Value -&gt; Parser a) -&gt; (Value -&gt; Parser [a]) -&gt; FromJSON a
parseJSONList :: Value -&gt; Parser [PeerEntry]
$cparseJSONList :: Value -&gt; Parser [PeerEntry]
parseJSON :: Value -&gt; Parser PeerEntry
$cparseJSON :: Value -&gt; Parser PeerEntry
</span><a href="#local-6989586621681493643"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">FromJSON</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681493641"><span class="annot"><span class="annottext">PeerEntry -&gt; ()
(PeerEntry -&gt; ()) -&gt; NFData PeerEntry
forall a. (a -&gt; ()) -&gt; NFData a
rnf :: PeerEntry -&gt; ()
$crnf :: PeerEntry -&gt; ()
</span><a href="#local-6989586621681493641"><span class="hs-identifier hs-var hs-var hs-var hs-var">NFData</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-165"></span><span>
</span><span id="line-166"></span><span id="peerEntryActiveSessionCount"><span id="peerEntryNetworkIds"><span id="peerEntryLastSuccess"><span id="peerEntrySuccessiveFailures"><span id="peerEntryInfo"><span class="hs-identifier">makeLenses</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">PeerEntry</span></span></span></span></span></span><span>
</span><span id="line-167"></span><span>
</span><span id="line-168"></span><span class="annot"><a href="P2P.Node.PeerDB.html#newPeerEntry"><span class="hs-identifier hs-type">newPeerEntry</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Chainweb.RestAPI.NetworkID.html#NetworkId"><span class="hs-identifier hs-type">NetworkId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="P2P.Peer.html#PeerInfo"><span class="hs-identifier hs-type">PeerInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="P2P.Node.PeerDB.html#PeerEntry"><span class="hs-identifier hs-type">PeerEntry</span></a></span><span>
</span><span id="line-169"></span><span id="newPeerEntry"><span class="annot"><span class="annottext">newPeerEntry :: NetworkId -&gt; PeerInfo -&gt; PeerEntry
</span><a href="P2P.Node.PeerDB.html#newPeerEntry"><span class="hs-identifier hs-var hs-var">newPeerEntry</span></a></span></span><span> </span><span id="local-6989586621681493638"><span class="annot"><span class="annottext">nid :: NetworkId
</span><a href="#local-6989586621681493638"><span class="hs-identifier hs-var">nid</span></a></span></span><span> </span><span id="local-6989586621681493637"><span class="annot"><span class="annottext">i :: PeerInfo
</span><a href="#local-6989586621681493637"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PeerInfo
-&gt; SuccessiveFailures
-&gt; LastSuccess
-&gt; Set NetworkId
-&gt; ActiveSessionCount
-&gt; PeerEntry
</span><a href="P2P.Node.PeerDB.html#PeerEntry"><span class="hs-identifier hs-var">PeerEntry</span></a></span><span> </span><span class="annot"><span class="annottext">PeerInfo
</span><a href="#local-6989586621681493637"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe UTCTime -&gt; LastSuccess
</span><a href="P2P.Node.PeerDB.html#LastSuccess"><span class="hs-identifier hs-var">LastSuccess</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe UTCTime
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NetworkId -&gt; Set NetworkId
forall a. a -&gt; Set a
</span><span class="hs-identifier hs-var">S.singleton</span></span><span> </span><span class="annot"><span class="annottext">NetworkId
</span><a href="#local-6989586621681493638"><span class="hs-identifier hs-var">nid</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-number">0</span></span><span>
</span><span id="line-170"></span><span>
</span><span id="line-171"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681493633"><span class="annot"><span class="hs-identifier hs-type">Arbitrary</span></span><span> </span><span class="annot"><a href="P2P.Node.PeerDB.html#PeerEntry"><span class="hs-identifier hs-type">PeerEntry</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-172"></span><span>    </span><span id="local-6989586621681493632"><span class="annot"><span class="annottext">arbitrary :: Gen PeerEntry
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">arbitrary</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PeerInfo
-&gt; SuccessiveFailures
-&gt; LastSuccess
-&gt; Set NetworkId
-&gt; ActiveSessionCount
-&gt; PeerEntry
</span><a href="P2P.Node.PeerDB.html#PeerEntry"><span class="hs-identifier hs-var">PeerEntry</span></a></span><span>
</span><span id="line-173"></span><span>        </span><span class="annot"><span class="annottext">(PeerInfo
 -&gt; SuccessiveFailures
 -&gt; LastSuccess
 -&gt; Set NetworkId
 -&gt; ActiveSessionCount
 -&gt; PeerEntry)
-&gt; Gen PeerInfo
-&gt; Gen
     (SuccessiveFailures
      -&gt; LastSuccess -&gt; Set NetworkId -&gt; ActiveSessionCount -&gt; PeerEntry)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Gen PeerInfo
forall a. Arbitrary a =&gt; Gen a
</span><span class="hs-identifier hs-var">arbitrary</span></span><span> </span><span class="annot"><span class="annottext">Gen
  (SuccessiveFailures
   -&gt; LastSuccess -&gt; Set NetworkId -&gt; ActiveSessionCount -&gt; PeerEntry)
-&gt; Gen SuccessiveFailures
-&gt; Gen
     (LastSuccess -&gt; Set NetworkId -&gt; ActiveSessionCount -&gt; PeerEntry)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Gen SuccessiveFailures
forall a. Arbitrary a =&gt; Gen a
</span><span class="hs-identifier hs-var">arbitrary</span></span><span> </span><span class="annot"><span class="annottext">Gen
  (LastSuccess -&gt; Set NetworkId -&gt; ActiveSessionCount -&gt; PeerEntry)
-&gt; Gen LastSuccess
-&gt; Gen (Set NetworkId -&gt; ActiveSessionCount -&gt; PeerEntry)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Gen LastSuccess
forall a. Arbitrary a =&gt; Gen a
</span><span class="hs-identifier hs-var">arbitrary</span></span><span> </span><span class="annot"><span class="annottext">Gen (Set NetworkId -&gt; ActiveSessionCount -&gt; PeerEntry)
-&gt; Gen (Set NetworkId) -&gt; Gen (ActiveSessionCount -&gt; PeerEntry)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Gen (Set NetworkId)
forall a. Arbitrary a =&gt; Gen a
</span><span class="hs-identifier hs-var">arbitrary</span></span><span> </span><span class="annot"><span class="annottext">Gen (ActiveSessionCount -&gt; PeerEntry)
-&gt; Gen ActiveSessionCount -&gt; Gen PeerEntry
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Gen ActiveSessionCount
forall a. Arbitrary a =&gt; Gen a
</span><span class="hs-identifier hs-var">arbitrary</span></span><span>
</span><span id="line-174"></span><span>
</span><span id="line-175"></span><span class="hs-comment">-- -------------------------------------------------------------------------- --</span><span>
</span><span id="line-176"></span><span class="hs-comment">-- Peer Entry Set</span><span>
</span><span id="line-177"></span><span>
</span><span id="line-178"></span><span class="hs-keyword">type</span><span> </span><span id="PeerEntryIxs"><span class="annot"><a href="P2P.Node.PeerDB.html#PeerEntryIxs"><span class="hs-identifier hs-var">PeerEntryIxs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-179"></span><span>    </span><span class="hs-special">'</span><span class="hs-special">[</span><span> </span><span class="annot"><a href="Chainweb.HostAddress.html#HostAddress"><span class="hs-identifier hs-type">HostAddress</span></a></span><span>
</span><span id="line-180"></span><span>        </span><span class="hs-comment">-- a primary index</span><span>
</span><span id="line-181"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="P2P.Peer.html#PeerId"><span class="hs-identifier hs-type">PeerId</span></a></span><span>
</span><span id="line-182"></span><span>        </span><span class="hs-comment">-- unique index in the 'Just' values, but not in the 'Nothing' values</span><span>
</span><span id="line-183"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="P2P.Node.PeerDB.html#SuccessiveFailures"><span class="hs-identifier hs-type">SuccessiveFailures</span></a></span><span>
</span><span id="line-184"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="P2P.Node.PeerDB.html#LastSuccess"><span class="hs-identifier hs-type">LastSuccess</span></a></span><span>
</span><span id="line-185"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Chainweb.RestAPI.NetworkID.html#NetworkId"><span class="hs-identifier hs-type">NetworkId</span></a></span><span>
</span><span id="line-186"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="P2P.Node.PeerDB.html#ActiveSessionCount"><span class="hs-identifier hs-type">ActiveSessionCount</span></a></span><span>
</span><span id="line-187"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-188"></span><span>
</span><span id="line-189"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Indexable</span></span><span> </span><span class="annot"><a href="P2P.Node.PeerDB.html#PeerEntryIxs"><span class="hs-identifier hs-type">PeerEntryIxs</span></a></span><span> </span><span class="annot"><a href="P2P.Node.PeerDB.html#PeerEntry"><span class="hs-identifier hs-type">PeerEntry</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-190"></span><span>    </span><span id="local-6989586621681493625"><span class="annot"><span class="annottext">indices :: IxList PeerEntryIxs PeerEntry
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">indices</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ix HostAddress PeerEntry
-&gt; Ix (Maybe PeerId) PeerEntry
-&gt; Ix SuccessiveFailures PeerEntry
-&gt; Ix LastSuccess PeerEntry
-&gt; Ix NetworkId PeerEntry
-&gt; Ix ActiveSessionCount PeerEntry
-&gt; IxList PeerEntryIxs PeerEntry
forall (ixs :: [*]) a r. MkIxList ixs ixs a r =&gt; r
</span><span class="hs-identifier hs-var">ixList</span></span><span>
</span><span id="line-191"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(PeerEntry -&gt; [HostAddress]) -&gt; Ix HostAddress PeerEntry
forall ix a. Ord ix =&gt; (a -&gt; [ix]) -&gt; Ix ix a
</span><span class="hs-identifier hs-var">ixFun</span></span><span> </span><span class="annot"><span class="annottext">((PeerEntry -&gt; [HostAddress]) -&gt; Ix HostAddress PeerEntry)
-&gt; (PeerEntry -&gt; [HostAddress]) -&gt; Ix HostAddress PeerEntry
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681493621"><span class="annot"><span class="annottext">e :: PeerEntry
</span><a href="#local-6989586621681493621"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PeerInfo -&gt; HostAddress
</span><a href="P2P.Peer.html#_peerAddr"><span class="hs-identifier hs-var hs-var">_peerAddr</span></a></span><span> </span><span class="annot"><span class="annottext">(PeerInfo -&gt; HostAddress) -&gt; PeerInfo -&gt; HostAddress
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PeerEntry -&gt; PeerInfo
</span><a href="P2P.Node.PeerDB.html#_peerEntryInfo"><span class="hs-identifier hs-var hs-var">_peerEntryInfo</span></a></span><span> </span><span class="annot"><span class="annottext">PeerEntry
</span><a href="#local-6989586621681493621"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-192"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(PeerEntry -&gt; [Maybe PeerId]) -&gt; Ix (Maybe PeerId) PeerEntry
forall ix a. Ord ix =&gt; (a -&gt; [ix]) -&gt; Ix ix a
</span><span class="hs-identifier hs-var">ixFun</span></span><span> </span><span class="annot"><span class="annottext">((PeerEntry -&gt; [Maybe PeerId]) -&gt; Ix (Maybe PeerId) PeerEntry)
-&gt; (PeerEntry -&gt; [Maybe PeerId]) -&gt; Ix (Maybe PeerId) PeerEntry
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681493619"><span class="annot"><span class="annottext">e :: PeerEntry
</span><a href="#local-6989586621681493619"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PeerInfo -&gt; Maybe PeerId
</span><a href="P2P.Peer.html#_peerId"><span class="hs-identifier hs-var hs-var">_peerId</span></a></span><span> </span><span class="annot"><span class="annottext">(PeerInfo -&gt; Maybe PeerId) -&gt; PeerInfo -&gt; Maybe PeerId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PeerEntry -&gt; PeerInfo
</span><a href="P2P.Node.PeerDB.html#_peerEntryInfo"><span class="hs-identifier hs-var hs-var">_peerEntryInfo</span></a></span><span> </span><span class="annot"><span class="annottext">PeerEntry
</span><a href="#local-6989586621681493619"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-193"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(PeerEntry -&gt; [SuccessiveFailures])
-&gt; Ix SuccessiveFailures PeerEntry
forall ix a. Ord ix =&gt; (a -&gt; [ix]) -&gt; Ix ix a
</span><span class="hs-identifier hs-var">ixFun</span></span><span> </span><span class="annot"><span class="annottext">((PeerEntry -&gt; [SuccessiveFailures])
 -&gt; Ix SuccessiveFailures PeerEntry)
-&gt; (PeerEntry -&gt; [SuccessiveFailures])
-&gt; Ix SuccessiveFailures PeerEntry
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681493617"><span class="annot"><span class="annottext">e :: PeerEntry
</span><a href="#local-6989586621681493617"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PeerEntry -&gt; SuccessiveFailures
</span><a href="P2P.Node.PeerDB.html#_peerEntrySuccessiveFailures"><span class="hs-identifier hs-var hs-var">_peerEntrySuccessiveFailures</span></a></span><span> </span><span class="annot"><span class="annottext">PeerEntry
</span><a href="#local-6989586621681493617"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-194"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(PeerEntry -&gt; [LastSuccess]) -&gt; Ix LastSuccess PeerEntry
forall ix a. Ord ix =&gt; (a -&gt; [ix]) -&gt; Ix ix a
</span><span class="hs-identifier hs-var">ixFun</span></span><span> </span><span class="annot"><span class="annottext">((PeerEntry -&gt; [LastSuccess]) -&gt; Ix LastSuccess PeerEntry)
-&gt; (PeerEntry -&gt; [LastSuccess]) -&gt; Ix LastSuccess PeerEntry
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681493616"><span class="annot"><span class="annottext">e :: PeerEntry
</span><a href="#local-6989586621681493616"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PeerEntry -&gt; LastSuccess
</span><a href="P2P.Node.PeerDB.html#_peerEntryLastSuccess"><span class="hs-identifier hs-var hs-var">_peerEntryLastSuccess</span></a></span><span> </span><span class="annot"><span class="annottext">PeerEntry
</span><a href="#local-6989586621681493616"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-195"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(PeerEntry -&gt; [NetworkId]) -&gt; Ix NetworkId PeerEntry
forall ix a. Ord ix =&gt; (a -&gt; [ix]) -&gt; Ix ix a
</span><span class="hs-identifier hs-var">ixFun</span></span><span> </span><span class="annot"><span class="annottext">((PeerEntry -&gt; [NetworkId]) -&gt; Ix NetworkId PeerEntry)
-&gt; (PeerEntry -&gt; [NetworkId]) -&gt; Ix NetworkId PeerEntry
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681493615"><span class="annot"><span class="annottext">e :: PeerEntry
</span><a href="#local-6989586621681493615"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Set NetworkId -&gt; [NetworkId]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">F.toList</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PeerEntry -&gt; Set NetworkId
</span><a href="P2P.Node.PeerDB.html#_peerEntryNetworkIds"><span class="hs-identifier hs-var hs-var">_peerEntryNetworkIds</span></a></span><span> </span><span class="annot"><span class="annottext">PeerEntry
</span><a href="#local-6989586621681493615"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-196"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(PeerEntry -&gt; [ActiveSessionCount])
-&gt; Ix ActiveSessionCount PeerEntry
forall ix a. Ord ix =&gt; (a -&gt; [ix]) -&gt; Ix ix a
</span><span class="hs-identifier hs-var">ixFun</span></span><span> </span><span class="annot"><span class="annottext">((PeerEntry -&gt; [ActiveSessionCount])
 -&gt; Ix ActiveSessionCount PeerEntry)
-&gt; (PeerEntry -&gt; [ActiveSessionCount])
-&gt; Ix ActiveSessionCount PeerEntry
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681493613"><span class="annot"><span class="annottext">e :: PeerEntry
</span><a href="#local-6989586621681493613"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PeerEntry -&gt; ActiveSessionCount
</span><a href="P2P.Node.PeerDB.html#_peerEntryActiveSessionCount"><span class="hs-identifier hs-var hs-var">_peerEntryActiveSessionCount</span></a></span><span> </span><span class="annot"><span class="annottext">PeerEntry
</span><a href="#local-6989586621681493613"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-197"></span><span>
</span><span id="line-198"></span><span class="hs-keyword">type</span><span> </span><span id="PeerSet"><span class="annot"><a href="P2P.Node.PeerDB.html#PeerSet"><span class="hs-identifier hs-var">PeerSet</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IxSet</span></span><span> </span><span class="annot"><a href="P2P.Node.PeerDB.html#PeerEntryIxs"><span class="hs-identifier hs-type">PeerEntryIxs</span></a></span><span> </span><span class="annot"><a href="P2P.Node.PeerDB.html#PeerEntry"><span class="hs-identifier hs-type">PeerEntry</span></a></span><span>
</span><span id="line-199"></span><span>
</span><span id="line-200"></span><span class="annot"><a href="P2P.Node.PeerDB.html#toPeerSet"><span class="hs-identifier hs-type">toPeerSet</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="P2P.Node.PeerDB.html#PeerSet"><span class="hs-identifier hs-type">PeerSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">S.Set</span></span><span> </span><span class="annot"><a href="P2P.Node.PeerDB.html#PeerEntry"><span class="hs-identifier hs-type">PeerEntry</span></a></span><span>
</span><span id="line-201"></span><span id="toPeerSet"><span class="annot"><span class="annottext">toPeerSet :: PeerSet -&gt; Set PeerEntry
</span><a href="P2P.Node.PeerDB.html#toPeerSet"><span class="hs-identifier hs-var hs-var">toPeerSet</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PeerSet -&gt; Set PeerEntry
forall (ixs :: [*]) a. IxSet ixs a -&gt; Set a
</span><span class="hs-identifier hs-var">toSet</span></span><span>
</span><span id="line-202"></span><span>
</span><span id="line-203"></span><span class="hs-comment">-- | Create new 'PeerSet' from a list of 'PeerEntry's</span><span>
</span><span id="line-204"></span><span class="hs-comment">--</span><span>
</span><span id="line-205"></span><span class="annot"><a href="P2P.Node.PeerDB.html#fromPeerSet"><span class="hs-identifier hs-type">fromPeerSet</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">S.Set</span></span><span> </span><span class="annot"><a href="P2P.Node.PeerDB.html#PeerEntry"><span class="hs-identifier hs-type">PeerEntry</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="P2P.Node.PeerDB.html#PeerSet"><span class="hs-identifier hs-type">PeerSet</span></a></span><span>
</span><span id="line-206"></span><span id="fromPeerSet"><span class="annot"><span class="annottext">fromPeerSet :: Set PeerEntry -&gt; PeerSet
</span><a href="P2P.Node.PeerDB.html#fromPeerSet"><span class="hs-identifier hs-var hs-var">fromPeerSet</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set PeerEntry -&gt; PeerSet
forall (ixs :: [*]) a. Indexable ixs a =&gt; Set a -&gt; IxSet ixs a
</span><span class="hs-identifier hs-var">fromSet</span></span><span>
</span><span id="line-207"></span><span>
</span><span id="line-208"></span><span class="hs-comment">-- | Add a 'PeerInfo' to an existing 'PeerSet'.</span><span>
</span><span id="line-209"></span><span class="hs-comment">--</span><span>
</span><span id="line-210"></span><span class="hs-comment">-- If the 'PeerAddr' doesn't exist, a new entry is created.</span><span>
</span><span id="line-211"></span><span class="hs-comment">--</span><span>
</span><span id="line-212"></span><span class="hs-comment">-- If the 'PeerAddr' exist with peer-id Nothing, the peer-id is updated and</span><span>
</span><span id="line-213"></span><span class="hs-comment">-- chain id is added.</span><span>
</span><span id="line-214"></span><span class="hs-comment">--</span><span>
</span><span id="line-215"></span><span class="hs-comment">-- If the 'PeerAddr' exist with 'Just' a different peer-id, the existing</span><span>
</span><span id="line-216"></span><span class="hs-comment">-- entry is replaced.</span><span>
</span><span id="line-217"></span><span class="hs-comment">--</span><span>
</span><span id="line-218"></span><span class="hs-comment">-- If the 'PeerAddr' exist with the same peer-id, the chain-id is added.</span><span>
</span><span id="line-219"></span><span class="hs-comment">--</span><span>
</span><span id="line-220"></span><span class="annot"><a href="P2P.Node.PeerDB.html#addPeerEntry"><span class="hs-identifier hs-type">addPeerEntry</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="P2P.Node.PeerDB.html#PeerEntry"><span class="hs-identifier hs-type">PeerEntry</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="P2P.Node.PeerDB.html#PeerSet"><span class="hs-identifier hs-type">PeerSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="P2P.Node.PeerDB.html#PeerSet"><span class="hs-identifier hs-type">PeerSet</span></a></span><span>
</span><span id="line-221"></span><span id="addPeerEntry"><span class="annot"><span class="annottext">addPeerEntry :: PeerEntry -&gt; PeerSet -&gt; PeerSet
</span><a href="P2P.Node.PeerDB.html#addPeerEntry"><span class="hs-identifier hs-var hs-var">addPeerEntry</span></a></span></span><span> </span><span id="local-6989586621681493607"><span class="annot"><span class="annottext">b :: PeerEntry
</span><a href="#local-6989586621681493607"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621681493606"><span class="annot"><span class="annottext">m :: PeerSet
</span><a href="#local-6989586621681493606"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PeerSet
</span><a href="#local-6989586621681493606"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">PeerSet -&gt; (PeerSet -&gt; PeerSet) -&gt; PeerSet
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PeerSet -&gt; Maybe PeerEntry
forall a (ixs :: [*]). Ord a =&gt; IxSet ixs a -&gt; Maybe a
</span><span class="hs-identifier hs-var">getOne</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HostAddress -&gt; PeerSet -&gt; PeerSet
forall (ixs :: [*]) a ix.
(Indexable ixs a, IsIndexOf ix ixs) =&gt;
ix -&gt; IxSet ixs a -&gt; IxSet ixs a
</span><span class="hs-identifier hs-var">getEQ</span></span><span> </span><span class="annot"><span class="annottext">HostAddress
</span><a href="#local-6989586621681493602"><span class="hs-identifier hs-var">addr</span></a></span><span> </span><span class="annot"><span class="annottext">PeerSet
</span><a href="#local-6989586621681493606"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-222"></span><span>
</span><span id="line-223"></span><span>    </span><span class="hs-comment">-- new peer doesn't exist: insert</span><span>
</span><span id="line-224"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HostAddress -&gt; PeerEntry -&gt; PeerSet -&gt; PeerSet
forall (ixs :: [*]) a ix.
(Indexable ixs a, IsIndexOf ix ixs) =&gt;
ix -&gt; a -&gt; IxSet ixs a -&gt; IxSet ixs a
</span><span class="hs-identifier hs-var">updateIx</span></span><span> </span><span class="annot"><span class="annottext">HostAddress
</span><a href="#local-6989586621681493602"><span class="hs-identifier hs-var">addr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PeerEntry -&gt; PeerEntry
forall a. NFData a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">force</span></span><span> </span><span class="annot"><span class="annottext">PeerEntry
</span><a href="#local-6989586621681493607"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-225"></span><span>
</span><span id="line-226"></span><span>    </span><span class="hs-comment">-- existing peer addr</span><span>
</span><span id="line-227"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621681493599"><span class="annot"><span class="annottext">a :: PeerEntry
</span><a href="#local-6989586621681493599"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PeerInfo -&gt; Maybe PeerId
</span><a href="P2P.Peer.html#_peerId"><span class="hs-identifier hs-var hs-var">_peerId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PeerEntry -&gt; PeerInfo
</span><a href="P2P.Node.PeerDB.html#_peerEntryInfo"><span class="hs-identifier hs-var hs-var">_peerEntryInfo</span></a></span><span> </span><span class="annot"><span class="annottext">PeerEntry
</span><a href="#local-6989586621681493599"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-228"></span><span>
</span><span id="line-229"></span><span>        </span><span class="hs-comment">-- existing peer without peer id: update peer id and chain ids</span><span>
</span><span id="line-230"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PeerEntry -&gt; PeerSet -&gt; PeerSet
</span><a href="#local-6989586621681493598"><span class="hs-identifier hs-var">update</span></a></span><span> </span><span class="annot"><span class="annottext">PeerEntry
</span><a href="#local-6989586621681493599"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-231"></span><span>
</span><span id="line-232"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621681493597"><span class="annot"><span class="annottext">pid :: PeerId
</span><a href="#local-6989586621681493597"><span class="hs-identifier hs-var">pid</span></a></span></span><span>
</span><span id="line-233"></span><span>            </span><span class="hs-comment">-- new peer id: replace existing peer</span><span>
</span><span id="line-234"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">PeerId -&gt; Maybe PeerId
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">PeerId
</span><a href="#local-6989586621681493597"><span class="hs-identifier hs-var">pid</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe PeerId -&gt; Maybe PeerId -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">PeerInfo -&gt; Maybe PeerId
</span><a href="P2P.Peer.html#_peerId"><span class="hs-identifier hs-var hs-var">_peerId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PeerEntry -&gt; PeerInfo
</span><a href="P2P.Node.PeerDB.html#_peerEntryInfo"><span class="hs-identifier hs-var hs-var">_peerEntryInfo</span></a></span><span> </span><span class="annot"><span class="annottext">PeerEntry
</span><a href="#local-6989586621681493607"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PeerSet -&gt; PeerSet
</span><a href="#local-6989586621681493595"><span class="hs-identifier hs-var">replace</span></a></span><span>
</span><span id="line-235"></span><span>
</span><span id="line-236"></span><span>            </span><span class="hs-comment">-- existing peer: update chain-ids</span><span>
</span><span id="line-237"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PeerEntry -&gt; PeerSet -&gt; PeerSet
</span><a href="#local-6989586621681493598"><span class="hs-identifier hs-var">update</span></a></span><span> </span><span class="annot"><span class="annottext">PeerEntry
</span><a href="#local-6989586621681493599"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-238"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-239"></span><span>    </span><span id="local-6989586621681493602"><span class="annot"><span class="annottext">addr :: HostAddress
</span><a href="#local-6989586621681493602"><span class="hs-identifier hs-var hs-var">addr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PeerInfo -&gt; HostAddress
</span><a href="P2P.Peer.html#_peerAddr"><span class="hs-identifier hs-var hs-var">_peerAddr</span></a></span><span> </span><span class="annot"><span class="annottext">(PeerInfo -&gt; HostAddress) -&gt; PeerInfo -&gt; HostAddress
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PeerEntry -&gt; PeerInfo
</span><a href="P2P.Node.PeerDB.html#_peerEntryInfo"><span class="hs-identifier hs-var hs-var">_peerEntryInfo</span></a></span><span> </span><span class="annot"><span class="annottext">PeerEntry
</span><a href="#local-6989586621681493607"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-240"></span><span>    </span><span id="local-6989586621681493595"><span class="annot"><span class="annottext">replace :: PeerSet -&gt; PeerSet
</span><a href="#local-6989586621681493595"><span class="hs-identifier hs-var hs-var">replace</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HostAddress -&gt; PeerEntry -&gt; PeerSet -&gt; PeerSet
forall (ixs :: [*]) a ix.
(Indexable ixs a, IsIndexOf ix ixs) =&gt;
ix -&gt; a -&gt; IxSet ixs a -&gt; IxSet ixs a
</span><span class="hs-identifier hs-var">updateIx</span></span><span> </span><span class="annot"><span class="annottext">HostAddress
</span><a href="#local-6989586621681493602"><span class="hs-identifier hs-var">addr</span></a></span><span> </span><span class="annot"><span class="annottext">PeerEntry
</span><a href="#local-6989586621681493607"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-241"></span><span>    </span><span id="local-6989586621681493598"><span class="annot"><span class="annottext">update :: PeerEntry -&gt; PeerSet -&gt; PeerSet
</span><a href="#local-6989586621681493598"><span class="hs-identifier hs-var hs-var">update</span></a></span></span><span> </span><span id="local-6989586621681493594"><span class="annot"><span class="annottext">a :: PeerEntry
</span><a href="#local-6989586621681493594"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HostAddress -&gt; PeerEntry -&gt; PeerSet -&gt; PeerSet
forall (ixs :: [*]) a ix.
(Indexable ixs a, IsIndexOf ix ixs) =&gt;
ix -&gt; a -&gt; IxSet ixs a -&gt; IxSet ixs a
</span><span class="hs-identifier hs-var">updateIx</span></span><span> </span><span class="annot"><span class="annottext">HostAddress
</span><a href="#local-6989586621681493602"><span class="hs-identifier hs-var">addr</span></a></span><span> </span><span class="annot"><span class="annottext">(PeerEntry -&gt; PeerSet -&gt; PeerSet)
-&gt; PeerEntry -&gt; PeerSet -&gt; PeerSet
forall a b. NFData a =&gt; (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!!</span></span><span> </span><span class="annot"><span class="annottext">$WPeerEntry :: PeerInfo
-&gt; SuccessiveFailures
-&gt; LastSuccess
-&gt; Set NetworkId
-&gt; ActiveSessionCount
-&gt; PeerEntry
</span><a href="P2P.Node.PeerDB.html#%24WPeerEntry"><span class="hs-identifier hs-type hs-type">PeerEntry</span></a></span><span>
</span><span id="line-242"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">_peerEntryInfo :: PeerInfo
</span><a href="P2P.Node.PeerDB.html#_peerEntryInfo"><span class="hs-identifier hs-var">_peerEntryInfo</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PeerEntry -&gt; PeerInfo
</span><a href="P2P.Node.PeerDB.html#_peerEntryInfo"><span class="hs-identifier hs-var hs-var">_peerEntryInfo</span></a></span><span> </span><span class="annot"><span class="annottext">PeerEntry
</span><a href="#local-6989586621681493594"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-243"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_peerEntrySuccessiveFailures :: SuccessiveFailures
</span><a href="P2P.Node.PeerDB.html#_peerEntrySuccessiveFailures"><span class="hs-identifier hs-var">_peerEntrySuccessiveFailures</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PeerEntry -&gt; SuccessiveFailures
</span><a href="P2P.Node.PeerDB.html#_peerEntrySuccessiveFailures"><span class="hs-identifier hs-var hs-var">_peerEntrySuccessiveFailures</span></a></span><span> </span><span class="annot"><span class="annottext">PeerEntry
</span><a href="#local-6989586621681493594"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">SuccessiveFailures -&gt; SuccessiveFailures -&gt; SuccessiveFailures
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">PeerEntry -&gt; SuccessiveFailures
</span><a href="P2P.Node.PeerDB.html#_peerEntrySuccessiveFailures"><span class="hs-identifier hs-var hs-var">_peerEntrySuccessiveFailures</span></a></span><span> </span><span class="annot"><span class="annottext">PeerEntry
</span><a href="#local-6989586621681493607"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-244"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_peerEntryLastSuccess :: LastSuccess
</span><a href="P2P.Node.PeerDB.html#_peerEntryLastSuccess"><span class="hs-identifier hs-var">_peerEntryLastSuccess</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LastSuccess -&gt; LastSuccess -&gt; LastSuccess
forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">max</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PeerEntry -&gt; LastSuccess
</span><a href="P2P.Node.PeerDB.html#_peerEntryLastSuccess"><span class="hs-identifier hs-var hs-var">_peerEntryLastSuccess</span></a></span><span> </span><span class="annot"><span class="annottext">PeerEntry
</span><a href="#local-6989586621681493594"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PeerEntry -&gt; LastSuccess
</span><a href="P2P.Node.PeerDB.html#_peerEntryLastSuccess"><span class="hs-identifier hs-var hs-var">_peerEntryLastSuccess</span></a></span><span> </span><span class="annot"><span class="annottext">PeerEntry
</span><a href="#local-6989586621681493607"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-245"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_peerEntryNetworkIds :: Set NetworkId
</span><a href="P2P.Node.PeerDB.html#_peerEntryNetworkIds"><span class="hs-identifier hs-var">_peerEntryNetworkIds</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PeerEntry -&gt; Set NetworkId
</span><a href="P2P.Node.PeerDB.html#_peerEntryNetworkIds"><span class="hs-identifier hs-var hs-var">_peerEntryNetworkIds</span></a></span><span> </span><span class="annot"><span class="annottext">PeerEntry
</span><a href="#local-6989586621681493594"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Set NetworkId -&gt; Set NetworkId -&gt; Set NetworkId
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">PeerEntry -&gt; Set NetworkId
</span><a href="P2P.Node.PeerDB.html#_peerEntryNetworkIds"><span class="hs-identifier hs-var hs-var">_peerEntryNetworkIds</span></a></span><span> </span><span class="annot"><span class="annottext">PeerEntry
</span><a href="#local-6989586621681493607"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-246"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_peerEntryActiveSessionCount :: ActiveSessionCount
</span><a href="P2P.Node.PeerDB.html#_peerEntryActiveSessionCount"><span class="hs-identifier hs-var">_peerEntryActiveSessionCount</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PeerEntry -&gt; ActiveSessionCount
</span><a href="P2P.Node.PeerDB.html#_peerEntryActiveSessionCount"><span class="hs-identifier hs-var hs-var">_peerEntryActiveSessionCount</span></a></span><span> </span><span class="annot"><span class="annottext">PeerEntry
</span><a href="#local-6989586621681493594"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">ActiveSessionCount -&gt; ActiveSessionCount -&gt; ActiveSessionCount
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">PeerEntry -&gt; ActiveSessionCount
</span><a href="P2P.Node.PeerDB.html#_peerEntryActiveSessionCount"><span class="hs-identifier hs-var hs-var">_peerEntryActiveSessionCount</span></a></span><span> </span><span class="annot"><span class="annottext">PeerEntry
</span><a href="#local-6989586621681493607"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-247"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-248"></span><span>
</span><span id="line-249"></span><span class="hs-comment">-- | Add a 'PeerInfo' to an existing 'PeerSet'.</span><span>
</span><span id="line-250"></span><span class="hs-comment">--</span><span>
</span><span id="line-251"></span><span class="hs-comment">-- If the 'PeerAddr' doesn't exist, a new entry is created.</span><span>
</span><span id="line-252"></span><span class="hs-comment">--</span><span>
</span><span id="line-253"></span><span class="hs-comment">-- If the 'PeerAddr' exist with peer-id Nothing, the peer-id is updated and</span><span>
</span><span id="line-254"></span><span class="hs-comment">-- chain id is added.</span><span>
</span><span id="line-255"></span><span class="hs-comment">--</span><span>
</span><span id="line-256"></span><span class="hs-comment">-- If the 'PeerAddr' exist with 'Just' a different peer-id, the existing</span><span>
</span><span id="line-257"></span><span class="hs-comment">-- entry is replaced.</span><span>
</span><span id="line-258"></span><span class="hs-comment">--</span><span>
</span><span id="line-259"></span><span class="hs-comment">-- If the 'PeerAddr' exist with the same peer-id, the chain-id is added.</span><span>
</span><span id="line-260"></span><span class="hs-comment">--</span><span>
</span><span id="line-261"></span><span class="annot"><a href="P2P.Node.PeerDB.html#addPeerInfo"><span class="hs-identifier hs-type">addPeerInfo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Chainweb.RestAPI.NetworkID.html#NetworkId"><span class="hs-identifier hs-type">NetworkId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="P2P.Peer.html#PeerInfo"><span class="hs-identifier hs-type">PeerInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="P2P.Node.PeerDB.html#PeerSet"><span class="hs-identifier hs-type">PeerSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="P2P.Node.PeerDB.html#PeerSet"><span class="hs-identifier hs-type">PeerSet</span></a></span><span>
</span><span id="line-262"></span><span id="addPeerInfo"><span class="annot"><span class="annottext">addPeerInfo :: NetworkId -&gt; PeerInfo -&gt; PeerSet -&gt; PeerSet
</span><a href="P2P.Node.PeerDB.html#addPeerInfo"><span class="hs-identifier hs-var hs-var">addPeerInfo</span></a></span></span><span> </span><span id="local-6989586621681493588"><span class="annot"><span class="annottext">nid :: NetworkId
</span><a href="#local-6989586621681493588"><span class="hs-identifier hs-var">nid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PeerEntry -&gt; PeerSet -&gt; PeerSet
</span><a href="P2P.Node.PeerDB.html#addPeerEntry"><span class="hs-identifier hs-var">addPeerEntry</span></a></span><span> </span><span class="annot"><span class="annottext">(PeerEntry -&gt; PeerSet -&gt; PeerSet)
-&gt; (PeerInfo -&gt; PeerEntry) -&gt; PeerInfo -&gt; PeerSet -&gt; PeerSet
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">NetworkId -&gt; PeerInfo -&gt; PeerEntry
</span><a href="P2P.Node.PeerDB.html#newPeerEntry"><span class="hs-identifier hs-var">newPeerEntry</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkId
</span><a href="#local-6989586621681493588"><span class="hs-identifier hs-var">nid</span></a></span><span>
</span><span id="line-263"></span><span>
</span><span id="line-264"></span><span class="hs-comment">-- | Delete a peer, identified by its host address, from the 'PeerSet'. The peer</span><span>
</span><span id="line-265"></span><span class="hs-comment">-- is delete for all network ids.</span><span>
</span><span id="line-266"></span><span class="hs-comment">--</span><span>
</span><span id="line-267"></span><span class="annot"><a href="P2P.Node.PeerDB.html#deletePeer"><span class="hs-identifier hs-type">deletePeer</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="P2P.Peer.html#PeerInfo"><span class="hs-identifier hs-type">PeerInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="P2P.Node.PeerDB.html#PeerSet"><span class="hs-identifier hs-type">PeerSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="P2P.Node.PeerDB.html#PeerSet"><span class="hs-identifier hs-type">PeerSet</span></a></span><span>
</span><span id="line-268"></span><span id="deletePeer"><span class="annot"><span class="annottext">deletePeer :: PeerInfo -&gt; PeerSet -&gt; PeerSet
</span><a href="P2P.Node.PeerDB.html#deletePeer"><span class="hs-identifier hs-var hs-var">deletePeer</span></a></span></span><span> </span><span id="local-6989586621681493585"><span class="annot"><span class="annottext">i :: PeerInfo
</span><a href="#local-6989586621681493585"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HostAddress -&gt; PeerSet -&gt; PeerSet
forall (ixs :: [*]) a ix.
(Indexable ixs a, IsIndexOf ix ixs) =&gt;
ix -&gt; IxSet ixs a -&gt; IxSet ixs a
</span><span class="hs-identifier hs-var">deleteIx</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PeerInfo -&gt; HostAddress
</span><a href="P2P.Peer.html#_peerAddr"><span class="hs-identifier hs-var hs-var">_peerAddr</span></a></span><span> </span><span class="annot"><span class="annottext">PeerInfo
</span><a href="#local-6989586621681493585"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-269"></span><span>
</span><span id="line-270"></span><span class="annot"><a href="P2P.Node.PeerDB.html#insertPeerEntryList"><span class="hs-identifier hs-type">insertPeerEntryList</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="P2P.Node.PeerDB.html#PeerEntry"><span class="hs-identifier hs-type">PeerEntry</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="P2P.Node.PeerDB.html#PeerSet"><span class="hs-identifier hs-type">PeerSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="P2P.Node.PeerDB.html#PeerSet"><span class="hs-identifier hs-type">PeerSet</span></a></span><span>
</span><span id="line-271"></span><span id="insertPeerEntryList"><span class="annot"><span class="annottext">insertPeerEntryList :: [PeerEntry] -&gt; PeerSet -&gt; PeerSet
</span><a href="P2P.Node.PeerDB.html#insertPeerEntryList"><span class="hs-identifier hs-var hs-var">insertPeerEntryList</span></a></span></span><span> </span><span id="local-6989586621681493582"><span class="annot"><span class="annottext">l :: [PeerEntry]
</span><a href="#local-6989586621681493582"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621681493581"><span class="annot"><span class="annottext">m :: PeerSet
</span><a href="#local-6989586621681493581"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(PeerSet -&gt; PeerEntry -&gt; PeerSet)
-&gt; PeerSet -&gt; [PeerEntry] -&gt; PeerSet
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl'</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(PeerEntry -&gt; PeerSet -&gt; PeerSet)
-&gt; PeerSet -&gt; PeerEntry -&gt; PeerSet
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">PeerEntry -&gt; PeerSet -&gt; PeerSet
</span><a href="P2P.Node.PeerDB.html#addPeerEntry"><span class="hs-identifier hs-var">addPeerEntry</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PeerSet
</span><a href="#local-6989586621681493581"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">[PeerEntry]
</span><a href="#local-6989586621681493582"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-272"></span><span>
</span><span id="line-273"></span><span class="hs-comment">-- -------------------------------------------------------------------------- --</span><span>
</span><span id="line-274"></span><span class="hs-comment">-- Peer Database</span><span>
</span><span id="line-275"></span><span>
</span><span id="line-276"></span><span id="local-6989586621681493578"><span id="local-6989586621681493579"></span></span><span class="hs-keyword">data</span><span> </span><span id="PeerDb"><span class="annot"><a href="P2P.Node.PeerDB.html#PeerDb"><span class="hs-identifier hs-var">PeerDb</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="PeerDb"><span class="annot"><a href="P2P.Node.PeerDB.html#PeerDb"><span class="hs-identifier hs-var">PeerDb</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MVar</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TVar</span></span><span> </span><span class="annot"><a href="P2P.Node.PeerDB.html#PeerSet"><span class="hs-identifier hs-type">PeerSet</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-277"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681493573"><span id="local-6989586621681493575"><span class="annot"><span class="annottext">PeerDb -&gt; PeerDb -&gt; Bool
(PeerDb -&gt; PeerDb -&gt; Bool)
-&gt; (PeerDb -&gt; PeerDb -&gt; Bool) -&gt; Eq PeerDb
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: PeerDb -&gt; PeerDb -&gt; Bool
$c/= :: PeerDb -&gt; PeerDb -&gt; Bool
== :: PeerDb -&gt; PeerDb -&gt; Bool
$c== :: PeerDb -&gt; PeerDb -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(forall x. PeerDb -&gt; Rep PeerDb x)
-&gt; (forall x. Rep PeerDb x -&gt; PeerDb) -&gt; Generic PeerDb
forall x. Rep PeerDb x -&gt; PeerDb
forall x. PeerDb -&gt; Rep PeerDb x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep PeerDb x -&gt; PeerDb
$cfrom :: forall x. PeerDb -&gt; Rep PeerDb x
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></span><span class="hs-special">)</span><span>
</span><span id="line-278"></span><span>
</span><span id="line-279"></span><span class="annot"><a href="P2P.Node.PeerDB.html#peerDbSnapshot"><span class="hs-identifier hs-type">peerDbSnapshot</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="P2P.Node.PeerDB.html#PeerDb"><span class="hs-identifier hs-type">PeerDb</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="P2P.Node.PeerDB.html#PeerSet"><span class="hs-identifier hs-type">PeerSet</span></a></span><span>
</span><span id="line-280"></span><span id="peerDbSnapshot"><span class="annot"><span class="annottext">peerDbSnapshot :: PeerDb -&gt; IO PeerSet
</span><a href="P2P.Node.PeerDB.html#peerDbSnapshot"><span class="hs-identifier hs-var hs-var">peerDbSnapshot</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="P2P.Node.PeerDB.html#PeerDb"><span class="hs-identifier hs-type">PeerDb</span></a></span><span> </span><span class="hs-identifier">_</span><span> </span><span id="local-6989586621681493570"><span class="annot"><span class="annottext">var :: TVar PeerSet
</span><a href="#local-6989586621681493570"><span class="hs-identifier hs-var">var</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TVar PeerSet -&gt; IO PeerSet
forall a. TVar a -&gt; IO a
</span><span class="hs-identifier hs-var">readTVarIO</span></span><span> </span><span class="annot"><span class="annottext">TVar PeerSet
</span><a href="#local-6989586621681493570"><span class="hs-identifier hs-var">var</span></a></span><span>
</span><span id="line-281"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="P2P.Node.PeerDB.html#peerDbSnapshot"><span class="hs-pragma hs-type">peerDbSnapshot</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-282"></span><span>
</span><span id="line-283"></span><span class="annot"><a href="P2P.Node.PeerDB.html#peerDbSnapshotSTM"><span class="hs-identifier hs-type">peerDbSnapshotSTM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="P2P.Node.PeerDB.html#PeerDb"><span class="hs-identifier hs-type">PeerDb</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">STM</span></span><span> </span><span class="annot"><a href="P2P.Node.PeerDB.html#PeerSet"><span class="hs-identifier hs-type">PeerSet</span></a></span><span>
</span><span id="line-284"></span><span id="peerDbSnapshotSTM"><span class="annot"><span class="annottext">peerDbSnapshotSTM :: PeerDb -&gt; STM PeerSet
</span><a href="P2P.Node.PeerDB.html#peerDbSnapshotSTM"><span class="hs-identifier hs-var hs-var">peerDbSnapshotSTM</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="P2P.Node.PeerDB.html#PeerDb"><span class="hs-identifier hs-type">PeerDb</span></a></span><span> </span><span class="hs-identifier">_</span><span> </span><span id="local-6989586621681493568"><span class="annot"><span class="annottext">var :: TVar PeerSet
</span><a href="#local-6989586621681493568"><span class="hs-identifier hs-var">var</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TVar PeerSet -&gt; STM PeerSet
forall a. TVar a -&gt; STM a
</span><span class="hs-identifier hs-var">readTVar</span></span><span> </span><span class="annot"><span class="annottext">TVar PeerSet
</span><a href="#local-6989586621681493568"><span class="hs-identifier hs-var">var</span></a></span><span>
</span><span id="line-285"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="P2P.Node.PeerDB.html#peerDbSnapshotSTM"><span class="hs-pragma hs-type">peerDbSnapshotSTM</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-286"></span><span>
</span><span id="line-287"></span><span class="annot"><a href="P2P.Node.PeerDB.html#peerDbSize"><span class="hs-identifier hs-type">peerDbSize</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="P2P.Node.PeerDB.html#PeerDb"><span class="hs-identifier hs-type">PeerDb</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Natural</span></span><span>
</span><span id="line-288"></span><span id="peerDbSize"><span class="annot"><span class="annottext">peerDbSize :: PeerDb -&gt; IO Natural
</span><a href="P2P.Node.PeerDB.html#peerDbSize"><span class="hs-identifier hs-var hs-var">peerDbSize</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="P2P.Node.PeerDB.html#PeerDb"><span class="hs-identifier hs-type">PeerDb</span></a></span><span> </span><span class="hs-identifier">_</span><span> </span><span id="local-6989586621681493566"><span class="annot"><span class="annottext">var :: TVar PeerSet
</span><a href="#local-6989586621681493566"><span class="hs-identifier hs-var">var</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Natural
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="Chainweb.Utils.html#int"><span class="hs-identifier hs-var">int</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Natural) -&gt; (PeerSet -&gt; Int) -&gt; PeerSet -&gt; Natural
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">PeerSet -&gt; Int
forall (ixs :: [*]) a. IxSet ixs a -&gt; Int
</span><span class="hs-identifier hs-var">size</span></span><span> </span><span class="annot"><span class="annottext">(PeerSet -&gt; Natural) -&gt; IO PeerSet -&gt; IO Natural
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">&lt;$!&gt;</span></span><span> </span><span class="annot"><span class="annottext">TVar PeerSet -&gt; IO PeerSet
forall a. TVar a -&gt; IO a
</span><span class="hs-identifier hs-var">readTVarIO</span></span><span> </span><span class="annot"><span class="annottext">TVar PeerSet
</span><a href="#local-6989586621681493566"><span class="hs-identifier hs-var">var</span></a></span><span>
</span><span id="line-289"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="P2P.Node.PeerDB.html#peerDbSize"><span class="hs-pragma hs-type">peerDbSize</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-290"></span><span>
</span><span id="line-291"></span><span class="annot"><a href="P2P.Node.PeerDB.html#peerDbSizeSTM"><span class="hs-identifier hs-type">peerDbSizeSTM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="P2P.Node.PeerDB.html#PeerDb"><span class="hs-identifier hs-type">PeerDb</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">STM</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Natural</span></span><span>
</span><span id="line-292"></span><span id="peerDbSizeSTM"><span class="annot"><span class="annottext">peerDbSizeSTM :: PeerDb -&gt; STM Natural
</span><a href="P2P.Node.PeerDB.html#peerDbSizeSTM"><span class="hs-identifier hs-var hs-var">peerDbSizeSTM</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="P2P.Node.PeerDB.html#PeerDb"><span class="hs-identifier hs-type">PeerDb</span></a></span><span> </span><span class="hs-identifier">_</span><span> </span><span id="local-6989586621681493563"><span class="annot"><span class="annottext">var :: TVar PeerSet
</span><a href="#local-6989586621681493563"><span class="hs-identifier hs-var">var</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Natural
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="Chainweb.Utils.html#int"><span class="hs-identifier hs-var">int</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Natural) -&gt; (PeerSet -&gt; Int) -&gt; PeerSet -&gt; Natural
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">PeerSet -&gt; Int
forall (ixs :: [*]) a. IxSet ixs a -&gt; Int
</span><span class="hs-identifier hs-var">size</span></span><span> </span><span class="annot"><span class="annottext">(PeerSet -&gt; Natural) -&gt; STM PeerSet -&gt; STM Natural
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">&lt;$!&gt;</span></span><span> </span><span class="annot"><span class="annottext">TVar PeerSet -&gt; STM PeerSet
forall a. TVar a -&gt; STM a
</span><span class="hs-identifier hs-var">readTVar</span></span><span> </span><span class="annot"><span class="annottext">TVar PeerSet
</span><a href="#local-6989586621681493563"><span class="hs-identifier hs-var">var</span></a></span><span>
</span><span id="line-293"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="P2P.Node.PeerDB.html#peerDbSizeSTM"><span class="hs-pragma hs-type">peerDbSizeSTM</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-294"></span><span>
</span><span id="line-295"></span><span class="hs-comment">-- | Adds new 'PeerInfo' values for a given chain id.</span><span>
</span><span id="line-296"></span><span class="hs-comment">--</span><span>
</span><span id="line-297"></span><span class="hs-comment">-- This function is fair. If there are multiple concurrent writers each writer</span><span>
</span><span id="line-298"></span><span class="hs-comment">-- is guaranteed to eventually write. It has also robust performance under</span><span>
</span><span id="line-299"></span><span class="hs-comment">-- contention.</span><span>
</span><span id="line-300"></span><span class="hs-comment">--</span><span>
</span><span id="line-301"></span><span class="annot"><a href="P2P.Node.PeerDB.html#peerDbInsert"><span class="hs-identifier hs-type">peerDbInsert</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="P2P.Node.PeerDB.html#PeerDb"><span class="hs-identifier hs-type">PeerDb</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Chainweb.RestAPI.NetworkID.html#NetworkId"><span class="hs-identifier hs-type">NetworkId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="P2P.Peer.html#PeerInfo"><span class="hs-identifier hs-type">PeerInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-302"></span><span id="peerDbInsert"><span class="annot"><span class="annottext">peerDbInsert :: PeerDb -&gt; NetworkId -&gt; PeerInfo -&gt; IO ()
</span><a href="P2P.Node.PeerDB.html#peerDbInsert"><span class="hs-identifier hs-var hs-var">peerDbInsert</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="P2P.Node.PeerDB.html#PeerDb"><span class="hs-identifier hs-type">PeerDb</span></a></span><span> </span><span id="local-6989586621681493562"><span class="annot"><span class="annottext">lock :: MVar ()
</span><a href="#local-6989586621681493562"><span class="hs-identifier hs-var">lock</span></a></span></span><span> </span><span id="local-6989586621681493561"><span class="annot"><span class="annottext">var :: TVar PeerSet
</span><a href="#local-6989586621681493561"><span class="hs-identifier hs-var">var</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681493560"><span class="annot"><span class="annottext">nid :: NetworkId
</span><a href="#local-6989586621681493560"><span class="hs-identifier hs-var">nid</span></a></span></span><span> </span><span id="local-6989586621681493559"><span class="annot"><span class="annottext">i :: PeerInfo
</span><a href="#local-6989586621681493559"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MVar () -&gt; (() -&gt; IO ()) -&gt; IO ()
forall a b. MVar a -&gt; (a -&gt; IO b) -&gt; IO b
</span><span class="hs-identifier hs-var">withMVar</span></span><span> </span><span class="annot"><span class="annottext">MVar ()
</span><a href="#local-6989586621681493562"><span class="hs-identifier hs-var">lock</span></a></span><span>
</span><span id="line-303"></span><span>    </span><span class="annot"><span class="annottext">((() -&gt; IO ()) -&gt; IO ())
-&gt; ((PeerSet -&gt; PeerSet) -&gt; () -&gt; IO ())
-&gt; (PeerSet -&gt; PeerSet)
-&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">IO () -&gt; () -&gt; IO ()
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span>
</span><span id="line-304"></span><span>    </span><span class="annot"><span class="annottext">(IO () -&gt; () -&gt; IO ())
-&gt; ((PeerSet -&gt; PeerSet) -&gt; IO ())
-&gt; (PeerSet -&gt; PeerSet)
-&gt; ()
-&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">STM () -&gt; IO ()
forall a. STM a -&gt; IO a
</span><span class="hs-identifier hs-var">atomically</span></span><span>
</span><span id="line-305"></span><span>    </span><span class="annot"><span class="annottext">(STM () -&gt; IO ())
-&gt; ((PeerSet -&gt; PeerSet) -&gt; STM ())
-&gt; (PeerSet -&gt; PeerSet)
-&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TVar PeerSet -&gt; (PeerSet -&gt; PeerSet) -&gt; STM ()
forall a. TVar a -&gt; (a -&gt; a) -&gt; STM ()
</span><span class="hs-identifier hs-var">modifyTVar'</span></span><span> </span><span class="annot"><span class="annottext">TVar PeerSet
</span><a href="#local-6989586621681493561"><span class="hs-identifier hs-var">var</span></a></span><span>
</span><span id="line-306"></span><span>    </span><span class="annot"><span class="annottext">((PeerSet -&gt; PeerSet) -&gt; IO ()) -&gt; (PeerSet -&gt; PeerSet) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NetworkId -&gt; PeerInfo -&gt; PeerSet -&gt; PeerSet
</span><a href="P2P.Node.PeerDB.html#addPeerInfo"><span class="hs-identifier hs-var">addPeerInfo</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkId
</span><a href="#local-6989586621681493560"><span class="hs-identifier hs-var">nid</span></a></span><span> </span><span class="annot"><span class="annottext">PeerInfo
</span><a href="#local-6989586621681493559"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-307"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="P2P.Node.PeerDB.html#peerDbInsert"><span class="hs-pragma hs-type">peerDbInsert</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-308"></span><span>
</span><span id="line-309"></span><span class="hs-comment">-- | Delete a peer, identified by its host address, from the peer database.</span><span>
</span><span id="line-310"></span><span class="hs-comment">--</span><span>
</span><span id="line-311"></span><span class="annot"><a href="P2P.Node.PeerDB.html#peerDbDelete"><span class="hs-identifier hs-type">peerDbDelete</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="P2P.Node.PeerDB.html#PeerDb"><span class="hs-identifier hs-type">PeerDb</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="P2P.Peer.html#PeerInfo"><span class="hs-identifier hs-type">PeerInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-312"></span><span id="peerDbDelete"><span class="annot"><span class="annottext">peerDbDelete :: PeerDb -&gt; PeerInfo -&gt; IO ()
</span><a href="P2P.Node.PeerDB.html#peerDbDelete"><span class="hs-identifier hs-var hs-var">peerDbDelete</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="P2P.Node.PeerDB.html#PeerDb"><span class="hs-identifier hs-type">PeerDb</span></a></span><span> </span><span id="local-6989586621681493554"><span class="annot"><span class="annottext">lock :: MVar ()
</span><a href="#local-6989586621681493554"><span class="hs-identifier hs-var">lock</span></a></span></span><span> </span><span id="local-6989586621681493553"><span class="annot"><span class="annottext">var :: TVar PeerSet
</span><a href="#local-6989586621681493553"><span class="hs-identifier hs-var">var</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681493552"><span class="annot"><span class="annottext">i :: PeerInfo
</span><a href="#local-6989586621681493552"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MVar () -&gt; (() -&gt; IO ()) -&gt; IO ()
forall a b. MVar a -&gt; (a -&gt; IO b) -&gt; IO b
</span><span class="hs-identifier hs-var">withMVar</span></span><span> </span><span class="annot"><span class="annottext">MVar ()
</span><a href="#local-6989586621681493554"><span class="hs-identifier hs-var">lock</span></a></span><span>
</span><span id="line-313"></span><span>    </span><span class="annot"><span class="annottext">((() -&gt; IO ()) -&gt; IO ())
-&gt; ((PeerSet -&gt; PeerSet) -&gt; () -&gt; IO ())
-&gt; (PeerSet -&gt; PeerSet)
-&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">IO () -&gt; () -&gt; IO ()
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span>
</span><span id="line-314"></span><span>    </span><span class="annot"><span class="annottext">(IO () -&gt; () -&gt; IO ())
-&gt; ((PeerSet -&gt; PeerSet) -&gt; IO ())
-&gt; (PeerSet -&gt; PeerSet)
-&gt; ()
-&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">STM () -&gt; IO ()
forall a. STM a -&gt; IO a
</span><span class="hs-identifier hs-var">atomically</span></span><span>
</span><span id="line-315"></span><span>    </span><span class="annot"><span class="annottext">(STM () -&gt; IO ())
-&gt; ((PeerSet -&gt; PeerSet) -&gt; STM ())
-&gt; (PeerSet -&gt; PeerSet)
-&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TVar PeerSet -&gt; (PeerSet -&gt; PeerSet) -&gt; STM ()
forall a. TVar a -&gt; (a -&gt; a) -&gt; STM ()
</span><span class="hs-identifier hs-var">modifyTVar'</span></span><span> </span><span class="annot"><span class="annottext">TVar PeerSet
</span><a href="#local-6989586621681493553"><span class="hs-identifier hs-var">var</span></a></span><span>
</span><span id="line-316"></span><span>    </span><span class="annot"><span class="annottext">((PeerSet -&gt; PeerSet) -&gt; IO ()) -&gt; (PeerSet -&gt; PeerSet) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PeerInfo -&gt; PeerSet -&gt; PeerSet
</span><a href="P2P.Node.PeerDB.html#deletePeer"><span class="hs-identifier hs-var">deletePeer</span></a></span><span> </span><span class="annot"><span class="annottext">PeerInfo
</span><a href="#local-6989586621681493552"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-317"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="P2P.Node.PeerDB.html#peerDbDelete"><span class="hs-pragma hs-type">peerDbDelete</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-318"></span><span>
</span><span id="line-319"></span><span class="annot"><a href="P2P.Node.PeerDB.html#fromPeerEntryList"><span class="hs-identifier hs-type">fromPeerEntryList</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="P2P.Node.PeerDB.html#PeerEntry"><span class="hs-identifier hs-type">PeerEntry</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="P2P.Node.PeerDB.html#PeerDb"><span class="hs-identifier hs-type">PeerDb</span></a></span><span>
</span><span id="line-320"></span><span id="fromPeerEntryList"><span class="annot"><span class="annottext">fromPeerEntryList :: [PeerEntry] -&gt; IO PeerDb
</span><a href="P2P.Node.PeerDB.html#fromPeerEntryList"><span class="hs-identifier hs-var hs-var">fromPeerEntryList</span></a></span></span><span> </span><span id="local-6989586621681493551"><span class="annot"><span class="annottext">peers :: [PeerEntry]
</span><a href="#local-6989586621681493551"><span class="hs-identifier hs-var">peers</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MVar () -&gt; TVar PeerSet -&gt; PeerDb
</span><a href="P2P.Node.PeerDB.html#PeerDb"><span class="hs-identifier hs-var">PeerDb</span></a></span><span>
</span><span id="line-321"></span><span>    </span><span class="annot"><span class="annottext">(MVar () -&gt; TVar PeerSet -&gt; PeerDb)
-&gt; IO (MVar ()) -&gt; IO (TVar PeerSet -&gt; PeerDb)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">() -&gt; IO (MVar ())
forall a. a -&gt; IO (MVar a)
</span><span class="hs-identifier hs-var">newMVar</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-322"></span><span>    </span><span class="annot"><span class="annottext">IO (TVar PeerSet -&gt; PeerDb) -&gt; IO (TVar PeerSet) -&gt; IO PeerDb
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">PeerSet -&gt; IO (TVar PeerSet)
forall a. a -&gt; IO (TVar a)
</span><span class="hs-identifier hs-var">newTVarIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[PeerEntry] -&gt; PeerSet
forall (ixs :: [*]) a. Indexable ixs a =&gt; [a] -&gt; IxSet ixs a
</span><span class="hs-identifier hs-var">fromList</span></span><span> </span><span class="annot"><span class="annottext">[PeerEntry]
</span><a href="#local-6989586621681493551"><span class="hs-identifier hs-var">peers</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-323"></span><span>
</span><span id="line-324"></span><span class="annot"><a href="P2P.Node.PeerDB.html#fromPeerInfoList"><span class="hs-identifier hs-type">fromPeerInfoList</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Chainweb.RestAPI.NetworkID.html#NetworkId"><span class="hs-identifier hs-type">NetworkId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="P2P.Peer.html#PeerInfo"><span class="hs-identifier hs-type">PeerInfo</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="P2P.Node.PeerDB.html#PeerDb"><span class="hs-identifier hs-type">PeerDb</span></a></span><span>
</span><span id="line-325"></span><span id="fromPeerInfoList"><span class="annot"><span class="annottext">fromPeerInfoList :: NetworkId -&gt; [PeerInfo] -&gt; IO PeerDb
</span><a href="P2P.Node.PeerDB.html#fromPeerInfoList"><span class="hs-identifier hs-var hs-var">fromPeerInfoList</span></a></span></span><span> </span><span id="local-6989586621681493547"><span class="annot"><span class="annottext">nid :: NetworkId
</span><a href="#local-6989586621681493547"><span class="hs-identifier hs-var">nid</span></a></span></span><span> </span><span id="local-6989586621681493546"><span class="annot"><span class="annottext">peers :: [PeerInfo]
</span><a href="#local-6989586621681493546"><span class="hs-identifier hs-var">peers</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[PeerEntry] -&gt; IO PeerDb
</span><a href="P2P.Node.PeerDB.html#fromPeerEntryList"><span class="hs-identifier hs-var">fromPeerEntryList</span></a></span><span> </span><span class="annot"><span class="annottext">([PeerEntry] -&gt; IO PeerDb) -&gt; [PeerEntry] -&gt; IO PeerDb
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NetworkId -&gt; PeerInfo -&gt; PeerEntry
</span><a href="P2P.Node.PeerDB.html#newPeerEntry"><span class="hs-identifier hs-var">newPeerEntry</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkId
</span><a href="#local-6989586621681493547"><span class="hs-identifier hs-var">nid</span></a></span><span> </span><span class="annot"><span class="annottext">(PeerInfo -&gt; PeerEntry) -&gt; [PeerInfo] -&gt; [PeerEntry]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[PeerInfo]
</span><a href="#local-6989586621681493546"><span class="hs-identifier hs-var">peers</span></a></span><span>
</span><span id="line-326"></span><span>
</span><span id="line-327"></span><span class="annot"><a href="P2P.Node.PeerDB.html#peerDbInsertList"><span class="hs-identifier hs-type">peerDbInsertList</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="P2P.Node.PeerDB.html#PeerEntry"><span class="hs-identifier hs-type">PeerEntry</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="P2P.Node.PeerDB.html#PeerDb"><span class="hs-identifier hs-type">PeerDb</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-328"></span><span id="peerDbInsertList"><span class="annot"><span class="annottext">peerDbInsertList :: [PeerEntry] -&gt; PeerDb -&gt; IO ()
</span><a href="P2P.Node.PeerDB.html#peerDbInsertList"><span class="hs-identifier hs-var hs-var">peerDbInsertList</span></a></span></span><span> </span><span id="local-6989586621681493545"><span class="annot"><span class="annottext">peers :: [PeerEntry]
</span><a href="#local-6989586621681493545"><span class="hs-identifier hs-var">peers</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="P2P.Node.PeerDB.html#PeerDb"><span class="hs-identifier hs-type">PeerDb</span></a></span><span> </span><span id="local-6989586621681493544"><span class="annot"><span class="annottext">lock :: MVar ()
</span><a href="#local-6989586621681493544"><span class="hs-identifier hs-var">lock</span></a></span></span><span> </span><span id="local-6989586621681493543"><span class="annot"><span class="annottext">var :: TVar PeerSet
</span><a href="#local-6989586621681493543"><span class="hs-identifier hs-var">var</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-329"></span><span>    </span><span class="annot"><span class="annottext">MVar () -&gt; (() -&gt; IO ()) -&gt; IO ()
forall a b. MVar a -&gt; (a -&gt; IO b) -&gt; IO b
</span><span class="hs-identifier hs-var">withMVar</span></span><span> </span><span class="annot"><span class="annottext">MVar ()
</span><a href="#local-6989586621681493544"><span class="hs-identifier hs-var">lock</span></a></span><span>
</span><span id="line-330"></span><span>        </span><span class="annot"><span class="annottext">((() -&gt; IO ()) -&gt; IO ())
-&gt; ((PeerSet -&gt; PeerSet) -&gt; () -&gt; IO ())
-&gt; (PeerSet -&gt; PeerSet)
-&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">IO () -&gt; () -&gt; IO ()
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span>
</span><span id="line-331"></span><span>        </span><span class="annot"><span class="annottext">(IO () -&gt; () -&gt; IO ())
-&gt; ((PeerSet -&gt; PeerSet) -&gt; IO ())
-&gt; (PeerSet -&gt; PeerSet)
-&gt; ()
-&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">STM () -&gt; IO ()
forall a. STM a -&gt; IO a
</span><span class="hs-identifier hs-var">atomically</span></span><span>
</span><span id="line-332"></span><span>        </span><span class="annot"><span class="annottext">(STM () -&gt; IO ())
-&gt; ((PeerSet -&gt; PeerSet) -&gt; STM ())
-&gt; (PeerSet -&gt; PeerSet)
-&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TVar PeerSet -&gt; (PeerSet -&gt; PeerSet) -&gt; STM ()
forall a. TVar a -&gt; (a -&gt; a) -&gt; STM ()
</span><span class="hs-identifier hs-var">modifyTVar'</span></span><span> </span><span class="annot"><span class="annottext">TVar PeerSet
</span><a href="#local-6989586621681493543"><span class="hs-identifier hs-var">var</span></a></span><span>
</span><span id="line-333"></span><span>        </span><span class="annot"><span class="annottext">((PeerSet -&gt; PeerSet) -&gt; IO ()) -&gt; (PeerSet -&gt; PeerSet) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[PeerEntry] -&gt; PeerSet -&gt; PeerSet
</span><a href="P2P.Node.PeerDB.html#insertPeerEntryList"><span class="hs-identifier hs-var">insertPeerEntryList</span></a></span><span> </span><span class="annot"><span class="annottext">[PeerEntry]
</span><a href="#local-6989586621681493545"><span class="hs-identifier hs-var">peers</span></a></span><span>
</span><span id="line-334"></span><span>
</span><span id="line-335"></span><span class="annot"><a href="P2P.Node.PeerDB.html#peerDbInsertPeerInfoList"><span class="hs-identifier hs-type">peerDbInsertPeerInfoList</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Chainweb.RestAPI.NetworkID.html#NetworkId"><span class="hs-identifier hs-type">NetworkId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="P2P.Peer.html#PeerInfo"><span class="hs-identifier hs-type">PeerInfo</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="P2P.Node.PeerDB.html#PeerDb"><span class="hs-identifier hs-type">PeerDb</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-336"></span><span id="peerDbInsertPeerInfoList"><span class="annot"><span class="annottext">peerDbInsertPeerInfoList :: NetworkId -&gt; [PeerInfo] -&gt; PeerDb -&gt; IO ()
</span><a href="P2P.Node.PeerDB.html#peerDbInsertPeerInfoList"><span class="hs-identifier hs-var hs-var">peerDbInsertPeerInfoList</span></a></span></span><span> </span><span id="local-6989586621681493542"><span class="annot"><span class="annottext">nid :: NetworkId
</span><a href="#local-6989586621681493542"><span class="hs-identifier hs-var">nid</span></a></span></span><span> </span><span id="local-6989586621681493541"><span class="annot"><span class="annottext">ps :: [PeerInfo]
</span><a href="#local-6989586621681493541"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[PeerEntry] -&gt; PeerDb -&gt; IO ()
</span><a href="P2P.Node.PeerDB.html#peerDbInsertList"><span class="hs-identifier hs-var">peerDbInsertList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NetworkId -&gt; PeerInfo -&gt; PeerEntry
</span><a href="P2P.Node.PeerDB.html#newPeerEntry"><span class="hs-identifier hs-var">newPeerEntry</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkId
</span><a href="#local-6989586621681493542"><span class="hs-identifier hs-var">nid</span></a></span><span> </span><span class="annot"><span class="annottext">(PeerInfo -&gt; PeerEntry) -&gt; [PeerInfo] -&gt; [PeerEntry]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[PeerInfo]
</span><a href="#local-6989586621681493541"><span class="hs-identifier hs-var">ps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-337"></span><span>
</span><span id="line-338"></span><span class="annot"><a href="P2P.Node.PeerDB.html#peerDbInsertSet"><span class="hs-identifier hs-type">peerDbInsertSet</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">S.Set</span></span><span> </span><span class="annot"><a href="P2P.Node.PeerDB.html#PeerEntry"><span class="hs-identifier hs-type">PeerEntry</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="P2P.Node.PeerDB.html#PeerDb"><span class="hs-identifier hs-type">PeerDb</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-339"></span><span id="peerDbInsertSet"><span class="annot"><span class="annottext">peerDbInsertSet :: Set PeerEntry -&gt; PeerDb -&gt; IO ()
</span><a href="P2P.Node.PeerDB.html#peerDbInsertSet"><span class="hs-identifier hs-var hs-var">peerDbInsertSet</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[PeerEntry] -&gt; PeerDb -&gt; IO ()
</span><a href="P2P.Node.PeerDB.html#peerDbInsertList"><span class="hs-identifier hs-var">peerDbInsertList</span></a></span><span> </span><span class="annot"><span class="annottext">([PeerEntry] -&gt; PeerDb -&gt; IO ())
-&gt; (Set PeerEntry -&gt; [PeerEntry])
-&gt; Set PeerEntry
-&gt; PeerDb
-&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Set PeerEntry -&gt; [PeerEntry]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">F.toList</span></span><span>
</span><span id="line-340"></span><span>
</span><span id="line-341"></span><span class="annot"><a href="P2P.Node.PeerDB.html#newEmptyPeerDb"><span class="hs-identifier hs-type">newEmptyPeerDb</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="P2P.Node.PeerDB.html#PeerDb"><span class="hs-identifier hs-type">PeerDb</span></a></span><span>
</span><span id="line-342"></span><span id="newEmptyPeerDb"><span class="annot"><span class="annottext">newEmptyPeerDb :: IO PeerDb
</span><a href="P2P.Node.PeerDB.html#newEmptyPeerDb"><span class="hs-identifier hs-var hs-var">newEmptyPeerDb</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MVar () -&gt; TVar PeerSet -&gt; PeerDb
</span><a href="P2P.Node.PeerDB.html#PeerDb"><span class="hs-identifier hs-var">PeerDb</span></a></span><span> </span><span class="annot"><span class="annottext">(MVar () -&gt; TVar PeerSet -&gt; PeerDb)
-&gt; IO (MVar ()) -&gt; IO (TVar PeerSet -&gt; PeerDb)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">() -&gt; IO (MVar ())
forall a. a -&gt; IO (MVar a)
</span><span class="hs-identifier hs-var">newMVar</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IO (TVar PeerSet -&gt; PeerDb) -&gt; IO (TVar PeerSet) -&gt; IO PeerDb
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">PeerSet -&gt; IO (TVar PeerSet)
forall a. a -&gt; IO (TVar a)
</span><span class="hs-identifier hs-var">newTVarIO</span></span><span> </span><span class="annot"><span class="annottext">PeerSet
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-343"></span><span>
</span><span id="line-344"></span><span class="annot"><a href="P2P.Node.PeerDB.html#updatePeerDb"><span class="hs-identifier hs-type">updatePeerDb</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="P2P.Node.PeerDB.html#PeerDb"><span class="hs-identifier hs-type">PeerDb</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Chainweb.HostAddress.html#HostAddress"><span class="hs-identifier hs-type">HostAddress</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="P2P.Node.PeerDB.html#PeerEntry"><span class="hs-identifier hs-type">PeerEntry</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="P2P.Node.PeerDB.html#PeerEntry"><span class="hs-identifier hs-type">PeerEntry</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-345"></span><span id="updatePeerDb"><span class="annot"><span class="annottext">updatePeerDb :: PeerDb -&gt; HostAddress -&gt; (PeerEntry -&gt; PeerEntry) -&gt; IO ()
</span><a href="P2P.Node.PeerDB.html#updatePeerDb"><span class="hs-identifier hs-var hs-var">updatePeerDb</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="P2P.Node.PeerDB.html#PeerDb"><span class="hs-identifier hs-type">PeerDb</span></a></span><span> </span><span id="local-6989586621681493539"><span class="annot"><span class="annottext">lock :: MVar ()
</span><a href="#local-6989586621681493539"><span class="hs-identifier hs-var">lock</span></a></span></span><span> </span><span id="local-6989586621681493538"><span class="annot"><span class="annottext">var :: TVar PeerSet
</span><a href="#local-6989586621681493538"><span class="hs-identifier hs-var">var</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681493537"><span class="annot"><span class="annottext">a :: HostAddress
</span><a href="#local-6989586621681493537"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621681493536"><span class="annot"><span class="annottext">f :: PeerEntry -&gt; PeerEntry
</span><a href="#local-6989586621681493536"><span class="hs-identifier hs-var">f</span></a></span></span><span>
</span><span id="line-346"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MVar () -&gt; (() -&gt; IO ()) -&gt; IO ()
forall a b. MVar a -&gt; (a -&gt; IO b) -&gt; IO b
</span><span class="hs-identifier hs-var">withMVar</span></span><span> </span><span class="annot"><span class="annottext">MVar ()
</span><a href="#local-6989586621681493539"><span class="hs-identifier hs-var">lock</span></a></span><span> </span><span class="annot"><span class="annottext">((() -&gt; IO ()) -&gt; IO ())
-&gt; ((PeerSet -&gt; PeerSet) -&gt; () -&gt; IO ())
-&gt; (PeerSet -&gt; PeerSet)
-&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">IO () -&gt; () -&gt; IO ()
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; () -&gt; IO ())
-&gt; ((PeerSet -&gt; PeerSet) -&gt; IO ())
-&gt; (PeerSet -&gt; PeerSet)
-&gt; ()
-&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">STM () -&gt; IO ()
forall a. STM a -&gt; IO a
</span><span class="hs-identifier hs-var">atomically</span></span><span> </span><span class="annot"><span class="annottext">(STM () -&gt; IO ())
-&gt; ((PeerSet -&gt; PeerSet) -&gt; STM ())
-&gt; (PeerSet -&gt; PeerSet)
-&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TVar PeerSet -&gt; (PeerSet -&gt; PeerSet) -&gt; STM ()
forall a. TVar a -&gt; (a -&gt; a) -&gt; STM ()
</span><span class="hs-identifier hs-var">modifyTVar'</span></span><span> </span><span class="annot"><span class="annottext">TVar PeerSet
</span><a href="#local-6989586621681493538"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">((PeerSet -&gt; PeerSet) -&gt; IO ()) -&gt; (PeerSet -&gt; PeerSet) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681493535"><span class="annot"><span class="annottext">s :: PeerSet
</span><a href="#local-6989586621681493535"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-347"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PeerSet -&gt; Maybe PeerEntry
forall a (ixs :: [*]). Ord a =&gt; IxSet ixs a -&gt; Maybe a
</span><span class="hs-identifier hs-var">getOne</span></span><span> </span><span class="annot"><span class="annottext">(PeerSet -&gt; Maybe PeerEntry) -&gt; PeerSet -&gt; Maybe PeerEntry
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HostAddress -&gt; PeerSet -&gt; PeerSet
forall (ixs :: [*]) a ix.
(Indexable ixs a, IsIndexOf ix ixs) =&gt;
ix -&gt; IxSet ixs a -&gt; IxSet ixs a
</span><span class="hs-identifier hs-var">getEQ</span></span><span> </span><span class="annot"><span class="annottext">HostAddress
</span><a href="#local-6989586621681493537"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">PeerSet
</span><a href="#local-6989586621681493535"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-348"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PeerSet
</span><a href="#local-6989586621681493535"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-349"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621681493534"><span class="annot"><span class="annottext">x :: PeerEntry
</span><a href="#local-6989586621681493534"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PeerSet -&gt; PeerSet
forall a. NFData a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">force</span></span><span> </span><span class="annot"><span class="annottext">(PeerSet -&gt; PeerSet) -&gt; PeerSet -&gt; PeerSet
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HostAddress -&gt; PeerEntry -&gt; PeerSet -&gt; PeerSet
forall (ixs :: [*]) a ix.
(Indexable ixs a, IsIndexOf ix ixs) =&gt;
ix -&gt; a -&gt; IxSet ixs a -&gt; IxSet ixs a
</span><span class="hs-identifier hs-var">updateIx</span></span><span> </span><span class="annot"><span class="annottext">HostAddress
</span><a href="#local-6989586621681493537"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PeerEntry -&gt; PeerEntry
forall a. NFData a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">force</span></span><span> </span><span class="annot"><span class="annottext">(PeerEntry -&gt; PeerEntry) -&gt; PeerEntry -&gt; PeerEntry
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PeerEntry -&gt; PeerEntry
</span><a href="#local-6989586621681493536"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">PeerEntry
</span><a href="#local-6989586621681493534"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PeerSet
</span><a href="#local-6989586621681493535"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-350"></span><span>
</span><span id="line-351"></span><span class="annot"><a href="P2P.Node.PeerDB.html#incrementActiveSessionCount"><span class="hs-identifier hs-type">incrementActiveSessionCount</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="P2P.Node.PeerDB.html#PeerDb"><span class="hs-identifier hs-type">PeerDb</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="P2P.Peer.html#PeerInfo"><span class="hs-identifier hs-type">PeerInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-352"></span><span id="incrementActiveSessionCount"><span class="annot"><span class="annottext">incrementActiveSessionCount :: PeerDb -&gt; PeerInfo -&gt; IO ()
</span><a href="P2P.Node.PeerDB.html#incrementActiveSessionCount"><span class="hs-identifier hs-var hs-var">incrementActiveSessionCount</span></a></span></span><span> </span><span id="local-6989586621681493533"><span class="annot"><span class="annottext">db :: PeerDb
</span><a href="#local-6989586621681493533"><span class="hs-identifier hs-var">db</span></a></span></span><span> </span><span id="local-6989586621681493532"><span class="annot"><span class="annottext">i :: PeerInfo
</span><a href="#local-6989586621681493532"><span class="hs-identifier hs-var">i</span></a></span></span><span>
</span><span id="line-353"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PeerDb -&gt; HostAddress -&gt; (PeerEntry -&gt; PeerEntry) -&gt; IO ()
</span><a href="P2P.Node.PeerDB.html#updatePeerDb"><span class="hs-identifier hs-var">updatePeerDb</span></a></span><span> </span><span class="annot"><span class="annottext">PeerDb
</span><a href="#local-6989586621681493533"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PeerInfo -&gt; HostAddress
</span><a href="P2P.Peer.html#_peerAddr"><span class="hs-identifier hs-var hs-var">_peerAddr</span></a></span><span> </span><span class="annot"><span class="annottext">PeerInfo
</span><a href="#local-6989586621681493532"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((PeerEntry -&gt; PeerEntry) -&gt; IO ())
-&gt; (PeerEntry -&gt; PeerEntry) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ASetter PeerEntry PeerEntry ActiveSessionCount ActiveSessionCount
-&gt; (ActiveSessionCount -&gt; ActiveSessionCount)
-&gt; PeerEntry
-&gt; PeerEntry
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><span class="hs-identifier hs-var">over</span></span><span> </span><span class="annot"><span class="annottext">ASetter PeerEntry PeerEntry ActiveSessionCount ActiveSessionCount
Lens' PeerEntry ActiveSessionCount
</span><a href="P2P.Node.PeerDB.html#peerEntryActiveSessionCount"><span class="hs-identifier hs-var">peerEntryActiveSessionCount</span></a></span><span> </span><span class="annot"><span class="annottext">ActiveSessionCount -&gt; ActiveSessionCount
forall a. Enum a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">succ</span></span><span>
</span><span id="line-354"></span><span>
</span><span id="line-355"></span><span class="annot"><a href="P2P.Node.PeerDB.html#decrementActiveSessionCount"><span class="hs-identifier hs-type">decrementActiveSessionCount</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="P2P.Node.PeerDB.html#PeerDb"><span class="hs-identifier hs-type">PeerDb</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="P2P.Peer.html#PeerInfo"><span class="hs-identifier hs-type">PeerInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-356"></span><span id="decrementActiveSessionCount"><span class="annot"><span class="annottext">decrementActiveSessionCount :: PeerDb -&gt; PeerInfo -&gt; IO ()
</span><a href="P2P.Node.PeerDB.html#decrementActiveSessionCount"><span class="hs-identifier hs-var hs-var">decrementActiveSessionCount</span></a></span></span><span> </span><span id="local-6989586621681493529"><span class="annot"><span class="annottext">db :: PeerDb
</span><a href="#local-6989586621681493529"><span class="hs-identifier hs-var">db</span></a></span></span><span> </span><span id="local-6989586621681493528"><span class="annot"><span class="annottext">i :: PeerInfo
</span><a href="#local-6989586621681493528"><span class="hs-identifier hs-var">i</span></a></span></span><span>
</span><span id="line-357"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PeerDb -&gt; HostAddress -&gt; (PeerEntry -&gt; PeerEntry) -&gt; IO ()
</span><a href="P2P.Node.PeerDB.html#updatePeerDb"><span class="hs-identifier hs-var">updatePeerDb</span></a></span><span> </span><span class="annot"><span class="annottext">PeerDb
</span><a href="#local-6989586621681493529"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PeerInfo -&gt; HostAddress
</span><a href="P2P.Peer.html#_peerAddr"><span class="hs-identifier hs-var hs-var">_peerAddr</span></a></span><span> </span><span class="annot"><span class="annottext">PeerInfo
</span><a href="#local-6989586621681493528"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((PeerEntry -&gt; PeerEntry) -&gt; IO ())
-&gt; (PeerEntry -&gt; PeerEntry) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ASetter PeerEntry PeerEntry ActiveSessionCount ActiveSessionCount
-&gt; (ActiveSessionCount -&gt; ActiveSessionCount)
-&gt; PeerEntry
-&gt; PeerEntry
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><span class="hs-identifier hs-var">over</span></span><span> </span><span class="annot"><span class="annottext">ASetter PeerEntry PeerEntry ActiveSessionCount ActiveSessionCount
Lens' PeerEntry ActiveSessionCount
</span><a href="P2P.Node.PeerDB.html#peerEntryActiveSessionCount"><span class="hs-identifier hs-var">peerEntryActiveSessionCount</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ActiveSessionCount -&gt; ActiveSessionCount
forall a. Enum a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">pred</span></span><span> </span><span class="annot"><span class="annottext">(ActiveSessionCount -&gt; ActiveSessionCount)
-&gt; (ActiveSessionCount -&gt; ActiveSessionCount)
-&gt; ActiveSessionCount
-&gt; ActiveSessionCount
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ActiveSessionCount -&gt; ActiveSessionCount -&gt; ActiveSessionCount
forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">max</span></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-358"></span><span>
</span><span id="line-359"></span><span class="annot"><a href="P2P.Node.PeerDB.html#incrementSuccessiveFailures"><span class="hs-identifier hs-type">incrementSuccessiveFailures</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="P2P.Node.PeerDB.html#PeerDb"><span class="hs-identifier hs-type">PeerDb</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="P2P.Peer.html#PeerInfo"><span class="hs-identifier hs-type">PeerInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-360"></span><span id="incrementSuccessiveFailures"><span class="annot"><span class="annottext">incrementSuccessiveFailures :: PeerDb -&gt; PeerInfo -&gt; IO ()
</span><a href="P2P.Node.PeerDB.html#incrementSuccessiveFailures"><span class="hs-identifier hs-var hs-var">incrementSuccessiveFailures</span></a></span></span><span> </span><span id="local-6989586621681493526"><span class="annot"><span class="annottext">db :: PeerDb
</span><a href="#local-6989586621681493526"><span class="hs-identifier hs-var">db</span></a></span></span><span> </span><span id="local-6989586621681493525"><span class="annot"><span class="annottext">i :: PeerInfo
</span><a href="#local-6989586621681493525"><span class="hs-identifier hs-var">i</span></a></span></span><span>
</span><span id="line-361"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PeerDb -&gt; HostAddress -&gt; (PeerEntry -&gt; PeerEntry) -&gt; IO ()
</span><a href="P2P.Node.PeerDB.html#updatePeerDb"><span class="hs-identifier hs-var">updatePeerDb</span></a></span><span> </span><span class="annot"><span class="annottext">PeerDb
</span><a href="#local-6989586621681493526"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PeerInfo -&gt; HostAddress
</span><a href="P2P.Peer.html#_peerAddr"><span class="hs-identifier hs-var hs-var">_peerAddr</span></a></span><span> </span><span class="annot"><span class="annottext">PeerInfo
</span><a href="#local-6989586621681493525"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((PeerEntry -&gt; PeerEntry) -&gt; IO ())
-&gt; (PeerEntry -&gt; PeerEntry) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ASetter PeerEntry PeerEntry SuccessiveFailures SuccessiveFailures
-&gt; (SuccessiveFailures -&gt; SuccessiveFailures)
-&gt; PeerEntry
-&gt; PeerEntry
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><span class="hs-identifier hs-var">over</span></span><span> </span><span class="annot"><span class="annottext">ASetter PeerEntry PeerEntry SuccessiveFailures SuccessiveFailures
Lens' PeerEntry SuccessiveFailures
</span><a href="P2P.Node.PeerDB.html#peerEntrySuccessiveFailures"><span class="hs-identifier hs-var">peerEntrySuccessiveFailures</span></a></span><span> </span><span class="annot"><span class="annottext">SuccessiveFailures -&gt; SuccessiveFailures
forall a. Enum a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">succ</span></span><span>
</span><span id="line-362"></span><span>
</span><span id="line-363"></span><span class="annot"><a href="P2P.Node.PeerDB.html#resetSuccessiveFailures"><span class="hs-identifier hs-type">resetSuccessiveFailures</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="P2P.Node.PeerDB.html#PeerDb"><span class="hs-identifier hs-type">PeerDb</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="P2P.Peer.html#PeerInfo"><span class="hs-identifier hs-type">PeerInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-364"></span><span id="resetSuccessiveFailures"><span class="annot"><span class="annottext">resetSuccessiveFailures :: PeerDb -&gt; PeerInfo -&gt; IO ()
</span><a href="P2P.Node.PeerDB.html#resetSuccessiveFailures"><span class="hs-identifier hs-var hs-var">resetSuccessiveFailures</span></a></span></span><span> </span><span id="local-6989586621681493524"><span class="annot"><span class="annottext">db :: PeerDb
</span><a href="#local-6989586621681493524"><span class="hs-identifier hs-var">db</span></a></span></span><span> </span><span id="local-6989586621681493523"><span class="annot"><span class="annottext">i :: PeerInfo
</span><a href="#local-6989586621681493523"><span class="hs-identifier hs-var">i</span></a></span></span><span>
</span><span id="line-365"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PeerDb -&gt; HostAddress -&gt; (PeerEntry -&gt; PeerEntry) -&gt; IO ()
</span><a href="P2P.Node.PeerDB.html#updatePeerDb"><span class="hs-identifier hs-var">updatePeerDb</span></a></span><span> </span><span class="annot"><span class="annottext">PeerDb
</span><a href="#local-6989586621681493524"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PeerInfo -&gt; HostAddress
</span><a href="P2P.Peer.html#_peerAddr"><span class="hs-identifier hs-var hs-var">_peerAddr</span></a></span><span> </span><span class="annot"><span class="annottext">PeerInfo
</span><a href="#local-6989586621681493523"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((PeerEntry -&gt; PeerEntry) -&gt; IO ())
-&gt; (PeerEntry -&gt; PeerEntry) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ASetter PeerEntry PeerEntry SuccessiveFailures SuccessiveFailures
-&gt; SuccessiveFailures -&gt; PeerEntry -&gt; PeerEntry
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-identifier hs-var">set</span></span><span> </span><span class="annot"><span class="annottext">ASetter PeerEntry PeerEntry SuccessiveFailures SuccessiveFailures
Lens' PeerEntry SuccessiveFailures
</span><a href="P2P.Node.PeerDB.html#peerEntrySuccessiveFailures"><span class="hs-identifier hs-var">peerEntrySuccessiveFailures</span></a></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span>
</span><span id="line-366"></span><span>
</span><span id="line-367"></span><span class="annot"><a href="P2P.Node.PeerDB.html#updateLastSuccess"><span class="hs-identifier hs-type">updateLastSuccess</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="P2P.Node.PeerDB.html#PeerDb"><span class="hs-identifier hs-type">PeerDb</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="P2P.Peer.html#PeerInfo"><span class="hs-identifier hs-type">PeerInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-368"></span><span id="updateLastSuccess"><span class="annot"><span class="annottext">updateLastSuccess :: PeerDb -&gt; PeerInfo -&gt; IO ()
</span><a href="P2P.Node.PeerDB.html#updateLastSuccess"><span class="hs-identifier hs-var hs-var">updateLastSuccess</span></a></span></span><span> </span><span id="local-6989586621681493521"><span class="annot"><span class="annottext">db :: PeerDb
</span><a href="#local-6989586621681493521"><span class="hs-identifier hs-var">db</span></a></span></span><span> </span><span id="local-6989586621681493520"><span class="annot"><span class="annottext">i :: PeerInfo
</span><a href="#local-6989586621681493520"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-369"></span><span>    </span><span id="local-6989586621681493519"><span class="annot"><span class="annottext">LastSuccess
</span><a href="#local-6989586621681493519"><span class="hs-identifier hs-var">now</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe UTCTime -&gt; LastSuccess
</span><a href="P2P.Node.PeerDB.html#LastSuccess"><span class="hs-identifier hs-var">LastSuccess</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe UTCTime -&gt; LastSuccess)
-&gt; (UTCTime -&gt; Maybe UTCTime) -&gt; UTCTime -&gt; LastSuccess
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">UTCTime -&gt; Maybe UTCTime
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(UTCTime -&gt; LastSuccess) -&gt; IO UTCTime -&gt; IO LastSuccess
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">IO UTCTime
</span><span class="hs-identifier hs-var">getCurrentTime</span></span><span>
</span><span id="line-370"></span><span>    </span><span class="annot"><span class="annottext">PeerDb -&gt; HostAddress -&gt; (PeerEntry -&gt; PeerEntry) -&gt; IO ()
</span><a href="P2P.Node.PeerDB.html#updatePeerDb"><span class="hs-identifier hs-var">updatePeerDb</span></a></span><span> </span><span class="annot"><span class="annottext">PeerDb
</span><a href="#local-6989586621681493521"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PeerInfo -&gt; HostAddress
</span><a href="P2P.Peer.html#_peerAddr"><span class="hs-identifier hs-var hs-var">_peerAddr</span></a></span><span> </span><span class="annot"><span class="annottext">PeerInfo
</span><a href="#local-6989586621681493520"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((PeerEntry -&gt; PeerEntry) -&gt; IO ())
-&gt; (PeerEntry -&gt; PeerEntry) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ASetter PeerEntry PeerEntry LastSuccess LastSuccess
-&gt; LastSuccess -&gt; PeerEntry -&gt; PeerEntry
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-identifier hs-var">set</span></span><span> </span><span class="annot"><span class="annottext">ASetter PeerEntry PeerEntry LastSuccess LastSuccess
Lens' PeerEntry LastSuccess
</span><a href="P2P.Node.PeerDB.html#peerEntryLastSuccess"><span class="hs-identifier hs-var">peerEntryLastSuccess</span></a></span><span> </span><span class="annot"><span class="annottext">LastSuccess
</span><a href="#local-6989586621681493519"><span class="hs-identifier hs-var">now</span></a></span><span>
</span><span id="line-371"></span><span>
</span><span id="line-372"></span><span class="hs-comment">-- -------------------------------------------------------------------------- --</span><span>
</span><span id="line-373"></span><span class="hs-comment">-- Persistence</span><span>
</span><span id="line-374"></span><span>
</span><span id="line-375"></span><span class="hs-comment">-- | Atomically store the database to a file.</span><span>
</span><span id="line-376"></span><span class="hs-comment">--</span><span>
</span><span id="line-377"></span><span class="hs-comment">-- TODO: Currently, this is somewhat inefficient, in particular at shutdown. It</span><span>
</span><span id="line-378"></span><span class="hs-comment">-- would be better to stream a transaction log to the temporary file and</span><span>
</span><span id="line-379"></span><span class="hs-comment">-- consolidate in the background only when there is enough time.</span><span>
</span><span id="line-380"></span><span class="hs-comment">--</span><span>
</span><span id="line-381"></span><span class="annot"><a href="P2P.Node.PeerDB.html#storePeerDb"><span class="hs-identifier hs-type">storePeerDb</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="P2P.Node.PeerDB.html#PeerDb"><span class="hs-identifier hs-type">PeerDb</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-382"></span><span id="storePeerDb"><span class="annot"><span class="annottext">storePeerDb :: String -&gt; PeerDb -&gt; IO ()
</span><a href="P2P.Node.PeerDB.html#storePeerDb"><span class="hs-identifier hs-var hs-var">storePeerDb</span></a></span></span><span> </span><span id="local-6989586621681493516"><span class="annot"><span class="annottext">f :: String
</span><a href="#local-6989586621681493516"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621681493515"><span class="annot"><span class="annottext">db :: PeerDb
</span><a href="#local-6989586621681493515"><span class="hs-identifier hs-var">db</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; (Handle -&gt; IO ()) -&gt; IO ()
forall (m :: * -&gt; *) a.
(MonadMask m, MonadIO m) =&gt;
String -&gt; (Handle -&gt; m a) -&gt; m a
</span><span class="hs-identifier hs-var">withOutputFile</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681493516"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">((Handle -&gt; IO ()) -&gt; IO ()) -&gt; (Handle -&gt; IO ()) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681493513"><span class="annot"><span class="annottext">h :: Handle
</span><a href="#local-6989586621681493513"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-383"></span><span>    </span><span class="annot"><span class="annottext">PeerDb -&gt; IO PeerSet
</span><a href="P2P.Node.PeerDB.html#peerDbSnapshot"><span class="hs-identifier hs-var">peerDbSnapshot</span></a></span><span> </span><span class="annot"><span class="annottext">PeerDb
</span><a href="#local-6989586621681493515"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="annot"><span class="annottext">IO PeerSet -&gt; (PeerSet -&gt; IO ()) -&gt; IO ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681493512"><span class="annot"><span class="annottext">sn :: PeerSet
</span><a href="#local-6989586621681493512"><span class="hs-identifier hs-var">sn</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Handle -&gt; ByteString -&gt; IO ()
</span><span class="hs-identifier hs-var">BL.hPutStr</span></span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621681493513"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set PeerEntry -&gt; ByteString
forall a. ToJSON a =&gt; a -&gt; ByteString
</span><span class="hs-identifier hs-var">encode</span></span><span> </span><span class="annot"><span class="annottext">(Set PeerEntry -&gt; ByteString) -&gt; Set PeerEntry -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PeerSet -&gt; Set PeerEntry
</span><a href="P2P.Node.PeerDB.html#toPeerSet"><span class="hs-identifier hs-var">toPeerSet</span></a></span><span> </span><span class="annot"><span class="annottext">PeerSet
</span><a href="#local-6989586621681493512"><span class="hs-identifier hs-var">sn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-384"></span><span>
</span><span id="line-385"></span><span class="annot"><a href="P2P.Node.PeerDB.html#loadPeerDb"><span class="hs-identifier hs-type">loadPeerDb</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="P2P.Node.PeerDB.html#PeerDb"><span class="hs-identifier hs-type">PeerDb</span></a></span><span>
</span><span id="line-386"></span><span id="loadPeerDb"><span class="annot"><span class="annottext">loadPeerDb :: String -&gt; IO PeerDb
</span><a href="P2P.Node.PeerDB.html#loadPeerDb"><span class="hs-identifier hs-var hs-var">loadPeerDb</span></a></span></span><span> </span><span id="local-6989586621681493509"><span class="annot"><span class="annottext">f :: String
</span><a href="#local-6989586621681493509"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MVar () -&gt; TVar PeerSet -&gt; PeerDb
</span><a href="P2P.Node.PeerDB.html#PeerDb"><span class="hs-identifier hs-var">PeerDb</span></a></span><span>
</span><span id="line-387"></span><span>    </span><span class="annot"><span class="annottext">(MVar () -&gt; TVar PeerSet -&gt; PeerDb)
-&gt; IO (MVar ()) -&gt; IO (TVar PeerSet -&gt; PeerDb)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">() -&gt; IO (MVar ())
forall a. a -&gt; IO (MVar a)
</span><span class="hs-identifier hs-var">newMVar</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-388"></span><span>    </span><span class="annot"><span class="annottext">IO (TVar PeerSet -&gt; PeerDb) -&gt; IO (TVar PeerSet) -&gt; IO PeerDb
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PeerSet -&gt; IO (TVar PeerSet)
forall a. a -&gt; IO (TVar a)
</span><span class="hs-identifier hs-var">newTVarIO</span></span><span> </span><span class="annot"><span class="annottext">(PeerSet -&gt; IO (TVar PeerSet))
-&gt; (Set PeerEntry -&gt; PeerSet) -&gt; Set PeerEntry -&gt; IO (TVar PeerSet)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Set PeerEntry -&gt; PeerSet
</span><a href="P2P.Node.PeerDB.html#fromPeerSet"><span class="hs-identifier hs-var">fromPeerSet</span></a></span><span> </span><span class="annot"><span class="annottext">(Set PeerEntry -&gt; IO (TVar PeerSet))
-&gt; IO (Set PeerEntry) -&gt; IO (TVar PeerSet)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; IO (Set PeerEntry)
forall a (m :: * -&gt; *).
(MonadIO m, MonadThrow m, FromJSON a) =&gt;
String -&gt; m a
</span><a href="Chainweb.Utils.html#decodeFileStrictOrThrow%27"><span class="hs-identifier hs-var">decodeFileStrictOrThrow'</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681493509"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-389"></span><span>
</span><span id="line-390"></span><span class="hs-comment">-- | New entries overwrite existing entries</span><span>
</span><span id="line-391"></span><span class="hs-comment">--</span><span>
</span><span id="line-392"></span><span class="annot"><a href="P2P.Node.PeerDB.html#loadIntoPeerDb"><span class="hs-identifier hs-type">loadIntoPeerDb</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="P2P.Node.PeerDB.html#PeerDb"><span class="hs-identifier hs-type">PeerDb</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-393"></span><span id="loadIntoPeerDb"><span class="annot"><span class="annottext">loadIntoPeerDb :: String -&gt; PeerDb -&gt; IO ()
</span><a href="P2P.Node.PeerDB.html#loadIntoPeerDb"><span class="hs-identifier hs-var hs-var">loadIntoPeerDb</span></a></span></span><span> </span><span id="local-6989586621681493506"><span class="annot"><span class="annottext">f :: String
</span><a href="#local-6989586621681493506"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621681493505"><span class="annot"><span class="annottext">db :: PeerDb
</span><a href="#local-6989586621681493505"><span class="hs-identifier hs-var">db</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-394"></span><span>    </span><span id="local-6989586621681493504"><span class="annot"><span class="annottext">Set PeerEntry
</span><a href="#local-6989586621681493504"><span class="hs-identifier hs-var">peers</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO (Set PeerEntry)
forall a (m :: * -&gt; *).
(MonadIO m, MonadThrow m, FromJSON a) =&gt;
String -&gt; m a
</span><a href="Chainweb.Utils.html#decodeFileStrictOrThrow%27"><span class="hs-identifier hs-var">decodeFileStrictOrThrow'</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681493506"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-395"></span><span>    </span><span class="annot"><span class="annottext">Set PeerEntry -&gt; PeerDb -&gt; IO ()
</span><a href="P2P.Node.PeerDB.html#peerDbInsertSet"><span class="hs-identifier hs-var">peerDbInsertSet</span></a></span><span> </span><span class="annot"><span class="annottext">Set PeerEntry
</span><a href="#local-6989586621681493504"><span class="hs-identifier hs-var">peers</span></a></span><span> </span><span class="annot"><span class="annottext">PeerDb
</span><a href="#local-6989586621681493505"><span class="hs-identifier hs-var">db</span></a></span><span>
</span><span id="line-396"></span><span>
</span><span id="line-397"></span><span class="hs-comment">-- -------------------------------------------------------------------------- --</span><span>
</span><span id="line-398"></span><span class="hs-comment">-- Some PeerDb</span><span>
</span><span id="line-399"></span><span>
</span><span id="line-400"></span><span class="hs-comment">-- | 'PeerDb' with type level 'ChainwebVersion' and 'NetworkIdT' indexes</span><span>
</span><span id="line-401"></span><span class="hs-comment">--</span><span>
</span><span id="line-402"></span><span id="local-6989586621681493502"><span id="local-6989586621681493503"></span></span><span class="hs-keyword">newtype</span><span> </span><span id="PeerDbT"><span class="annot"><a href="P2P.Node.PeerDB.html#PeerDbT"><span class="hs-identifier hs-var">PeerDbT</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681494005"><span class="annot"><a href="#local-6989586621681494005"><span class="hs-identifier hs-type">v</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Chainweb.Version.html#ChainwebVersionT"><span class="hs-identifier hs-type">ChainwebVersionT</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681494004"><span class="annot"><a href="#local-6989586621681494004"><span class="hs-identifier hs-type">n</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Chainweb.RestAPI.NetworkID.html#NetworkIdT"><span class="hs-identifier hs-type">NetworkIdT</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span id="PeerDbT"><span class="annot"><a href="P2P.Node.PeerDB.html#PeerDbT"><span class="hs-identifier hs-var">PeerDbT</span></a></span></span><span> </span><span class="annot"><a href="P2P.Node.PeerDB.html#PeerDb"><span class="hs-identifier hs-type">PeerDb</span></a></span><span>
</span><span id="line-403"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681493497"><span id="local-6989586621681493499"><span class="annot"><span class="annottext">PeerDbT v n -&gt; PeerDbT v n -&gt; Bool
(PeerDbT v n -&gt; PeerDbT v n -&gt; Bool)
-&gt; (PeerDbT v n -&gt; PeerDbT v n -&gt; Bool) -&gt; Eq (PeerDbT v n)
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
forall (v :: ChainwebVersionT) (n :: NetworkIdT).
PeerDbT v n -&gt; PeerDbT v n -&gt; Bool
/= :: PeerDbT v n -&gt; PeerDbT v n -&gt; Bool
$c/= :: forall (v :: ChainwebVersionT) (n :: NetworkIdT).
PeerDbT v n -&gt; PeerDbT v n -&gt; Bool
== :: PeerDbT v n -&gt; PeerDbT v n -&gt; Bool
$c== :: forall (v :: ChainwebVersionT) (n :: NetworkIdT).
PeerDbT v n -&gt; PeerDbT v n -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(forall x. PeerDbT v n -&gt; Rep (PeerDbT v n) x)
-&gt; (forall x. Rep (PeerDbT v n) x -&gt; PeerDbT v n)
-&gt; Generic (PeerDbT v n)
forall x. Rep (PeerDbT v n) x -&gt; PeerDbT v n
forall x. PeerDbT v n -&gt; Rep (PeerDbT v n) x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
forall (v :: ChainwebVersionT) (n :: NetworkIdT) x.
Rep (PeerDbT v n) x -&gt; PeerDbT v n
forall (v :: ChainwebVersionT) (n :: NetworkIdT) x.
PeerDbT v n -&gt; Rep (PeerDbT v n) x
$cto :: forall (v :: ChainwebVersionT) (n :: NetworkIdT) x.
Rep (PeerDbT v n) x -&gt; PeerDbT v n
$cfrom :: forall (v :: ChainwebVersionT) (n :: NetworkIdT) x.
PeerDbT v n -&gt; Rep (PeerDbT v n) x
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></span><span class="hs-special">)</span><span>
</span><span id="line-404"></span><span>
</span><span id="line-405"></span><span class="hs-keyword">data</span><span> </span><span id="SomePeerDb"><span class="annot"><a href="P2P.Node.PeerDB.html#SomePeerDb"><span class="hs-identifier hs-var">SomePeerDb</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621681494010"><span class="annot"><a href="#local-6989586621681494010"><span class="hs-identifier hs-type">v</span></a></span></span><span> </span><span id="local-6989586621681494008"><span class="annot"><a href="#local-6989586621681494008"><span class="hs-identifier hs-type">n</span></a></span></span><span>
</span><span id="line-406"></span><span>    </span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Chainweb.Version.html#KnownChainwebVersionSymbol"><span class="hs-identifier hs-type">KnownChainwebVersionSymbol</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681494010"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Singletons.html#SingI"><span class="hs-identifier hs-type">SingI</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681494008"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-407"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span id="SomePeerDb"><span class="annot"><a href="P2P.Node.PeerDB.html#SomePeerDb"><span class="hs-identifier hs-var">SomePeerDb</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="P2P.Node.PeerDB.html#PeerDbT"><span class="hs-identifier hs-type">PeerDbT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681494010"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681494008"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-408"></span><span>
</span><span id="line-409"></span><span class="annot"><a href="P2P.Node.PeerDB.html#somePeerDbVal"><span class="hs-identifier hs-type">somePeerDbVal</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Chainweb.Version.html#ChainwebVersion"><span class="hs-identifier hs-type">ChainwebVersion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Chainweb.RestAPI.NetworkID.html#NetworkId"><span class="hs-identifier hs-type">NetworkId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="P2P.Node.PeerDB.html#PeerDb"><span class="hs-identifier hs-type">PeerDb</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="P2P.Node.PeerDB.html#SomePeerDb"><span class="hs-identifier hs-type">SomePeerDb</span></a></span><span>
</span><span id="line-410"></span><span id="somePeerDbVal"><span class="annot"><span class="annottext">somePeerDbVal :: ChainwebVersion -&gt; NetworkId -&gt; PeerDb -&gt; SomePeerDb
</span><a href="P2P.Node.PeerDB.html#somePeerDbVal"><span class="hs-identifier hs-var hs-var">somePeerDbVal</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Singletons.html#FromSing"><span class="hs-identifier hs-type">FromSing</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681493492"><span class="annot"><a href="Chainweb.Version.html#SChainwebVersion"><span class="hs-identifier hs-type">SChainwebVersion</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.Singletons.html#Sing"><span class="hs-identifier hs-type">Sing</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681493492"><span class="hs-identifier hs-type">v</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621681493489"><span class="annot"><span class="annottext">n :: NetworkId
</span><a href="#local-6989586621681493489"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621681493488"><span class="annot"><span class="annottext">db :: PeerDb
</span><a href="#local-6989586621681493488"><span class="hs-identifier hs-var">db</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NetworkId -&gt; SomePeerDb
</span><a href="#local-6989586621681493487"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkId
</span><a href="#local-6989586621681493489"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-411"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-412"></span><span>    </span><span id="local-6989586621681493487"><span class="annot"><span class="annottext">f :: NetworkId -&gt; SomePeerDb
</span><a href="#local-6989586621681493487"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Singletons.html#FromSing"><span class="hs-identifier hs-type">FromSing</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681493486"><span class="annot"><a href="Chainweb.RestAPI.NetworkID.html#SChainNetwork"><span class="hs-identifier hs-type">SChainNetwork</span></a></span><span> </span><span class="annot"><a href="Chainweb.ChainId.html#SChainId"><span class="hs-identifier hs-type">SChainId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.Singletons.html#Sing"><span class="hs-identifier hs-type">Sing</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681493486"><span class="hs-identifier hs-type">n</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PeerDbT a ('ChainNetworkT c) -&gt; SomePeerDb
forall (v :: ChainwebVersionT) (n :: NetworkIdT).
(KnownChainwebVersionSymbol v, SingI n) =&gt;
PeerDbT v n -&gt; SomePeerDb
</span><a href="P2P.Node.PeerDB.html#SomePeerDb"><span class="hs-identifier hs-var">SomePeerDb</span></a></span><span> </span><span class="annot"><span class="annottext">(PeerDbT a ('ChainNetworkT c) -&gt; SomePeerDb)
-&gt; PeerDbT a ('ChainNetworkT c) -&gt; SomePeerDb
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PeerDb -&gt; PeerDbT a a
forall (v :: ChainwebVersionT) (n :: NetworkIdT).
PeerDb -&gt; PeerDbT v n
</span><a href="P2P.Node.PeerDB.html#PeerDbT"><span class="hs-identifier hs-var">PeerDbT</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621681493492"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621681493486"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="annottext">PeerDb
</span><a href="#local-6989586621681493488"><span class="hs-identifier hs-var">db</span></a></span><span>
</span><span id="line-413"></span><span>    </span><span class="annot"><a href="#local-6989586621681493487"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Singletons.html#FromSing"><span class="hs-identifier hs-type">FromSing</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681493483"><span class="annot"><a href="Chainweb.RestAPI.NetworkID.html#SMempoolNetwork"><span class="hs-identifier hs-type">SMempoolNetwork</span></a></span><span> </span><span class="annot"><a href="Chainweb.ChainId.html#SChainId"><span class="hs-identifier hs-type">SChainId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.Singletons.html#Sing"><span class="hs-identifier hs-type">Sing</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681493483"><span class="hs-identifier hs-type">n</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PeerDbT a ('MempoolNetworkT c) -&gt; SomePeerDb
forall (v :: ChainwebVersionT) (n :: NetworkIdT).
(KnownChainwebVersionSymbol v, SingI n) =&gt;
PeerDbT v n -&gt; SomePeerDb
</span><a href="P2P.Node.PeerDB.html#SomePeerDb"><span class="hs-identifier hs-var">SomePeerDb</span></a></span><span> </span><span class="annot"><span class="annottext">(PeerDbT a ('MempoolNetworkT c) -&gt; SomePeerDb)
-&gt; PeerDbT a ('MempoolNetworkT c) -&gt; SomePeerDb
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PeerDb -&gt; PeerDbT a a
forall (v :: ChainwebVersionT) (n :: NetworkIdT).
PeerDb -&gt; PeerDbT v n
</span><a href="P2P.Node.PeerDB.html#PeerDbT"><span class="hs-identifier hs-var">PeerDbT</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621681493492"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621681493483"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="annottext">PeerDb
</span><a href="#local-6989586621681493488"><span class="hs-identifier hs-var">db</span></a></span><span>
</span><span id="line-414"></span><span>    </span><span class="annot"><a href="#local-6989586621681493487"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Singletons.html#FromSing"><span class="hs-identifier hs-type">FromSing</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681493481"><span class="annot"><a href="Chainweb.RestAPI.NetworkID.html#SCutNetwork"><span class="hs-identifier hs-type">SCutNetwork</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.Singletons.html#Sing"><span class="hs-identifier hs-type">Sing</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681493481"><span class="hs-identifier hs-type">n</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PeerDbT a 'CutNetworkT -&gt; SomePeerDb
forall (v :: ChainwebVersionT) (n :: NetworkIdT).
(KnownChainwebVersionSymbol v, SingI n) =&gt;
PeerDbT v n -&gt; SomePeerDb
</span><a href="P2P.Node.PeerDB.html#SomePeerDb"><span class="hs-identifier hs-var">SomePeerDb</span></a></span><span> </span><span class="annot"><span class="annottext">(PeerDbT a 'CutNetworkT -&gt; SomePeerDb)
-&gt; PeerDbT a 'CutNetworkT -&gt; SomePeerDb
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PeerDb -&gt; PeerDbT a a
forall (v :: ChainwebVersionT) (n :: NetworkIdT).
PeerDb -&gt; PeerDbT v n
</span><a href="P2P.Node.PeerDB.html#PeerDbT"><span class="hs-identifier hs-var">PeerDbT</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621681493492"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621681493481"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="annottext">PeerDb
</span><a href="#local-6989586621681493488"><span class="hs-identifier hs-var">db</span></a></span><span>
</span><span id="line-415"></span><span>
</span><span id="line-416"></span><span class="hs-comment">-- -------------------------------------------------------------------------- --</span><span>
</span><span id="line-417"></span><span class="hs-comment">-- Properties</span><span>
</span><span id="line-418"></span><span>
</span><span id="line-419"></span><span class="annot"><a href="P2P.Node.PeerDB.html#prop_peerDbLoadStore"><span class="hs-identifier hs-type">prop_peerDbLoadStore</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="P2P.Node.PeerDB.html#PeerEntry"><span class="hs-identifier hs-type">PeerEntry</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Property</span></span><span>
</span><span id="line-420"></span><span id="prop_peerDbLoadStore"><span class="annot"><span class="annottext">prop_peerDbLoadStore :: [PeerEntry] -&gt; Property
</span><a href="P2P.Node.PeerDB.html#prop_peerDbLoadStore"><span class="hs-identifier hs-var hs-var">prop_peerDbLoadStore</span></a></span></span><span> </span><span id="local-6989586621681493478"><span class="annot"><span class="annottext">peers :: [PeerEntry]
</span><a href="#local-6989586621681493478"><span class="hs-identifier hs-var">peers</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO Property -&gt; Property
forall prop. Testable prop =&gt; IO prop -&gt; Property
</span><span class="hs-identifier hs-var">ioProperty</span></span><span>
</span><span id="line-421"></span><span>    </span><span class="annot"><span class="annottext">(IO Property -&gt; Property) -&gt; IO Property -&gt; Property
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; (String -&gt; IO Property) -&gt; IO Property
forall (m :: * -&gt; *) a.
(MonadIO m, MonadMask m) =&gt;
String -&gt; (String -&gt; m a) -&gt; m a
</span><span class="hs-identifier hs-var">withSystemTempDirectory</span></span><span> </span><span class="annot"><span class="hs-string">&quot;peerDbTest&quot;</span></span><span> </span><span class="annot"><span class="annottext">((String -&gt; IO Property) -&gt; IO Property)
-&gt; (String -&gt; IO Property) -&gt; IO Property
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681493476"><span class="annot"><span class="annottext">dirName :: String
</span><a href="#local-6989586621681493476"><span class="hs-identifier hs-var">dirName</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-422"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681493475"><span class="annot"><span class="annottext">filePath :: String
</span><a href="#local-6989586621681493475"><span class="hs-identifier hs-var hs-var">filePath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681493476"><span class="hs-identifier hs-var">dirName</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="hs-string">&quot;/peerDb.json&quot;</span></span><span>
</span><span id="line-423"></span><span>        </span><span id="local-6989586621681493474"><span class="annot"><span class="annottext">PeerDb
</span><a href="#local-6989586621681493474"><span class="hs-identifier hs-var">db</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[PeerEntry] -&gt; IO PeerDb
</span><a href="P2P.Node.PeerDB.html#fromPeerEntryList"><span class="hs-identifier hs-var">fromPeerEntryList</span></a></span><span> </span><span class="annot"><span class="annottext">[PeerEntry]
</span><a href="#local-6989586621681493478"><span class="hs-identifier hs-var">peers</span></a></span><span>
</span><span id="line-424"></span><span>        </span><span id="local-6989586621681493473"><span class="annot"><span class="annottext">PeerDb
</span><a href="#local-6989586621681493473"><span class="hs-identifier hs-var">db'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; PeerDb -&gt; IO ()
</span><a href="P2P.Node.PeerDB.html#storePeerDb"><span class="hs-identifier hs-var">storePeerDb</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681493475"><span class="hs-identifier hs-var">filePath</span></a></span><span> </span><span class="annot"><span class="annottext">PeerDb
</span><a href="#local-6989586621681493474"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="annot"><span class="annottext">IO () -&gt; IO PeerDb -&gt; IO PeerDb
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; IO PeerDb
</span><a href="P2P.Node.PeerDB.html#loadPeerDb"><span class="hs-identifier hs-var">loadPeerDb</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681493475"><span class="hs-identifier hs-var">filePath</span></a></span><span>
</span><span id="line-425"></span><span>        </span><span id="local-6989586621681493472"><span class="annot"><span class="annottext">PeerDb
</span><a href="#local-6989586621681493472"><span class="hs-identifier hs-var">db''</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; PeerDb -&gt; IO ()
</span><a href="P2P.Node.PeerDB.html#storePeerDb"><span class="hs-identifier hs-var">storePeerDb</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681493475"><span class="hs-identifier hs-var">filePath</span></a></span><span> </span><span class="annot"><span class="annottext">PeerDb
</span><a href="#local-6989586621681493473"><span class="hs-identifier hs-var">db'</span></a></span><span> </span><span class="annot"><span class="annottext">IO () -&gt; IO PeerDb -&gt; IO PeerDb
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; IO PeerDb
</span><a href="P2P.Node.PeerDB.html#loadPeerDb"><span class="hs-identifier hs-var">loadPeerDb</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681493475"><span class="hs-identifier hs-var">filePath</span></a></span><span>
</span><span id="line-426"></span><span>        </span><span class="annot"><span class="annottext">PeerSet -&gt; PeerSet -&gt; Property
forall a. (Eq a, Show a) =&gt; a -&gt; a -&gt; Property
</span><span class="hs-operator hs-var">(===)</span></span><span>
</span><span id="line-427"></span><span>            </span><span class="annot"><span class="annottext">(PeerSet -&gt; PeerSet -&gt; Property)
-&gt; IO PeerSet -&gt; IO (PeerSet -&gt; Property)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">PeerDb -&gt; IO PeerSet
</span><a href="P2P.Node.PeerDB.html#peerDbSnapshot"><span class="hs-identifier hs-var">peerDbSnapshot</span></a></span><span> </span><span class="annot"><span class="annottext">PeerDb
</span><a href="#local-6989586621681493474"><span class="hs-identifier hs-var">db</span></a></span><span>
</span><span id="line-428"></span><span>            </span><span class="annot"><span class="annottext">IO (PeerSet -&gt; Property) -&gt; IO PeerSet -&gt; IO Property
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">PeerDb -&gt; IO PeerSet
</span><a href="P2P.Node.PeerDB.html#peerDbSnapshot"><span class="hs-identifier hs-var">peerDbSnapshot</span></a></span><span> </span><span class="annot"><span class="annottext">PeerDb
</span><a href="#local-6989586621681493472"><span class="hs-identifier hs-var">db''</span></a></span><span>
</span><span id="line-429"></span><span>
</span><span id="line-430"></span><span class="annot"><a href="P2P.Node.PeerDB.html#properties"><span class="hs-identifier hs-type">properties</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Property</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-431"></span><span id="properties"><span class="annot"><span class="annottext">properties :: [(String, Property)]
</span><a href="P2P.Node.PeerDB.html#properties"><span class="hs-identifier hs-var hs-var">properties</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-432"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;peerDbLoadStore&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">([PeerEntry] -&gt; Property) -&gt; Property
forall prop. Testable prop =&gt; prop -&gt; Property
</span><span class="hs-identifier hs-var">property</span></span><span> </span><span class="annot"><span class="annottext">[PeerEntry] -&gt; Property
</span><a href="P2P.Node.PeerDB.html#prop_peerDbLoadStore"><span class="hs-identifier hs-var">prop_peerDbLoadStore</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-433"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-434"></span></pre></body></html>