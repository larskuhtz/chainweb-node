<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE AllowAmbiguousTypes #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE BangPatterns #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE DataKinds #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE DeriveAnyClass #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE DeriveGeneric #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE DerivingStrategies #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase #-}</span><span>
</span><span id="line-10"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-11"></span><span class="hs-pragma">{-# LANGUAGE PatternSynonyms #-}</span><span>
</span><span id="line-12"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-13"></span><span class="hs-pragma">{-# LANGUAGE TypeApplications #-}</span><span>
</span><span id="line-14"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies #-}</span><span>
</span><span id="line-15"></span><span>
</span><span id="line-16"></span><span class="hs-comment">-- |</span><span>
</span><span id="line-17"></span><span class="hs-comment">-- Module: Network.X509.SelfSigned</span><span>
</span><span id="line-18"></span><span class="hs-comment">-- Copyright: Copyright &#169; 2018 Kadena LLC.</span><span>
</span><span id="line-19"></span><span class="hs-comment">-- License: MIT</span><span>
</span><span id="line-20"></span><span class="hs-comment">-- Maintainer: Kadena Chainweb Team &lt;chainweb-dev@kadena.io&gt;</span><span>
</span><span id="line-21"></span><span class="hs-comment">-- Stability: experimental</span><span>
</span><span id="line-22"></span><span class="hs-comment">--</span><span>
</span><span id="line-23"></span><span class="hs-comment">-- TODO</span><span>
</span><span id="line-24"></span><span class="hs-comment">--</span><span>
</span><span id="line-25"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Network.X509.SelfSigned</span><span>
</span><span id="line-26"></span><span class="hs-special">(</span><span>
</span><span id="line-27"></span><span class="annot"><span class="hs-comment">-- * Supported X509 Certificate Types</span></span><span>
</span><span id="line-28"></span><span>  </span><span class="annot"><a href="Network.X509.SelfSigned.html#Ed25519Cert"><span class="hs-identifier">Ed25519Cert</span></a></span><span>
</span><span id="line-29"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#Ed448Cert"><span class="hs-identifier">Ed448Cert</span></a></span><span>
</span><span id="line-30"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#RsaCert"><span class="hs-identifier">RsaCert</span></a></span><span>
</span><span id="line-31"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#P256Cert"><span class="hs-identifier">P256Cert</span></a></span><span>
</span><span id="line-32"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#DefCertType"><span class="hs-identifier">DefCertType</span></a></span><span>
</span><span id="line-33"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#X509Key"><span class="hs-identifier">X509Key</span></a></span><span>
</span><span id="line-34"></span><span>
</span><span id="line-35"></span><span class="annot"><span class="hs-comment">-- * Generate PEM encoded self-signed X509 Certificates</span></span><span>
</span><span id="line-36"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#generateSelfSignedCertificate"><span class="hs-identifier">generateSelfSignedCertificate</span></a></span><span>
</span><span id="line-37"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#generateLocalhostCertificate"><span class="hs-identifier">generateLocalhostCertificate</span></a></span><span>
</span><span id="line-38"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#makeCertificate"><span class="hs-identifier">makeCertificate</span></a></span><span>
</span><span id="line-39"></span><span>
</span><span id="line-40"></span><span class="annot"><span class="hs-comment">-- * Client Support</span></span><span>
</span><span id="line-41"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#TlsPolicy"><span class="hs-identifier">TlsPolicy</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">ServiceID</span></span><span>
</span><span id="line-43"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#unsafeMakeCredential"><span class="hs-identifier">unsafeMakeCredential</span></a></span><span>
</span><span id="line-44"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#certificateCacheManagerSettings"><span class="hs-identifier">certificateCacheManagerSettings</span></a></span><span>
</span><span id="line-45"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#isCertificateMismatchException"><span class="hs-identifier">isCertificateMismatchException</span></a></span><span>
</span><span id="line-46"></span><span>
</span><span id="line-47"></span><span class="annot"><span class="hs-comment">-- * Server Settings</span></span><span>
</span><span id="line-48"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#tlsServerSettings"><span class="hs-identifier">tlsServerSettings</span></a></span><span>
</span><span id="line-49"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#tlsServerChainSettings"><span class="hs-identifier">tlsServerChainSettings</span></a></span><span>
</span><span id="line-50"></span><span>
</span><span id="line-51"></span><span class="annot"><span class="hs-comment">-- * Low level Utils</span></span><span>
</span><span id="line-52"></span><span>
</span><span id="line-53"></span><span class="annot"><span class="hs-comment">-- ** Distinguished Name and Alt Names</span></span><span>
</span><span id="line-54"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#name"><span class="hs-identifier">name</span></a></span><span>
</span><span id="line-55"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#org"><span class="hs-identifier">org</span></a></span><span>
</span><span id="line-56"></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">AltName</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-57"></span><span>
</span><span id="line-58"></span><span class="annot"><span class="hs-comment">-- ** Certificate Fingerprints</span></span><span>
</span><span id="line-59"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#FingerprintByteCount"><span class="hs-identifier">FingerprintByteCount</span></a></span><span>
</span><span id="line-60"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#fingerprintByteCount"><span class="hs-identifier">fingerprintByteCount</span></a></span><span>
</span><span id="line-61"></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Fingerprint</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#fingerprint"><span class="hs-identifier">fingerprint</span></a></span><span>
</span><span id="line-63"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#fingerprintToText"><span class="hs-identifier">fingerprintToText</span></a></span><span>
</span><span id="line-64"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#fingerprintFromText"><span class="hs-identifier">fingerprintFromText</span></a></span><span>
</span><span id="line-65"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#unsafeFingerprintFromText"><span class="hs-identifier">unsafeFingerprintFromText</span></a></span><span>
</span><span id="line-66"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#fingerprintPem"><span class="hs-identifier">fingerprintPem</span></a></span><span>
</span><span id="line-67"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#unsafeFingerprintPem"><span class="hs-identifier">unsafeFingerprintPem</span></a></span><span>
</span><span id="line-68"></span><span>
</span><span id="line-69"></span><span class="annot"><span class="hs-comment">-- ** PEM encoded Certificate</span></span><span>
</span><span id="line-70"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#X509CertPem"><span class="hs-identifier">X509CertPem</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-71"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#x509CertPemToText"><span class="hs-identifier">x509CertPemToText</span></a></span><span>
</span><span id="line-72"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#x509CertPemFromText"><span class="hs-identifier">x509CertPemFromText</span></a></span><span>
</span><span id="line-73"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#pX509CertPem"><span class="hs-identifier">pX509CertPem</span></a></span><span>
</span><span id="line-74"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#unsafeX509CertPemFromText"><span class="hs-identifier">unsafeX509CertPemFromText</span></a></span><span>
</span><span id="line-75"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#validateX509CertPem"><span class="hs-identifier">validateX509CertPem</span></a></span><span>
</span><span id="line-76"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#decodePemX509Cert"><span class="hs-identifier">decodePemX509Cert</span></a></span><span>
</span><span id="line-77"></span><span>
</span><span id="line-78"></span><span class="annot"><span class="hs-comment">-- ** PEM encoded Key</span></span><span>
</span><span id="line-79"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#X509KeyPem"><span class="hs-identifier">X509KeyPem</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-80"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#x509KeyPemToText"><span class="hs-identifier">x509KeyPemToText</span></a></span><span>
</span><span id="line-81"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#x509KeyPemFromText"><span class="hs-identifier">x509KeyPemFromText</span></a></span><span>
</span><span id="line-82"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#pX509KeyPem"><span class="hs-identifier">pX509KeyPem</span></a></span><span>
</span><span id="line-83"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#unsafeX509KeyPemFromText"><span class="hs-identifier">unsafeX509KeyPemFromText</span></a></span><span>
</span><span id="line-84"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#validateX509KeyPem"><span class="hs-identifier">validateX509KeyPem</span></a></span><span>
</span><span id="line-85"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#decodePemX509Key"><span class="hs-identifier">decodePemX509Key</span></a></span><span>
</span><span id="line-86"></span><span>
</span><span id="line-87"></span><span class="annot"><span class="hs-comment">-- ** PEM encode certificate chain</span></span><span>
</span><span id="line-88"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#X509CertChainPem"><span class="hs-identifier">X509CertChainPem</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-89"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#x509CertChainPemToText"><span class="hs-identifier">x509CertChainPemToText</span></a></span><span>
</span><span id="line-90"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#x509CertChainPemFromText"><span class="hs-identifier">x509CertChainPemFromText</span></a></span><span>
</span><span id="line-91"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#pX509CertChainPem"><span class="hs-identifier">pX509CertChainPem</span></a></span><span>
</span><span id="line-92"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#unsafeX509CertChainPemFromText"><span class="hs-identifier">unsafeX509CertChainPemFromText</span></a></span><span>
</span><span id="line-93"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#validateX509CertChainPem"><span class="hs-identifier">validateX509CertChainPem</span></a></span><span>
</span><span id="line-94"></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-95"></span><span>
</span><span id="line-96"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Configuration.Utils</span></span><span>
</span><span id="line-97"></span><span>
</span><span id="line-98"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.DeepSeq</span></span><span>
</span><span id="line-99"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span>
</span><span id="line-100"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Catch</span></span><span>
</span><span id="line-101"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Error.Class</span></span><span>
</span><span id="line-102"></span><span>
</span><span id="line-103"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Crypto.Hash.Algorithms</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">SHA512</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-104"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Crypto.Number.Serialize</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">EC</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">i2ospOf_</span></span><span class="hs-special">)</span><span>
</span><span id="line-105"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Crypto.PubKey.ECC.ECDSA</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">EC</span></span><span>
</span><span id="line-106"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Crypto.PubKey.ECC.Generate</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">EC</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">generate</span></span><span class="hs-special">)</span><span>
</span><span id="line-107"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Crypto.PubKey.ECC.Types</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">EC</span></span><span>
</span><span id="line-108"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Crypto.PubKey.Ed25519</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Ed25519</span></span><span>
</span><span id="line-109"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Crypto.PubKey.Ed448</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Ed448</span></span><span>
</span><span id="line-110"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Crypto.PubKey.RSA</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">RSA</span></span><span>
</span><span id="line-111"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Crypto.PubKey.RSA.PKCS15</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">RSA</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">signSafer</span></span><span class="hs-special">)</span><span>
</span><span id="line-112"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Crypto.PubKey.RSA.Types</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">RSA</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">KeyPair</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">toPublicKey</span></span><span class="hs-special">)</span><span>
</span><span id="line-113"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Crypto.Random.Types</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">MonadRandom</span></span><span class="hs-special">)</span><span>
</span><span id="line-114"></span><span>
</span><span id="line-115"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.ASN1.BinaryEncoding</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">DER</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-116"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.ASN1.Encoding</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">decodeASN1'</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">encodeASN1'</span></span><span class="hs-special">)</span><span>
</span><span id="line-117"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.ASN1.Types</span></span><span>
</span><span id="line-118"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Bifunctor</span></span><span>
</span><span id="line-119"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteArray</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ByteArray</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">convert</span></span><span class="hs-special">)</span><span>
</span><span id="line-120"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">B</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ByteString</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">length</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">pack</span></span><span class="hs-special">)</span><span>
</span><span id="line-121"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Char8</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">B8</span></span><span>
</span><span id="line-122"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Default</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">def</span></span><span class="hs-special">)</span><span>
</span><span id="line-123"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Foldable</span></span><span>
</span><span id="line-124"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Hashable</span></span><span>
</span><span id="line-125"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Hourglass</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">DateTime</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">durationHours</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">timeAdd</span></span><span class="hs-special">)</span><span>
</span><span id="line-126"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">L</span></span><span>
</span><span id="line-127"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.List.NonEmpty</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">NE</span></span><span>
</span><span id="line-128"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">maybeToList</span></span><span class="hs-special">)</span><span>
</span><span id="line-129"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.PEM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">PEM</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">pemParseBS</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">pemWriteBS</span></span><span class="hs-special">)</span><span>
</span><span id="line-130"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Proxy</span></span><span>
</span><span id="line-131"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.String</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">fromString</span></span><span class="hs-special">)</span><span>
</span><span id="line-132"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-133"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text.Encoding</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-134"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.X509</span></span><span>
</span><span id="line-135"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.X509.Validation</span></span><span>
</span><span id="line-136"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Fingerprint</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">ServiceID</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">ValidationCacheQueryCallback</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">getFingerprint</span></span><span class="hs-special">)</span><span>
</span><span id="line-137"></span><span>
</span><span id="line-138"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Generics</span></span><span>
</span><span id="line-139"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Stack</span></span><span>
</span><span id="line-140"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.TypeNats</span></span><span>
</span><span id="line-141"></span><span>
</span><span id="line-142"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Network.Connection</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">TLSSettings</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-143"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Network.HTTP.Client</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ManagerSettings</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">HttpException</span></span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">HttpExceptionRequest</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">HttpExceptionContent</span></span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">InternalException</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-144"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Network.HTTP.Client.TLS</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">mkManagerSettings</span></span><span class="hs-special">)</span><span>
</span><span id="line-145"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Network.TLS</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">HashSHA256</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">HashSHA512</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">SHA512</span></span><span class="hs-special">)</span><span>
</span><span id="line-146"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Network.TLS.Extra</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ciphersuite_default</span></span><span class="hs-special">)</span><span>
</span><span id="line-147"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Network.Wai.Handler.WarpTLS</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">WARP</span></span><span>
</span><span id="line-148"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">TLSSettings</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">tlsSettingsChainMemory</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">tlsSettingsMemory</span></span><span class="hs-special">)</span><span>
</span><span id="line-149"></span><span>
</span><span id="line-150"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Numeric.Natural</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Natural</span></span><span class="hs-special">)</span><span>
</span><span id="line-151"></span><span>
</span><span id="line-152"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.Hourglass</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">dateCurrent</span></span><span class="hs-special">)</span><span>
</span><span id="line-153"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.X509</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">getSystemCertificateStore</span></span><span class="hs-special">)</span><span>
</span><span id="line-154"></span><span>
</span><span id="line-155"></span><span class="hs-comment">-- internal modules</span><span>
</span><span id="line-156"></span><span>
</span><span id="line-157"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Chainweb.Utils.html"><span class="hs-identifier">Chainweb.Utils</span></a></span><span>
</span><span id="line-158"></span><span>
</span><span id="line-159"></span><span class="hs-comment">-- -------------------------------------------------------------------------- --</span><span>
</span><span id="line-160"></span><span class="hs-comment">-- X509 Certificate Types</span><span class="hs-cpp">

#if WITH_ED25519
</span><span class="hs-keyword">type</span><span> </span><span class="hs-identifier">DefCertType</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Ed25519Cert</span><span class="hs-cpp">
#else
</span><span class="hs-keyword">type</span><span> </span><span id="DefCertType"><span class="annot"><a href="Network.X509.SelfSigned.html#DefCertType"><span class="hs-identifier hs-var">DefCertType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#RsaCert"><span class="hs-identifier hs-type">RsaCert</span></a></span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-168"></span><span class="hs-comment">-- | The signature algorithm Ed25519. EdDSA signature algorithms are not yet</span><span>
</span><span id="line-169"></span><span class="hs-comment">-- supported by most clients. It is part of TLSv1.3 and supported in openssl-1.1</span><span>
</span><span id="line-170"></span><span class="hs-comment">-- (with TLSv1.2 and TLS1.3) and the master branch (as of 2019-01-10) of Haskell</span><span>
</span><span id="line-171"></span><span class="hs-comment">-- tls (with TLSv1.2 and TLSv1.3). Also, the under high load the performance of</span><span>
</span><span id="line-172"></span><span class="hs-comment">-- the Haskell tls package is better with 4096 bit RSA certificates than with</span><span>
</span><span id="line-173"></span><span class="hs-comment">-- ED25519 certificates.</span><span>
</span><span id="line-174"></span><span class="hs-comment">--</span><span>
</span><span id="line-175"></span><span class="hs-keyword">type</span><span> </span><span id="Ed25519Cert"><span class="annot"><a href="Network.X509.SelfSigned.html#Ed25519Cert"><span class="hs-identifier hs-var">Ed25519Cert</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ed25519.SecretKey</span></span><span>
</span><span id="line-176"></span><span>
</span><span id="line-177"></span><span class="hs-comment">-- | The signature algorithm Ed25519. EdDSA signature algorithms are not yet</span><span>
</span><span id="line-178"></span><span class="hs-comment">-- supported by most clients. It is part of TLSv1.3 and supported in openssl-1.1</span><span>
</span><span id="line-179"></span><span class="hs-comment">-- (with TLSv1.2 and TLS1.3) and the master branch (as of 2019-01-10) of Haskell</span><span>
</span><span id="line-180"></span><span class="hs-comment">-- tls (with TLSv1.2 and TLSv1.3).</span><span>
</span><span id="line-181"></span><span class="hs-comment">--</span><span>
</span><span id="line-182"></span><span class="hs-keyword">type</span><span> </span><span id="Ed448Cert"><span class="annot"><a href="Network.X509.SelfSigned.html#Ed448Cert"><span class="hs-identifier hs-var">Ed448Cert</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ed448.SecretKey</span></span><span>
</span><span id="line-183"></span><span>
</span><span id="line-184"></span><span class="hs-comment">-- | RSA signature algorithm. Generating RSA keys is somewhat slow and the</span><span>
</span><span id="line-185"></span><span class="hs-comment">-- (sufficiently secure) public keys are large. But currently it is still the</span><span>
</span><span id="line-186"></span><span class="hs-comment">-- most widely supported certificate type. For the Haskell tls &lt;= 1.4.1 it seems</span><span>
</span><span id="line-187"></span><span class="hs-comment">-- that this is the only certificate type that is fully supported on the server</span><span>
</span><span id="line-188"></span><span class="hs-comment">-- side.</span><span>
</span><span id="line-189"></span><span class="hs-comment">--</span><span>
</span><span id="line-190"></span><span class="hs-keyword">type</span><span> </span><span id="RsaCert"><span class="annot"><a href="Network.X509.SelfSigned.html#RsaCert"><span class="hs-identifier hs-var">RsaCert</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">RSA.PrivateKey</span></span><span>
</span><span id="line-191"></span><span>
</span><span id="line-192"></span><span class="hs-comment">-- | ECDSA signature algorithm. p-256 (or prime256v1 or secp256r1) is used with</span><span>
</span><span id="line-193"></span><span class="hs-comment">-- ecdsa. it is supported by most standard clients, but disabled as signing</span><span>
</span><span id="line-194"></span><span class="hs-comment">-- algorithm on the server-side of the Haskell tls package due to an timing</span><span>
</span><span id="line-195"></span><span class="hs-comment">-- attack vulnerability in the generic ECDSA implementation.</span><span>
</span><span id="line-196"></span><span class="hs-comment">--</span><span>
</span><span id="line-197"></span><span class="hs-comment">-- https://github.com/ocheron/cryptonite/commits/tc-ecdsa</span><span>
</span><span id="line-198"></span><span class="hs-comment">-- https://github.com/ocheron/hs-tls/commits/ecdsa-signing</span><span>
</span><span id="line-199"></span><span class="hs-comment">--</span><span>
</span><span id="line-200"></span><span class="hs-comment">-- The former resolves the timing attack vulnerability for P-256 (SEC_p521r1) in</span><span>
</span><span id="line-201"></span><span class="hs-comment">-- the cryptonite package. The latter implements signing with ECDSA certificates</span><span>
</span><span id="line-202"></span><span class="hs-comment">-- in the tls package. With the increasing support for Ed25519 and Ed448 accross</span><span>
</span><span id="line-203"></span><span class="hs-comment">-- the internet it is not clear if support for ECDSA with NIST curves will ever</span><span>
</span><span id="line-204"></span><span class="hs-comment">-- be added to the Haskell tls package.</span><span>
</span><span id="line-205"></span><span class="hs-comment">--</span><span>
</span><span id="line-206"></span><span class="hs-keyword">type</span><span> </span><span id="P256Cert"><span class="annot"><a href="Network.X509.SelfSigned.html#P256Cert"><span class="hs-identifier hs-var">P256Cert</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">EC.KeyPair</span></span><span>
</span><span id="line-207"></span><span>
</span><span id="line-208"></span><span class="hs-comment">-- -------------------------------------------------------------------------- --</span><span>
</span><span id="line-209"></span><span class="hs-comment">-- EC Utils</span><span>
</span><span id="line-210"></span><span>
</span><span id="line-211"></span><span class="annot"><a href="Network.X509.SelfSigned.html#serializePoint"><span class="hs-identifier hs-type">serializePoint</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">EC.Curve</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">EC.Point</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SerializedPoint</span></span><span>
</span><span id="line-212"></span><span id="serializePoint"><span class="annot"><span class="annottext">serializePoint :: Curve -&gt; Point -&gt; SerializedPoint
</span><a href="Network.X509.SelfSigned.html#serializePoint"><span class="hs-identifier hs-var hs-var">serializePoint</span></a></span></span><span> </span><span class="hs-identifier">_</span><span> </span><span class="annot"><span class="hs-identifier hs-type">EC.PointO</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; SerializedPoint
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="hs-string">&quot;can't serialize EC point at infinity&quot;</span></span><span>
</span><span id="line-213"></span><span class="annot"><a href="Network.X509.SelfSigned.html#serializePoint"><span class="hs-identifier hs-var">serializePoint</span></a></span><span> </span><span id="local-6989586621681477168"><span class="annot"><span class="annottext">curve :: Curve
</span><a href="#local-6989586621681477168"><span class="hs-identifier hs-var">curve</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">EC.Point</span></span><span> </span><span id="local-6989586621681477166"><span class="annot"><span class="annottext">x :: Integer
</span><a href="#local-6989586621681477166"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621681477165"><span class="annot"><span class="annottext">y :: Integer
</span><a href="#local-6989586621681477165"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; SerializedPoint
</span><span class="hs-identifier hs-var">SerializedPoint</span></span><span>
</span><span id="line-214"></span><span>    </span><span class="annot"><span class="annottext">(ByteString -&gt; SerializedPoint) -&gt; ByteString -&gt; SerializedPoint
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Word8] -&gt; ByteString
</span><span class="hs-identifier hs-var">B.pack</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-number">4</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString -&gt; ByteString
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Integer -&gt; ByteString
forall ba. ByteArray ba =&gt; Int -&gt; Integer -&gt; ba
</span><span class="hs-identifier hs-var">EC.i2ospOf_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681477163"><span class="hs-identifier hs-var">bytes</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621681477166"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString -&gt; ByteString
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Integer -&gt; ByteString
forall ba. ByteArray ba =&gt; Int -&gt; Integer -&gt; ba
</span><span class="hs-identifier hs-var">EC.i2ospOf_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681477163"><span class="hs-identifier hs-var">bytes</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621681477165"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-215"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-216"></span><span>    </span><span id="local-6989586621681477162"><span class="annot"><span class="annottext">bits :: Int
</span><a href="#local-6989586621681477162"><span class="hs-identifier hs-var hs-var">bits</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Curve -&gt; Int
</span><span class="hs-identifier hs-var">EC.curveSizeBits</span></span><span> </span><span class="annot"><span class="annottext">Curve
</span><a href="#local-6989586621681477168"><span class="hs-identifier hs-var">curve</span></a></span><span>
</span><span id="line-217"></span><span>    </span><span id="local-6989586621681477163"><span class="annot"><span class="annottext">bytes :: Int
</span><a href="#local-6989586621681477163"><span class="hs-identifier hs-var hs-var">bytes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681477162"><span class="hs-identifier hs-var">bits</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="hs-number">7</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`div`</span></span><span> </span><span class="annot"><span class="hs-number">8</span></span><span>
</span><span id="line-218"></span><span>
</span><span id="line-219"></span><span class="hs-comment">-- | The ECDSA implementation in cryptonite as of version 0.25 is vulnerable to</span><span>
</span><span id="line-220"></span><span class="hs-comment">-- timing attacks. It is thus not supported server-side in the Haskell tls</span><span>
</span><span id="line-221"></span><span class="hs-comment">-- package.</span><span>
</span><span id="line-222"></span><span class="hs-comment">--</span><span>
</span><span id="line-223"></span><span class="hs-comment">-- The PR https://github.com/haskell-crypto/cryptonite/pull/226 addresses this</span><span>
</span><span id="line-224"></span><span class="hs-comment">-- for curve P-256 / SEC_p256r1.</span><span>
</span><span id="line-225"></span><span class="hs-comment">--</span><span>
</span><span id="line-226"></span><span class="annot"><a href="Network.X509.SelfSigned.html#ecCurveName"><span class="hs-identifier hs-type">ecCurveName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">EC.CurveName</span></span><span>
</span><span id="line-227"></span><span id="ecCurveName"><span class="annot"><span class="annottext">ecCurveName :: CurveName
</span><a href="Network.X509.SelfSigned.html#ecCurveName"><span class="hs-identifier hs-var hs-var">ecCurveName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CurveName
</span><span class="hs-identifier hs-var">EC.SEC_p256r1</span></span><span>
</span><span id="line-228"></span><span class="hs-comment">-- ecCurveName = EC.SEC_p384r1</span><span>
</span><span id="line-229"></span><span class="hs-comment">-- ecCurveName = EC.SEC_p521r1</span><span>
</span><span id="line-230"></span><span>
</span><span id="line-231"></span><span class="hs-comment">-- -------------------------------------------------------------------------- --</span><span>
</span><span id="line-232"></span><span class="hs-comment">-- X509 Certificate Type instances</span><span>
</span><span id="line-233"></span><span>
</span><span id="line-234"></span><span class="hs-keyword">class</span><span> </span><span id="X509Key"><span class="annot"><a href="Network.X509.SelfSigned.html#X509Key"><span class="hs-identifier hs-var">X509Key</span></a></span></span><span> </span><span id="local-6989586621681477504"><span class="annot"><a href="#local-6989586621681477504"><span class="hs-identifier hs-type">k</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-235"></span><span>    </span><span class="hs-keyword">type</span><span> </span><span id="PK"><span class="annot"><a href="Network.X509.SelfSigned.html#PK"><span class="hs-identifier hs-var">PK</span></a></span></span><span> </span><span id="local-6989586621681477504"><span class="annot"><a href="#local-6989586621681477504"><span class="hs-identifier hs-type">k</span></a></span></span><span>
</span><span id="line-236"></span><span>
</span><span id="line-237"></span><span>    </span><span id="generateKey"><span class="annot"><a href="Network.X509.SelfSigned.html#generateKey"><span class="hs-identifier hs-type">generateKey</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621681477504"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-238"></span><span>    </span><span id="publicKey"><span class="annot"><a href="Network.X509.SelfSigned.html#publicKey"><span class="hs-identifier hs-type">publicKey</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621681477504"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#PK"><span class="hs-identifier hs-type">PK</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681477504"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-239"></span><span>    </span><span id="getPubKey"><span class="annot"><a href="Network.X509.SelfSigned.html#getPubKey"><span class="hs-identifier hs-type">getPubKey</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621681477504"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PubKey</span></span><span>
</span><span id="line-240"></span><span>    </span><span id="getPrivKey"><span class="annot"><a href="Network.X509.SelfSigned.html#getPrivKey"><span class="hs-identifier hs-type">getPrivKey</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621681477504"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PrivKey</span></span><span>
</span><span id="line-241"></span><span>    </span><span id="sigAlg"><span class="annot"><a href="Network.X509.SelfSigned.html#sigAlg"><span class="hs-identifier hs-type">sigAlg</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SignatureALG</span></span><span>
</span><span id="line-242"></span><span>
</span><span id="line-243"></span><span>    </span><span id="local-6989586621681477506"><span id="local-6989586621681477508"><span id="signIO"><span class="annot"><a href="Network.X509.SelfSigned.html#signIO"><span class="hs-identifier hs-type">signIO</span></a></span></span><span>
</span><span id="line-244"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadRandom</span></span><span> </span><span class="annot"><a href="#local-6989586621681477508"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-245"></span><span>        </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteArray</span></span><span> </span><span class="annot"><a href="#local-6989586621681477506"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-246"></span><span>        </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681477504"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-247"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span>
</span><span id="line-248"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681477508"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681477506"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SignatureALG</span></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-249"></span><span>
</span><span id="line-250"></span><span>    </span><span id="pemKeyHeader"><span class="annot"><a href="Network.X509.SelfSigned.html#pemKeyHeader"><span class="hs-identifier hs-type">pemKeyHeader</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-251"></span><span>
</span><span id="line-252"></span><span class="hs-comment">-- | EC</span><span>
</span><span id="line-253"></span><span class="hs-comment">--</span><span>
</span><span id="line-254"></span><span class="hs-comment">-- The ECDSA implementation in cryptonite as of version 0.25 is vulnerable to</span><span>
</span><span id="line-255"></span><span class="hs-comment">-- timing attacks. It is thus not supported in the Haskell tls package.</span><span>
</span><span id="line-256"></span><span class="hs-comment">--</span><span>
</span><span id="line-257"></span><span class="hs-comment">-- The PR https://github.com/haskell-crypto/cryptonite/pull/226 addresses this</span><span>
</span><span id="line-258"></span><span class="hs-comment">-- for curve P-256 / SEC_p256r1.</span><span>
</span><span id="line-259"></span><span class="hs-comment">--</span><span>
</span><span id="line-260"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#X509Key"><span class="hs-identifier hs-type">X509Key</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">EC.KeyPair</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-261"></span><span>    </span><span class="hs-keyword">type</span><span> </span><span id="PK"><span class="annot"><a href="Network.X509.SelfSigned.html#PK"><span class="hs-identifier hs-var">PK</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">EC.KeyPair</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">EC.PublicPoint</span></span><span>
</span><span id="line-262"></span><span>
</span><span id="line-263"></span><span>    </span><span id="local-6989586621681477139"><span class="annot"><span class="annottext">generateKey :: IO KeyPair
</span><a href="#local-6989586621681477139"><span class="hs-identifier hs-var hs-var hs-var hs-var">generateKey</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(PublicKey -&gt; PrivateKey -&gt; KeyPair)
-&gt; (PublicKey, PrivateKey) -&gt; KeyPair
forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><span class="hs-identifier hs-var">uncurry</span></span><span> </span><span class="annot"><span class="annottext">PublicKey -&gt; PrivateKey -&gt; KeyPair
</span><a href="#local-6989586621681477137"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">((PublicKey, PrivateKey) -&gt; KeyPair)
-&gt; IO (PublicKey, PrivateKey) -&gt; IO KeyPair
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Curve -&gt; IO (PublicKey, PrivateKey)
forall (m :: * -&gt; *).
MonadRandom m =&gt;
Curve -&gt; m (PublicKey, PrivateKey)
</span><span class="hs-identifier hs-var">EC.generate</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CurveName -&gt; Curve
</span><span class="hs-identifier hs-var">EC.getCurveByName</span></span><span> </span><span class="annot"><span class="annottext">CurveName
</span><a href="Network.X509.SelfSigned.html#ecCurveName"><span class="hs-identifier hs-var">ecCurveName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-264"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-265"></span><span>        </span><span id="local-6989586621681477137"><span class="annot"><span class="annottext">f :: PublicKey -&gt; PrivateKey -&gt; KeyPair
</span><a href="#local-6989586621681477137"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span id="local-6989586621681477134"><span class="annot"><span class="annottext">pk :: PublicKey
</span><a href="#local-6989586621681477134"><span class="hs-identifier hs-var">pk</span></a></span></span><span> </span><span id="local-6989586621681477133"><span class="annot"><span class="annottext">sk :: PrivateKey
</span><a href="#local-6989586621681477133"><span class="hs-identifier hs-var">sk</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Curve -&gt; Point -&gt; Integer -&gt; KeyPair
</span><span class="hs-identifier hs-var">EC.KeyPair</span></span><span>
</span><span id="line-266"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CurveName -&gt; Curve
</span><span class="hs-identifier hs-var">EC.getCurveByName</span></span><span> </span><span class="annot"><span class="annottext">CurveName
</span><a href="Network.X509.SelfSigned.html#ecCurveName"><span class="hs-identifier hs-var">ecCurveName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-267"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PublicKey -&gt; Point
</span><span class="hs-identifier hs-var hs-var">EC.public_q</span></span><span> </span><span class="annot"><span class="annottext">PublicKey
</span><a href="#local-6989586621681477134"><span class="hs-identifier hs-var">pk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-268"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrivateKey -&gt; Integer
</span><span class="hs-identifier hs-var hs-var">EC.private_d</span></span><span> </span><span class="annot"><span class="annottext">PrivateKey
</span><a href="#local-6989586621681477133"><span class="hs-identifier hs-var">sk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-269"></span><span>
</span><span id="line-270"></span><span>    </span><span id="local-6989586621681477129"><span class="annot"><span class="annottext">publicKey :: KeyPair -&gt; PK KeyPair
</span><a href="#local-6989586621681477129"><span class="hs-identifier hs-var hs-var hs-var hs-var">publicKey</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">EC.KeyPair</span></span><span> </span><span class="hs-identifier">_</span><span> </span><span id="local-6989586621681477128"><span class="annot"><span class="annottext">pk :: Point
</span><a href="#local-6989586621681477128"><span class="hs-identifier hs-var">pk</span></a></span></span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Point
PK KeyPair
</span><a href="#local-6989586621681477128"><span class="hs-identifier hs-var">pk</span></a></span><span>
</span><span id="line-271"></span><span>
</span><span id="line-272"></span><span>    </span><span id="local-6989586621681477127"><span class="annot"><span class="annottext">getPubKey :: KeyPair -&gt; PubKey
</span><a href="#local-6989586621681477127"><span class="hs-identifier hs-var hs-var hs-var hs-var">getPubKey</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">EC.KeyPair</span></span><span> </span><span class="hs-identifier">_</span><span> </span><span id="local-6989586621681477126"><span class="annot"><span class="annottext">pk :: Point
</span><a href="#local-6989586621681477126"><span class="hs-identifier hs-var">pk</span></a></span></span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PubKeyEC -&gt; PubKey
</span><span class="hs-identifier hs-var">PubKeyEC</span></span><span>
</span><span id="line-273"></span><span>        </span><span class="annot"><span class="annottext">(PubKeyEC -&gt; PubKey) -&gt; PubKeyEC -&gt; PubKey
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CurveName -&gt; SerializedPoint -&gt; PubKeyEC
</span><span class="hs-identifier hs-var">PubKeyEC_Named</span></span><span> </span><span class="annot"><span class="annottext">CurveName
</span><a href="Network.X509.SelfSigned.html#ecCurveName"><span class="hs-identifier hs-var">ecCurveName</span></a></span><span>
</span><span id="line-274"></span><span>        </span><span class="annot"><span class="annottext">(SerializedPoint -&gt; PubKeyEC) -&gt; SerializedPoint -&gt; PubKeyEC
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; Curve -&gt; Point -&gt; SerializedPoint
Curve -&gt; Point -&gt; SerializedPoint
</span><a href="Network.X509.SelfSigned.html#serializePoint"><span class="hs-identifier hs-var">serializePoint</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CurveName -&gt; Curve
</span><span class="hs-identifier hs-var">EC.getCurveByName</span></span><span> </span><span class="annot"><span class="annottext">CurveName
</span><a href="Network.X509.SelfSigned.html#ecCurveName"><span class="hs-identifier hs-var">ecCurveName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Point
</span><a href="#local-6989586621681477126"><span class="hs-identifier hs-var">pk</span></a></span><span>
</span><span id="line-275"></span><span>
</span><span id="line-276"></span><span>    </span><span id="local-6989586621681477123"><span class="annot"><span class="annottext">getPrivKey :: KeyPair -&gt; PrivKey
</span><a href="#local-6989586621681477123"><span class="hs-identifier hs-var hs-var hs-var hs-var">getPrivKey</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">EC.KeyPair</span></span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span id="local-6989586621681477122"><span class="annot"><span class="annottext">sk :: Integer
</span><a href="#local-6989586621681477122"><span class="hs-identifier hs-var">sk</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PrivKeyEC -&gt; PrivKey
</span><span class="hs-identifier hs-var">PrivKeyEC</span></span><span>
</span><span id="line-277"></span><span>        </span><span class="annot"><span class="annottext">(PrivKeyEC -&gt; PrivKey) -&gt; PrivKeyEC -&gt; PrivKey
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CurveName -&gt; Integer -&gt; PrivKeyEC
</span><span class="hs-identifier hs-var">PrivKeyEC_Named</span></span><span> </span><span class="annot"><span class="annottext">CurveName
</span><a href="Network.X509.SelfSigned.html#ecCurveName"><span class="hs-identifier hs-var">ecCurveName</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621681477122"><span class="hs-identifier hs-var">sk</span></a></span><span>
</span><span id="line-278"></span><span>
</span><span id="line-279"></span><span>    </span><span id="local-6989586621681477119"><span class="annot"><span class="annottext">sigAlg :: SignatureALG
</span><a href="#local-6989586621681477119"><span class="hs-identifier hs-var hs-var hs-var hs-var">sigAlg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashALG -&gt; PubKeyALG -&gt; SignatureALG
</span><span class="hs-identifier hs-var">SignatureALG</span></span><span> </span><span class="annot"><span class="annottext">HashALG
</span><span class="hs-identifier hs-var">HashSHA512</span></span><span> </span><span class="annot"><span class="annottext">PubKeyALG
</span><span class="hs-identifier hs-var">PubKeyALG_EC</span></span><span>
</span><span id="line-280"></span><span>
</span><span id="line-281"></span><span>    </span><span id="local-6989586621681477115"><span class="annot"><span class="annottext">pemKeyHeader :: [Char]
</span><a href="#local-6989586621681477115"><span class="hs-identifier hs-var hs-var hs-var hs-var">pemKeyHeader</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-string">&quot;EC PRIVATE KEY&quot;</span></span><span>
</span><span id="line-282"></span><span>
</span><span id="line-283"></span><span>    </span><span id="local-6989586621681477114"><span class="annot"><span class="annottext">signIO :: KeyPair -&gt; ByteString -&gt; m (a, SignatureALG)
</span><a href="#local-6989586621681477114"><span class="hs-identifier hs-var hs-var hs-var hs-var">signIO</span></a></span></span><span> </span><span id="local-6989586621681477113"><span class="annot"><span class="annottext">sk :: KeyPair
</span><a href="#local-6989586621681477113"><span class="hs-identifier hs-var">sk</span></a></span></span><span> </span><span id="local-6989586621681477112"><span class="annot"><span class="annottext">bytes :: ByteString
</span><a href="#local-6989586621681477112"><span class="hs-identifier hs-var">bytes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-284"></span><span>        </span><span id="local-6989586621681477111"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621681477111"><span class="hs-identifier hs-var">sig</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Signature -&gt; ByteString
</span><a href="Network.X509.SelfSigned.html#encodeEcSignatureDer"><span class="hs-identifier hs-var">encodeEcSignatureDer</span></a></span><span> </span><span class="annot"><span class="annottext">(Signature -&gt; ByteString) -&gt; m Signature -&gt; m ByteString
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">PrivateKey -&gt; SHA512 -&gt; ByteString -&gt; m Signature
forall msg hash (m :: * -&gt; *).
(ByteArrayAccess msg, HashAlgorithm hash, MonadRandom m) =&gt;
PrivateKey -&gt; hash -&gt; msg -&gt; m Signature
</span><span class="hs-identifier hs-var">EC.sign</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">KeyPair -&gt; PrivateKey
</span><span class="hs-identifier hs-var">EC.toPrivateKey</span></span><span> </span><span class="annot"><span class="annottext">KeyPair
</span><a href="#local-6989586621681477113"><span class="hs-identifier hs-var">sk</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SHA512
</span><span class="hs-identifier hs-var">SHA512</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621681477112"><span class="hs-identifier hs-var">bytes</span></a></span><span>
</span><span id="line-285"></span><span>        </span><span class="annot"><span class="annottext">(a, SignatureALG) -&gt; m (a, SignatureALG)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">((a, SignatureALG) -&gt; m (a, SignatureALG))
-&gt; (a, SignatureALG) -&gt; m (a, SignatureALG)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; a
forall bin bout.
(ByteArrayAccess bin, ByteArray bout) =&gt;
bin -&gt; bout
</span><span class="hs-identifier hs-var">convert</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621681477111"><span class="hs-identifier hs-var">sig</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">X509Key KeyPair =&gt; SignatureALG
forall k. X509Key k =&gt; SignatureALG
</span><a href="Network.X509.SelfSigned.html#sigAlg"><span class="hs-identifier hs-var">sigAlg</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">EC.KeyPair</span></span><span class="hs-special">)</span><span>
</span><span id="line-286"></span><span>
</span><span id="line-287"></span><span class="hs-comment">-- | Ed25519</span><span>
</span><span id="line-288"></span><span class="hs-comment">--</span><span>
</span><span id="line-289"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#X509Key"><span class="hs-identifier hs-type">X509Key</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ed25519.SecretKey</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-290"></span><span>    </span><span class="hs-keyword">type</span><span> </span><span id="PK"><span class="annot"><a href="Network.X509.SelfSigned.html#PK"><span class="hs-identifier hs-var">PK</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ed25519.SecretKey</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ed25519.PublicKey</span></span><span>
</span><span id="line-291"></span><span>
</span><span id="line-292"></span><span>    </span><span id="local-6989586621681477098"><span class="annot"><span class="annottext">generateKey :: IO SecretKey
</span><a href="#local-6989586621681477098"><span class="hs-identifier hs-var hs-var hs-var hs-var">generateKey</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO SecretKey
forall (m :: * -&gt; *). MonadRandom m =&gt; m SecretKey
</span><span class="hs-identifier hs-var">Ed25519.generateSecretKey</span></span><span>
</span><span id="line-293"></span><span>    </span><span id="local-6989586621681477096"><span class="annot"><span class="annottext">publicKey :: SecretKey -&gt; PK SecretKey
</span><a href="#local-6989586621681477096"><span class="hs-identifier hs-var hs-var hs-var hs-var">publicKey</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SecretKey -&gt; PublicKey
SecretKey -&gt; PK SecretKey
</span><span class="hs-identifier hs-var">Ed25519.toPublic</span></span><span>
</span><span id="line-294"></span><span>    </span><span id="local-6989586621681477094"><span class="annot"><span class="annottext">getPubKey :: SecretKey -&gt; PubKey
</span><a href="#local-6989586621681477094"><span class="hs-identifier hs-var hs-var hs-var hs-var">getPubKey</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PublicKey -&gt; PubKey
</span><span class="hs-identifier hs-var">PubKeyEd25519</span></span><span> </span><span class="annot"><span class="annottext">(PublicKey -&gt; PubKey)
-&gt; (SecretKey -&gt; PublicKey) -&gt; SecretKey -&gt; PubKey
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SecretKey -&gt; PublicKey
forall k. X509Key k =&gt; k -&gt; PK k
</span><a href="Network.X509.SelfSigned.html#publicKey"><span class="hs-identifier hs-var">publicKey</span></a></span><span>
</span><span id="line-295"></span><span>    </span><span id="local-6989586621681477091"><span class="annot"><span class="annottext">getPrivKey :: SecretKey -&gt; PrivKey
</span><a href="#local-6989586621681477091"><span class="hs-identifier hs-var hs-var hs-var hs-var">getPrivKey</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SecretKey -&gt; PrivKey
</span><span class="hs-identifier hs-var">PrivKeyEd25519</span></span><span>
</span><span id="line-296"></span><span>    </span><span id="local-6989586621681477089"><span class="annot"><span class="annottext">sigAlg :: SignatureALG
</span><a href="#local-6989586621681477089"><span class="hs-identifier hs-var hs-var hs-var hs-var">sigAlg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PubKeyALG -&gt; SignatureALG
</span><span class="hs-identifier hs-var">SignatureALG_IntrinsicHash</span></span><span> </span><span class="annot"><span class="annottext">PubKeyALG
</span><span class="hs-identifier hs-var">PubKeyALG_Ed25519</span></span><span>
</span><span id="line-297"></span><span>    </span><span id="local-6989586621681477086"><span class="annot"><span class="annottext">pemKeyHeader :: [Char]
</span><a href="#local-6989586621681477086"><span class="hs-identifier hs-var hs-var hs-var hs-var">pemKeyHeader</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-string">&quot;PRIVATE KEY&quot;</span></span><span>
</span><span id="line-298"></span><span>
</span><span id="line-299"></span><span>    </span><span id="local-6989586621681477085"><span class="annot"><span class="annottext">signIO :: SecretKey -&gt; ByteString -&gt; m (a, SignatureALG)
</span><a href="#local-6989586621681477085"><span class="hs-identifier hs-var hs-var hs-var hs-var">signIO</span></a></span></span><span> </span><span id="local-6989586621681477084"><span class="annot"><span class="annottext">sk :: SecretKey
</span><a href="#local-6989586621681477084"><span class="hs-identifier hs-var">sk</span></a></span></span><span> </span><span id="local-6989586621681477083"><span class="annot"><span class="annottext">bytes :: ByteString
</span><a href="#local-6989586621681477083"><span class="hs-identifier hs-var">bytes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a, SignatureALG) -&gt; m (a, SignatureALG)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">((a, SignatureALG) -&gt; m (a, SignatureALG))
-&gt; (a, SignatureALG) -&gt; m (a, SignatureALG)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Signature -&gt; a
forall bin bout.
(ByteArrayAccess bin, ByteArray bout) =&gt;
bin -&gt; bout
</span><span class="hs-identifier hs-var">convert</span></span><span> </span><span class="annot"><span class="annottext">Signature
</span><a href="#local-6989586621681477082"><span class="hs-identifier hs-var">sig</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">X509Key SecretKey =&gt; SignatureALG
forall k. X509Key k =&gt; SignatureALG
</span><a href="Network.X509.SelfSigned.html#sigAlg"><span class="hs-identifier hs-var">sigAlg</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">Ed25519.SecretKey</span></span><span class="hs-special">)</span><span>
</span><span id="line-300"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-301"></span><span>        </span><span id="local-6989586621681477082"><span class="annot"><span class="annottext">sig :: Signature
</span><a href="#local-6989586621681477082"><span class="hs-identifier hs-var hs-var">sig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SecretKey -&gt; PublicKey -&gt; ByteString -&gt; Signature
forall ba.
ByteArrayAccess ba =&gt;
SecretKey -&gt; PublicKey -&gt; ba -&gt; Signature
</span><span class="hs-identifier hs-var">Ed25519.sign</span></span><span> </span><span class="annot"><span class="annottext">SecretKey
</span><a href="#local-6989586621681477084"><span class="hs-identifier hs-var">sk</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SecretKey -&gt; PK SecretKey
forall k. X509Key k =&gt; k -&gt; PK k
</span><a href="Network.X509.SelfSigned.html#publicKey"><span class="hs-identifier hs-var">publicKey</span></a></span><span> </span><span class="annot"><span class="annottext">SecretKey
</span><a href="#local-6989586621681477084"><span class="hs-identifier hs-var">sk</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621681477083"><span class="hs-identifier hs-var">bytes</span></a></span><span>
</span><span id="line-302"></span><span>
</span><span id="line-303"></span><span class="hs-comment">-- | Ed448</span><span>
</span><span id="line-304"></span><span class="hs-comment">--</span><span>
</span><span id="line-305"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#X509Key"><span class="hs-identifier hs-type">X509Key</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ed448.SecretKey</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-306"></span><span>    </span><span class="hs-keyword">type</span><span> </span><span id="PK"><span class="annot"><a href="Network.X509.SelfSigned.html#PK"><span class="hs-identifier hs-var">PK</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ed448.SecretKey</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ed448.PublicKey</span></span><span>
</span><span id="line-307"></span><span>
</span><span id="line-308"></span><span>    </span><span id="local-6989586621681477073"><span class="annot"><span class="annottext">generateKey :: IO SecretKey
</span><a href="#local-6989586621681477073"><span class="hs-identifier hs-var hs-var hs-var hs-var">generateKey</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO SecretKey
forall (m :: * -&gt; *). MonadRandom m =&gt; m SecretKey
</span><span class="hs-identifier hs-var">Ed448.generateSecretKey</span></span><span>
</span><span id="line-309"></span><span>    </span><span id="local-6989586621681477071"><span class="annot"><span class="annottext">publicKey :: SecretKey -&gt; PK SecretKey
</span><a href="#local-6989586621681477071"><span class="hs-identifier hs-var hs-var hs-var hs-var">publicKey</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SecretKey -&gt; PublicKey
SecretKey -&gt; PK SecretKey
</span><span class="hs-identifier hs-var">Ed448.toPublic</span></span><span>
</span><span id="line-310"></span><span>    </span><span id="local-6989586621681477069"><span class="annot"><span class="annottext">getPubKey :: SecretKey -&gt; PubKey
</span><a href="#local-6989586621681477069"><span class="hs-identifier hs-var hs-var hs-var hs-var">getPubKey</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PublicKey -&gt; PubKey
</span><span class="hs-identifier hs-var">PubKeyEd448</span></span><span> </span><span class="annot"><span class="annottext">(PublicKey -&gt; PubKey)
-&gt; (SecretKey -&gt; PublicKey) -&gt; SecretKey -&gt; PubKey
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SecretKey -&gt; PublicKey
forall k. X509Key k =&gt; k -&gt; PK k
</span><a href="Network.X509.SelfSigned.html#publicKey"><span class="hs-identifier hs-var">publicKey</span></a></span><span>
</span><span id="line-311"></span><span>    </span><span id="local-6989586621681477067"><span class="annot"><span class="annottext">getPrivKey :: SecretKey -&gt; PrivKey
</span><a href="#local-6989586621681477067"><span class="hs-identifier hs-var hs-var hs-var hs-var">getPrivKey</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SecretKey -&gt; PrivKey
</span><span class="hs-identifier hs-var">PrivKeyEd448</span></span><span>
</span><span id="line-312"></span><span>    </span><span id="local-6989586621681477065"><span class="annot"><span class="annottext">sigAlg :: SignatureALG
</span><a href="#local-6989586621681477065"><span class="hs-identifier hs-var hs-var hs-var hs-var">sigAlg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PubKeyALG -&gt; SignatureALG
</span><span class="hs-identifier hs-var">SignatureALG_IntrinsicHash</span></span><span> </span><span class="annot"><span class="annottext">PubKeyALG
</span><span class="hs-identifier hs-var">PubKeyALG_Ed448</span></span><span>
</span><span id="line-313"></span><span>    </span><span id="local-6989586621681477063"><span class="annot"><span class="annottext">pemKeyHeader :: [Char]
</span><a href="#local-6989586621681477063"><span class="hs-identifier hs-var hs-var hs-var hs-var">pemKeyHeader</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-string">&quot;PRIVATE KEY&quot;</span></span><span>
</span><span id="line-314"></span><span>
</span><span id="line-315"></span><span>    </span><span id="local-6989586621681477062"><span class="annot"><span class="annottext">signIO :: SecretKey -&gt; ByteString -&gt; m (a, SignatureALG)
</span><a href="#local-6989586621681477062"><span class="hs-identifier hs-var hs-var hs-var hs-var">signIO</span></a></span></span><span> </span><span id="local-6989586621681477061"><span class="annot"><span class="annottext">sk :: SecretKey
</span><a href="#local-6989586621681477061"><span class="hs-identifier hs-var">sk</span></a></span></span><span> </span><span id="local-6989586621681477060"><span class="annot"><span class="annottext">bytes :: ByteString
</span><a href="#local-6989586621681477060"><span class="hs-identifier hs-var">bytes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a, SignatureALG) -&gt; m (a, SignatureALG)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">((a, SignatureALG) -&gt; m (a, SignatureALG))
-&gt; (a, SignatureALG) -&gt; m (a, SignatureALG)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Signature -&gt; a
forall bin bout.
(ByteArrayAccess bin, ByteArray bout) =&gt;
bin -&gt; bout
</span><span class="hs-identifier hs-var">convert</span></span><span> </span><span class="annot"><span class="annottext">Signature
</span><a href="#local-6989586621681477059"><span class="hs-identifier hs-var">sig</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">X509Key SecretKey =&gt; SignatureALG
forall k. X509Key k =&gt; SignatureALG
</span><a href="Network.X509.SelfSigned.html#sigAlg"><span class="hs-identifier hs-var">sigAlg</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">Ed448.SecretKey</span></span><span class="hs-special">)</span><span>
</span><span id="line-316"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-317"></span><span>        </span><span id="local-6989586621681477059"><span class="annot"><span class="annottext">sig :: Signature
</span><a href="#local-6989586621681477059"><span class="hs-identifier hs-var hs-var">sig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SecretKey -&gt; PublicKey -&gt; ByteString -&gt; Signature
forall ba.
ByteArrayAccess ba =&gt;
SecretKey -&gt; PublicKey -&gt; ba -&gt; Signature
</span><span class="hs-identifier hs-var">Ed448.sign</span></span><span> </span><span class="annot"><span class="annottext">SecretKey
</span><a href="#local-6989586621681477061"><span class="hs-identifier hs-var">sk</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SecretKey -&gt; PK SecretKey
forall k. X509Key k =&gt; k -&gt; PK k
</span><a href="Network.X509.SelfSigned.html#publicKey"><span class="hs-identifier hs-var">publicKey</span></a></span><span> </span><span class="annot"><span class="annottext">SecretKey
</span><a href="#local-6989586621681477061"><span class="hs-identifier hs-var">sk</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621681477060"><span class="hs-identifier hs-var">bytes</span></a></span><span>
</span><span id="line-318"></span><span>
</span><span id="line-319"></span><span class="hs-comment">-- | RSA (4096 bit keys size)</span><span>
</span><span id="line-320"></span><span class="hs-comment">--</span><span>
</span><span id="line-321"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#X509Key"><span class="hs-identifier hs-type">X509Key</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">RSA.PrivateKey</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-322"></span><span>    </span><span class="hs-keyword">type</span><span> </span><span id="PK"><span class="annot"><a href="Network.X509.SelfSigned.html#PK"><span class="hs-identifier hs-var">PK</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">RSA.PrivateKey</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">RSA.PublicKey</span></span><span>
</span><span id="line-323"></span><span>
</span><span id="line-324"></span><span>    </span><span id="local-6989586621681477050"><span class="annot"><span class="annottext">generateKey :: IO PrivateKey
</span><a href="#local-6989586621681477050"><span class="hs-identifier hs-var hs-var hs-var hs-var">generateKey</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(PublicKey, PrivateKey) -&gt; PrivateKey
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">((PublicKey, PrivateKey) -&gt; PrivateKey)
-&gt; IO (PublicKey, PrivateKey) -&gt; IO PrivateKey
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Integer -&gt; IO (PublicKey, PrivateKey)
forall (m :: * -&gt; *).
MonadRandom m =&gt;
Int -&gt; Integer -&gt; m (PublicKey, PrivateKey)
</span><span class="hs-identifier hs-var">RSA.generate</span></span><span> </span><span class="annot"><span class="hs-number">512</span></span><span> </span><span class="annot"><span class="hs-number">0x10001</span></span><span>
</span><span id="line-325"></span><span>    </span><span id="local-6989586621681477048"><span class="annot"><span class="annottext">publicKey :: PrivateKey -&gt; PK PrivateKey
</span><a href="#local-6989586621681477048"><span class="hs-identifier hs-var hs-var hs-var hs-var">publicKey</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">KeyPair -&gt; PublicKey
</span><span class="hs-identifier hs-var">RSA.toPublicKey</span></span><span> </span><span class="annot"><span class="annottext">(KeyPair -&gt; PublicKey)
-&gt; (PrivateKey -&gt; KeyPair) -&gt; PrivateKey -&gt; PublicKey
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">PrivateKey -&gt; KeyPair
</span><span class="hs-identifier hs-var">RSA.KeyPair</span></span><span>
</span><span id="line-326"></span><span>    </span><span id="local-6989586621681477046"><span class="annot"><span class="annottext">getPubKey :: PrivateKey -&gt; PubKey
</span><a href="#local-6989586621681477046"><span class="hs-identifier hs-var hs-var hs-var hs-var">getPubKey</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PublicKey -&gt; PubKey
</span><span class="hs-identifier hs-var">PubKeyRSA</span></span><span> </span><span class="annot"><span class="annottext">(PublicKey -&gt; PubKey)
-&gt; (PrivateKey -&gt; PublicKey) -&gt; PrivateKey -&gt; PubKey
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">PrivateKey -&gt; PublicKey
forall k. X509Key k =&gt; k -&gt; PK k
</span><a href="Network.X509.SelfSigned.html#publicKey"><span class="hs-identifier hs-var">publicKey</span></a></span><span>
</span><span id="line-327"></span><span>    </span><span id="local-6989586621681477044"><span class="annot"><span class="annottext">getPrivKey :: PrivateKey -&gt; PrivKey
</span><a href="#local-6989586621681477044"><span class="hs-identifier hs-var hs-var hs-var hs-var">getPrivKey</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PrivateKey -&gt; PrivKey
</span><span class="hs-identifier hs-var">PrivKeyRSA</span></span><span>
</span><span id="line-328"></span><span>    </span><span id="local-6989586621681477042"><span class="annot"><span class="annottext">pemKeyHeader :: [Char]
</span><a href="#local-6989586621681477042"><span class="hs-identifier hs-var hs-var hs-var hs-var">pemKeyHeader</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-string">&quot;PRIVATE KEY&quot;</span></span><span>
</span><span id="line-329"></span><span>
</span><span id="line-330"></span><span>    </span><span id="local-6989586621681477041"><span class="annot"><span class="annottext">signIO :: PrivateKey -&gt; ByteString -&gt; m (a, SignatureALG)
</span><a href="#local-6989586621681477041"><span class="hs-identifier hs-var hs-var hs-var hs-var">signIO</span></a></span></span><span> </span><span id="local-6989586621681477040"><span class="annot"><span class="annottext">sk :: PrivateKey
</span><a href="#local-6989586621681477040"><span class="hs-identifier hs-var">sk</span></a></span></span><span> </span><span id="local-6989586621681477039"><span class="annot"><span class="annottext">bytes :: ByteString
</span><a href="#local-6989586621681477039"><span class="hs-identifier hs-var">bytes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-331"></span><span>        </span><span id="local-6989586621681477038"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621681477038"><span class="hs-identifier hs-var">sig</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe SHA512
-&gt; PrivateKey -&gt; ByteString -&gt; m (Either Error ByteString)
forall hashAlg (m :: * -&gt; *).
(HashAlgorithmASN1 hashAlg, MonadRandom m) =&gt;
Maybe hashAlg
-&gt; PrivateKey -&gt; ByteString -&gt; m (Either Error ByteString)
</span><span class="hs-identifier hs-var">RSA.signSafer</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SHA512 -&gt; Maybe SHA512
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">SHA512
</span><span class="hs-identifier hs-var">SHA512</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PrivateKey
</span><a href="#local-6989586621681477040"><span class="hs-identifier hs-var">sk</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621681477039"><span class="hs-identifier hs-var">bytes</span></a></span><span> </span><span class="annot"><span class="annottext">m (Either Error ByteString)
-&gt; (Either Error ByteString -&gt; m ByteString) -&gt; m ByteString
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-332"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621681477037"><span class="annot"><span class="annottext">e :: Error
</span><a href="#local-6989586621681477037"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; m ByteString
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; m ByteString) -&gt; [Char] -&gt; m ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;Network.X509.SelfSigned: X509Key instance for RSA.PrivateKey: signIO: &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span>  </span><span class="annot"><span class="annottext">Error -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Error
</span><a href="#local-6989586621681477037"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-333"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621681477035"><span class="annot"><span class="annottext">x :: ByteString
</span><a href="#local-6989586621681477035"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; m ByteString
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; m ByteString) -&gt; ByteString -&gt; m ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621681477035"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-334"></span><span>        </span><span class="annot"><span class="annottext">(a, SignatureALG) -&gt; m (a, SignatureALG)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">((a, SignatureALG) -&gt; m (a, SignatureALG))
-&gt; (a, SignatureALG) -&gt; m (a, SignatureALG)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; a
forall bin bout.
(ByteArrayAccess bin, ByteArray bout) =&gt;
bin -&gt; bout
</span><span class="hs-identifier hs-var">convert</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621681477038"><span class="hs-identifier hs-var">sig</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">X509Key PrivateKey =&gt; SignatureALG
forall k. X509Key k =&gt; SignatureALG
</span><a href="Network.X509.SelfSigned.html#sigAlg"><span class="hs-identifier hs-var">sigAlg</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">RSA.PrivateKey</span></span><span class="hs-special">)</span><span>
</span><span id="line-335"></span><span>
</span><span id="line-336"></span><span>    </span><span id="local-6989586621681477034"><span class="annot"><span class="annottext">sigAlg :: SignatureALG
</span><a href="#local-6989586621681477034"><span class="hs-identifier hs-var hs-var hs-var hs-var">sigAlg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashALG -&gt; PubKeyALG -&gt; SignatureALG
</span><span class="hs-identifier hs-var">SignatureALG</span></span><span> </span><span class="annot"><span class="annottext">HashALG
</span><span class="hs-identifier hs-var">HashSHA512</span></span><span> </span><span class="annot"><span class="annottext">PubKeyALG
</span><span class="hs-identifier hs-var">PubKeyALG_RSA</span></span><span>
</span><span id="line-337"></span><span>
</span><span id="line-338"></span><span class="hs-comment">-- -------------------------------------------------------------------------- --</span><span>
</span><span id="line-339"></span><span class="hs-comment">-- Unsigned tbs Certificate</span><span>
</span><span id="line-340"></span><span>
</span><span id="line-341"></span><span class="annot"><a href="Network.X509.SelfSigned.html#makeCertificate"><span class="hs-identifier hs-type">makeCertificate</span></a></span><span>
</span><span id="line-342"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621681477289"><span class="annot"><a href="#local-6989586621681477289"><span class="hs-identifier hs-type">k</span></a></span></span><span>
</span><span id="line-343"></span><span>    </span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#X509Key"><span class="hs-identifier hs-type">X509Key</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681477289"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-344"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DateTime</span></span><span>
</span><span id="line-345"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DateTime</span></span><span>
</span><span id="line-346"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DistinguishedName</span></span><span>
</span><span id="line-347"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DistinguishedName</span></span><span>
</span><span id="line-348"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">NE.NonEmpty</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">AltName</span></span><span class="hs-special">)</span><span>
</span><span id="line-349"></span><span>        </span><span class="hs-comment">-- ^ the list of altnames must include the CN name from the subject</span><span>
</span><span id="line-350"></span><span>        </span><span class="hs-comment">-- distinguished name.</span><span>
</span><span id="line-351"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PubKey</span></span><span>
</span><span id="line-352"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Certificate</span></span><span>
</span><span id="line-353"></span><span id="makeCertificate"><span class="annot"><span class="annottext">makeCertificate :: DateTime
-&gt; DateTime
-&gt; DistinguishedName
-&gt; DistinguishedName
-&gt; Maybe (NonEmpty AltName)
-&gt; PubKey
-&gt; Certificate
</span><a href="Network.X509.SelfSigned.html#makeCertificate"><span class="hs-identifier hs-var hs-var">makeCertificate</span></a></span></span><span> </span><span id="local-6989586621681477032"><span class="annot"><span class="annottext">start :: DateTime
</span><a href="#local-6989586621681477032"><span class="hs-identifier hs-var">start</span></a></span></span><span> </span><span id="local-6989586621681477031"><span class="annot"><span class="annottext">end :: DateTime
</span><a href="#local-6989586621681477031"><span class="hs-identifier hs-var">end</span></a></span></span><span> </span><span id="local-6989586621681477030"><span class="annot"><span class="annottext">issuer :: DistinguishedName
</span><a href="#local-6989586621681477030"><span class="hs-identifier hs-var">issuer</span></a></span></span><span> </span><span id="local-6989586621681477029"><span class="annot"><span class="annottext">subject :: DistinguishedName
</span><a href="#local-6989586621681477029"><span class="hs-identifier hs-var">subject</span></a></span></span><span> </span><span id="local-6989586621681477028"><span class="annot"><span class="annottext">altNames :: Maybe (NonEmpty AltName)
</span><a href="#local-6989586621681477028"><span class="hs-identifier hs-var">altNames</span></a></span></span><span> </span><span id="local-6989586621681477027"><span class="annot"><span class="annottext">pk :: PubKey
</span><a href="#local-6989586621681477027"><span class="hs-identifier hs-var">pk</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Certificate :: Int
-&gt; Integer
-&gt; SignatureALG
-&gt; DistinguishedName
-&gt; (DateTime, DateTime)
-&gt; DistinguishedName
-&gt; PubKey
-&gt; Extensions
-&gt; Certificate
</span><span class="hs-identifier hs-type hs-type">Certificate</span></span><span>
</span><span id="line-354"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">certVersion :: Int
</span><span class="hs-identifier hs-var">certVersion</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-number">2</span></span><span>
</span><span id="line-355"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">certSerial :: Integer
</span><span class="hs-identifier hs-var">certSerial</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-number">1</span></span><span>
</span><span id="line-356"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">certSignatureAlg :: SignatureALG
</span><span class="hs-identifier hs-var">certSignatureAlg</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">X509Key k =&gt; SignatureALG
forall k. X509Key k =&gt; SignatureALG
</span><a href="Network.X509.SelfSigned.html#sigAlg"><span class="hs-identifier hs-var">sigAlg</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621681477289"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-357"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">certIssuerDN :: DistinguishedName
</span><span class="hs-identifier hs-var">certIssuerDN</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DistinguishedName
</span><a href="#local-6989586621681477030"><span class="hs-identifier hs-var">issuer</span></a></span><span>
</span><span id="line-358"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">certValidity :: (DateTime, DateTime)
</span><span class="hs-identifier hs-var">certValidity</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DateTime
</span><a href="#local-6989586621681477032"><span class="hs-identifier hs-var">start</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DateTime
</span><a href="#local-6989586621681477031"><span class="hs-identifier hs-var">end</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-359"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">certSubjectDN :: DistinguishedName
</span><span class="hs-identifier hs-var">certSubjectDN</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DistinguishedName
</span><a href="#local-6989586621681477029"><span class="hs-identifier hs-var">subject</span></a></span><span>
</span><span id="line-360"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">certPubKey :: PubKey
</span><span class="hs-identifier hs-var">certPubKey</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PubKey
</span><a href="#local-6989586621681477027"><span class="hs-identifier hs-var">pk</span></a></span><span>
</span><span id="line-361"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">certExtensions :: Extensions
</span><span class="hs-identifier hs-var">certExtensions</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe [ExtensionRaw] -&gt; Extensions
</span><span class="hs-identifier hs-var">Extensions</span></span><span> </span><span class="annot"><span class="annottext">(Maybe [ExtensionRaw] -&gt; Extensions)
-&gt; Maybe [ExtensionRaw] -&gt; Extensions
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[ExtensionRaw] -&gt; Maybe [ExtensionRaw]
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">([ExtensionRaw] -&gt; Maybe [ExtensionRaw])
-&gt; [ExtensionRaw] -&gt; Maybe [ExtensionRaw]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe (NonEmpty AltName) -&gt; [ExtensionRaw]
</span><a href="Network.X509.SelfSigned.html#rawExtensions"><span class="hs-identifier hs-var">rawExtensions</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (NonEmpty AltName)
</span><a href="#local-6989586621681477028"><span class="hs-identifier hs-var">altNames</span></a></span><span>
</span><span id="line-362"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-363"></span><span>
</span><span id="line-364"></span><span class="annot"><a href="Network.X509.SelfSigned.html#name"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DistinguishedName</span></span><span>
</span><span id="line-365"></span><span id="name"><span class="annot"><span class="annottext">name :: [Char] -&gt; DistinguishedName
</span><a href="Network.X509.SelfSigned.html#name"><span class="hs-identifier hs-var hs-var">name</span></a></span></span><span> </span><span id="local-6989586621681477014"><span class="annot"><span class="annottext">n :: [Char]
</span><a href="#local-6989586621681477014"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(OID, ASN1CharacterString)] -&gt; DistinguishedName
</span><span class="hs-identifier hs-var">DistinguishedName</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">DnElement -&gt; OID
forall a. OIDable a =&gt; a -&gt; OID
</span><span class="hs-identifier hs-var">getObjectID</span></span><span> </span><span class="annot"><span class="annottext">DnElement
</span><span class="hs-identifier hs-var">DnCommonName</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ASN1CharacterString
forall a. IsString a =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">fromString</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621681477014"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-366"></span><span>
</span><span id="line-367"></span><span class="annot"><a href="Network.X509.SelfSigned.html#org"><span class="hs-identifier hs-type">org</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DistinguishedName</span></span><span>
</span><span id="line-368"></span><span id="org"><span class="annot"><span class="annottext">org :: [Char] -&gt; DistinguishedName
</span><a href="Network.X509.SelfSigned.html#org"><span class="hs-identifier hs-var hs-var">org</span></a></span></span><span> </span><span id="local-6989586621681477010"><span class="annot"><span class="annottext">n :: [Char]
</span><a href="#local-6989586621681477010"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(OID, ASN1CharacterString)] -&gt; DistinguishedName
</span><span class="hs-identifier hs-var">DistinguishedName</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">DnElement -&gt; OID
forall a. OIDable a =&gt; a -&gt; OID
</span><span class="hs-identifier hs-var">getObjectID</span></span><span> </span><span class="annot"><span class="annottext">DnElement
</span><span class="hs-identifier hs-var">DnOrganization</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ASN1CharacterString
forall a. IsString a =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">fromString</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621681477010"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-369"></span><span>
</span><span id="line-370"></span><span class="hs-comment">-- -------------------------------------------------------------------------- --</span><span>
</span><span id="line-371"></span><span class="hs-comment">-- Signed Certificate</span><span>
</span><span id="line-372"></span><span>
</span><span id="line-373"></span><span id="local-6989586621681477288"><span class="annot"><a href="Network.X509.SelfSigned.html#signedCertIO"><span class="hs-identifier hs-type">signedCertIO</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#X509Key"><span class="hs-identifier hs-type">X509Key</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681477288"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681477288"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Certificate</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">SignedExact</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Certificate</span></span><span class="hs-special">)</span></span><span>
</span><span id="line-374"></span><span id="signedCertIO"><span class="annot"><span class="annottext">signedCertIO :: k -&gt; Certificate -&gt; IO (SignedExact Certificate)
</span><a href="Network.X509.SelfSigned.html#signedCertIO"><span class="hs-identifier hs-var hs-var">signedCertIO</span></a></span></span><span> </span><span id="local-6989586621681477007"><span class="annot"><span class="annottext">sk :: k
</span><a href="#local-6989586621681477007"><span class="hs-identifier hs-var">sk</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; IO (ByteString, SignatureALG))
-&gt; Certificate -&gt; IO (SignedExact Certificate)
forall (f :: * -&gt; *) a.
(Functor f, Show a, Eq a, ASN1Object a) =&gt;
(ByteString -&gt; f (ByteString, SignatureALG))
-&gt; a -&gt; f (SignedExact a)
</span><span class="hs-identifier hs-var">objectToSignedExactF</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">k -&gt; ByteString -&gt; IO (ByteString, SignatureALG)
forall k (m :: * -&gt; *) a.
(X509Key k, MonadRandom m, ByteArray a) =&gt;
k -&gt; ByteString -&gt; m (a, SignatureALG)
</span><a href="Network.X509.SelfSigned.html#signIO"><span class="hs-identifier hs-var">signIO</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621681477007"><span class="hs-identifier hs-var">sk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-375"></span><span>
</span><span id="line-376"></span><span class="hs-comment">-- -------------------------------------------------------------------------- --</span><span>
</span><span id="line-377"></span><span class="hs-comment">-- Extensions</span><span>
</span><span id="line-378"></span><span>
</span><span id="line-379"></span><span class="annot"><a href="Network.X509.SelfSigned.html#keyUsage"><span class="hs-identifier hs-type">keyUsage</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ExtKeyUsage</span></span><span>
</span><span id="line-380"></span><span id="keyUsage"><span class="annot"><span class="annottext">keyUsage :: ExtKeyUsage
</span><a href="Network.X509.SelfSigned.html#keyUsage"><span class="hs-identifier hs-var hs-var">keyUsage</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ExtKeyUsageFlag] -&gt; ExtKeyUsage
</span><span class="hs-identifier hs-var">ExtKeyUsage</span></span><span>
</span><span id="line-381"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">ExtKeyUsageFlag
</span><span class="hs-identifier hs-var">KeyUsage_digitalSignature</span></span><span>
</span><span id="line-382"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ExtKeyUsageFlag
</span><span class="hs-identifier hs-var">KeyUsage_keyCertSign</span></span><span>
</span><span id="line-383"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ExtKeyUsageFlag
</span><span class="hs-identifier hs-var">KeyUsage_keyAgreement</span></span><span>
</span><span id="line-384"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ExtKeyUsageFlag
</span><span class="hs-identifier hs-var">KeyUsage_keyEncipherment</span></span><span>
</span><span id="line-385"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ExtKeyUsageFlag
</span><span class="hs-identifier hs-var">KeyUsage_dataEncipherment</span></span><span>
</span><span id="line-386"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ExtKeyUsageFlag
</span><span class="hs-identifier hs-var">KeyUsage_nonRepudiation</span></span><span>
</span><span id="line-387"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-388"></span><span>
</span><span id="line-389"></span><span class="annot"><a href="Network.X509.SelfSigned.html#keyPurpose"><span class="hs-identifier hs-type">keyPurpose</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ExtExtendedKeyUsage</span></span><span>
</span><span id="line-390"></span><span id="keyPurpose"><span class="annot"><span class="annottext">keyPurpose :: ExtExtendedKeyUsage
</span><a href="Network.X509.SelfSigned.html#keyPurpose"><span class="hs-identifier hs-var hs-var">keyPurpose</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ExtKeyUsagePurpose] -&gt; ExtExtendedKeyUsage
</span><span class="hs-identifier hs-var">ExtExtendedKeyUsage</span></span><span>
</span><span id="line-391"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">ExtKeyUsagePurpose
</span><span class="hs-identifier hs-var">KeyUsagePurpose_ServerAuth</span></span><span>
</span><span id="line-392"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ExtKeyUsagePurpose
</span><span class="hs-identifier hs-var">KeyUsagePurpose_ClientAuth</span></span><span>
</span><span id="line-393"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-394"></span><span>
</span><span id="line-395"></span><span class="hs-comment">{-
subjectKeyId :: B.ByteString -&gt; ExtSubjectKeyId
subjectKeyId k = ExtSubjectKeyId k
-}</span><span>
</span><span id="line-399"></span><span>
</span><span id="line-400"></span><span class="annot"><a href="Network.X509.SelfSigned.html#basicConstraints"><span class="hs-identifier hs-type">basicConstraints</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ExtBasicConstraints</span></span><span>
</span><span id="line-401"></span><span id="basicConstraints"><span class="annot"><span class="annottext">basicConstraints :: ExtBasicConstraints
</span><a href="Network.X509.SelfSigned.html#basicConstraints"><span class="hs-identifier hs-var hs-var">basicConstraints</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Maybe Integer -&gt; ExtBasicConstraints
</span><span class="hs-identifier hs-var">ExtBasicConstraints</span></span><span>
</span><span id="line-402"></span><span>    </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-comment">{- CA flag -}</span><span>
</span><span id="line-403"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Maybe Integer
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="hs-comment">{- path length -}</span><span>
</span><span id="line-404"></span><span>
</span><span id="line-405"></span><span class="annot"><a href="Network.X509.SelfSigned.html#rawExtensions"><span class="hs-identifier hs-type">rawExtensions</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">NE.NonEmpty</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">AltName</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">ExtensionRaw</span></span><span class="hs-special">]</span><span>
</span><span id="line-406"></span><span id="rawExtensions"><span class="annot"><span class="annottext">rawExtensions :: Maybe (NonEmpty AltName) -&gt; [ExtensionRaw]
</span><a href="Network.X509.SelfSigned.html#rawExtensions"><span class="hs-identifier hs-var hs-var">rawExtensions</span></a></span></span><span> </span><span id="local-6989586621681476991"><span class="annot"><span class="annottext">altNames :: Maybe (NonEmpty AltName)
</span><a href="#local-6989586621681476991"><span class="hs-identifier hs-var">altNames</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-407"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; ExtKeyUsage -&gt; ExtensionRaw
forall a. Extension a =&gt; Bool -&gt; a -&gt; ExtensionRaw
</span><span class="hs-identifier hs-var">extensionEncode</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">ExtKeyUsage
</span><a href="Network.X509.SelfSigned.html#keyUsage"><span class="hs-identifier hs-var">keyUsage</span></a></span><span>
</span><span id="line-408"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; ExtExtendedKeyUsage -&gt; ExtensionRaw
forall a. Extension a =&gt; Bool -&gt; a -&gt; ExtensionRaw
</span><span class="hs-identifier hs-var">extensionEncode</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">ExtExtendedKeyUsage
</span><a href="Network.X509.SelfSigned.html#keyPurpose"><span class="hs-identifier hs-var">keyPurpose</span></a></span><span>
</span><span id="line-409"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; ExtBasicConstraints -&gt; ExtensionRaw
forall a. Extension a =&gt; Bool -&gt; a -&gt; ExtensionRaw
</span><span class="hs-identifier hs-var">extensionEncode</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">ExtBasicConstraints
</span><a href="Network.X509.SelfSigned.html#basicConstraints"><span class="hs-identifier hs-var">basicConstraints</span></a></span><span>
</span><span id="line-410"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-411"></span><span>    </span><span class="annot"><span class="annottext">[ExtensionRaw] -&gt; [ExtensionRaw] -&gt; [ExtensionRaw]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span>
</span><span id="line-412"></span><span>    </span><span class="annot"><span class="annottext">[ExtensionRaw]
-&gt; (NonEmpty AltName -&gt; [ExtensionRaw])
-&gt; Maybe (NonEmpty AltName)
-&gt; [ExtensionRaw]
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExtensionRaw -&gt; [ExtensionRaw]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(ExtensionRaw -&gt; [ExtensionRaw])
-&gt; (NonEmpty AltName -&gt; ExtensionRaw)
-&gt; NonEmpty AltName
-&gt; [ExtensionRaw]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; ExtSubjectAltName -&gt; ExtensionRaw
forall a. Extension a =&gt; Bool -&gt; a -&gt; ExtensionRaw
</span><span class="hs-identifier hs-var">extensionEncode</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">(ExtSubjectAltName -&gt; ExtensionRaw)
-&gt; (NonEmpty AltName -&gt; ExtSubjectAltName)
-&gt; NonEmpty AltName
-&gt; ExtensionRaw
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[AltName] -&gt; ExtSubjectAltName
</span><span class="hs-identifier hs-var">ExtSubjectAltName</span></span><span> </span><span class="annot"><span class="annottext">([AltName] -&gt; ExtSubjectAltName)
-&gt; (NonEmpty AltName -&gt; [AltName])
-&gt; NonEmpty AltName
-&gt; ExtSubjectAltName
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty AltName -&gt; [AltName]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe (NonEmpty AltName)
</span><a href="#local-6989586621681476991"><span class="hs-identifier hs-var">altNames</span></a></span><span>
</span><span id="line-413"></span><span>
</span><span id="line-414"></span><span class="hs-comment">-- -------------------------------------------------------------------------- --</span><span>
</span><span id="line-415"></span><span class="hs-comment">-- Certificate Fingerprint</span><span>
</span><span id="line-416"></span><span>
</span><span id="line-417"></span><span class="hs-keyword">type</span><span> </span><span id="FingerprintByteCount"><span class="annot"><a href="Network.X509.SelfSigned.html#FingerprintByteCount"><span class="hs-identifier hs-var">FingerprintByteCount</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-number">32</span></span><span>
</span><span id="line-418"></span><span>
</span><span id="line-419"></span><span class="annot"><a href="Network.X509.SelfSigned.html#fingerprintByteCount"><span class="hs-identifier hs-type">fingerprintByteCount</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Natural</span></span><span>
</span><span id="line-420"></span><span id="fingerprintByteCount"><span class="annot"><span class="annottext">fingerprintByteCount :: Natural
</span><a href="Network.X509.SelfSigned.html#fingerprintByteCount"><span class="hs-identifier hs-var hs-var">fingerprintByteCount</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Proxy FingerprintByteCount -&gt; Natural
forall (n :: Nat) (proxy :: Nat -&gt; *).
KnownNat n =&gt;
proxy n -&gt; Natural
</span><span class="hs-identifier hs-var">natVal</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy FingerprintByteCount
forall k (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Network.X509.SelfSigned.html#FingerprintByteCount"><span class="hs-identifier hs-type">FingerprintByteCount</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-421"></span><span>
</span><span id="line-422"></span><span class="annot"><a href="Network.X509.SelfSigned.html#fingerprint"><span class="hs-identifier hs-type">fingerprint</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SignedExact</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Certificate</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Fingerprint</span></span><span>
</span><span id="line-423"></span><span id="fingerprint"><span class="annot"><span class="annottext">fingerprint :: SignedExact Certificate -&gt; Fingerprint
</span><a href="Network.X509.SelfSigned.html#fingerprint"><span class="hs-identifier hs-var hs-var">fingerprint</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SignedExact Certificate -&gt; HashALG -&gt; Fingerprint)
-&gt; HashALG -&gt; SignedExact Certificate -&gt; Fingerprint
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">SignedExact Certificate -&gt; HashALG -&gt; Fingerprint
forall a.
(Show a, Eq a, ASN1Object a) =&gt;
SignedExact a -&gt; HashALG -&gt; Fingerprint
</span><span class="hs-identifier hs-var">getFingerprint</span></span><span> </span><span class="annot"><span class="annottext">HashALG
</span><span class="hs-identifier hs-var">HashSHA256</span></span><span>
</span><span id="line-424"></span><span>    </span><span class="hs-comment">-- The TLS package uses SHA256 for certifcate fingerprints, so we do the</span><span>
</span><span id="line-425"></span><span>    </span><span class="hs-comment">-- same here. If this changes in the TLS package, we'd have to change</span><span>
</span><span id="line-426"></span><span>    </span><span class="hs-comment">-- our fingerprint format or compute SHA256 fingerprints in certificate</span><span>
</span><span id="line-427"></span><span>    </span><span class="hs-comment">-- cache queries from the provided certificate.</span><span>
</span><span id="line-428"></span><span>
</span><span id="line-429"></span><span class="annot"><a href="Network.X509.SelfSigned.html#fingerprintToText"><span class="hs-identifier hs-type">fingerprintToText</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Fingerprint</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span>
</span><span id="line-430"></span><span id="fingerprintToText"><span class="annot"><span class="annottext">fingerprintToText :: Fingerprint -&gt; Text
</span><a href="Network.X509.SelfSigned.html#fingerprintToText"><span class="hs-identifier hs-var hs-var">fingerprintToText</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Fingerprint</span></span><span> </span><span id="local-6989586621681476981"><span class="annot"><span class="annottext">b :: ByteString
</span><a href="#local-6989586621681476981"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Text
</span><a href="Chainweb.Utils.html#encodeB64UrlNoPaddingText"><span class="hs-identifier hs-var">encodeB64UrlNoPaddingText</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621681476981"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-431"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#fingerprintToText"><span class="hs-pragma hs-type">fingerprintToText</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-432"></span><span>
</span><span id="line-433"></span><span id="local-6989586621681477386"><span class="annot"><a href="Network.X509.SelfSigned.html#fingerprintFromText"><span class="hs-identifier hs-type">fingerprintFromText</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadThrow</span></span><span> </span><span class="annot"><a href="#local-6989586621681477386"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681477386"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Fingerprint</span></span></span><span>
</span><span id="line-434"></span><span id="fingerprintFromText"><span class="annot"><span class="annottext">fingerprintFromText :: Text -&gt; m Fingerprint
</span><a href="Network.X509.SelfSigned.html#fingerprintFromText"><span class="hs-identifier hs-var hs-var">fingerprintFromText</span></a></span></span><span> </span><span id="local-6989586621681476979"><span class="annot"><span class="annottext">t :: Text
</span><a href="#local-6989586621681476979"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-435"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621681476978"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621681476978"><span class="hs-identifier hs-var">bytes</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Text -&gt; m ByteString
forall (m :: * -&gt; *). MonadThrow m =&gt; Text -&gt; m ByteString
</span><a href="Chainweb.Utils.html#decodeB64UrlNoPaddingText"><span class="hs-identifier hs-var">decodeB64UrlNoPaddingText</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621681476979"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-436"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; m () -&gt; m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; Int
</span><span class="hs-identifier hs-var">B.length</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621681476978"><span class="hs-identifier hs-var">bytes</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="Chainweb.Utils.html#int"><span class="hs-identifier hs-var">int</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="Network.X509.SelfSigned.html#fingerprintByteCount"><span class="hs-identifier hs-var">fingerprintByteCount</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">EncodingException -&gt; m ()
forall (m :: * -&gt; *) e a. (MonadThrow m, Exception e) =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwM</span></span><span>
</span><span id="line-437"></span><span>        </span><span class="annot"><span class="annottext">(EncodingException -&gt; m ()) -&gt; EncodingException -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; EncodingException
</span><a href="Chainweb.Utils.html#TextFormatException"><span class="hs-identifier hs-var">TextFormatException</span></a></span><span>
</span><span id="line-438"></span><span>        </span><span class="annot"><span class="annottext">(Text -&gt; EncodingException) -&gt; Text -&gt; EncodingException
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;wrong certificate fingerprint length: expected &quot;</span></span><span>
</span><span id="line-439"></span><span>        </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Text
forall a b. (Show a, IsString b) =&gt; a -&gt; b
</span><a href="Chainweb.Utils.html#sshow"><span class="hs-identifier hs-var">sshow</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="Network.X509.SelfSigned.html#fingerprintByteCount"><span class="hs-identifier hs-var">fingerprintByteCount</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="hs-string">&quot; bytes, got &quot;</span></span><span>
</span><span id="line-440"></span><span>        </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Text
forall a b. (Show a, IsString b) =&gt; a -&gt; b
</span><a href="Chainweb.Utils.html#sshow"><span class="hs-identifier hs-var">sshow</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; Int
</span><span class="hs-identifier hs-var">B.length</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621681476978"><span class="hs-identifier hs-var">bytes</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="hs-string">&quot; bytes.&quot;</span></span><span>
</span><span id="line-441"></span><span>    </span><span class="annot"><span class="annottext">Fingerprint -&gt; m Fingerprint
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Fingerprint -&gt; m Fingerprint) -&gt; Fingerprint -&gt; m Fingerprint
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Fingerprint
</span><span class="hs-identifier hs-var">Fingerprint</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621681476978"><span class="hs-identifier hs-var">bytes</span></a></span><span>
</span><span id="line-442"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#fingerprintFromText"><span class="hs-pragma hs-type">fingerprintFromText</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-443"></span><span>
</span><span id="line-444"></span><span class="annot"><a href="Network.X509.SelfSigned.html#unsafeFingerprintFromText"><span class="hs-identifier hs-type">unsafeFingerprintFromText</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Fingerprint</span></span><span>
</span><span id="line-445"></span><span id="unsafeFingerprintFromText"><span class="annot"><span class="annottext">unsafeFingerprintFromText :: [Char] -&gt; Fingerprint
</span><a href="Network.X509.SelfSigned.html#unsafeFingerprintFromText"><span class="hs-identifier hs-var hs-var">unsafeFingerprintFromText</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Fingerprint -&gt; Fingerprint
forall a. HasCallStack =&gt; Maybe a -&gt; a
</span><a href="Chainweb.Utils.html#fromJuste"><span class="hs-identifier hs-var">fromJuste</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe Fingerprint -&gt; Fingerprint)
-&gt; ([Char] -&gt; Maybe Fingerprint) -&gt; [Char] -&gt; Fingerprint
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Maybe Fingerprint
forall (m :: * -&gt; *). MonadThrow m =&gt; Text -&gt; m Fingerprint
</span><a href="Network.X509.SelfSigned.html#fingerprintFromText"><span class="hs-identifier hs-var">fingerprintFromText</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Maybe Fingerprint)
-&gt; ([Char] -&gt; Text) -&gt; [Char] -&gt; Maybe Fingerprint
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span>
</span><span id="line-446"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#unsafeFingerprintFromText"><span class="hs-pragma hs-type">unsafeFingerprintFromText</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-447"></span><span>
</span><span id="line-448"></span><span class="hs-comment">-- -------------------------------------------------------------------------- --</span><span>
</span><span id="line-449"></span><span class="hs-comment">-- PEM Encoded Certificate</span><span>
</span><span id="line-450"></span><span>
</span><span id="line-451"></span><span id="local-6989586621681476968"><span id="local-6989586621681476969"></span></span><span class="hs-keyword">newtype</span><span> </span><span id="X509CertPem"><span class="annot"><a href="Network.X509.SelfSigned.html#X509CertPem"><span class="hs-identifier hs-var">X509CertPem</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="X509CertPem"><span class="annot"><a href="Network.X509.SelfSigned.html#X509CertPem"><span class="hs-identifier hs-var">X509CertPem</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span>
</span><span id="line-452"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681476961"><span id="local-6989586621681476963"><span id="local-6989586621681476965"><span class="annot"><span class="annottext">Int -&gt; X509CertPem -&gt; [Char] -&gt; [Char]
[X509CertPem] -&gt; [Char] -&gt; [Char]
X509CertPem -&gt; [Char]
(Int -&gt; X509CertPem -&gt; [Char] -&gt; [Char])
-&gt; (X509CertPem -&gt; [Char])
-&gt; ([X509CertPem] -&gt; [Char] -&gt; [Char])
-&gt; Show X509CertPem
forall a.
(Int -&gt; a -&gt; [Char] -&gt; [Char])
-&gt; (a -&gt; [Char]) -&gt; ([a] -&gt; [Char] -&gt; [Char]) -&gt; Show a
showList :: [X509CertPem] -&gt; [Char] -&gt; [Char]
$cshowList :: [X509CertPem] -&gt; [Char] -&gt; [Char]
show :: X509CertPem -&gt; [Char]
$cshow :: X509CertPem -&gt; [Char]
showsPrec :: Int -&gt; X509CertPem -&gt; [Char] -&gt; [Char]
$cshowsPrec :: Int -&gt; X509CertPem -&gt; [Char] -&gt; [Char]
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681476956"><span id="local-6989586621681476958"><span class="annot"><span class="annottext">X509CertPem -&gt; X509CertPem -&gt; Bool
(X509CertPem -&gt; X509CertPem -&gt; Bool)
-&gt; (X509CertPem -&gt; X509CertPem -&gt; Bool) -&gt; Eq X509CertPem
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: X509CertPem -&gt; X509CertPem -&gt; Bool
$c/= :: X509CertPem -&gt; X509CertPem -&gt; Bool
== :: X509CertPem -&gt; X509CertPem -&gt; Bool
$c== :: X509CertPem -&gt; X509CertPem -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681476940"><span id="local-6989586621681476942"><span id="local-6989586621681476944"><span id="local-6989586621681476946"><span id="local-6989586621681476948"><span id="local-6989586621681476950"><span id="local-6989586621681476952"><span class="annot"><span class="annottext">Eq X509CertPem
Eq X509CertPem =&gt;
(X509CertPem -&gt; X509CertPem -&gt; Ordering)
-&gt; (X509CertPem -&gt; X509CertPem -&gt; Bool)
-&gt; (X509CertPem -&gt; X509CertPem -&gt; Bool)
-&gt; (X509CertPem -&gt; X509CertPem -&gt; Bool)
-&gt; (X509CertPem -&gt; X509CertPem -&gt; Bool)
-&gt; (X509CertPem -&gt; X509CertPem -&gt; X509CertPem)
-&gt; (X509CertPem -&gt; X509CertPem -&gt; X509CertPem)
-&gt; Ord X509CertPem
X509CertPem -&gt; X509CertPem -&gt; Bool
X509CertPem -&gt; X509CertPem -&gt; Ordering
X509CertPem -&gt; X509CertPem -&gt; X509CertPem
forall a.
Eq a =&gt;
(a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
min :: X509CertPem -&gt; X509CertPem -&gt; X509CertPem
$cmin :: X509CertPem -&gt; X509CertPem -&gt; X509CertPem
max :: X509CertPem -&gt; X509CertPem -&gt; X509CertPem
$cmax :: X509CertPem -&gt; X509CertPem -&gt; X509CertPem
&gt;= :: X509CertPem -&gt; X509CertPem -&gt; Bool
$c&gt;= :: X509CertPem -&gt; X509CertPem -&gt; Bool
&gt; :: X509CertPem -&gt; X509CertPem -&gt; Bool
$c&gt; :: X509CertPem -&gt; X509CertPem -&gt; Bool
&lt;= :: X509CertPem -&gt; X509CertPem -&gt; Bool
$c&lt;= :: X509CertPem -&gt; X509CertPem -&gt; Bool
&lt; :: X509CertPem -&gt; X509CertPem -&gt; Bool
$c&lt; :: X509CertPem -&gt; X509CertPem -&gt; Bool
compare :: X509CertPem -&gt; X509CertPem -&gt; Ordering
$ccompare :: X509CertPem -&gt; X509CertPem -&gt; Ordering
$cp1Ord :: Eq X509CertPem
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(forall x. X509CertPem -&gt; Rep X509CertPem x)
-&gt; (forall x. Rep X509CertPem x -&gt; X509CertPem)
-&gt; Generic X509CertPem
forall x. Rep X509CertPem x -&gt; X509CertPem
forall x. X509CertPem -&gt; Rep X509CertPem x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep X509CertPem x -&gt; X509CertPem
$cfrom :: forall x. X509CertPem -&gt; Rep X509CertPem x
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></span><span class="hs-special">)</span><span>
</span><span id="line-453"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">anyclass</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681476932"><span id="local-6989586621681476934"><span class="annot"><span class="annottext">Int -&gt; X509CertPem -&gt; Int
X509CertPem -&gt; Int
(Int -&gt; X509CertPem -&gt; Int)
-&gt; (X509CertPem -&gt; Int) -&gt; Hashable X509CertPem
forall a. (Int -&gt; a -&gt; Int) -&gt; (a -&gt; Int) -&gt; Hashable a
hash :: X509CertPem -&gt; Int
$chash :: X509CertPem -&gt; Int
hashWithSalt :: Int -&gt; X509CertPem -&gt; Int
$chashWithSalt :: Int -&gt; X509CertPem -&gt; Int
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Hashable</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681476929"><span class="annot"><span class="annottext">X509CertPem -&gt; ()
(X509CertPem -&gt; ()) -&gt; NFData X509CertPem
forall a. (a -&gt; ()) -&gt; NFData a
rnf :: X509CertPem -&gt; ()
$crnf :: X509CertPem -&gt; ()
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">NFData</span></span></span><span class="hs-special">)</span><span>
</span><span id="line-454"></span><span>
</span><span id="line-455"></span><span class="annot"><a href="Network.X509.SelfSigned.html#x509CertPemToText"><span class="hs-identifier hs-type">x509CertPemToText</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#X509CertPem"><span class="hs-identifier hs-type">X509CertPem</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span>
</span><span id="line-456"></span><span id="x509CertPemToText"><span class="annot"><span class="annottext">x509CertPemToText :: X509CertPem -&gt; Text
</span><a href="Network.X509.SelfSigned.html#x509CertPemToText"><span class="hs-identifier hs-var hs-var">x509CertPemToText</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.X509.SelfSigned.html#X509CertPem"><span class="hs-identifier hs-type">X509CertPem</span></a></span><span> </span><span id="local-6989586621681476927"><span class="annot"><span class="annottext">b :: ByteString
</span><a href="#local-6989586621681476927"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Text
</span><span class="hs-identifier hs-var">T.decodeUtf8</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621681476927"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-457"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#x509CertPemToText"><span class="hs-pragma hs-type">x509CertPemToText</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-458"></span><span>
</span><span id="line-459"></span><span id="local-6989586621681477373"><span class="annot"><a href="Network.X509.SelfSigned.html#x509CertPemFromText"><span class="hs-identifier hs-type">x509CertPemFromText</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadThrow</span></span><span> </span><span class="annot"><a href="#local-6989586621681477373"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681477373"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#X509CertPem"><span class="hs-identifier hs-type">X509CertPem</span></a></span></span><span>
</span><span id="line-460"></span><span id="x509CertPemFromText"><span class="annot"><span class="annottext">x509CertPemFromText :: Text -&gt; m X509CertPem
</span><a href="Network.X509.SelfSigned.html#x509CertPemFromText"><span class="hs-identifier hs-var hs-var">x509CertPemFromText</span></a></span></span><span> </span><span id="local-6989586621681476925"><span class="annot"><span class="annottext">t :: Text
</span><a href="#local-6989586621681476925"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">X509CertPem -&gt; m X509CertPem
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(X509CertPem -&gt; m X509CertPem) -&gt; X509CertPem -&gt; m X509CertPem
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; X509CertPem
</span><a href="Network.X509.SelfSigned.html#X509CertPem"><span class="hs-identifier hs-var">X509CertPem</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; X509CertPem) -&gt; ByteString -&gt; X509CertPem
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; ByteString
</span><span class="hs-identifier hs-var">T.encodeUtf8</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621681476925"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-461"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#x509CertPemFromText"><span class="hs-pragma hs-type">x509CertPemFromText</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-462"></span><span>
</span><span id="line-463"></span><span class="annot"><a href="Network.X509.SelfSigned.html#unsafeX509CertPemFromText"><span class="hs-identifier hs-type">unsafeX509CertPemFromText</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#X509CertPem"><span class="hs-identifier hs-type">X509CertPem</span></a></span><span>
</span><span id="line-464"></span><span id="unsafeX509CertPemFromText"><span class="annot"><span class="annottext">unsafeX509CertPemFromText :: [Char] -&gt; X509CertPem
</span><a href="Network.X509.SelfSigned.html#unsafeX509CertPemFromText"><span class="hs-identifier hs-var hs-var">unsafeX509CertPemFromText</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe X509CertPem -&gt; X509CertPem
forall a. HasCallStack =&gt; Maybe a -&gt; a
</span><a href="Chainweb.Utils.html#fromJuste"><span class="hs-identifier hs-var">fromJuste</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe X509CertPem -&gt; X509CertPem)
-&gt; ([Char] -&gt; Maybe X509CertPem) -&gt; [Char] -&gt; X509CertPem
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Maybe X509CertPem
forall (m :: * -&gt; *). MonadThrow m =&gt; Text -&gt; m X509CertPem
</span><a href="Network.X509.SelfSigned.html#x509CertPemFromText"><span class="hs-identifier hs-var">x509CertPemFromText</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Maybe X509CertPem)
-&gt; ([Char] -&gt; Text) -&gt; [Char] -&gt; Maybe X509CertPem
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span>
</span><span id="line-465"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#unsafeX509CertPemFromText"><span class="hs-pragma hs-type">unsafeX509CertPemFromText</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-466"></span><span>
</span><span id="line-467"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Chainweb.Utils.html#HasTextRepresentation"><span class="hs-identifier hs-type">HasTextRepresentation</span></a></span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#X509CertPem"><span class="hs-identifier hs-type">X509CertPem</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-468"></span><span>    </span><span id="local-6989586621681476920"><span class="annot"><span class="annottext">toText :: X509CertPem -&gt; Text
</span><a href="Chainweb.Utils.html#toText"><span class="hs-identifier hs-var hs-var hs-var hs-var">toText</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">X509CertPem -&gt; Text
</span><a href="Network.X509.SelfSigned.html#x509CertPemToText"><span class="hs-identifier hs-var">x509CertPemToText</span></a></span><span>
</span><span id="line-469"></span><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Chainweb.Utils.html#toText"><span class="hs-pragma hs-type">toText</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-470"></span><span>    </span><span id="local-6989586621681476918"><span class="annot"><span class="annottext">fromText :: Text -&gt; m X509CertPem
</span><a href="Chainweb.Utils.html#fromText"><span class="hs-identifier hs-var hs-var hs-var hs-var">fromText</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; m X509CertPem
forall (m :: * -&gt; *). MonadThrow m =&gt; Text -&gt; m X509CertPem
</span><a href="Network.X509.SelfSigned.html#x509CertPemFromText"><span class="hs-identifier hs-var">x509CertPemFromText</span></a></span><span>
</span><span id="line-471"></span><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Chainweb.Utils.html#fromText"><span class="hs-pragma hs-type">fromText</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-472"></span><span>
</span><span id="line-473"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681476910"><span id="local-6989586621681476912"><span id="local-6989586621681476914"><span class="annot"><span class="hs-identifier hs-type">ToJSON</span></span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#X509CertPem"><span class="hs-identifier hs-type">X509CertPem</span></a></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-474"></span><span>    </span><span id="local-6989586621681476908"><span class="annot"><span class="annottext">toJSON :: X509CertPem -&gt; Value
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">toJSON</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Value
forall a. ToJSON a =&gt; a -&gt; Value
</span><span class="hs-identifier hs-var">toJSON</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Value) -&gt; (X509CertPem -&gt; Text) -&gt; X509CertPem -&gt; Value
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">X509CertPem -&gt; Text
forall a. HasTextRepresentation a =&gt; a -&gt; Text
</span><a href="Chainweb.Utils.html#toText"><span class="hs-identifier hs-var">toText</span></a></span><span>
</span><span id="line-475"></span><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><span class="hs-pragma hs-type">toJSON</span></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-476"></span><span>
</span><span id="line-477"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681476904"><span class="annot"><span class="hs-identifier hs-type">FromJSON</span></span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#X509CertPem"><span class="hs-identifier hs-type">X509CertPem</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-478"></span><span>    </span><span id="local-6989586621681476902"><span class="annot"><span class="annottext">parseJSON :: Value -&gt; Parser X509CertPem
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">parseJSON</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Value -&gt; Parser X509CertPem
forall a. HasTextRepresentation a =&gt; [Char] -&gt; Value -&gt; Parser a
</span><a href="Chainweb.Utils.html#parseJsonFromText"><span class="hs-identifier hs-var">parseJsonFromText</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;X509CertPem&quot;</span></span><span>
</span><span id="line-479"></span><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><span class="hs-pragma hs-type">parseJSON</span></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-480"></span><span>
</span><span id="line-481"></span><span class="annot"><a href="Network.X509.SelfSigned.html#pX509CertPem"><span class="hs-identifier hs-type">pX509CertPem</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Chainweb.Utils.html#OptionParser"><span class="hs-identifier hs-type">OptionParser</span></a></span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#X509CertPem"><span class="hs-identifier hs-type">X509CertPem</span></a></span><span>
</span><span id="line-482"></span><span id="pX509CertPem"><span class="annot"><span class="annottext">pX509CertPem :: Maybe [Char] -&gt; OptionParser X509CertPem
</span><a href="Network.X509.SelfSigned.html#pX509CertPem"><span class="hs-identifier hs-var hs-var">pX509CertPem</span></a></span></span><span> </span><span id="local-6989586621681476899"><span class="annot"><span class="annottext">service :: Maybe [Char]
</span><a href="#local-6989586621681476899"><span class="hs-identifier hs-var">service</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Mod OptionFields X509CertPem -&gt; OptionParser X509CertPem
forall a. HasTextRepresentation a =&gt; Mod OptionFields a -&gt; Parser a
</span><a href="Chainweb.Utils.html#textOption"><span class="hs-identifier hs-var">textOption</span></a></span><span>
</span><span id="line-483"></span><span>    </span><span class="annot"><span class="annottext">(Mod OptionFields X509CertPem -&gt; OptionParser X509CertPem)
-&gt; Mod OptionFields X509CertPem -&gt; OptionParser X509CertPem
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">Maybe [Char] -&gt; [Char] -&gt; Mod OptionFields X509CertPem
forall (f :: * -&gt; *) a.
HasName f =&gt;
Maybe [Char] -&gt; [Char] -&gt; Mod f a
</span><a href="Chainweb.Utils.html#prefixLong"><span class="hs-identifier hs-var">prefixLong</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe [Char]
</span><a href="#local-6989586621681476899"><span class="hs-identifier hs-var">service</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;certificate&quot;</span></span><span>
</span><span id="line-484"></span><span>    </span><span class="annot"><span class="annottext">Mod OptionFields X509CertPem
-&gt; Mod OptionFields X509CertPem -&gt; Mod OptionFields X509CertPem
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe [Char] -&gt; [Char] -&gt; Mod OptionFields X509CertPem
forall (f :: * -&gt; *) a. Maybe [Char] -&gt; [Char] -&gt; Mod f a
</span><a href="Chainweb.Utils.html#suffixHelp"><span class="hs-identifier hs-var">suffixHelp</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe [Char]
</span><a href="#local-6989586621681476899"><span class="hs-identifier hs-var">service</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;PEM encoded X509 certificate of the local peer&quot;</span></span><span>
</span><span id="line-485"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#pX509CertPem"><span class="hs-pragma hs-type">pX509CertPem</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-486"></span><span>
</span><span id="line-487"></span><span id="local-6989586621681476894"><span class="annot"><a href="Network.X509.SelfSigned.html#validateX509CertPem"><span class="hs-identifier hs-type">validateX509CertPem</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span> </span><span class="annot"><a href="#local-6989586621681476894"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#X509CertPem"><span class="hs-identifier hs-type">X509CertPem</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681476894"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-488"></span><span id="validateX509CertPem"><span class="annot"><span class="annottext">validateX509CertPem :: X509CertPem -&gt; m ()
</span><a href="Network.X509.SelfSigned.html#validateX509CertPem"><span class="hs-identifier hs-var hs-var">validateX509CertPem</span></a></span></span><span> </span><span id="local-6989586621681476893"><span class="annot"><span class="annottext">pemCert :: X509CertPem
</span><a href="#local-6989586621681476893"><span class="hs-identifier hs-var">pemCert</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-489"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">X509CertPem -&gt; Either SomeException (SignedExact Certificate)
forall (m :: * -&gt; *).
MonadThrow m =&gt;
X509CertPem -&gt; m (SignedExact Certificate)
</span><a href="Network.X509.SelfSigned.html#decodePemX509Cert"><span class="hs-identifier hs-var">decodePemX509Cert</span></a></span><span> </span><span class="annot"><span class="annottext">X509CertPem
</span><a href="#local-6989586621681476893"><span class="hs-identifier hs-var">pemCert</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-490"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621681476892"><span class="annot"><span class="annottext">e :: SomeException
</span><a href="#local-6989586621681476892"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; m ()
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; m ()) -&gt; Text -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SomeException -&gt; Text
forall a b. (Show a, IsString b) =&gt; a -&gt; b
</span><a href="Chainweb.Utils.html#sshow"><span class="hs-identifier hs-var">sshow</span></a></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621681476892"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-491"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; m ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-492"></span><span>
</span><span id="line-493"></span><span id="local-6989586621681477346"><span class="annot"><a href="Network.X509.SelfSigned.html#decodePemX509Cert"><span class="hs-identifier hs-type">decodePemX509Cert</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadThrow</span></span><span> </span><span class="annot"><a href="#local-6989586621681477346"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#X509CertPem"><span class="hs-identifier hs-type">X509CertPem</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681477346"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">SignedExact</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Certificate</span></span><span class="hs-special">)</span></span><span>
</span><span id="line-494"></span><span id="decodePemX509Cert"><span class="annot"><span class="annottext">decodePemX509Cert :: X509CertPem -&gt; m (SignedExact Certificate)
</span><a href="Network.X509.SelfSigned.html#decodePemX509Cert"><span class="hs-identifier hs-var hs-var">decodePemX509Cert</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.X509.SelfSigned.html#X509CertPem"><span class="hs-identifier hs-type">X509CertPem</span></a></span><span> </span><span id="local-6989586621681476890"><span class="annot"><span class="annottext">bytes :: ByteString
</span><a href="#local-6989586621681476890"><span class="hs-identifier hs-var">bytes</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-495"></span><span>    </span><span class="annot"><span class="annottext">([Char] -&gt; m (SignedExact Certificate))
-&gt; (SignedExact Certificate -&gt; m (SignedExact Certificate))
-&gt; Either [Char] (SignedExact Certificate)
-&gt; m (SignedExact Certificate)
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><span class="hs-identifier hs-var">either</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EncodingException -&gt; m (SignedExact Certificate)
forall (m :: * -&gt; *) e a. (MonadThrow m, Exception e) =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwM</span></span><span> </span><span class="annot"><span class="annottext">(EncodingException -&gt; m (SignedExact Certificate))
-&gt; ([Char] -&gt; EncodingException)
-&gt; [Char]
-&gt; m (SignedExact Certificate)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; EncodingException
</span><a href="Chainweb.Utils.html#X509CertificateDecodeException"><span class="hs-identifier hs-var">X509CertificateDecodeException</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; EncodingException)
-&gt; ([Char] -&gt; Text) -&gt; [Char] -&gt; EncodingException
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SignedExact Certificate -&gt; m (SignedExact Certificate)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Either [Char] (SignedExact Certificate)
 -&gt; m (SignedExact Certificate))
-&gt; Either [Char] (SignedExact Certificate)
-&gt; m (SignedExact Certificate)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-496"></span><span>        </span><span id="local-6989586621681476887"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621681476887"><span class="hs-identifier hs-var">der</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Either [Char] [PEM]
</span><span class="hs-identifier hs-var">pemParseBS</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621681476890"><span class="hs-identifier hs-var">bytes</span></a></span><span> </span><span class="annot"><span class="annottext">Either [Char] [PEM]
-&gt; ([PEM] -&gt; Either [Char] ByteString) -&gt; Either [Char] ByteString
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-497"></span><span>            </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Either [Char] ByteString
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="hs-string">&quot;no PEM encoded object found.&quot;</span></span><span>
</span><span id="line-498"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621681476886"><span class="annot"><span class="annottext">h :: PEM
</span><a href="#local-6989586621681476886"><span class="hs-identifier hs-var">h</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Either [Char] ByteString
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; Either [Char] ByteString)
-&gt; ByteString -&gt; Either [Char] ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PEM -&gt; ByteString
</span><span class="hs-identifier hs-var hs-var">pemContent</span></span><span> </span><span class="annot"><span class="annottext">PEM
</span><a href="#local-6989586621681476886"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-499"></span><span>        </span><span class="annot"><span class="annottext">ByteString -&gt; Either [Char] (SignedExact Certificate)
forall a.
(Show a, Eq a, ASN1Object a) =&gt;
ByteString -&gt; Either [Char] (SignedExact a)
</span><span class="hs-identifier hs-var">decodeSignedObject</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621681476887"><span class="hs-identifier hs-var">der</span></a></span><span>
</span><span id="line-500"></span><span>
</span><span id="line-501"></span><span id="local-6989586621681477328"><span class="annot"><a href="Network.X509.SelfSigned.html#fingerprintPem"><span class="hs-identifier hs-type">fingerprintPem</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadThrow</span></span><span> </span><span class="annot"><a href="#local-6989586621681477328"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#X509CertPem"><span class="hs-identifier hs-type">X509CertPem</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681477328"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Fingerprint</span></span></span><span>
</span><span id="line-502"></span><span id="fingerprintPem"><span class="annot"><span class="annottext">fingerprintPem :: X509CertPem -&gt; m Fingerprint
</span><a href="Network.X509.SelfSigned.html#fingerprintPem"><span class="hs-identifier hs-var hs-var">fingerprintPem</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SignedExact Certificate -&gt; Fingerprint)
-&gt; m (SignedExact Certificate) -&gt; m Fingerprint
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">SignedExact Certificate -&gt; Fingerprint
</span><a href="Network.X509.SelfSigned.html#fingerprint"><span class="hs-identifier hs-var">fingerprint</span></a></span><span> </span><span class="annot"><span class="annottext">(m (SignedExact Certificate) -&gt; m Fingerprint)
-&gt; (X509CertPem -&gt; m (SignedExact Certificate))
-&gt; X509CertPem
-&gt; m Fingerprint
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">X509CertPem -&gt; m (SignedExact Certificate)
forall (m :: * -&gt; *).
MonadThrow m =&gt;
X509CertPem -&gt; m (SignedExact Certificate)
</span><a href="Network.X509.SelfSigned.html#decodePemX509Cert"><span class="hs-identifier hs-var">decodePemX509Cert</span></a></span><span>
</span><span id="line-503"></span><span>
</span><span id="line-504"></span><span class="annot"><a href="Network.X509.SelfSigned.html#unsafeFingerprintPem"><span class="hs-identifier hs-type">unsafeFingerprintPem</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#X509CertPem"><span class="hs-identifier hs-type">X509CertPem</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Fingerprint</span></span><span>
</span><span id="line-505"></span><span id="unsafeFingerprintPem"><span class="annot"><span class="annottext">unsafeFingerprintPem :: X509CertPem -&gt; Fingerprint
</span><a href="Network.X509.SelfSigned.html#unsafeFingerprintPem"><span class="hs-identifier hs-var hs-var">unsafeFingerprintPem</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SomeException -&gt; Fingerprint)
-&gt; (Fingerprint -&gt; Fingerprint)
-&gt; Either SomeException Fingerprint
-&gt; Fingerprint
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><span class="hs-identifier hs-var">either</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; Fingerprint
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; Fingerprint)
-&gt; (SomeException -&gt; [Char]) -&gt; SomeException -&gt; Fingerprint
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SomeException -&gt; [Char]
forall a b. (Show a, IsString b) =&gt; a -&gt; b
</span><a href="Chainweb.Utils.html#sshow"><span class="hs-identifier hs-var">sshow</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Fingerprint -&gt; Fingerprint
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="annot"><span class="annottext">(Either SomeException Fingerprint -&gt; Fingerprint)
-&gt; (X509CertPem -&gt; Either SomeException Fingerprint)
-&gt; X509CertPem
-&gt; Fingerprint
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">X509CertPem -&gt; Either SomeException Fingerprint
forall (m :: * -&gt; *). MonadThrow m =&gt; X509CertPem -&gt; m Fingerprint
</span><a href="Network.X509.SelfSigned.html#fingerprintPem"><span class="hs-identifier hs-var">fingerprintPem</span></a></span><span>
</span><span id="line-506"></span><span>
</span><span id="line-507"></span><span class="annot"><a href="Network.X509.SelfSigned.html#encodeCertDer"><span class="hs-identifier hs-type">encodeCertDer</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SignedExact</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Certificate</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span>
</span><span id="line-508"></span><span id="encodeCertDer"><span class="annot"><span class="annottext">encodeCertDer :: SignedExact Certificate -&gt; ByteString
</span><a href="Network.X509.SelfSigned.html#encodeCertDer"><span class="hs-identifier hs-var hs-var">encodeCertDer</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SignedExact Certificate -&gt; ByteString
forall a.
(Show a, Eq a, ASN1Object a) =&gt;
SignedExact a -&gt; ByteString
</span><span class="hs-identifier hs-var hs-var">encodeSignedObject</span></span><span>
</span><span id="line-509"></span><span>
</span><span id="line-510"></span><span class="annot"><a href="Network.X509.SelfSigned.html#encodeCertPem"><span class="hs-identifier hs-type">encodeCertPem</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SignedExact</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Certificate</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#X509CertPem"><span class="hs-identifier hs-type">X509CertPem</span></a></span><span>
</span><span id="line-511"></span><span id="encodeCertPem"><span class="annot"><span class="annottext">encodeCertPem :: SignedExact Certificate -&gt; X509CertPem
</span><a href="Network.X509.SelfSigned.html#encodeCertPem"><span class="hs-identifier hs-var hs-var">encodeCertPem</span></a></span></span><span> </span><span id="local-6989586621681476879"><span class="annot"><span class="annottext">c :: SignedExact Certificate
</span><a href="#local-6989586621681476879"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; X509CertPem
</span><a href="Network.X509.SelfSigned.html#X509CertPem"><span class="hs-identifier hs-var">X509CertPem</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; X509CertPem)
-&gt; (PEM -&gt; ByteString) -&gt; PEM -&gt; X509CertPem
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">PEM -&gt; ByteString
</span><span class="hs-identifier hs-var">pemWriteBS</span></span><span> </span><span class="annot"><span class="annottext">(PEM -&gt; X509CertPem) -&gt; PEM -&gt; X509CertPem
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PEM :: [Char] -&gt; [([Char], ByteString)] -&gt; ByteString -&gt; PEM
</span><span class="hs-identifier hs-type hs-type">PEM</span></span><span>
</span><span id="line-512"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">pemName :: [Char]
</span><span class="hs-identifier hs-var">pemName</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-string">&quot;CERTIFICATE&quot;</span></span><span>
</span><span id="line-513"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">pemHeader :: [([Char], ByteString)]
</span><span class="hs-identifier hs-var">pemHeader</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-514"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">pemContent :: ByteString
</span><span class="hs-identifier hs-var">pemContent</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SignedExact Certificate -&gt; ByteString
</span><a href="Network.X509.SelfSigned.html#encodeCertDer"><span class="hs-identifier hs-var">encodeCertDer</span></a></span><span> </span><span class="annot"><span class="annottext">SignedExact Certificate
</span><a href="#local-6989586621681476879"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-515"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-516"></span><span>
</span><span id="line-517"></span><span class="annot"><a href="Network.X509.SelfSigned.html#encodeEcSignatureDer"><span class="hs-identifier hs-type">encodeEcSignatureDer</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">EC.Signature</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span>
</span><span id="line-518"></span><span id="encodeEcSignatureDer"><span class="annot"><span class="annottext">encodeEcSignatureDer :: Signature -&gt; ByteString
</span><a href="Network.X509.SelfSigned.html#encodeEcSignatureDer"><span class="hs-identifier hs-var hs-var">encodeEcSignatureDer</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">EC.Signature</span></span><span> </span><span id="local-6989586621681476873"><span class="annot"><span class="annottext">r :: Integer
</span><a href="#local-6989586621681476873"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621681476872"><span class="annot"><span class="annottext">s :: Integer
</span><a href="#local-6989586621681476872"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DER -&gt; [ASN1] -&gt; ByteString
forall a. ASN1Encoding a =&gt; a -&gt; [ASN1] -&gt; ByteString
</span><span class="hs-identifier hs-var">encodeASN1'</span></span><span> </span><span class="annot"><span class="annottext">DER
</span><span class="hs-identifier hs-var">DER</span></span><span>
</span><span id="line-519"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">ASN1ConstructionType -&gt; ASN1
</span><span class="hs-identifier hs-var">Start</span></span><span> </span><span class="annot"><span class="annottext">ASN1ConstructionType
</span><span class="hs-identifier hs-var">Sequence</span></span><span>
</span><span id="line-520"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; ASN1
</span><span class="hs-identifier hs-var">IntVal</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621681476873"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-521"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; ASN1
</span><span class="hs-identifier hs-var">IntVal</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621681476872"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-522"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ASN1ConstructionType -&gt; ASN1
</span><span class="hs-identifier hs-var">End</span></span><span> </span><span class="annot"><span class="annottext">ASN1ConstructionType
</span><span class="hs-identifier hs-var">Sequence</span></span><span>
</span><span id="line-523"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-524"></span><span>
</span><span id="line-525"></span><span class="hs-comment">-- -------------------------------------------------------------------------- --</span><span>
</span><span id="line-526"></span><span class="hs-comment">-- PEM Encoded Key</span><span>
</span><span id="line-527"></span><span>
</span><span id="line-528"></span><span id="local-6989586621681476865"><span id="local-6989586621681476866"></span></span><span class="hs-keyword">newtype</span><span> </span><span id="X509KeyPem"><span class="annot"><a href="Network.X509.SelfSigned.html#X509KeyPem"><span class="hs-identifier hs-var">X509KeyPem</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="X509KeyPem"><span class="annot"><a href="Network.X509.SelfSigned.html#X509KeyPem"><span class="hs-identifier hs-var">X509KeyPem</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span>
</span><span id="line-529"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681476858"><span id="local-6989586621681476860"><span id="local-6989586621681476862"><span class="annot"><span class="annottext">Int -&gt; X509KeyPem -&gt; [Char] -&gt; [Char]
[X509KeyPem] -&gt; [Char] -&gt; [Char]
X509KeyPem -&gt; [Char]
(Int -&gt; X509KeyPem -&gt; [Char] -&gt; [Char])
-&gt; (X509KeyPem -&gt; [Char])
-&gt; ([X509KeyPem] -&gt; [Char] -&gt; [Char])
-&gt; Show X509KeyPem
forall a.
(Int -&gt; a -&gt; [Char] -&gt; [Char])
-&gt; (a -&gt; [Char]) -&gt; ([a] -&gt; [Char] -&gt; [Char]) -&gt; Show a
showList :: [X509KeyPem] -&gt; [Char] -&gt; [Char]
$cshowList :: [X509KeyPem] -&gt; [Char] -&gt; [Char]
show :: X509KeyPem -&gt; [Char]
$cshow :: X509KeyPem -&gt; [Char]
showsPrec :: Int -&gt; X509KeyPem -&gt; [Char] -&gt; [Char]
$cshowsPrec :: Int -&gt; X509KeyPem -&gt; [Char] -&gt; [Char]
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681476854"><span id="local-6989586621681476856"><span class="annot"><span class="annottext">X509KeyPem -&gt; X509KeyPem -&gt; Bool
(X509KeyPem -&gt; X509KeyPem -&gt; Bool)
-&gt; (X509KeyPem -&gt; X509KeyPem -&gt; Bool) -&gt; Eq X509KeyPem
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: X509KeyPem -&gt; X509KeyPem -&gt; Bool
$c/= :: X509KeyPem -&gt; X509KeyPem -&gt; Bool
== :: X509KeyPem -&gt; X509KeyPem -&gt; Bool
$c== :: X509KeyPem -&gt; X509KeyPem -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681476839"><span id="local-6989586621681476841"><span id="local-6989586621681476843"><span id="local-6989586621681476845"><span id="local-6989586621681476847"><span id="local-6989586621681476849"><span id="local-6989586621681476851"><span class="annot"><span class="annottext">Eq X509KeyPem
Eq X509KeyPem =&gt;
(X509KeyPem -&gt; X509KeyPem -&gt; Ordering)
-&gt; (X509KeyPem -&gt; X509KeyPem -&gt; Bool)
-&gt; (X509KeyPem -&gt; X509KeyPem -&gt; Bool)
-&gt; (X509KeyPem -&gt; X509KeyPem -&gt; Bool)
-&gt; (X509KeyPem -&gt; X509KeyPem -&gt; Bool)
-&gt; (X509KeyPem -&gt; X509KeyPem -&gt; X509KeyPem)
-&gt; (X509KeyPem -&gt; X509KeyPem -&gt; X509KeyPem)
-&gt; Ord X509KeyPem
X509KeyPem -&gt; X509KeyPem -&gt; Bool
X509KeyPem -&gt; X509KeyPem -&gt; Ordering
X509KeyPem -&gt; X509KeyPem -&gt; X509KeyPem
forall a.
Eq a =&gt;
(a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
min :: X509KeyPem -&gt; X509KeyPem -&gt; X509KeyPem
$cmin :: X509KeyPem -&gt; X509KeyPem -&gt; X509KeyPem
max :: X509KeyPem -&gt; X509KeyPem -&gt; X509KeyPem
$cmax :: X509KeyPem -&gt; X509KeyPem -&gt; X509KeyPem
&gt;= :: X509KeyPem -&gt; X509KeyPem -&gt; Bool
$c&gt;= :: X509KeyPem -&gt; X509KeyPem -&gt; Bool
&gt; :: X509KeyPem -&gt; X509KeyPem -&gt; Bool
$c&gt; :: X509KeyPem -&gt; X509KeyPem -&gt; Bool
&lt;= :: X509KeyPem -&gt; X509KeyPem -&gt; Bool
$c&lt;= :: X509KeyPem -&gt; X509KeyPem -&gt; Bool
&lt; :: X509KeyPem -&gt; X509KeyPem -&gt; Bool
$c&lt; :: X509KeyPem -&gt; X509KeyPem -&gt; Bool
compare :: X509KeyPem -&gt; X509KeyPem -&gt; Ordering
$ccompare :: X509KeyPem -&gt; X509KeyPem -&gt; Ordering
$cp1Ord :: Eq X509KeyPem
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(forall x. X509KeyPem -&gt; Rep X509KeyPem x)
-&gt; (forall x. Rep X509KeyPem x -&gt; X509KeyPem) -&gt; Generic X509KeyPem
forall x. Rep X509KeyPem x -&gt; X509KeyPem
forall x. X509KeyPem -&gt; Rep X509KeyPem x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep X509KeyPem x -&gt; X509KeyPem
$cfrom :: forall x. X509KeyPem -&gt; Rep X509KeyPem x
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></span><span class="hs-special">)</span><span>
</span><span id="line-530"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">anyclass</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681476833"><span id="local-6989586621681476835"><span class="annot"><span class="annottext">Int -&gt; X509KeyPem -&gt; Int
X509KeyPem -&gt; Int
(Int -&gt; X509KeyPem -&gt; Int)
-&gt; (X509KeyPem -&gt; Int) -&gt; Hashable X509KeyPem
forall a. (Int -&gt; a -&gt; Int) -&gt; (a -&gt; Int) -&gt; Hashable a
hash :: X509KeyPem -&gt; Int
$chash :: X509KeyPem -&gt; Int
hashWithSalt :: Int -&gt; X509KeyPem -&gt; Int
$chashWithSalt :: Int -&gt; X509KeyPem -&gt; Int
</span><a href="#local-6989586621681476833"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Hashable</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681476831"><span class="annot"><span class="annottext">X509KeyPem -&gt; ()
(X509KeyPem -&gt; ()) -&gt; NFData X509KeyPem
forall a. (a -&gt; ()) -&gt; NFData a
rnf :: X509KeyPem -&gt; ()
$crnf :: X509KeyPem -&gt; ()
</span><a href="#local-6989586621681476831"><span class="hs-identifier hs-var hs-var hs-var hs-var">NFData</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-531"></span><span>
</span><span id="line-532"></span><span class="annot"><a href="Network.X509.SelfSigned.html#x509KeyPemToText"><span class="hs-identifier hs-type">x509KeyPemToText</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#X509KeyPem"><span class="hs-identifier hs-type">X509KeyPem</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span>
</span><span id="line-533"></span><span id="x509KeyPemToText"><span class="annot"><span class="annottext">x509KeyPemToText :: X509KeyPem -&gt; Text
</span><a href="Network.X509.SelfSigned.html#x509KeyPemToText"><span class="hs-identifier hs-var hs-var">x509KeyPemToText</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.X509.SelfSigned.html#X509KeyPem"><span class="hs-identifier hs-type">X509KeyPem</span></a></span><span> </span><span id="local-6989586621681476830"><span class="annot"><span class="annottext">b :: ByteString
</span><a href="#local-6989586621681476830"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Text
</span><span class="hs-identifier hs-var">T.decodeUtf8</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621681476830"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-534"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#x509KeyPemToText"><span class="hs-pragma hs-type">x509KeyPemToText</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-535"></span><span>
</span><span id="line-536"></span><span id="local-6989586621681477317"><span class="annot"><a href="Network.X509.SelfSigned.html#x509KeyPemFromText"><span class="hs-identifier hs-type">x509KeyPemFromText</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadThrow</span></span><span> </span><span class="annot"><a href="#local-6989586621681477317"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681477317"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#X509KeyPem"><span class="hs-identifier hs-type">X509KeyPem</span></a></span></span><span>
</span><span id="line-537"></span><span id="x509KeyPemFromText"><span class="annot"><span class="annottext">x509KeyPemFromText :: Text -&gt; m X509KeyPem
</span><a href="Network.X509.SelfSigned.html#x509KeyPemFromText"><span class="hs-identifier hs-var hs-var">x509KeyPemFromText</span></a></span></span><span> </span><span id="local-6989586621681476829"><span class="annot"><span class="annottext">t :: Text
</span><a href="#local-6989586621681476829"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">X509KeyPem -&gt; m X509KeyPem
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(X509KeyPem -&gt; m X509KeyPem)
-&gt; (ByteString -&gt; X509KeyPem) -&gt; ByteString -&gt; m X509KeyPem
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; X509KeyPem
</span><a href="Network.X509.SelfSigned.html#X509KeyPem"><span class="hs-identifier hs-var">X509KeyPem</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; m X509KeyPem) -&gt; ByteString -&gt; m X509KeyPem
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; ByteString
</span><span class="hs-identifier hs-var">T.encodeUtf8</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621681476829"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-538"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#x509KeyPemFromText"><span class="hs-pragma hs-type">x509KeyPemFromText</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-539"></span><span>
</span><span id="line-540"></span><span class="annot"><a href="Network.X509.SelfSigned.html#unsafeX509KeyPemFromText"><span class="hs-identifier hs-type">unsafeX509KeyPemFromText</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#X509KeyPem"><span class="hs-identifier hs-type">X509KeyPem</span></a></span><span>
</span><span id="line-541"></span><span id="unsafeX509KeyPemFromText"><span class="annot"><span class="annottext">unsafeX509KeyPemFromText :: [Char] -&gt; X509KeyPem
</span><a href="Network.X509.SelfSigned.html#unsafeX509KeyPemFromText"><span class="hs-identifier hs-var hs-var">unsafeX509KeyPemFromText</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe X509KeyPem -&gt; X509KeyPem
forall a. HasCallStack =&gt; Maybe a -&gt; a
</span><a href="Chainweb.Utils.html#fromJuste"><span class="hs-identifier hs-var">fromJuste</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe X509KeyPem -&gt; X509KeyPem)
-&gt; ([Char] -&gt; Maybe X509KeyPem) -&gt; [Char] -&gt; X509KeyPem
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Maybe X509KeyPem
forall (m :: * -&gt; *). MonadThrow m =&gt; Text -&gt; m X509KeyPem
</span><a href="Network.X509.SelfSigned.html#x509KeyPemFromText"><span class="hs-identifier hs-var">x509KeyPemFromText</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Maybe X509KeyPem)
-&gt; ([Char] -&gt; Text) -&gt; [Char] -&gt; Maybe X509KeyPem
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span>
</span><span id="line-542"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#unsafeX509KeyPemFromText"><span class="hs-pragma hs-type">unsafeX509KeyPemFromText</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-543"></span><span>
</span><span id="line-544"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Chainweb.Utils.html#HasTextRepresentation"><span class="hs-identifier hs-type">HasTextRepresentation</span></a></span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#X509KeyPem"><span class="hs-identifier hs-type">X509KeyPem</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-545"></span><span>    </span><span id="local-6989586621681476826"><span class="annot"><span class="annottext">toText :: X509KeyPem -&gt; Text
</span><a href="#local-6989586621681476826"><span class="hs-identifier hs-var hs-var hs-var hs-var">toText</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">X509KeyPem -&gt; Text
</span><a href="Network.X509.SelfSigned.html#x509KeyPemToText"><span class="hs-identifier hs-var">x509KeyPemToText</span></a></span><span>
</span><span id="line-546"></span><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Chainweb.Utils.html#toText"><span class="hs-pragma hs-type">toText</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-547"></span><span>    </span><span id="local-6989586621681476825"><span class="annot"><span class="annottext">fromText :: Text -&gt; m X509KeyPem
</span><a href="#local-6989586621681476825"><span class="hs-identifier hs-var hs-var hs-var hs-var">fromText</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; m X509KeyPem
forall (m :: * -&gt; *). MonadThrow m =&gt; Text -&gt; m X509KeyPem
</span><a href="Network.X509.SelfSigned.html#x509KeyPemFromText"><span class="hs-identifier hs-var">x509KeyPemFromText</span></a></span><span>
</span><span id="line-548"></span><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Chainweb.Utils.html#fromText"><span class="hs-pragma hs-type">fromText</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-549"></span><span>
</span><span id="line-550"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681476818"><span id="local-6989586621681476820"><span id="local-6989586621681476822"><span class="annot"><span class="hs-identifier hs-type">ToJSON</span></span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#X509KeyPem"><span class="hs-identifier hs-type">X509KeyPem</span></a></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-551"></span><span>    </span><span id="local-6989586621681476817"><span class="annot"><span class="annottext">toJSON :: X509KeyPem -&gt; Value
</span><a href="#local-6989586621681476817"><span class="hs-identifier hs-var hs-var hs-var hs-var">toJSON</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Value
forall a. ToJSON a =&gt; a -&gt; Value
</span><span class="hs-identifier hs-var">toJSON</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Value) -&gt; (X509KeyPem -&gt; Text) -&gt; X509KeyPem -&gt; Value
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">X509KeyPem -&gt; Text
forall a. HasTextRepresentation a =&gt; a -&gt; Text
</span><a href="Chainweb.Utils.html#toText"><span class="hs-identifier hs-var">toText</span></a></span><span>
</span><span id="line-552"></span><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><span class="hs-pragma hs-type">toJSON</span></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-553"></span><span>
</span><span id="line-554"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681476814"><span class="annot"><span class="hs-identifier hs-type">FromJSON</span></span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#X509KeyPem"><span class="hs-identifier hs-type">X509KeyPem</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-555"></span><span>    </span><span id="local-6989586621681476813"><span class="annot"><span class="annottext">parseJSON :: Value -&gt; Parser X509KeyPem
</span><a href="#local-6989586621681476813"><span class="hs-identifier hs-var hs-var hs-var hs-var">parseJSON</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Value -&gt; Parser X509KeyPem
forall a. HasTextRepresentation a =&gt; [Char] -&gt; Value -&gt; Parser a
</span><a href="Chainweb.Utils.html#parseJsonFromText"><span class="hs-identifier hs-var">parseJsonFromText</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;X509KeyPem&quot;</span></span><span>
</span><span id="line-556"></span><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><span class="hs-pragma hs-type">parseJSON</span></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-557"></span><span>
</span><span id="line-558"></span><span class="annot"><a href="Network.X509.SelfSigned.html#pX509KeyPem"><span class="hs-identifier hs-type">pX509KeyPem</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Chainweb.Utils.html#OptionParser"><span class="hs-identifier hs-type">OptionParser</span></a></span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#X509KeyPem"><span class="hs-identifier hs-type">X509KeyPem</span></a></span><span>
</span><span id="line-559"></span><span id="pX509KeyPem"><span class="annot"><span class="annottext">pX509KeyPem :: Maybe [Char] -&gt; OptionParser X509KeyPem
</span><a href="Network.X509.SelfSigned.html#pX509KeyPem"><span class="hs-identifier hs-var hs-var">pX509KeyPem</span></a></span></span><span> </span><span id="local-6989586621681476812"><span class="annot"><span class="annottext">service :: Maybe [Char]
</span><a href="#local-6989586621681476812"><span class="hs-identifier hs-var">service</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Mod OptionFields X509KeyPem -&gt; OptionParser X509KeyPem
forall a. HasTextRepresentation a =&gt; Mod OptionFields a -&gt; Parser a
</span><a href="Chainweb.Utils.html#textOption"><span class="hs-identifier hs-var">textOption</span></a></span><span>
</span><span id="line-560"></span><span>    </span><span class="annot"><span class="annottext">(Mod OptionFields X509KeyPem -&gt; OptionParser X509KeyPem)
-&gt; Mod OptionFields X509KeyPem -&gt; OptionParser X509KeyPem
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">Maybe [Char] -&gt; [Char] -&gt; Mod OptionFields X509KeyPem
forall (f :: * -&gt; *) a.
HasName f =&gt;
Maybe [Char] -&gt; [Char] -&gt; Mod f a
</span><a href="Chainweb.Utils.html#prefixLong"><span class="hs-identifier hs-var">prefixLong</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe [Char]
</span><a href="#local-6989586621681476812"><span class="hs-identifier hs-var">service</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;key&quot;</span></span><span>
</span><span id="line-561"></span><span>    </span><span class="annot"><span class="annottext">Mod OptionFields X509KeyPem
-&gt; Mod OptionFields X509KeyPem -&gt; Mod OptionFields X509KeyPem
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe [Char] -&gt; [Char] -&gt; Mod OptionFields X509KeyPem
forall (f :: * -&gt; *) a. Maybe [Char] -&gt; [Char] -&gt; Mod f a
</span><a href="Chainweb.Utils.html#suffixHelp"><span class="hs-identifier hs-var">suffixHelp</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe [Char]
</span><a href="#local-6989586621681476812"><span class="hs-identifier hs-var">service</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;PEM encoded X509 certificate key of the local peer&quot;</span></span><span>
</span><span id="line-562"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#pX509KeyPem"><span class="hs-pragma hs-type">pX509KeyPem</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-563"></span><span>
</span><span id="line-564"></span><span id="local-6989586621681477311"><span class="annot"><a href="Network.X509.SelfSigned.html#encodeKeyDer"><span class="hs-identifier hs-type">encodeKeyDer</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#X509Key"><span class="hs-identifier hs-type">X509Key</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681477311"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681477311"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span></span><span>
</span><span id="line-565"></span><span id="encodeKeyDer"><span class="annot"><span class="annottext">encodeKeyDer :: k -&gt; ByteString
</span><a href="Network.X509.SelfSigned.html#encodeKeyDer"><span class="hs-identifier hs-var hs-var">encodeKeyDer</span></a></span></span><span> </span><span id="local-6989586621681476810"><span class="annot"><span class="annottext">sk :: k
</span><a href="#local-6989586621681476810"><span class="hs-identifier hs-var">sk</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DER -&gt; [ASN1] -&gt; ByteString
forall a. ASN1Encoding a =&gt; a -&gt; [ASN1] -&gt; ByteString
</span><span class="hs-identifier hs-var">encodeASN1'</span></span><span> </span><span class="annot"><span class="annottext">DER
</span><span class="hs-identifier hs-var">DER</span></span><span> </span><span class="annot"><span class="annottext">([ASN1] -&gt; ByteString) -&gt; [ASN1] -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrivKey -&gt; ASN1S
forall a. ASN1Object a =&gt; a -&gt; ASN1S
</span><span class="hs-identifier hs-var">toASN1</span></span><span> </span><span class="annot"><span class="annottext">(PrivKey -&gt; ASN1S) -&gt; PrivKey -&gt; ASN1S
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">k -&gt; PrivKey
forall k. X509Key k =&gt; k -&gt; PrivKey
</span><a href="Network.X509.SelfSigned.html#getPrivKey"><span class="hs-identifier hs-var">getPrivKey</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621681476810"><span class="hs-identifier hs-var">sk</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-566"></span><span>
</span><span id="line-567"></span><span class="annot"><a href="Network.X509.SelfSigned.html#encodeKeyPem"><span class="hs-identifier hs-type">encodeKeyPem</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621681477287"><span class="annot"><a href="#local-6989586621681477287"><span class="hs-identifier hs-type">k</span></a></span></span><span> </span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#X509Key"><span class="hs-identifier hs-type">X509Key</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681477287"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681477287"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#X509KeyPem"><span class="hs-identifier hs-type">X509KeyPem</span></a></span><span>
</span><span id="line-568"></span><span id="encodeKeyPem"><span class="annot"><span class="annottext">encodeKeyPem :: k -&gt; X509KeyPem
</span><a href="Network.X509.SelfSigned.html#encodeKeyPem"><span class="hs-identifier hs-var hs-var">encodeKeyPem</span></a></span></span><span> </span><span id="local-6989586621681476807"><span class="annot"><span class="annottext">sk :: k
</span><a href="#local-6989586621681476807"><span class="hs-identifier hs-var">sk</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; X509KeyPem
</span><a href="Network.X509.SelfSigned.html#X509KeyPem"><span class="hs-identifier hs-var">X509KeyPem</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; X509KeyPem)
-&gt; (PEM -&gt; ByteString) -&gt; PEM -&gt; X509KeyPem
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">PEM -&gt; ByteString
</span><span class="hs-identifier hs-var">pemWriteBS</span></span><span> </span><span class="annot"><span class="annottext">(PEM -&gt; X509KeyPem) -&gt; PEM -&gt; X509KeyPem
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PEM :: [Char] -&gt; [([Char], ByteString)] -&gt; ByteString -&gt; PEM
</span><span class="hs-identifier hs-type hs-type">PEM</span></span><span>
</span><span id="line-569"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">pemName :: [Char]
</span><span class="hs-identifier hs-var">pemName</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">X509Key k =&gt; [Char]
forall k. X509Key k =&gt; [Char]
</span><a href="Network.X509.SelfSigned.html#pemKeyHeader"><span class="hs-identifier hs-var">pemKeyHeader</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621681477287"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-570"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">pemHeader :: [([Char], ByteString)]
</span><span class="hs-identifier hs-var">pemHeader</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-571"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">pemContent :: ByteString
</span><span class="hs-identifier hs-var">pemContent</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">k -&gt; ByteString
forall k. X509Key k =&gt; k -&gt; ByteString
</span><a href="Network.X509.SelfSigned.html#encodeKeyDer"><span class="hs-identifier hs-var">encodeKeyDer</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621681476807"><span class="hs-identifier hs-var">sk</span></a></span><span>
</span><span id="line-572"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-573"></span><span>
</span><span id="line-574"></span><span id="local-6989586621681476806"><span class="annot"><a href="Network.X509.SelfSigned.html#validateX509KeyPem"><span class="hs-identifier hs-type">validateX509KeyPem</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span> </span><span class="annot"><a href="#local-6989586621681476806"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#X509KeyPem"><span class="hs-identifier hs-type">X509KeyPem</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681476806"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-575"></span><span id="validateX509KeyPem"><span class="annot"><span class="annottext">validateX509KeyPem :: X509KeyPem -&gt; m ()
</span><a href="Network.X509.SelfSigned.html#validateX509KeyPem"><span class="hs-identifier hs-var hs-var">validateX509KeyPem</span></a></span></span><span> </span><span id="local-6989586621681476805"><span class="annot"><span class="annottext">pemKey :: X509KeyPem
</span><a href="#local-6989586621681476805"><span class="hs-identifier hs-var">pemKey</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-576"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">X509KeyPem -&gt; Either SomeException PrivKey
forall (m :: * -&gt; *). MonadThrow m =&gt; X509KeyPem -&gt; m PrivKey
</span><a href="Network.X509.SelfSigned.html#decodePemX509Key"><span class="hs-identifier hs-var">decodePemX509Key</span></a></span><span> </span><span class="annot"><span class="annottext">X509KeyPem
</span><a href="#local-6989586621681476805"><span class="hs-identifier hs-var">pemKey</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-577"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621681476804"><span class="annot"><span class="annottext">e :: SomeException
</span><a href="#local-6989586621681476804"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; m ()
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; m ()) -&gt; Text -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SomeException -&gt; Text
forall a b. (Show a, IsString b) =&gt; a -&gt; b
</span><a href="Chainweb.Utils.html#sshow"><span class="hs-identifier hs-var">sshow</span></a></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621681476804"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-578"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; m ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-579"></span><span>
</span><span id="line-580"></span><span id="local-6989586621681477309"><span class="annot"><a href="Network.X509.SelfSigned.html#decodePemX509Key"><span class="hs-identifier hs-type">decodePemX509Key</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadThrow</span></span><span> </span><span class="annot"><a href="#local-6989586621681477309"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#X509KeyPem"><span class="hs-identifier hs-type">X509KeyPem</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681477309"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">PrivKey</span></span></span><span>
</span><span id="line-581"></span><span id="decodePemX509Key"><span class="annot"><span class="annottext">decodePemX509Key :: X509KeyPem -&gt; m PrivKey
</span><a href="Network.X509.SelfSigned.html#decodePemX509Key"><span class="hs-identifier hs-var hs-var">decodePemX509Key</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.X509.SelfSigned.html#X509KeyPem"><span class="hs-identifier hs-type">X509KeyPem</span></a></span><span> </span><span id="local-6989586621681476803"><span class="annot"><span class="annottext">bytes :: ByteString
</span><a href="#local-6989586621681476803"><span class="hs-identifier hs-var">bytes</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-582"></span><span>    </span><span class="annot"><span class="annottext">([Char] -&gt; m PrivKey)
-&gt; (PrivKey -&gt; m PrivKey) -&gt; Either [Char] PrivKey -&gt; m PrivKey
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><span class="hs-identifier hs-var">either</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EncodingException -&gt; m PrivKey
forall (m :: * -&gt; *) e a. (MonadThrow m, Exception e) =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwM</span></span><span> </span><span class="annot"><span class="annottext">(EncodingException -&gt; m PrivKey)
-&gt; ([Char] -&gt; EncodingException) -&gt; [Char] -&gt; m PrivKey
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; EncodingException
</span><a href="Chainweb.Utils.html#X509KeyDecodeException"><span class="hs-identifier hs-var">X509KeyDecodeException</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; EncodingException)
-&gt; ([Char] -&gt; Text) -&gt; [Char] -&gt; EncodingException
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PrivKey -&gt; m PrivKey
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Either [Char] PrivKey -&gt; m PrivKey)
-&gt; Either [Char] PrivKey -&gt; m PrivKey
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-583"></span><span>        </span><span id="local-6989586621681476801"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621681476801"><span class="hs-identifier hs-var">der</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Either [Char] [PEM]
</span><span class="hs-identifier hs-var">pemParseBS</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621681476803"><span class="hs-identifier hs-var">bytes</span></a></span><span> </span><span class="annot"><span class="annottext">Either [Char] [PEM]
-&gt; ([PEM] -&gt; Either [Char] ByteString) -&gt; Either [Char] ByteString
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-584"></span><span>            </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Either [Char] ByteString
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="hs-string">&quot;no PEM encoded object found.&quot;</span></span><span>
</span><span id="line-585"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621681476800"><span class="annot"><span class="annottext">h :: PEM
</span><a href="#local-6989586621681476800"><span class="hs-identifier hs-var">h</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Either [Char] ByteString
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; Either [Char] ByteString)
-&gt; ByteString -&gt; Either [Char] ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PEM -&gt; ByteString
</span><span class="hs-identifier hs-var hs-var">pemContent</span></span><span> </span><span class="annot"><span class="annottext">PEM
</span><a href="#local-6989586621681476800"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-586"></span><span>        </span><span id="local-6989586621681476799"><span class="annot"><span class="annottext">[ASN1]
</span><a href="#local-6989586621681476799"><span class="hs-identifier hs-var">asn1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ASN1Error -&gt; [Char])
-&gt; Either ASN1Error [ASN1] -&gt; Either [Char] [ASN1]
forall (p :: * -&gt; * -&gt; *) a b c.
Bifunctor p =&gt;
(a -&gt; b) -&gt; p a c -&gt; p b c
</span><span class="hs-identifier hs-var">first</span></span><span> </span><span class="annot"><span class="annottext">ASN1Error -&gt; [Char]
forall a b. (Show a, IsString b) =&gt; a -&gt; b
</span><a href="Chainweb.Utils.html#sshow"><span class="hs-identifier hs-var">sshow</span></a></span><span> </span><span class="annot"><span class="annottext">(Either ASN1Error [ASN1] -&gt; Either [Char] [ASN1])
-&gt; Either ASN1Error [ASN1] -&gt; Either [Char] [ASN1]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">DER -&gt; ByteString -&gt; Either ASN1Error [ASN1]
forall a.
ASN1Decoding a =&gt;
a -&gt; ByteString -&gt; Either ASN1Error [ASN1]
</span><span class="hs-identifier hs-var">decodeASN1'</span></span><span> </span><span class="annot"><span class="annottext">DER
</span><span class="hs-identifier hs-var">DER</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621681476801"><span class="hs-identifier hs-var">der</span></a></span><span>
</span><span id="line-587"></span><span>        </span><span class="annot"><span class="annottext">(PrivKey, [ASN1]) -&gt; PrivKey
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">((PrivKey, [ASN1]) -&gt; PrivKey)
-&gt; Either [Char] (PrivKey, [ASN1]) -&gt; Either [Char] PrivKey
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[ASN1] -&gt; Either [Char] (PrivKey, [ASN1])
forall a. ASN1Object a =&gt; [ASN1] -&gt; Either [Char] (a, [ASN1])
</span><span class="hs-identifier hs-var">fromASN1</span></span><span> </span><span class="annot"><span class="annottext">[ASN1]
</span><a href="#local-6989586621681476799"><span class="hs-identifier hs-var">asn1</span></a></span><span>
</span><span id="line-588"></span><span>
</span><span id="line-589"></span><span class="hs-comment">-- -------------------------------------------------------------------------- --</span><span>
</span><span id="line-590"></span><span class="hs-comment">-- Generate Self Signed Certificate</span><span>
</span><span id="line-591"></span><span>
</span><span id="line-592"></span><span class="hs-comment">-- | Generate a self-signed Certificate for a given distinguished name and</span><span>
</span><span id="line-593"></span><span class="hs-comment">-- optionally additional alternative names. Note, however, that for a most uses</span><span>
</span><span id="line-594"></span><span class="hs-comment">-- of a self-signed cerificate the names don't matter. Instead the certificate</span><span>
</span><span id="line-595"></span><span class="hs-comment">-- is authenticated by checking its fingerprint.</span><span>
</span><span id="line-596"></span><span class="hs-comment">--</span><span>
</span><span id="line-597"></span><span class="annot"><a href="Network.X509.SelfSigned.html#generateSelfSignedCertificate"><span class="hs-identifier hs-type">generateSelfSignedCertificate</span></a></span><span>
</span><span id="line-598"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621681477286"><span class="annot"><a href="#local-6989586621681477286"><span class="hs-identifier hs-type">k</span></a></span></span><span>
</span><span id="line-599"></span><span>    </span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#X509Key"><span class="hs-identifier hs-type">X509Key</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681477286"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-600"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Natural</span></span><span>
</span><span id="line-601"></span><span>        </span><span class="hs-comment">-- ^ days of validity</span><span>
</span><span id="line-602"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DistinguishedName</span></span><span>
</span><span id="line-603"></span><span>        </span><span class="hs-comment">-- ^ the subject of the certificate. This should include at least the CN</span><span>
</span><span id="line-604"></span><span>        </span><span class="hs-comment">-- name, which can be created with 'name'.</span><span>
</span><span id="line-605"></span><span>
</span><span id="line-606"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">NE.NonEmpty</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">AltName</span></span><span class="hs-special">)</span><span>
</span><span id="line-607"></span><span>        </span><span class="hs-comment">-- ^ For self-signed certificates it's usually fine to leave this empty.</span><span>
</span><span id="line-608"></span><span>        </span><span class="hs-comment">-- If it's not empty it should include the CN value from</span><span>
</span><span id="line-609"></span><span>        </span><span class="hs-comment">-- the distinguished name.</span><span>
</span><span id="line-610"></span><span>
</span><span id="line-611"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Fingerprint</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#X509CertPem"><span class="hs-identifier hs-type">X509CertPem</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#X509KeyPem"><span class="hs-identifier hs-type">X509KeyPem</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-612"></span><span id="generateSelfSignedCertificate"><span class="annot"><span class="annottext">generateSelfSignedCertificate :: Natural
-&gt; DistinguishedName
-&gt; Maybe (NonEmpty AltName)
-&gt; IO (Fingerprint, X509CertPem, X509KeyPem)
</span><a href="Network.X509.SelfSigned.html#generateSelfSignedCertificate"><span class="hs-identifier hs-var hs-var">generateSelfSignedCertificate</span></a></span></span><span> </span><span id="local-6989586621681476796"><span class="annot"><span class="annottext">days :: Natural
</span><a href="#local-6989586621681476796"><span class="hs-identifier hs-var">days</span></a></span></span><span> </span><span id="local-6989586621681476795"><span class="annot"><span class="annottext">dn :: DistinguishedName
</span><a href="#local-6989586621681476795"><span class="hs-identifier hs-var">dn</span></a></span></span><span> </span><span id="local-6989586621681476794"><span class="annot"><span class="annottext">altNames :: Maybe (NonEmpty AltName)
</span><a href="#local-6989586621681476794"><span class="hs-identifier hs-var">altNames</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-613"></span><span>    </span><span id="local-6989586621681476793"><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621681476793"><span class="hs-identifier hs-var">sk</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">X509Key k =&gt; IO k
forall k. X509Key k =&gt; IO k
</span><a href="Network.X509.SelfSigned.html#generateKey"><span class="hs-identifier hs-var">generateKey</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621681477286"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-614"></span><span>    </span><span id="local-6989586621681476792"><span class="annot"><span class="annottext">DateTime
</span><a href="#local-6989586621681476792"><span class="hs-identifier hs-var">start</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO DateTime
</span><span class="hs-identifier hs-var">dateCurrent</span></span><span>
</span><span id="line-615"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681476791"><span class="annot"><span class="annottext">end :: DateTime
</span><a href="#local-6989586621681476791"><span class="hs-identifier hs-var hs-var">end</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DateTime
</span><a href="#local-6989586621681476792"><span class="hs-identifier hs-var">start</span></a></span><span> </span><span class="annot"><span class="annottext">DateTime -&gt; Duration -&gt; DateTime
forall t ti. (Time t, TimeInterval ti) =&gt; t -&gt; ti -&gt; t
</span><span class="hs-operator hs-var">`timeAdd`</span></span><span> </span><span class="annot"><span class="annottext">Duration
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">durationHours :: Hours
</span><span class="hs-identifier hs-var">durationHours</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-number">24</span></span><span> </span><span class="annot"><span class="annottext">Hours -&gt; Hours -&gt; Hours
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Hours
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621681476796"><span class="hs-identifier hs-var">days</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-616"></span><span>        </span><span id="local-6989586621681476789"><span class="annot"><span class="annottext">c :: Certificate
</span><a href="#local-6989586621681476789"><span class="hs-identifier hs-var hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DateTime
-&gt; DateTime
-&gt; DistinguishedName
-&gt; DistinguishedName
-&gt; Maybe (NonEmpty AltName)
-&gt; PubKey
-&gt; Certificate
forall k.
X509Key k =&gt;
DateTime
-&gt; DateTime
-&gt; DistinguishedName
-&gt; DistinguishedName
-&gt; Maybe (NonEmpty AltName)
-&gt; PubKey
-&gt; Certificate
</span><a href="Network.X509.SelfSigned.html#makeCertificate"><span class="hs-identifier hs-var">makeCertificate</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621681477286"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">DateTime
</span><a href="#local-6989586621681476792"><span class="hs-identifier hs-var">start</span></a></span><span> </span><span class="annot"><span class="annottext">DateTime
</span><a href="#local-6989586621681476791"><span class="hs-identifier hs-var">end</span></a></span><span> </span><span class="annot"><span class="annottext">DistinguishedName
</span><a href="#local-6989586621681476795"><span class="hs-identifier hs-var">dn</span></a></span><span> </span><span class="annot"><span class="annottext">DistinguishedName
</span><a href="#local-6989586621681476795"><span class="hs-identifier hs-var">dn</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (NonEmpty AltName)
</span><a href="#local-6989586621681476794"><span class="hs-identifier hs-var">altNames</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">k -&gt; PubKey
forall k. X509Key k =&gt; k -&gt; PubKey
</span><a href="Network.X509.SelfSigned.html#getPubKey"><span class="hs-identifier hs-var">getPubKey</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621681476793"><span class="hs-identifier hs-var">sk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-617"></span><span>    </span><span id="local-6989586621681476788"><span class="annot"><span class="annottext">SignedExact Certificate
</span><a href="#local-6989586621681476788"><span class="hs-identifier hs-var">sc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">k -&gt; Certificate -&gt; IO (SignedExact Certificate)
forall k.
X509Key k =&gt;
k -&gt; Certificate -&gt; IO (SignedExact Certificate)
</span><a href="Network.X509.SelfSigned.html#signedCertIO"><span class="hs-identifier hs-var">signedCertIO</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621681476793"><span class="hs-identifier hs-var">sk</span></a></span><span> </span><span class="annot"><span class="annottext">Certificate
</span><a href="#local-6989586621681476789"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-618"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621681476787"><span class="annot"><span class="annottext">fp :: Fingerprint
</span><a href="#local-6989586621681476787"><span class="hs-identifier hs-var hs-var">fp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SignedExact Certificate -&gt; Fingerprint
</span><a href="Network.X509.SelfSigned.html#fingerprint"><span class="hs-identifier hs-var">fingerprint</span></a></span><span> </span><span class="annot"><span class="annottext">SignedExact Certificate
</span><a href="#local-6989586621681476788"><span class="hs-identifier hs-var">sc</span></a></span><span>
</span><span id="line-619"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621681476786"><span class="annot"><span class="annottext">cpem :: X509CertPem
</span><a href="#local-6989586621681476786"><span class="hs-identifier hs-var hs-var">cpem</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SignedExact Certificate -&gt; X509CertPem
</span><a href="Network.X509.SelfSigned.html#encodeCertPem"><span class="hs-identifier hs-var">encodeCertPem</span></a></span><span> </span><span class="annot"><span class="annottext">SignedExact Certificate
</span><a href="#local-6989586621681476788"><span class="hs-identifier hs-var">sc</span></a></span><span>
</span><span id="line-620"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621681476785"><span class="annot"><span class="annottext">kpem :: X509KeyPem
</span><a href="#local-6989586621681476785"><span class="hs-identifier hs-var hs-var">kpem</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">k -&gt; X509KeyPem
forall k. X509Key k =&gt; k -&gt; X509KeyPem
</span><a href="Network.X509.SelfSigned.html#encodeKeyPem"><span class="hs-identifier hs-var">encodeKeyPem</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621681476793"><span class="hs-identifier hs-var">sk</span></a></span><span>
</span><span id="line-621"></span><span>    </span><span class="annot"><span class="annottext">(Fingerprint, X509CertPem, X509KeyPem)
-&gt; IO (Fingerprint, X509CertPem, X509KeyPem)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">((Fingerprint, X509CertPem, X509KeyPem)
 -&gt; IO (Fingerprint, X509CertPem, X509KeyPem))
-&gt; (Fingerprint, X509CertPem, X509KeyPem)
-&gt; IO (Fingerprint, X509CertPem, X509KeyPem)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Fingerprint
</span><a href="#local-6989586621681476787"><span class="hs-identifier hs-var">fp</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">X509CertPem
</span><a href="#local-6989586621681476786"><span class="hs-identifier hs-var">cpem</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">X509KeyPem
</span><a href="#local-6989586621681476785"><span class="hs-identifier hs-var">kpem</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-622"></span><span>
</span><span id="line-623"></span><span class="hs-comment">-- -------------------------------------------------------------------------- --</span><span>
</span><span id="line-624"></span><span class="hs-comment">-- Generate Self Signed Certificate for Localhost</span><span>
</span><span id="line-625"></span><span>
</span><span id="line-626"></span><span class="hs-comment">-- | Generate a self-signed Certificate for localhost. Note, however, that for a</span><span>
</span><span id="line-627"></span><span class="hs-comment">-- most uses of a self-signed cerificate the names don't matter. Instead the</span><span>
</span><span id="line-628"></span><span class="hs-comment">-- certificate is authenticated by checking its fingerprint.</span><span>
</span><span id="line-629"></span><span class="hs-comment">--</span><span>
</span><span id="line-630"></span><span class="annot"><a href="Network.X509.SelfSigned.html#generateLocalhostCertificate"><span class="hs-identifier hs-type">generateLocalhostCertificate</span></a></span><span>
</span><span id="line-631"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621681476784"><span class="annot"><a href="#local-6989586621681476784"><span class="hs-identifier hs-type">k</span></a></span></span><span>
</span><span id="line-632"></span><span>    </span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#X509Key"><span class="hs-identifier hs-type">X509Key</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681476784"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-633"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Natural</span></span><span>
</span><span id="line-634"></span><span>        </span><span class="hs-comment">-- ^ days of validity</span><span>
</span><span id="line-635"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Fingerprint</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#X509CertPem"><span class="hs-identifier hs-type">X509CertPem</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#X509KeyPem"><span class="hs-identifier hs-type">X509KeyPem</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-636"></span><span id="generateLocalhostCertificate"><span class="annot"><span class="annottext">generateLocalhostCertificate :: Natural -&gt; IO (Fingerprint, X509CertPem, X509KeyPem)
</span><a href="Network.X509.SelfSigned.html#generateLocalhostCertificate"><span class="hs-identifier hs-var hs-var">generateLocalhostCertificate</span></a></span></span><span> </span><span id="local-6989586621681476783"><span class="annot"><span class="annottext">days :: Natural
</span><a href="#local-6989586621681476783"><span class="hs-identifier hs-var">days</span></a></span></span><span>
</span><span id="line-637"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Natural
-&gt; DistinguishedName
-&gt; Maybe (NonEmpty AltName)
-&gt; IO (Fingerprint, X509CertPem, X509KeyPem)
forall k.
X509Key k =&gt;
Natural
-&gt; DistinguishedName
-&gt; Maybe (NonEmpty AltName)
-&gt; IO (Fingerprint, X509CertPem, X509KeyPem)
</span><a href="Network.X509.SelfSigned.html#generateSelfSignedCertificate"><span class="hs-identifier hs-var">generateSelfSignedCertificate</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621681476784"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621681476783"><span class="hs-identifier hs-var">days</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; DistinguishedName
</span><a href="Network.X509.SelfSigned.html#name"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;localhost&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe (NonEmpty AltName)
 -&gt; IO (Fingerprint, X509CertPem, X509KeyPem))
-&gt; Maybe (NonEmpty AltName)
-&gt; IO (Fingerprint, X509CertPem, X509KeyPem)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty AltName -&gt; Maybe (NonEmpty AltName)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span>
</span><span id="line-638"></span><span>        </span><span class="annot"><span class="annottext">(NonEmpty AltName -&gt; Maybe (NonEmpty AltName))
-&gt; NonEmpty AltName -&gt; Maybe (NonEmpty AltName)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; AltName
</span><span class="hs-identifier hs-var">AltNameDNS</span></span><span> </span><span class="annot"><span class="hs-string">&quot;localhost&quot;</span></span><span> </span><span class="annot"><span class="annottext">AltName -&gt; [AltName] -&gt; NonEmpty AltName
forall a. a -&gt; [a] -&gt; NonEmpty a
</span><span class="hs-operator hs-var">NE.:|</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ByteString -&gt; AltName
</span><span class="hs-identifier hs-var">AltNameIP</span></span><span> </span><span class="annot"><span class="hs-string">&quot;127.0.0.1&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-639"></span><span>
</span><span id="line-640"></span><span class="hs-comment">-- -------------------------------------------------------------------------- --</span><span>
</span><span id="line-641"></span><span class="hs-comment">-- Client</span><span>
</span><span id="line-642"></span><span>
</span><span id="line-643"></span><span class="hs-comment">-- | Create a client credential for a certificate</span><span>
</span><span id="line-644"></span><span class="hs-comment">--</span><span>
</span><span id="line-645"></span><span class="annot"><a href="Network.X509.SelfSigned.html#unsafeMakeCredential"><span class="hs-identifier hs-type">unsafeMakeCredential</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#X509CertChainPem"><span class="hs-identifier hs-type">X509CertChainPem</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#X509KeyPem"><span class="hs-identifier hs-type">X509KeyPem</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Credential</span></span><span>
</span><span id="line-646"></span><span id="unsafeMakeCredential"><span class="annot"><span class="annottext">unsafeMakeCredential :: X509CertChainPem -&gt; X509KeyPem -&gt; Credential
</span><a href="Network.X509.SelfSigned.html#unsafeMakeCredential"><span class="hs-identifier hs-var hs-var">unsafeMakeCredential</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.X509.SelfSigned.html#X509CertChainPem"><span class="hs-identifier hs-type">X509CertChainPem</span></a></span><span> </span><span id="local-6989586621681476778"><span class="annot"><span class="annottext">cert :: X509CertPem
</span><a href="#local-6989586621681476778"><span class="hs-identifier hs-var">cert</span></a></span></span><span> </span><span id="local-6989586621681476777"><span class="annot"><span class="annottext">chain :: [X509CertPem]
</span><a href="#local-6989586621681476777"><span class="hs-identifier hs-var">chain</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.X509.SelfSigned.html#X509KeyPem"><span class="hs-identifier hs-type">X509KeyPem</span></a></span><span> </span><span id="local-6989586621681476776"><span class="annot"><span class="annottext">keyBytes :: ByteString
</span><a href="#local-6989586621681476776"><span class="hs-identifier hs-var">keyBytes</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-647"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ByteString
-&gt; [ByteString] -&gt; ByteString -&gt; Either [Char] Credential
</span><span class="hs-identifier hs-var">credentialLoadX509ChainFromMemory</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">X509CertPem -&gt; ByteString
</span><a href="#local-6989586621681476774"><span class="hs-identifier hs-var">x509Bytes</span></a></span><span> </span><span class="annot"><span class="annottext">X509CertPem
</span><a href="#local-6989586621681476778"><span class="hs-identifier hs-var">cert</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">X509CertPem -&gt; ByteString
</span><a href="#local-6989586621681476774"><span class="hs-identifier hs-var">x509Bytes</span></a></span><span> </span><span class="annot"><span class="annottext">(X509CertPem -&gt; ByteString) -&gt; [X509CertPem] -&gt; [ByteString]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[X509CertPem]
</span><a href="#local-6989586621681476777"><span class="hs-identifier hs-var">chain</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621681476776"><span class="hs-identifier hs-var">keyBytes</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-648"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621681476773"><span class="annot"><span class="annottext">e :: [Char]
</span><a href="#local-6989586621681476773"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Credential
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; Credential) -&gt; [Char] -&gt; Credential
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;failed to read certificate or key: &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621681476773"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-649"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621681476772"><span class="annot"><span class="annottext">x :: Credential
</span><a href="#local-6989586621681476772"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Credential
</span><a href="#local-6989586621681476772"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-650"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-651"></span><span>    </span><span id="local-6989586621681476774"><span class="annot"><span class="annottext">x509Bytes :: X509CertPem -&gt; ByteString
</span><a href="#local-6989586621681476774"><span class="hs-identifier hs-var hs-var">x509Bytes</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.X509.SelfSigned.html#X509CertPem"><span class="hs-identifier hs-type">X509CertPem</span></a></span><span> </span><span id="local-6989586621681476771"><span class="annot"><span class="annottext">bytes :: ByteString
</span><a href="#local-6989586621681476771"><span class="hs-identifier hs-var">bytes</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621681476771"><span class="hs-identifier hs-var">bytes</span></a></span><span>
</span><span id="line-652"></span><span>
</span><span id="line-653"></span><span class="hs-comment">-- | A certificate policy for using self-signed certifcates with a connection</span><span>
</span><span id="line-654"></span><span class="hs-comment">-- manager</span><span>
</span><span id="line-655"></span><span class="hs-comment">--</span><span>
</span><span id="line-656"></span><span class="hs-keyword">data</span><span> </span><span id="TlsPolicy"><span class="annot"><a href="Network.X509.SelfSigned.html#TlsPolicy"><span class="hs-identifier hs-var">TlsPolicy</span></a></span></span><span>
</span><span id="line-657"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="TlsInsecure"><span class="annot"><a href="Network.X509.SelfSigned.html#TlsInsecure"><span class="hs-identifier hs-var">TlsInsecure</span></a></span></span><span>
</span><span id="line-658"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="TlsSecure"><span class="annot"><a href="Network.X509.SelfSigned.html#TlsSecure"><span class="hs-identifier hs-var">TlsSecure</span></a></span></span><span>
</span><span id="line-659"></span><span>        </span><span class="hs-special">{</span><span> </span><span id="_tlsPolicyUseSystemStore"><span class="annot"><span class="annottext">TlsPolicy -&gt; Bool
</span><a href="Network.X509.SelfSigned.html#_tlsPolicyUseSystemStore"><span class="hs-identifier hs-var hs-var">_tlsPolicyUseSystemStore</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-660"></span><span>            </span><span class="hs-comment">-- ^ whether to use the system certificate store.</span><span>
</span><span id="line-661"></span><span>        </span><span class="hs-special">,</span><span> </span><span id="_tlsPolicyCallback"><span class="annot"><span class="annottext">TlsPolicy -&gt; ([Char], ByteString) -&gt; IO (Maybe Fingerprint)
</span><a href="Network.X509.SelfSigned.html#_tlsPolicyCallback"><span class="hs-identifier hs-var hs-var">_tlsPolicyCallback</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ServiceID</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Fingerprint</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-662"></span><span>            </span><span class="hs-comment">-- ^ a callback for looking up certificate fingerprints for known</span><span>
</span><span id="line-663"></span><span>            </span><span class="hs-comment">-- service endpoints.</span><span>
</span><span id="line-664"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-665"></span><span>
</span><span id="line-666"></span><span class="hs-comment">-- | Create a connection manager for a given 'TlsPolicy'.</span><span>
</span><span id="line-667"></span><span class="hs-comment">--</span><span>
</span><span id="line-668"></span><span class="annot"><a href="Network.X509.SelfSigned.html#certificateCacheManagerSettings"><span class="hs-identifier hs-type">certificateCacheManagerSettings</span></a></span><span>
</span><span id="line-669"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#TlsPolicy"><span class="hs-identifier hs-type">TlsPolicy</span></a></span><span>
</span><span id="line-670"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Credential</span></span><span>
</span><span id="line-671"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ManagerSettings</span></span><span>
</span><span id="line-672"></span><span id="certificateCacheManagerSettings"><span class="annot"><span class="annottext">certificateCacheManagerSettings :: TlsPolicy -&gt; Maybe Credential -&gt; IO ManagerSettings
</span><a href="Network.X509.SelfSigned.html#certificateCacheManagerSettings"><span class="hs-identifier hs-var hs-var">certificateCacheManagerSettings</span></a></span></span><span> </span><span id="local-6989586621681476766"><span class="annot"><span class="annottext">policy :: TlsPolicy
</span><a href="#local-6989586621681476766"><span class="hs-identifier hs-var">policy</span></a></span></span><span> </span><span id="local-6989586621681476765"><span class="annot"><span class="annottext">credential :: Maybe Credential
</span><a href="#local-6989586621681476765"><span class="hs-identifier hs-var">credential</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-673"></span><span>    </span><span id="local-6989586621681476764"><span class="annot"><span class="annottext">CertificateStore
</span><a href="#local-6989586621681476764"><span class="hs-identifier hs-var">certstore</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TlsPolicy -&gt; IO CertificateStore
</span><a href="#local-6989586621681476763"><span class="hs-identifier hs-var">getCertStore</span></a></span><span> </span><span class="annot"><span class="annottext">TlsPolicy
</span><a href="#local-6989586621681476766"><span class="hs-identifier hs-var">policy</span></a></span><span>
</span><span id="line-674"></span><span>    </span><span class="annot"><span class="annottext">ManagerSettings -&gt; IO ManagerSettings
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(ManagerSettings -&gt; IO ManagerSettings)
-&gt; ManagerSettings -&gt; IO ManagerSettings
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TLSSettings -&gt; Maybe SockSettings -&gt; ManagerSettings
</span><span class="hs-identifier hs-var">mkManagerSettings</span></span><span>
</span><span id="line-675"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ClientParams -&gt; TLSSettings
</span><span class="hs-identifier hs-var">TLSSettings</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CertificateStore -&gt; ClientParams
</span><a href="#local-6989586621681476761"><span class="hs-identifier hs-var">settings</span></a></span><span> </span><span class="annot"><span class="annottext">CertificateStore
</span><a href="#local-6989586621681476764"><span class="hs-identifier hs-var">certstore</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-676"></span><span>        </span><span class="annot"><span class="annottext">Maybe SockSettings
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-677"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-678"></span><span>    </span><span class="hs-comment">-- It is safe to pass empty strings for host and port since 'connectFromHandle'</span><span>
</span><span id="line-679"></span><span>    </span><span class="hs-comment">-- and 'connectTo' are going to overwrite this anyways.</span><span>
</span><span id="line-680"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-681"></span><span>    </span><span id="local-6989586621681476761"><span class="annot"><span class="annottext">settings :: CertificateStore -&gt; ClientParams
</span><a href="#local-6989586621681476761"><span class="hs-identifier hs-var hs-var">settings</span></a></span></span><span> </span><span id="local-6989586621681476760"><span class="annot"><span class="annottext">certstore :: CertificateStore
</span><a href="#local-6989586621681476760"><span class="hs-identifier hs-var">certstore</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; ByteString -&gt; ClientParams
</span><span class="hs-identifier hs-var">defaultParamsClient</span></span><span> </span><span class="annot"><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="annot"><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-682"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">clientSupported :: Supported
</span><span class="hs-identifier hs-var">clientSupported</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Supported
forall a. Default a =&gt; a
</span><span class="hs-identifier hs-var">def</span></span><span>
</span><span id="line-683"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">supportedCiphers :: [Cipher]
</span><span class="hs-identifier hs-var">supportedCiphers</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Cipher]
</span><span class="hs-identifier hs-var">ciphersuite_default</span></span><span>
</span><span id="line-684"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">supportedVersions :: [Version]
</span><span class="hs-identifier hs-var">supportedVersions</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Version
</span><span class="hs-identifier hs-var">TLS13</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Version
</span><span class="hs-identifier hs-var">TLS12</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Version
</span><span class="hs-identifier hs-var">TLS11</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Version
</span><span class="hs-identifier hs-var">TLS10</span></span><span class="hs-special">]</span><span>
</span><span id="line-685"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-686"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">clientShared :: Shared
</span><span class="hs-identifier hs-var">clientShared</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Shared
forall a. Default a =&gt; a
</span><span class="hs-identifier hs-var">def</span></span><span>
</span><span id="line-687"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">sharedCAStore :: CertificateStore
</span><span class="hs-identifier hs-var">sharedCAStore</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CertificateStore
</span><a href="#local-6989586621681476760"><span class="hs-identifier hs-var">certstore</span></a></span><span>
</span><span id="line-688"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sharedValidationCache :: ValidationCache
</span><span class="hs-identifier hs-var">sharedValidationCache</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TlsPolicy -&gt; ValidationCache
</span><a href="#local-6989586621681476748"><span class="hs-identifier hs-var">validationCache</span></a></span><span> </span><span class="annot"><span class="annottext">TlsPolicy
</span><a href="#local-6989586621681476766"><span class="hs-identifier hs-var">policy</span></a></span><span>
</span><span id="line-689"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sharedCredentials :: Credentials
</span><span class="hs-identifier hs-var">sharedCredentials</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Credential] -&gt; Credentials
</span><span class="hs-identifier hs-var">Credentials</span></span><span> </span><span class="annot"><span class="annottext">([Credential] -&gt; Credentials) -&gt; [Credential] -&gt; Credentials
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe Credential -&gt; [Credential]
forall a. Maybe a -&gt; [a]
</span><span class="hs-identifier hs-var">maybeToList</span></span><span> </span><span class="annot"><span class="annottext">Maybe Credential
</span><a href="#local-6989586621681476765"><span class="hs-identifier hs-var">credential</span></a></span><span>
</span><span id="line-690"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-691"></span><span>
</span><span id="line-692"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-693"></span><span>
</span><span id="line-694"></span><span>    </span><span id="local-6989586621681476748"><span class="annot"><span class="annottext">validationCache :: TlsPolicy -&gt; ValidationCache
</span><a href="#local-6989586621681476748"><span class="hs-identifier hs-var hs-var">validationCache</span></a></span></span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#TlsInsecure"><span class="hs-identifier hs-type">TlsInsecure</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ValidationCacheQueryCallback
-&gt; ValidationCacheAddCallback -&gt; ValidationCache
</span><span class="hs-identifier hs-var">ValidationCache</span></span><span>
</span><span id="line-695"></span><span>        </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ValidationCacheResult -&gt; IO ValidationCacheResult
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">ValidationCacheResult
</span><span class="hs-identifier hs-var">ValidationCachePass</span></span><span class="hs-special">)</span><span>
</span><span id="line-696"></span><span>        </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-697"></span><span>
</span><span id="line-698"></span><span>    </span><span class="annot"><a href="#local-6989586621681476748"><span class="hs-identifier hs-var">validationCache</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.X509.SelfSigned.html#TlsSecure"><span class="hs-identifier hs-type">TlsSecure</span></a></span><span> </span><span class="hs-identifier">_</span><span> </span><span id="local-6989586621681476743"><span class="annot"><span class="annottext">query :: ([Char], ByteString) -&gt; IO (Maybe Fingerprint)
</span><a href="#local-6989586621681476743"><span class="hs-identifier hs-var">query</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(([Char], ByteString) -&gt; IO (Maybe Fingerprint)) -&gt; ValidationCache
</span><a href="Network.X509.SelfSigned.html#certificateCache"><span class="hs-identifier hs-var">certificateCache</span></a></span><span> </span><span class="annot"><span class="annottext">([Char], ByteString) -&gt; IO (Maybe Fingerprint)
</span><a href="#local-6989586621681476743"><span class="hs-identifier hs-var">query</span></a></span><span>
</span><span id="line-699"></span><span>
</span><span id="line-700"></span><span>    </span><span id="local-6989586621681476763"><span class="annot"><span class="annottext">getCertStore :: TlsPolicy -&gt; IO CertificateStore
</span><a href="#local-6989586621681476763"><span class="hs-identifier hs-var hs-var">getCertStore</span></a></span></span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#TlsInsecure"><span class="hs-identifier hs-type">TlsInsecure</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CertificateStore -&gt; IO CertificateStore
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">CertificateStore
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-701"></span><span>    </span><span class="annot"><a href="#local-6989586621681476763"><span class="hs-identifier hs-var">getCertStore</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.X509.SelfSigned.html#TlsSecure"><span class="hs-identifier hs-type">TlsSecure</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">False</span></span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CertificateStore -&gt; IO CertificateStore
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">CertificateStore
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-702"></span><span>    </span><span class="annot"><a href="#local-6989586621681476763"><span class="hs-identifier hs-var">getCertStore</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.X509.SelfSigned.html#TlsSecure"><span class="hs-identifier hs-type">TlsSecure</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">True</span></span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO CertificateStore
</span><span class="hs-identifier hs-var">getSystemCertificateStore</span></span><span>
</span><span id="line-703"></span><span>
</span><span id="line-704"></span><span class="hs-comment">-- -------------------------------------------------------------------------- --</span><span>
</span><span id="line-705"></span><span class="hs-comment">-- Certifcate Fingerprint Cache</span><span>
</span><span id="line-706"></span><span>
</span><span id="line-707"></span><span class="hs-comment">-- NOTE: the validation cache supports only a single peer-id/fingerprint per</span><span>
</span><span id="line-708"></span><span class="hs-comment">-- host-address/serviceid.</span><span>
</span><span id="line-709"></span><span class="hs-comment">--</span><span>
</span><span id="line-710"></span><span class="annot"><a href="Network.X509.SelfSigned.html#certificateCache"><span class="hs-identifier hs-type">certificateCache</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ServiceID</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Fingerprint</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ValidationCache</span></span><span>
</span><span id="line-711"></span><span id="certificateCache"><span class="annot"><span class="annottext">certificateCache :: (([Char], ByteString) -&gt; IO (Maybe Fingerprint)) -&gt; ValidationCache
</span><a href="Network.X509.SelfSigned.html#certificateCache"><span class="hs-identifier hs-var hs-var">certificateCache</span></a></span></span><span> </span><span id="local-6989586621681476741"><span class="annot"><span class="annottext">query :: ([Char], ByteString) -&gt; IO (Maybe Fingerprint)
</span><a href="#local-6989586621681476741"><span class="hs-identifier hs-var">query</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ValidationCacheQueryCallback
-&gt; ValidationCacheAddCallback -&gt; ValidationCache
</span><span class="hs-identifier hs-var">ValidationCache</span></span><span> </span><span class="annot"><span class="annottext">ValidationCacheQueryCallback
</span><a href="#local-6989586621681476740"><span class="hs-identifier hs-var">queryCallback</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-712"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-713"></span><span>    </span><span class="annot"><a href="#local-6989586621681476740"><span class="hs-identifier hs-type">queryCallback</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ValidationCacheQueryCallback</span></span><span>
</span><span id="line-714"></span><span>    </span><span id="local-6989586621681476740"><span class="annot"><span class="annottext">queryCallback :: ValidationCacheQueryCallback
</span><a href="#local-6989586621681476740"><span class="hs-identifier hs-var hs-var">queryCallback</span></a></span></span><span> </span><span id="local-6989586621681476739"><span class="annot"><span class="annottext">serviceID :: ([Char], ByteString)
</span><a href="#local-6989586621681476739"><span class="hs-identifier hs-var">serviceID</span></a></span></span><span> </span><span id="local-6989586621681476738"><span class="annot"><span class="annottext">fp :: Fingerprint
</span><a href="#local-6989586621681476738"><span class="hs-identifier hs-var">fp</span></a></span></span><span> </span><span id="local-6989586621681476737"><span class="annot"><span class="annottext">_cert :: Certificate
</span><a href="#local-6989586621681476737"><span class="hs-identifier hs-var">_cert</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([Char], ByteString) -&gt; IO (Maybe Fingerprint)
</span><a href="#local-6989586621681476741"><span class="hs-identifier hs-var">query</span></a></span><span> </span><span class="annot"><span class="annottext">([Char], ByteString)
</span><a href="#local-6989586621681476739"><span class="hs-identifier hs-var">serviceID</span></a></span><span> </span><span class="annot"><span class="annottext">IO (Maybe Fingerprint)
-&gt; (Maybe Fingerprint -&gt; IO ValidationCacheResult)
-&gt; IO ValidationCacheResult
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-715"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ValidationCacheResult -&gt; IO ValidationCacheResult
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">ValidationCacheResult
</span><span class="hs-identifier hs-var">ValidationCacheUnknown</span></span><span>
</span><span id="line-716"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621681476735"><span class="annot"><span class="annottext">f :: Fingerprint
</span><a href="#local-6989586621681476735"><span class="hs-identifier hs-var">f</span></a></span></span><span>
</span><span id="line-717"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Fingerprint
</span><a href="#local-6989586621681476738"><span class="hs-identifier hs-var">fp</span></a></span><span> </span><span class="annot"><span class="annottext">Fingerprint -&gt; Fingerprint -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Fingerprint
</span><a href="#local-6989586621681476735"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ValidationCacheResult -&gt; IO ValidationCacheResult
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">ValidationCacheResult
</span><span class="hs-identifier hs-var">ValidationCachePass</span></span><span>
</span><span id="line-718"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ValidationCacheResult -&gt; IO ValidationCacheResult
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(ValidationCacheResult -&gt; IO ValidationCacheResult)
-&gt; ValidationCacheResult -&gt; IO ValidationCacheResult
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ValidationCacheResult
</span><span class="hs-identifier hs-var">ValidationCacheDenied</span></span><span>
</span><span id="line-719"></span><span>                </span><span class="annot"><span class="annottext">([Char] -&gt; ValidationCacheResult)
-&gt; [Char] -&gt; ValidationCacheResult
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;for host: &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">([Char], ByteString) -&gt; [Char]
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">([Char], ByteString)
</span><a href="#local-6989586621681476739"><span class="hs-identifier hs-var">serviceID</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="hs-string">&quot;:&quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; [Char]
</span><span class="hs-identifier hs-var">B8.unpack</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">([Char], ByteString) -&gt; ByteString
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">([Char], ByteString)
</span><a href="#local-6989586621681476739"><span class="hs-identifier hs-var">serviceID</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-720"></span><span>                </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="hs-string">&quot; expected fingerprint: &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Char]
</span><span class="hs-identifier hs-var">T.unpack</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Fingerprint -&gt; Text
</span><a href="Network.X509.SelfSigned.html#fingerprintToText"><span class="hs-identifier hs-var">fingerprintToText</span></a></span><span> </span><span class="annot"><span class="annottext">Fingerprint
</span><a href="#local-6989586621681476735"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-721"></span><span>                </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="hs-string">&quot; but got fingerprint: &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Char]
</span><span class="hs-identifier hs-var">T.unpack</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Fingerprint -&gt; Text
</span><a href="Network.X509.SelfSigned.html#fingerprintToText"><span class="hs-identifier hs-var">fingerprintToText</span></a></span><span> </span><span class="annot"><span class="annottext">Fingerprint
</span><a href="#local-6989586621681476738"><span class="hs-identifier hs-var">fp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-722"></span><span>
</span><span id="line-723"></span><span class="hs-comment">-- | Check whether a connection failed due to an certificate missmatch</span><span>
</span><span id="line-724"></span><span class="hs-comment">--</span><span>
</span><span id="line-725"></span><span class="annot"><a href="Network.X509.SelfSigned.html#isCertificateMismatchException"><span class="hs-identifier hs-type">isCertificateMismatchException</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HttpException</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-726"></span><span id="isCertificateMismatchException"><span class="annot"><span class="annottext">isCertificateMismatchException :: HttpException -&gt; Bool
</span><a href="Network.X509.SelfSigned.html#isCertificateMismatchException"><span class="hs-identifier hs-var hs-var">isCertificateMismatchException</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HttpExceptionRequest</span></span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">InternalException</span></span><span> </span><span id="local-6989586621681476731"><span class="annot"><span class="annottext">e :: SomeException
</span><a href="#local-6989586621681476731"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-727"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SomeException -&gt; Maybe TLSException
forall e. Exception e =&gt; SomeException -&gt; Maybe e
</span><span class="hs-identifier hs-var">fromException</span></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621681476731"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-728"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HandshakeFailed</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Error_Protocol</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681476727"><span class="annot"><span class="annottext">_msg :: [Char]
</span><a href="#local-6989586621681476727"><span class="hs-identifier hs-var">_msg</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CertificateUnknown</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-729"></span><span>        </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-730"></span><span>    </span><span class="hs-comment">-- _msg looks something like:</span><span>
</span><span id="line-731"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-732"></span><span>    </span><span class="hs-comment">-- &quot;certificate rejected: [</span><span>
</span><span id="line-733"></span><span>    </span><span class="hs-comment">--   CacheSaysNo \&quot;for host: 54.93.103.7:443 expected fingerprint: aXv-A9r5FUbg7R9hQHG0huvVIuS0_HQacvMn-wIUS-M but got fingerprint: GqZr-fWw0zj68xll-HW9RcL46e1mq6wwwDjRuXPlrcA\&quot;</span><span>
</span><span id="line-734"></span><span>    </span><span class="hs-comment">-- ]&quot;</span><span>
</span><span id="line-735"></span><span class="annot"><a href="Network.X509.SelfSigned.html#isCertificateMismatchException"><span class="hs-identifier hs-var">isCertificateMismatchException</span></a></span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-736"></span><span>
</span><span id="line-737"></span><span>
</span><span id="line-738"></span><span class="hs-comment">-- -------------------------------------------------------------------------- --</span><span>
</span><span id="line-739"></span><span class="hs-comment">-- Server Settings</span><span>
</span><span id="line-740"></span><span>
</span><span id="line-741"></span><span class="hs-comment">-- | TLS server settings</span><span>
</span><span id="line-742"></span><span class="hs-comment">--</span><span>
</span><span id="line-743"></span><span class="annot"><a href="Network.X509.SelfSigned.html#tlsServerSettings"><span class="hs-identifier hs-type">tlsServerSettings</span></a></span><span>
</span><span id="line-744"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#X509CertPem"><span class="hs-identifier hs-type">X509CertPem</span></a></span><span>
</span><span id="line-745"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#X509KeyPem"><span class="hs-identifier hs-type">X509KeyPem</span></a></span><span>
</span><span id="line-746"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">WARP.TLSSettings</span></span><span>
</span><span id="line-747"></span><span id="tlsServerSettings"><span class="annot"><span class="annottext">tlsServerSettings :: X509CertPem -&gt; X509KeyPem -&gt; TLSSettings
</span><a href="Network.X509.SelfSigned.html#tlsServerSettings"><span class="hs-identifier hs-var hs-var">tlsServerSettings</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.X509.SelfSigned.html#X509CertPem"><span class="hs-identifier hs-type">X509CertPem</span></a></span><span> </span><span id="local-6989586621681476725"><span class="annot"><span class="annottext">certBytes :: ByteString
</span><a href="#local-6989586621681476725"><span class="hs-identifier hs-var">certBytes</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.X509.SelfSigned.html#X509KeyPem"><span class="hs-identifier hs-type">X509KeyPem</span></a></span><span> </span><span id="local-6989586621681476724"><span class="annot"><span class="annottext">keyBytes :: ByteString
</span><a href="#local-6989586621681476724"><span class="hs-identifier hs-var">keyBytes</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-748"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; ByteString -&gt; TLSSettings
</span><span class="hs-identifier hs-var">tlsSettingsMemory</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621681476725"><span class="hs-identifier hs-var">certBytes</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621681476724"><span class="hs-identifier hs-var">keyBytes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-749"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tlsCiphers :: [Cipher]
</span><span class="hs-identifier hs-var">tlsCiphers</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Cipher]
</span><span class="hs-identifier hs-var">ciphersuite_default</span></span><span>
</span><span id="line-750"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tlsAllowedVersions :: [Version]
</span><span class="hs-identifier hs-var">tlsAllowedVersions</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Version
</span><span class="hs-identifier hs-var">TLS13</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Version
</span><span class="hs-identifier hs-var">TLS12</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Version
</span><span class="hs-identifier hs-var">TLS11</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Version
</span><span class="hs-identifier hs-var">TLS10</span></span><span class="hs-special">]</span><span>
</span><span id="line-751"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-752"></span><span>
</span><span id="line-753"></span><span class="hs-comment">-- | TLS server settings</span><span>
</span><span id="line-754"></span><span class="hs-comment">--</span><span>
</span><span id="line-755"></span><span class="annot"><a href="Network.X509.SelfSigned.html#tlsServerChainSettings"><span class="hs-identifier hs-type">tlsServerChainSettings</span></a></span><span>
</span><span id="line-756"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#X509CertChainPem"><span class="hs-identifier hs-type">X509CertChainPem</span></a></span><span>
</span><span id="line-757"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#X509KeyPem"><span class="hs-identifier hs-type">X509KeyPem</span></a></span><span>
</span><span id="line-758"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">WARP.TLSSettings</span></span><span>
</span><span id="line-759"></span><span id="tlsServerChainSettings"><span class="annot"><span class="annottext">tlsServerChainSettings :: X509CertChainPem -&gt; X509KeyPem -&gt; TLSSettings
</span><a href="Network.X509.SelfSigned.html#tlsServerChainSettings"><span class="hs-identifier hs-var hs-var">tlsServerChainSettings</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.X509.SelfSigned.html#X509CertChainPem"><span class="hs-identifier hs-type">X509CertChainPem</span></a></span><span> </span><span id="local-6989586621681476721"><span class="annot"><span class="annottext">cert :: X509CertPem
</span><a href="#local-6989586621681476721"><span class="hs-identifier hs-var">cert</span></a></span></span><span> </span><span id="local-6989586621681476720"><span class="annot"><span class="annottext">chain :: [X509CertPem]
</span><a href="#local-6989586621681476720"><span class="hs-identifier hs-var">chain</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.X509.SelfSigned.html#X509KeyPem"><span class="hs-identifier hs-type">X509KeyPem</span></a></span><span> </span><span id="local-6989586621681476719"><span class="annot"><span class="annottext">keyBytes :: ByteString
</span><a href="#local-6989586621681476719"><span class="hs-identifier hs-var">keyBytes</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-760"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; [ByteString] -&gt; ByteString -&gt; TLSSettings
</span><span class="hs-identifier hs-var">tlsSettingsChainMemory</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">X509CertPem -&gt; ByteString
</span><a href="#local-6989586621681476718"><span class="hs-identifier hs-var">x509Bytes</span></a></span><span> </span><span class="annot"><span class="annottext">X509CertPem
</span><a href="#local-6989586621681476721"><span class="hs-identifier hs-var">cert</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">X509CertPem -&gt; ByteString
</span><a href="#local-6989586621681476718"><span class="hs-identifier hs-var">x509Bytes</span></a></span><span> </span><span class="annot"><span class="annottext">(X509CertPem -&gt; ByteString) -&gt; [X509CertPem] -&gt; [ByteString]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[X509CertPem]
</span><a href="#local-6989586621681476720"><span class="hs-identifier hs-var">chain</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621681476719"><span class="hs-identifier hs-var">keyBytes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-761"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tlsCiphers :: [Cipher]
</span><span class="hs-identifier hs-var">tlsCiphers</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Cipher]
</span><span class="hs-identifier hs-var">ciphersuite_default</span></span><span>
</span><span id="line-762"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tlsAllowedVersions :: [Version]
</span><span class="hs-identifier hs-var">tlsAllowedVersions</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Version
</span><span class="hs-identifier hs-var">TLS13</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Version
</span><span class="hs-identifier hs-var">TLS12</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Version
</span><span class="hs-identifier hs-var">TLS11</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Version
</span><span class="hs-identifier hs-var">TLS10</span></span><span class="hs-special">]</span><span>
</span><span id="line-763"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-764"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-765"></span><span>    </span><span id="local-6989586621681476718"><span class="annot"><span class="annottext">x509Bytes :: X509CertPem -&gt; ByteString
</span><a href="#local-6989586621681476718"><span class="hs-identifier hs-var hs-var">x509Bytes</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.X509.SelfSigned.html#X509CertPem"><span class="hs-identifier hs-type">X509CertPem</span></a></span><span> </span><span id="local-6989586621681476717"><span class="annot"><span class="annottext">bytes :: ByteString
</span><a href="#local-6989586621681476717"><span class="hs-identifier hs-var">bytes</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621681476717"><span class="hs-identifier hs-var">bytes</span></a></span><span>
</span><span id="line-766"></span><span>
</span><span id="line-767"></span><span class="hs-comment">-- -------------------------------------------------------------------------- --</span><span>
</span><span id="line-768"></span><span class="hs-comment">-- Split Certificate Chain into the head and the remaining certificats</span><span>
</span><span id="line-769"></span><span>
</span><span id="line-770"></span><span class="hs-keyword">pattern</span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#CertHeader"><span class="hs-identifier hs-type">CertHeader</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">B8.ByteString</span></span><span>
</span><span id="line-771"></span><span class="hs-keyword">pattern</span><span> </span><span id="%24bCertHeader"><span id="%24mCertHeader"><span id="CertHeader"><span class="annot"><span class="annottext">$bCertHeader :: ByteString
$mCertHeader :: forall r. ByteString -&gt; (Void# -&gt; r) -&gt; (Void# -&gt; r) -&gt; r
</span><a href="Network.X509.SelfSigned.html#%24bCertHeader"><span class="hs-identifier hs-var hs-var hs-var">CertHeader</span></a></span></span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-string">&quot;-----BEGIN CERTIFICATE-----&quot;</span></span><span>
</span><span id="line-772"></span><span>
</span><span id="line-773"></span><span id="local-6989586621681477252"><span class="annot"><a href="Network.X509.SelfSigned.html#takeCert"><span class="hs-identifier hs-type">takeCert</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadThrow</span></span><span> </span><span class="annot"><a href="#local-6989586621681477252"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">B8.ByteString</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681477252"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">B8.ByteString</span></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">B8.ByteString</span></span><span class="hs-special">]</span><span class="hs-special">)</span></span><span>
</span><span id="line-774"></span><span id="takeCert"><span class="annot"><span class="annottext">takeCert :: [ByteString] -&gt; m ([ByteString], [ByteString])
</span><a href="Network.X509.SelfSigned.html#takeCert"><span class="hs-identifier hs-var hs-var">takeCert</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.X509.SelfSigned.html#CertHeader"><span class="hs-identifier hs-type">CertHeader</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621681476712"><span class="annot"><span class="annottext">t :: [ByteString]
</span><a href="#local-6989586621681476712"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([ByteString], [ByteString]) -&gt; m ([ByteString], [ByteString])
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(([ByteString], [ByteString]) -&gt; m ([ByteString], [ByteString]))
-&gt; ([ByteString], [ByteString]) -&gt; m ([ByteString], [ByteString])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">([ByteString] -&gt; [ByteString])
-&gt; ([ByteString], [ByteString]) -&gt; ([ByteString], [ByteString])
forall (p :: * -&gt; * -&gt; *) a b c.
Bifunctor p =&gt;
(a -&gt; b) -&gt; p a c -&gt; p b c
</span><span class="hs-identifier hs-var">first</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString
</span><a href="Network.X509.SelfSigned.html#CertHeader"><span class="hs-identifier hs-var">CertHeader</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; [ByteString] -&gt; [ByteString]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(([ByteString], [ByteString]) -&gt; ([ByteString], [ByteString]))
-&gt; ([ByteString], [ByteString]) -&gt; ([ByteString], [ByteString])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; Bool)
-&gt; [ByteString] -&gt; ([ByteString], [ByteString])
forall a. (a -&gt; Bool) -&gt; [a] -&gt; ([a], [a])
</span><span class="hs-identifier hs-var">L.break</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; ByteString -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="Network.X509.SelfSigned.html#CertHeader"><span class="hs-identifier hs-var">CertHeader</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621681476712"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-775"></span><span class="annot"><a href="Network.X509.SelfSigned.html#takeCert"><span class="hs-identifier hs-var">takeCert</span></a></span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EncodingException -&gt; m ([ByteString], [ByteString])
forall (m :: * -&gt; *) e a. (MonadThrow m, Exception e) =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwM</span></span><span> </span><span class="annot"><span class="annottext">(EncodingException -&gt; m ([ByteString], [ByteString]))
-&gt; EncodingException -&gt; m ([ByteString], [ByteString])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; EncodingException
</span><a href="Chainweb.Utils.html#DecodeException"><span class="hs-identifier hs-var">DecodeException</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;failed to decode X509 PEM certificate. Missing header.&quot;</span></span><span>
</span><span id="line-776"></span><span>
</span><span id="line-777"></span><span id="local-6989586621681477250"><span class="annot"><a href="Network.X509.SelfSigned.html#parseCerts"><span class="hs-identifier hs-type">parseCerts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadThrow</span></span><span> </span><span class="annot"><a href="#local-6989586621681477250"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">B8.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681477250"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">B8.ByteString</span></span><span class="hs-special">]</span></span><span>
</span><span id="line-778"></span><span id="parseCerts"><span class="annot"><span class="annottext">parseCerts :: ByteString -&gt; m [ByteString]
</span><a href="Network.X509.SelfSigned.html#parseCerts"><span class="hs-identifier hs-var hs-var">parseCerts</span></a></span></span><span> </span><span id="local-6989586621681476708"><span class="annot"><span class="annottext">bytes :: ByteString
</span><a href="#local-6989586621681476708"><span class="hs-identifier hs-var">bytes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ByteString] -&gt; m [ByteString]
forall (m :: * -&gt; *).
MonadThrow m =&gt;
[ByteString] -&gt; m [ByteString]
</span><a href="#local-6989586621681476707"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; [ByteString]
</span><span class="hs-identifier hs-var">B8.lines</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621681476708"><span class="hs-identifier hs-var">bytes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-779"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-780"></span><span>    </span><span id="local-6989586621681476707"><span class="annot"><span class="annottext">go :: [ByteString] -&gt; m [ByteString]
</span><a href="#local-6989586621681476707"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ByteString] -&gt; m [ByteString]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-781"></span><span>    </span><span class="annot"><a href="#local-6989586621681476707"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621681476705"><span class="annot"><span class="annottext">l :: [ByteString]
</span><a href="#local-6989586621681476705"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-782"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621681476704"><span class="annot"><span class="annottext">h :: [ByteString]
</span><a href="#local-6989586621681476704"><span class="hs-identifier hs-var">h</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681476703"><span class="annot"><span class="annottext">t :: [ByteString]
</span><a href="#local-6989586621681476703"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[ByteString] -&gt; m ([ByteString], [ByteString])
forall (m :: * -&gt; *).
MonadThrow m =&gt;
[ByteString] -&gt; m ([ByteString], [ByteString])
</span><a href="Network.X509.SelfSigned.html#takeCert"><span class="hs-identifier hs-var">takeCert</span></a></span><span> </span><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621681476705"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-783"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; [ByteString] -&gt; ByteString
</span><span class="hs-identifier hs-var">B8.intercalate</span></span><span> </span><span class="annot"><span class="hs-string">&quot;\n&quot;</span></span><span> </span><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621681476704"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; [ByteString] -&gt; [ByteString]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([ByteString] -&gt; [ByteString]) -&gt; m [ByteString] -&gt; m [ByteString]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[ByteString] -&gt; m [ByteString]
</span><a href="#local-6989586621681476707"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621681476703"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-784"></span><span>
</span><span id="line-785"></span><span id="local-6989586621681477246"><span class="annot"><a href="Network.X509.SelfSigned.html#parseCertChain"><span class="hs-identifier hs-type">parseCertChain</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadThrow</span></span><span> </span><span class="annot"><a href="#local-6989586621681477246"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">B8.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681477246"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#X509CertChainPem"><span class="hs-identifier hs-type">X509CertChainPem</span></a></span></span><span>
</span><span id="line-786"></span><span id="parseCertChain"><span class="annot"><span class="annottext">parseCertChain :: ByteString -&gt; m X509CertChainPem
</span><a href="Network.X509.SelfSigned.html#parseCertChain"><span class="hs-identifier hs-var hs-var">parseCertChain</span></a></span></span><span> </span><span id="local-6989586621681476700"><span class="annot"><span class="annottext">bytes :: ByteString
</span><a href="#local-6989586621681476700"><span class="hs-identifier hs-var">bytes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; m [ByteString]
forall (m :: * -&gt; *). MonadThrow m =&gt; ByteString -&gt; m [ByteString]
</span><a href="Network.X509.SelfSigned.html#parseCerts"><span class="hs-identifier hs-var">parseCerts</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621681476700"><span class="hs-identifier hs-var">bytes</span></a></span><span> </span><span class="annot"><span class="annottext">m [ByteString]
-&gt; ([ByteString] -&gt; m X509CertChainPem) -&gt; m X509CertChainPem
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-787"></span><span>    </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">EncodingException -&gt; m X509CertChainPem
forall (m :: * -&gt; *) e a. (MonadThrow m, Exception e) =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwM</span></span><span> </span><span class="annot"><span class="annottext">(EncodingException -&gt; m X509CertChainPem)
-&gt; EncodingException -&gt; m X509CertChainPem
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; EncodingException
</span><a href="Chainweb.Utils.html#DecodeException"><span class="hs-identifier hs-var">DecodeException</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;certificate must have at least one certificate&quot;</span></span><span>
</span><span id="line-788"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621681476699"><span class="annot"><span class="annottext">h :: ByteString
</span><a href="#local-6989586621681476699"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621681476698"><span class="annot"><span class="annottext">t :: [ByteString]
</span><a href="#local-6989586621681476698"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">X509CertChainPem -&gt; m X509CertChainPem
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(X509CertChainPem -&gt; m X509CertChainPem)
-&gt; X509CertChainPem -&gt; m X509CertChainPem
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">X509CertPem -&gt; [X509CertPem] -&gt; X509CertChainPem
</span><a href="Network.X509.SelfSigned.html#X509CertChainPem"><span class="hs-identifier hs-var">X509CertChainPem</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; X509CertPem
</span><a href="Network.X509.SelfSigned.html#X509CertPem"><span class="hs-identifier hs-var">X509CertPem</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621681476699"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; X509CertPem
</span><a href="Network.X509.SelfSigned.html#X509CertPem"><span class="hs-identifier hs-var">X509CertPem</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; X509CertPem) -&gt; [ByteString] -&gt; [X509CertPem]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621681476698"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-789"></span><span>
</span><span id="line-790"></span><span id="local-6989586621681476696"><span id="local-6989586621681476697"></span></span><span class="hs-keyword">data</span><span> </span><span id="X509CertChainPem"><span class="annot"><a href="Network.X509.SelfSigned.html#X509CertChainPem"><span class="hs-identifier hs-var">X509CertChainPem</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="X509CertChainPem"><span class="annot"><a href="Network.X509.SelfSigned.html#X509CertChainPem"><span class="hs-identifier hs-var">X509CertChainPem</span></a></span></span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#X509CertPem"><span class="hs-identifier hs-type">X509CertPem</span></a></span><span> </span><span class="hs-glyph">!</span><span class="hs-special">[</span><span class="annot"><a href="Network.X509.SelfSigned.html#X509CertPem"><span class="hs-identifier hs-type">X509CertPem</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-791"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681476690"><span id="local-6989586621681476692"><span id="local-6989586621681476694"><span class="annot"><span class="annottext">Int -&gt; X509CertChainPem -&gt; [Char] -&gt; [Char]
[X509CertChainPem] -&gt; [Char] -&gt; [Char]
X509CertChainPem -&gt; [Char]
(Int -&gt; X509CertChainPem -&gt; [Char] -&gt; [Char])
-&gt; (X509CertChainPem -&gt; [Char])
-&gt; ([X509CertChainPem] -&gt; [Char] -&gt; [Char])
-&gt; Show X509CertChainPem
forall a.
(Int -&gt; a -&gt; [Char] -&gt; [Char])
-&gt; (a -&gt; [Char]) -&gt; ([a] -&gt; [Char] -&gt; [Char]) -&gt; Show a
showList :: [X509CertChainPem] -&gt; [Char] -&gt; [Char]
$cshowList :: [X509CertChainPem] -&gt; [Char] -&gt; [Char]
show :: X509CertChainPem -&gt; [Char]
$cshow :: X509CertChainPem -&gt; [Char]
showsPrec :: Int -&gt; X509CertChainPem -&gt; [Char] -&gt; [Char]
$cshowsPrec :: Int -&gt; X509CertChainPem -&gt; [Char] -&gt; [Char]
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681476686"><span id="local-6989586621681476688"><span class="annot"><span class="annottext">X509CertChainPem -&gt; X509CertChainPem -&gt; Bool
(X509CertChainPem -&gt; X509CertChainPem -&gt; Bool)
-&gt; (X509CertChainPem -&gt; X509CertChainPem -&gt; Bool)
-&gt; Eq X509CertChainPem
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: X509CertChainPem -&gt; X509CertChainPem -&gt; Bool
$c/= :: X509CertChainPem -&gt; X509CertChainPem -&gt; Bool
== :: X509CertChainPem -&gt; X509CertChainPem -&gt; Bool
$c== :: X509CertChainPem -&gt; X509CertChainPem -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681476671"><span id="local-6989586621681476673"><span id="local-6989586621681476675"><span id="local-6989586621681476677"><span id="local-6989586621681476679"><span id="local-6989586621681476681"><span id="local-6989586621681476683"><span class="annot"><span class="annottext">Eq X509CertChainPem
Eq X509CertChainPem =&gt;
(X509CertChainPem -&gt; X509CertChainPem -&gt; Ordering)
-&gt; (X509CertChainPem -&gt; X509CertChainPem -&gt; Bool)
-&gt; (X509CertChainPem -&gt; X509CertChainPem -&gt; Bool)
-&gt; (X509CertChainPem -&gt; X509CertChainPem -&gt; Bool)
-&gt; (X509CertChainPem -&gt; X509CertChainPem -&gt; Bool)
-&gt; (X509CertChainPem -&gt; X509CertChainPem -&gt; X509CertChainPem)
-&gt; (X509CertChainPem -&gt; X509CertChainPem -&gt; X509CertChainPem)
-&gt; Ord X509CertChainPem
X509CertChainPem -&gt; X509CertChainPem -&gt; Bool
X509CertChainPem -&gt; X509CertChainPem -&gt; Ordering
X509CertChainPem -&gt; X509CertChainPem -&gt; X509CertChainPem
forall a.
Eq a =&gt;
(a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
min :: X509CertChainPem -&gt; X509CertChainPem -&gt; X509CertChainPem
$cmin :: X509CertChainPem -&gt; X509CertChainPem -&gt; X509CertChainPem
max :: X509CertChainPem -&gt; X509CertChainPem -&gt; X509CertChainPem
$cmax :: X509CertChainPem -&gt; X509CertChainPem -&gt; X509CertChainPem
&gt;= :: X509CertChainPem -&gt; X509CertChainPem -&gt; Bool
$c&gt;= :: X509CertChainPem -&gt; X509CertChainPem -&gt; Bool
&gt; :: X509CertChainPem -&gt; X509CertChainPem -&gt; Bool
$c&gt; :: X509CertChainPem -&gt; X509CertChainPem -&gt; Bool
&lt;= :: X509CertChainPem -&gt; X509CertChainPem -&gt; Bool
$c&lt;= :: X509CertChainPem -&gt; X509CertChainPem -&gt; Bool
&lt; :: X509CertChainPem -&gt; X509CertChainPem -&gt; Bool
$c&lt; :: X509CertChainPem -&gt; X509CertChainPem -&gt; Bool
compare :: X509CertChainPem -&gt; X509CertChainPem -&gt; Ordering
$ccompare :: X509CertChainPem -&gt; X509CertChainPem -&gt; Ordering
$cp1Ord :: Eq X509CertChainPem
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(forall x. X509CertChainPem -&gt; Rep X509CertChainPem x)
-&gt; (forall x. Rep X509CertChainPem x -&gt; X509CertChainPem)
-&gt; Generic X509CertChainPem
forall x. Rep X509CertChainPem x -&gt; X509CertChainPem
forall x. X509CertChainPem -&gt; Rep X509CertChainPem x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep X509CertChainPem x -&gt; X509CertChainPem
$cfrom :: forall x. X509CertChainPem -&gt; Rep X509CertChainPem x
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681476667"><span class="annot"><span class="annottext">X509CertChainPem -&gt; ()
(X509CertChainPem -&gt; ()) -&gt; NFData X509CertChainPem
forall a. (a -&gt; ()) -&gt; NFData a
rnf :: X509CertChainPem -&gt; ()
$crnf :: X509CertChainPem -&gt; ()
</span><a href="#local-6989586621681476667"><span class="hs-identifier hs-var hs-var hs-var hs-var">NFData</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-792"></span><span>
</span><span id="line-793"></span><span class="annot"><a href="Network.X509.SelfSigned.html#x509CertChainPemToText"><span class="hs-identifier hs-type">x509CertChainPemToText</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#X509CertChainPem"><span class="hs-identifier hs-type">X509CertChainPem</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span>
</span><span id="line-794"></span><span id="x509CertChainPemToText"><span class="annot"><span class="annottext">x509CertChainPemToText :: X509CertChainPem -&gt; Text
</span><a href="Network.X509.SelfSigned.html#x509CertChainPemToText"><span class="hs-identifier hs-var hs-var">x509CertChainPemToText</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.X509.SelfSigned.html#X509CertChainPem"><span class="hs-identifier hs-type">X509CertChainPem</span></a></span><span> </span><span id="local-6989586621681476666"><span class="annot"><span class="annottext">a :: X509CertPem
</span><a href="#local-6989586621681476666"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621681476665"><span class="annot"><span class="annottext">b :: [X509CertPem]
</span><a href="#local-6989586621681476665"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Text] -&gt; Text
</span><span class="hs-identifier hs-var">T.intercalate</span></span><span> </span><span class="annot"><span class="hs-string">&quot;\n&quot;</span></span><span>
</span><span id="line-795"></span><span>    </span><span class="annot"><span class="annottext">([Text] -&gt; Text) -&gt; [Text] -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">X509CertPem -&gt; Text
</span><a href="Network.X509.SelfSigned.html#x509CertPemToText"><span class="hs-identifier hs-var">x509CertPemToText</span></a></span><span> </span><span class="annot"><span class="annottext">X509CertPem
</span><a href="#local-6989586621681476666"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-796"></span><span>    </span><span class="annot"><span class="annottext">Text -&gt; [Text] -&gt; [Text]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">X509CertPem -&gt; Text
</span><a href="Network.X509.SelfSigned.html#x509CertPemToText"><span class="hs-identifier hs-var">x509CertPemToText</span></a></span><span> </span><span class="annot"><span class="annottext">(X509CertPem -&gt; Text) -&gt; [X509CertPem] -&gt; [Text]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[X509CertPem]
</span><a href="#local-6989586621681476665"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-797"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#x509CertChainPemToText"><span class="hs-pragma hs-type">x509CertChainPemToText</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-798"></span><span>
</span><span id="line-799"></span><span id="local-6989586621681476663"><span class="annot"><a href="Network.X509.SelfSigned.html#x509CertChainPemFromText"><span class="hs-identifier hs-type">x509CertChainPemFromText</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadThrow</span></span><span> </span><span class="annot"><a href="#local-6989586621681476663"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681476663"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#X509CertChainPem"><span class="hs-identifier hs-type">X509CertChainPem</span></a></span></span><span>
</span><span id="line-800"></span><span id="x509CertChainPemFromText"><span class="annot"><span class="annottext">x509CertChainPemFromText :: Text -&gt; m X509CertChainPem
</span><a href="Network.X509.SelfSigned.html#x509CertChainPemFromText"><span class="hs-identifier hs-var hs-var">x509CertChainPemFromText</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; m X509CertChainPem
forall (m :: * -&gt; *).
MonadThrow m =&gt;
ByteString -&gt; m X509CertChainPem
</span><a href="Network.X509.SelfSigned.html#parseCertChain"><span class="hs-identifier hs-var">parseCertChain</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; m X509CertChainPem)
-&gt; (Text -&gt; ByteString) -&gt; Text -&gt; m X509CertChainPem
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; ByteString
</span><span class="hs-identifier hs-var">T.encodeUtf8</span></span><span>
</span><span id="line-801"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#x509CertChainPemFromText"><span class="hs-pragma hs-type">x509CertChainPemFromText</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-802"></span><span>
</span><span id="line-803"></span><span class="annot"><a href="Network.X509.SelfSigned.html#unsafeX509CertChainPemFromText"><span class="hs-identifier hs-type">unsafeX509CertChainPemFromText</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#X509CertChainPem"><span class="hs-identifier hs-type">X509CertChainPem</span></a></span><span>
</span><span id="line-804"></span><span id="unsafeX509CertChainPemFromText"><span class="annot"><span class="annottext">unsafeX509CertChainPemFromText :: [Char] -&gt; X509CertChainPem
</span><a href="Network.X509.SelfSigned.html#unsafeX509CertChainPemFromText"><span class="hs-identifier hs-var hs-var">unsafeX509CertChainPemFromText</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; X509CertChainPem
forall a. (HasCallStack, HasTextRepresentation a) =&gt; Text -&gt; a
</span><a href="Chainweb.Utils.html#unsafeFromText"><span class="hs-identifier hs-var">unsafeFromText</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; X509CertChainPem)
-&gt; ([Char] -&gt; Text) -&gt; [Char] -&gt; X509CertChainPem
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span>
</span><span id="line-805"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#unsafeX509CertChainPemFromText"><span class="hs-pragma hs-type">unsafeX509CertChainPemFromText</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-806"></span><span>
</span><span id="line-807"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Chainweb.Utils.html#HasTextRepresentation"><span class="hs-identifier hs-type">HasTextRepresentation</span></a></span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#X509CertChainPem"><span class="hs-identifier hs-type">X509CertChainPem</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-808"></span><span>    </span><span id="local-6989586621681476659"><span class="annot"><span class="annottext">toText :: X509CertChainPem -&gt; Text
</span><a href="#local-6989586621681476659"><span class="hs-identifier hs-var hs-var hs-var hs-var">toText</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">X509CertChainPem -&gt; Text
</span><a href="Network.X509.SelfSigned.html#x509CertChainPemToText"><span class="hs-identifier hs-var">x509CertChainPemToText</span></a></span><span>
</span><span id="line-809"></span><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Chainweb.Utils.html#toText"><span class="hs-pragma hs-type">toText</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-810"></span><span>    </span><span id="local-6989586621681476658"><span class="annot"><span class="annottext">fromText :: Text -&gt; m X509CertChainPem
</span><a href="#local-6989586621681476658"><span class="hs-identifier hs-var hs-var hs-var hs-var">fromText</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; m X509CertChainPem
forall (m :: * -&gt; *). MonadThrow m =&gt; Text -&gt; m X509CertChainPem
</span><a href="Network.X509.SelfSigned.html#x509CertChainPemFromText"><span class="hs-identifier hs-var">x509CertChainPemFromText</span></a></span><span>
</span><span id="line-811"></span><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Chainweb.Utils.html#fromText"><span class="hs-pragma hs-type">fromText</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-812"></span><span>
</span><span id="line-813"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681476651"><span id="local-6989586621681476653"><span id="local-6989586621681476655"><span class="annot"><span class="hs-identifier hs-type">ToJSON</span></span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#X509CertChainPem"><span class="hs-identifier hs-type">X509CertChainPem</span></a></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-814"></span><span>    </span><span id="local-6989586621681476650"><span class="annot"><span class="annottext">toJSON :: X509CertChainPem -&gt; Value
</span><a href="#local-6989586621681476650"><span class="hs-identifier hs-var hs-var hs-var hs-var">toJSON</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Value
forall a. ToJSON a =&gt; a -&gt; Value
</span><span class="hs-identifier hs-var">toJSON</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Value)
-&gt; (X509CertChainPem -&gt; Text) -&gt; X509CertChainPem -&gt; Value
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">X509CertChainPem -&gt; Text
forall a. HasTextRepresentation a =&gt; a -&gt; Text
</span><a href="Chainweb.Utils.html#toText"><span class="hs-identifier hs-var">toText</span></a></span><span>
</span><span id="line-815"></span><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><span class="hs-pragma hs-type">toJSON</span></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-816"></span><span>
</span><span id="line-817"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681476647"><span class="annot"><span class="hs-identifier hs-type">FromJSON</span></span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#X509CertChainPem"><span class="hs-identifier hs-type">X509CertChainPem</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-818"></span><span>    </span><span id="local-6989586621681476646"><span class="annot"><span class="annottext">parseJSON :: Value -&gt; Parser X509CertChainPem
</span><a href="#local-6989586621681476646"><span class="hs-identifier hs-var hs-var hs-var hs-var">parseJSON</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Value -&gt; Parser X509CertChainPem
forall a. HasTextRepresentation a =&gt; [Char] -&gt; Value -&gt; Parser a
</span><a href="Chainweb.Utils.html#parseJsonFromText"><span class="hs-identifier hs-var">parseJsonFromText</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;X509CertChainPem&quot;</span></span><span>
</span><span id="line-819"></span><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><span class="hs-pragma hs-type">parseJSON</span></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-820"></span><span>
</span><span id="line-821"></span><span class="annot"><a href="Network.X509.SelfSigned.html#pX509CertChainPem"><span class="hs-identifier hs-type">pX509CertChainPem</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Chainweb.Utils.html#OptionParser"><span class="hs-identifier hs-type">OptionParser</span></a></span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#X509CertChainPem"><span class="hs-identifier hs-type">X509CertChainPem</span></a></span><span>
</span><span id="line-822"></span><span id="pX509CertChainPem"><span class="annot"><span class="annottext">pX509CertChainPem :: Maybe [Char] -&gt; OptionParser X509CertChainPem
</span><a href="Network.X509.SelfSigned.html#pX509CertChainPem"><span class="hs-identifier hs-var hs-var">pX509CertChainPem</span></a></span></span><span> </span><span id="local-6989586621681476645"><span class="annot"><span class="annottext">service :: Maybe [Char]
</span><a href="#local-6989586621681476645"><span class="hs-identifier hs-var">service</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Mod OptionFields X509CertChainPem -&gt; OptionParser X509CertChainPem
forall a. HasTextRepresentation a =&gt; Mod OptionFields a -&gt; Parser a
</span><a href="Chainweb.Utils.html#textOption"><span class="hs-identifier hs-var">textOption</span></a></span><span>
</span><span id="line-823"></span><span>    </span><span class="annot"><span class="annottext">(Mod OptionFields X509CertChainPem
 -&gt; OptionParser X509CertChainPem)
-&gt; Mod OptionFields X509CertChainPem
-&gt; OptionParser X509CertChainPem
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">Maybe [Char] -&gt; [Char] -&gt; Mod OptionFields X509CertChainPem
forall (f :: * -&gt; *) a.
HasName f =&gt;
Maybe [Char] -&gt; [Char] -&gt; Mod f a
</span><a href="Chainweb.Utils.html#prefixLong"><span class="hs-identifier hs-var">prefixLong</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe [Char]
</span><a href="#local-6989586621681476645"><span class="hs-identifier hs-var">service</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;certificate-chain&quot;</span></span><span>
</span><span id="line-824"></span><span>    </span><span class="annot"><span class="annottext">Mod OptionFields X509CertChainPem
-&gt; Mod OptionFields X509CertChainPem
-&gt; Mod OptionFields X509CertChainPem
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe [Char] -&gt; [Char] -&gt; Mod OptionFields X509CertChainPem
forall (f :: * -&gt; *) a. Maybe [Char] -&gt; [Char] -&gt; Mod f a
</span><a href="Chainweb.Utils.html#suffixHelp"><span class="hs-identifier hs-var">suffixHelp</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe [Char]
</span><a href="#local-6989586621681476645"><span class="hs-identifier hs-var">service</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;PEM encoded X509 certificate or certificate chain of the local peer&quot;</span></span><span>
</span><span id="line-825"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#pX509CertChainPem"><span class="hs-pragma hs-type">pX509CertChainPem</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-826"></span><span>
</span><span id="line-827"></span><span id="local-6989586621681476644"><span class="annot"><a href="Network.X509.SelfSigned.html#validateX509CertChainPem"><span class="hs-identifier hs-type">validateX509CertChainPem</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span> </span><span class="annot"><a href="#local-6989586621681476644"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Network.X509.SelfSigned.html#X509CertChainPem"><span class="hs-identifier hs-type">X509CertChainPem</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681476644"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-828"></span><span id="validateX509CertChainPem"><span class="annot"><span class="annottext">validateX509CertChainPem :: X509CertChainPem -&gt; m ()
</span><a href="Network.X509.SelfSigned.html#validateX509CertChainPem"><span class="hs-identifier hs-var hs-var">validateX509CertChainPem</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.X509.SelfSigned.html#X509CertChainPem"><span class="hs-identifier hs-type">X509CertChainPem</span></a></span><span> </span><span id="local-6989586621681476643"><span class="annot"><span class="annottext">a :: X509CertPem
</span><a href="#local-6989586621681476643"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621681476642"><span class="annot"><span class="annottext">b :: [X509CertPem]
</span><a href="#local-6989586621681476642"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-829"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">(X509CertPem -&gt; Either SomeException (SignedExact Certificate))
-&gt; [X509CertPem] -&gt; Either SomeException ()
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f ()
</span><span class="hs-identifier hs-var">traverse_</span></span><span> </span><span class="annot"><span class="annottext">X509CertPem -&gt; Either SomeException (SignedExact Certificate)
forall (m :: * -&gt; *).
MonadThrow m =&gt;
X509CertPem -&gt; m (SignedExact Certificate)
</span><a href="Network.X509.SelfSigned.html#decodePemX509Cert"><span class="hs-identifier hs-var">decodePemX509Cert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">X509CertPem
</span><a href="#local-6989586621681476643"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">X509CertPem -&gt; [X509CertPem] -&gt; [X509CertPem]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[X509CertPem]
</span><a href="#local-6989586621681476642"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-830"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621681476640"><span class="annot"><span class="annottext">e :: SomeException
</span><a href="#local-6989586621681476640"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; m ()
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; m ()) -&gt; Text -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SomeException -&gt; Text
forall a b. (Show a, IsString b) =&gt; a -&gt; b
</span><a href="Chainweb.Utils.html#sshow"><span class="hs-identifier hs-var">sshow</span></a></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621681476640"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-831"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; m ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-832"></span></pre></body></html>